\hypertarget{usb__pd__policy_8c}{\section{pd/usb\-\_\-pd\-\_\-policy.c File Reference}
\label{usb__pd__policy_8c}\index{pd/usb\-\_\-pd\-\_\-policy.\-c@{pd/usb\-\_\-pd\-\_\-policy.\-c}}
}
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-config.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-phy.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-interface.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-timer.\-h\char`\"{}}\\*
Include dependency graph for usb\-\_\-pd\-\_\-policy.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c__incl}
\end{center}
\end{figure}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct__psm__trigger__info}{\-\_\-psm\-\_\-trigger\-\_\-info}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{usb__pd__policy_8c_aa1cb572e01e6e6e53632c7996691bef0}{N\-\_\-\-C\-A\-P\-S\-\_\-\-C\-O\-U\-N\-T}~(50)
\item 
\#define \hyperlink{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{N\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T\-\_\-\-C\-O\-U\-N\-T}~(2)
\item 
\#define \hyperlink{usb__pd__policy_8c_a499898e85b1889f50250bff6505d2ed5}{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-R\-C\-\_\-\-C\-A\-P\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}~(23)
\item 
\#define \hyperlink{usb__pd__policy_8c_a3bde83665d64a1e3941edd01d0d67865}{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}~(3)
\item 
\#define \hyperlink{usb__pd__policy_8c_ae8642782a2afa1c649b7a4356229a635}{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-B\-A\-T\-T\-E\-R\-Y\-\_\-\-C\-A\-P\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}~(9)
\item 
\#define \hyperlink{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-B\-U\-F\-F\-E\-R}~((uint32\-\_\-t $\ast$)(\&(pd\-Instance-\/$>$received\-Data\mbox{[}1\mbox{]})))
\item 
\#define \hyperlink{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-H\-E\-A\-D\-E\-R}~(pd\-Instance-\/$>$received\-Data\mbox{[}0\mbox{]} $>$$>$ 16)
\item 
\#define \hyperlink{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{P\-D\-\_\-\-N\-O\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-\_\-\-R\-E\-P\-L\-Y\-\_\-\-M\-S\-G}~((pd\-Instance-\/$>$revision $>$= \hyperlink{group__usb__pd__stack_ga4be9f8c2d24914f46c855883891789e0}{P\-D\-\_\-\-S\-P\-E\-C\-\_\-\-R\-E\-V\-I\-S\-I\-O\-N\-\_\-30}) ? \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{k\-P\-D\-\_\-\-Msg\-Not\-Supported} \-: \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{k\-P\-D\-\_\-\-Msg\-Reject})
\item 
\#define \hyperlink{usb__pd__policy_8c_ab6ea63979d7a148dd6c0a3b4004464cb}{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-U\-F\-P\-\_\-\-C\-A\-B\-L\-E\-\_\-\-P\-L\-U\-G\-\_\-\-T\-Y\-P\-E\-\_\-\-M\-A\-S\-K}~(0x38000000u)
\item 
\#define \hyperlink{usb__pd__policy_8c_a4fcc820cacf5ba9d5d511fe24e451c84}{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-P\-A\-S\-S\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}~(0x18000000u)
\item 
\#define \hyperlink{usb__pd__policy_8c_a48b38de5a1d0283eb28b6b681dcfb897}{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}~(0x20000000u)
\item 
\#define \hyperlink{usb__pd__policy_8c_a9d46ce58619ca7eb83acffcb676b509a}{V\-D\-M\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-D\-O\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-C\-A\-P\-A\-B\-I\-L\-I\-T\-Y}~(0x00000060u)
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef enum \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169f}{\-\_\-trigger\-\_\-event} \hyperlink{usb__pd__policy_8c_a12264f4dd9ec181a02f7b659aedebe52}{trigger\-\_\-event\-\_\-t}
\item 
typedef struct \hyperlink{struct__psm__trigger__info}{\-\_\-psm\-\_\-trigger\-\_\-info} \hyperlink{usb__pd__policy_8c_a902c7797d01630122934bdbf84e2cb3b}{psm\-\_\-trigger\-\_\-info\-\_\-t}
\item 
typedef enum \\*
\hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119}{\-\_\-pd\-\_\-state\-\_\-machine\-\_\-state} \hyperlink{usb__pd__policy_8c_ae26d1cc8c96d3a46f84955c58438edbc}{pd\-\_\-state\-\_\-machine\-\_\-state\-\_\-t}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169f}{\-\_\-trigger\-\_\-event} \{ \\*
\hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-E}, 
\hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa4a98effc36f9ecea5ec74a115571da10}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-\_\-\-S\-T\-A\-R\-T}, 
\hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-D\-P\-M\-\_\-\-M\-S\-G}, 
\hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-P\-D\-\_\-\-M\-S\-G}, 
\\*
\hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fad322f67900d1d0c0a1b685ad33522c3e}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-R\-E\-C\-E\-I\-V\-E\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T}
 \}
\item 
enum \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119}{\-\_\-pd\-\_\-state\-\_\-machine\-\_\-state} \{ \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a0db9773d8c18493ddff27ea9c3fc80f2}{k\-S\-M\-\_\-\-None} = 0, 
\hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{k\-S\-M\-\_\-\-Continue}, 
\hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a7cacf9f3344176be4f627e097c8fa5ff}{k\-S\-M\-\_\-\-Wait\-Event}, 
\hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}{k\-S\-M\-\_\-\-Error\-Recovery}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{P\-D\-\_\-\-Psm\-Start\-Command} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t command, uint8\-\_\-t is\-Initiator)
\item 
void \hyperlink{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653}{P\-D\-\_\-\-Msg\-Reset} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a4c31fc7951e54e4e153f64d3a8e229ef}{P\-D\-\_\-\-Msg\-Disable} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{P\-D\-\_\-\-Msg\-Set\-Port\-Role} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t power\-Role, uint8\-\_\-t data\-Role)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}{P\-D\-\_\-\-Msg\-Wait\-Send\-Result} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_a1bc0b8a0146a3a133023eda572e3adc7}{P\-D\-\_\-\-Msg\-Send\-Structured\-V\-D\-M\-And\-Wait} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\-\_\-of\-\_\-packet\-\_\-t} sop, \hyperlink{group__usb__pd__stack_ga245b8bec3f3b7771e73016ac98595570}{pd\-\_\-structured\-\_\-vdm\-\_\-header\-\_\-t} reponse\-Vdm\-Header, uint8\-\_\-t count, uint32\-\_\-t $\ast$vdos)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_ab97edd8ad822d84ac4c3c60716d949e6}{P\-D\-\_\-\-Msg\-Send\-Hard\-Reset} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d}{P\-D\-\_\-\-Msg\-Send} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\-\_\-of\-\_\-packet\-\_\-t} sop, \hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\-\_\-type\-\_\-t} msg\-Type, uint32\-\_\-t data\-Length, uint8\-\_\-t $\ast$data\-Buffer)
\item 
void \hyperlink{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{P\-D\-\_\-\-Msg\-Receive} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a76b0f4cfb65f3523c10e8e472f42d9c4}{P\-D\-\_\-\-Msg\-Stop\-Receive} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a6ab430500b707d49e6f44a32e91d1aa9}{P\-D\-\_\-\-Msg\-Start\-Receive} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a19c2d2c30e1d818cf1b730f60f866f44}{P\-D\-\_\-\-Msg\-Get\-Receive\-Result} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4}{P\-D\-\_\-\-Msg\-Recv\-Pending} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a3d563de469ea4f02119bc23fa5a55f6c}{P\-D\-\_\-\-Dpm\-Src\-Transition\-To\-Newpwr} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga4dcb1103574222cf94d4b45128f2b884}{pd\-\_\-rdo\-\_\-t} rdo, uint8\-\_\-t goto\-Min)
\begin{DoxyCompactList}\small\item\em The P\-S\-M has accepted a new power contract as source. \end{DoxyCompactList}\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_ade792f3a5e9ffb477a9598ad4a3fb697}{P\-D\-\_\-\-Dpm\-Check\-Vbus} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}{P\-D\-\_\-\-Dpm\-Check\-Less\-Or\-Equal\-Vsafe5v} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e}{P\-D\-\_\-\-Dpm\-Check\-Vsafe0\-V} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_afe9fa5f2f570274127c5a163adb5cd90}{P\-D\-\_\-\-Dpm\-Get\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a8478bb46d180cbe30f733a859d18547f}{P\-D\-\_\-\-Dpm\-Clear\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga91457cf9522e345a0efa2e2a7424bb0d}{pd\-\_\-command\-\_\-t} id)
\item 
void \hyperlink{usb__pd__policy_8c_a4f173065c59e2f188edd90264410c503}{P\-D\-\_\-\-Dpm\-Send\-Msg} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint8\-\_\-t id)
\item 
void \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{P\-D\-\_\-\-Connect\-Set\-Power\-Progress} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t state)
\item 
void \hyperlink{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344}{P\-D\-\_\-\-Dpm\-Disconnect} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_aef67884d9408a328e52733a0535109e1}{P\-D\-\_\-\-Msg\-Send\-Request\-Chunk\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\-\_\-of\-\_\-packet\-\_\-t} sop, \hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\-\_\-type\-\_\-t} ext\-Msg\-Type, \hyperlink{group__usb__pd__stack_gaac1fc676553ba20dd1712a8c7a63a3b0}{pd\-\_\-extended\-\_\-msg\-\_\-header\-\_\-t} ext\-Header)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_aad334e14a1b8c980ae68a9978a46daa5}{P\-D\-\_\-\-Msg\-Send\-Extended\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\-\_\-of\-\_\-packet\-\_\-t} sop, \hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\-\_\-type\-\_\-t} ext\-Msg\-Type, uint32\-\_\-t data\-Length, uint8\-\_\-t $\ast$data\-Buffer)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a}{P\-D\-\_\-\-Msg\-Send\-Chunked\-Extended\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\-\_\-of\-\_\-packet\-\_\-t} sop, \hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\-\_\-type\-\_\-t} ext\-Msg\-Type, \hyperlink{group__usb__pd__stack_gaac1fc676553ba20dd1712a8c7a63a3b0}{pd\-\_\-extended\-\_\-msg\-\_\-header\-\_\-t} ext\-Header, uint32\-\_\-t data\-Length, uint8\-\_\-t $\ast$data\-Buffer)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_aafe1563428401cff5a9f430cba8043e1}{P\-D\-\_\-\-Msg\-Send\-Unchunked\-Extended\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\-\_\-of\-\_\-packet\-\_\-t} sop, \hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\-\_\-type\-\_\-t} ext\-Msg\-Type, uint32\-\_\-t data\-Length, uint8\-\_\-t $\ast$data\-Buffer)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_a19872ab9fb1085c5425f9e0d15b0395a}{P\-D\-\_\-\-Msg\-Send\-Unstructured\-V\-D\-M} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\-\_\-of\-\_\-packet\-\_\-t} sop, uint8\-\_\-t $\ast$data\-Buffer, uint32\-\_\-t data\-Length)
\item 
void \hyperlink{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa}{P\-D\-\_\-\-Dpm\-Discharge\-Vbus} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t enable)
\item 
void \hyperlink{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4}{P\-D\-\_\-\-Connect\-Init\-Role} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint32\-\_\-t typec\-Role, uint8\-\_\-t error\-Recovery)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a25116c60801fe4f4def90e3e42614b54}{P\-D\-\_\-\-Connect\-Check} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
\hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338}{Type\-C\-State\-\_\-t} \hyperlink{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02}{P\-D\-\_\-\-Connect\-Get\-State\-Machine} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_af415d8897be39b06937aa0c1316abca9}{P\-D\-\_\-\-Connect\-Alt\-Mode\-Enter\-Fail} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t pd\-Connected)
\item 
void \hyperlink{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a}{P\-D\-\_\-\-Dpm\-Set\-Vconn} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t enable)
\item 
void \hyperlink{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe}{P\-D\-\_\-\-Connect\-Set\-P\-R\-Swap\-Role} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t power\-Role)
\item 
void \hyperlink{usb__pd__policy_8c_a90012fae056618ce9b4431bd004a852a}{P\-D\-\_\-\-Msg\-Src\-End\-Command} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{P\-D\-\_\-\-Dpm\-App\-Callback} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint32\-\_\-t event, void $\ast$param, uint8\-\_\-t done)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{P\-D\-\_\-\-Phy\-Control} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint32\-\_\-t control, void $\ast$param)
\item 
void \hyperlink{usb__pd__policy_8c_a0dee3662096589c64561a02b662b602a}{P\-D\-\_\-\-Dpm\-Discharge\-Vconn} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t enable)
\item 
\hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338}{Type\-C\-State\-\_\-t} \hyperlink{usb__pd__policy_8c_aa173143bdf6b1a4a301e5576b364d5d6}{P\-D\-\_\-\-Connect\-Get\-Init\-Role\-State} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint32\-\_\-t typec\-Role)
\item 
static void \hyperlink{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046}{P\-D\-\_\-\-Psm\-Command\-Fail} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t command)
\item 
static void \hyperlink{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c}{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Error} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t interrupted\-State, \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\-\_\-psm\-\_\-state\-\_\-t} error\-State)
\begin{DoxyCompactList}\small\item\em Function to simplify the error handling of message transmit. \end{DoxyCompactList}\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{P\-D\-\_\-\-Msg\-Send\-Control\-Transition} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t msg\-Type, \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\-\_\-psm\-\_\-state\-\_\-t} success\-Next\-State, uint8\-\_\-t interrupted\-State, \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\-\_\-psm\-\_\-state\-\_\-t} error\-State)
\item 
static void \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Control} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t msg\-Type, \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\-\_\-psm\-\_\-state\-\_\-t} success\-Next\-State)
\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{P\-D\-\_\-\-Msg\-Send\-Data\-Transition} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t msg\-Type, uint32\-\_\-t do\-Count, uint32\-\_\-t $\ast$dos, \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\-\_\-psm\-\_\-state\-\_\-t} success\-Next\-State, uint8\-\_\-t interrupted\-State, \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\-\_\-psm\-\_\-state\-\_\-t} error\-State)
\item 
static void \hyperlink{usb__pd__policy_8c_ac674e40520a08c8895ec4e852a3751c7}{P\-D\-\_\-\-Psm\-Set\-Normal\-Power} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t psm\-State)
\item 
static void \hyperlink{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61}{P\-D\-\_\-\-Psm\-Reset} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_ad25940850feb762e329a32f90726c59a}{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Dpm\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t $\ast$return\-New\-State, \hyperlink{usb__pd__policy_8c_a902c7797d01630122934bdbf84e2cb3b}{psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$trigger\-Info)
\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_a094d9150746a4bc943e34a883ed51c38}{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Pd\-Msg} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t $\ast$return\-New\-State, \hyperlink{usb__pd__policy_8c_a902c7797d01630122934bdbf84e2cb3b}{psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$trigger\-Info)
\item 
void \hyperlink{usb__pd__policy_8c_a39aa541f6a8e3843b3ab18fdcf533768}{P\-D\-\_\-\-Port\-Task\-Event\-Process} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint32\-\_\-t event\-Set)
\item 
static void \hyperlink{usb__pd__policy_8c_a9bfe23523b40ee86c423c43291017cc5}{P\-D\-\_\-\-Psm\-End\-Command} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t psm\-State)
\item 
static void \hyperlink{usb__pd__policy_8c_ac96632daf46a82db5a695cdc2d647371}{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Dpm\-Message} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{usb__pd__policy_8c_a902c7797d01630122934bdbf84e2cb3b}{psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$trigger\-Info)
\item 
static void \hyperlink{usb__pd__policy_8c_a82a9479341ca58d919f5f5df53647dea}{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Pd\-Message} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, \hyperlink{usb__pd__policy_8c_a902c7797d01630122934bdbf84e2cb3b}{psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$trigger\-Info)
\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_aa84db2763770b08d1dd666c12e4ec45b}{P\-D\-\_\-\-Psm\-Can\-Pending\-Receive} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_ac46d497d9fc03b0096c2977f6a203e02}{P\-D\-\_\-\-Psm\-Process\-State} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
static uint8\-\_\-t \hyperlink{usb__pd__policy_8c_afbd2eb3bceb62f29229f0bff6eed6844}{P\-D\-\_\-\-Psm\-Enter\-State} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
static void \hyperlink{usb__pd__policy_8c_aec90d4fab260652b95f5027a080bff6b}{P\-D\-\_\-\-Psm\-Connect} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
static void \hyperlink{usb__pd__policy_8c_aa2694544089f6e2d123810cd48b27d6e}{P\-D\-\_\-\-Psm\-Disconnect} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a150b2573c8bfe54de3d77cd020d85bc0}{P\-D\-\_\-\-Dpm\-Connect} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
uint8\-\_\-t \hyperlink{usb__pd__policy_8c_ac6e31fa3949c6ca1288f96b6c5252bba}{P\-D\-\_\-\-Psm\-State\-Machine} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
void \hyperlink{usb__pd__policy_8c_a602f8622c0ba8d21b5013537dd3dadf9}{P\-D\-\_\-\-Stack\-State\-Machine} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{group__usb__pd__stack_gaa61d0ac40ef36db1ef5a88532f6eea90}{P\-D\-\_\-\-Command} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint32\-\_\-t command, void $\ast$param)
\begin{DoxyCompactList}\small\item\em start up P\-D command. \end{DoxyCompactList}\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{group__usb__pd__stack_gac3d77e334213f541028d2da518086ca2}{P\-D\-\_\-\-Control} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint32\-\_\-t control\-Code, void $\ast$param)
\begin{DoxyCompactList}\small\item\em Control P\-D stack and get info from P\-D stack. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-B\-U\-F\-F\-E\-R@{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-B\-U\-F\-F\-E\-R}}
\index{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-B\-U\-F\-F\-E\-R@{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-B\-U\-F\-F\-E\-R}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-B\-U\-F\-F\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-B\-U\-F\-F\-E\-R~((uint32\-\_\-t $\ast$)(\&(pd\-Instance-\/$>$received\-Data\mbox{[}1\mbox{]})))}}\label{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}
\hypertarget{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-H\-E\-A\-D\-E\-R@{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-H\-E\-A\-D\-E\-R}}
\index{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-H\-E\-A\-D\-E\-R@{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-H\-E\-A\-D\-E\-R}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-H\-E\-A\-D\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-H\-E\-A\-D\-E\-R~(pd\-Instance-\/$>$received\-Data\mbox{[}0\mbox{]} $>$$>$ 16)}}\label{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}
\hypertarget{usb__pd__policy_8c_aa1cb572e01e6e6e53632c7996691bef0}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!N\-\_\-\-C\-A\-P\-S\-\_\-\-C\-O\-U\-N\-T@{N\-\_\-\-C\-A\-P\-S\-\_\-\-C\-O\-U\-N\-T}}
\index{N\-\_\-\-C\-A\-P\-S\-\_\-\-C\-O\-U\-N\-T@{N\-\_\-\-C\-A\-P\-S\-\_\-\-C\-O\-U\-N\-T}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{N\-\_\-\-C\-A\-P\-S\-\_\-\-C\-O\-U\-N\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\-\_\-\-C\-A\-P\-S\-\_\-\-C\-O\-U\-N\-T~(50)}}\label{usb__pd__policy_8c_aa1cb572e01e6e6e53632c7996691bef0}
\hypertarget{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!N\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T\-\_\-\-C\-O\-U\-N\-T@{N\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T\-\_\-\-C\-O\-U\-N\-T}}
\index{N\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T\-\_\-\-C\-O\-U\-N\-T@{N\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T\-\_\-\-C\-O\-U\-N\-T}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{N\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T\-\_\-\-C\-O\-U\-N\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T\-\_\-\-C\-O\-U\-N\-T~(2)}}\label{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}
\hypertarget{usb__pd__policy_8c_ae8642782a2afa1c649b7a4356229a635}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-B\-A\-T\-T\-E\-R\-Y\-\_\-\-C\-A\-P\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H@{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-B\-A\-T\-T\-E\-R\-Y\-\_\-\-C\-A\-P\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-B\-A\-T\-T\-E\-R\-Y\-\_\-\-C\-A\-P\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H@{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-B\-A\-T\-T\-E\-R\-Y\-\_\-\-C\-A\-P\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-B\-A\-T\-T\-E\-R\-Y\-\_\-\-C\-A\-P\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-B\-A\-T\-T\-E\-R\-Y\-\_\-\-C\-A\-P\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H~(9)}}\label{usb__pd__policy_8c_ae8642782a2afa1c649b7a4356229a635}
\hypertarget{usb__pd__policy_8c_a499898e85b1889f50250bff6505d2ed5}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-R\-C\-\_\-\-C\-A\-P\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H@{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-R\-C\-\_\-\-C\-A\-P\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-R\-C\-\_\-\-C\-A\-P\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H@{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-R\-C\-\_\-\-C\-A\-P\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-R\-C\-\_\-\-C\-A\-P\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-R\-C\-\_\-\-C\-A\-P\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H~(23)}}\label{usb__pd__policy_8c_a499898e85b1889f50250bff6505d2ed5}
\hypertarget{usb__pd__policy_8c_a3bde83665d64a1e3941edd01d0d67865}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H@{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H@{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-D\-\_\-\-E\-X\-T\-E\-N\-D\-E\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-M\-S\-G\-\_\-\-D\-A\-T\-A\-\_\-\-L\-E\-N\-G\-T\-H~(3)}}\label{usb__pd__policy_8c_a3bde83665d64a1e3941edd01d0d67865}
\hypertarget{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-N\-O\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-\_\-\-R\-E\-P\-L\-Y\-\_\-\-M\-S\-G@{P\-D\-\_\-\-N\-O\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-\_\-\-R\-E\-P\-L\-Y\-\_\-\-M\-S\-G}}
\index{P\-D\-\_\-\-N\-O\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-\_\-\-R\-E\-P\-L\-Y\-\_\-\-M\-S\-G@{P\-D\-\_\-\-N\-O\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-\_\-\-R\-E\-P\-L\-Y\-\_\-\-M\-S\-G}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-N\-O\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-\_\-\-R\-E\-P\-L\-Y\-\_\-\-M\-S\-G}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-D\-\_\-\-N\-O\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-\_\-\-R\-E\-P\-L\-Y\-\_\-\-M\-S\-G~((pd\-Instance-\/$>$revision $>$= {\bf P\-D\-\_\-\-S\-P\-E\-C\-\_\-\-R\-E\-V\-I\-S\-I\-O\-N\-\_\-30}) ? {\bf k\-P\-D\-\_\-\-Msg\-Not\-Supported} \-: {\bf k\-P\-D\-\_\-\-Msg\-Reject})}}\label{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}
\hypertarget{usb__pd__policy_8c_a9d46ce58619ca7eb83acffcb676b509a}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!V\-D\-M\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-D\-O\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-C\-A\-P\-A\-B\-I\-L\-I\-T\-Y@{V\-D\-M\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-D\-O\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-C\-A\-P\-A\-B\-I\-L\-I\-T\-Y}}
\index{V\-D\-M\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-D\-O\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-C\-A\-P\-A\-B\-I\-L\-I\-T\-Y@{V\-D\-M\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-D\-O\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-C\-A\-P\-A\-B\-I\-L\-I\-T\-Y}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{V\-D\-M\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-D\-O\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-C\-A\-P\-A\-B\-I\-L\-I\-T\-Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-D\-M\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-D\-O\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-C\-A\-P\-A\-B\-I\-L\-I\-T\-Y~(0x00000060u)}}\label{usb__pd__policy_8c_a9d46ce58619ca7eb83acffcb676b509a}
\hypertarget{usb__pd__policy_8c_a48b38de5a1d0283eb28b6b681dcfb897}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L@{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}}
\index{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L@{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L~(0x20000000u)}}\label{usb__pd__policy_8c_a48b38de5a1d0283eb28b6b681dcfb897}
\hypertarget{usb__pd__policy_8c_a4fcc820cacf5ba9d5d511fe24e451c84}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-P\-A\-S\-S\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L@{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-P\-A\-S\-S\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}}
\index{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-P\-A\-S\-S\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L@{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-P\-A\-S\-S\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-P\-A\-S\-S\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-P\-A\-S\-S\-I\-V\-E\-\_\-\-C\-A\-B\-L\-E\-\_\-\-V\-A\-L~(0x18000000u)}}\label{usb__pd__policy_8c_a4fcc820cacf5ba9d5d511fe24e451c84}
\hypertarget{usb__pd__policy_8c_ab6ea63979d7a148dd6c0a3b4004464cb}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-U\-F\-P\-\_\-\-C\-A\-B\-L\-E\-\_\-\-P\-L\-U\-G\-\_\-\-T\-Y\-P\-E\-\_\-\-M\-A\-S\-K@{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-U\-F\-P\-\_\-\-C\-A\-B\-L\-E\-\_\-\-P\-L\-U\-G\-\_\-\-T\-Y\-P\-E\-\_\-\-M\-A\-S\-K}}
\index{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-U\-F\-P\-\_\-\-C\-A\-B\-L\-E\-\_\-\-P\-L\-U\-G\-\_\-\-T\-Y\-P\-E\-\_\-\-M\-A\-S\-K@{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-U\-F\-P\-\_\-\-C\-A\-B\-L\-E\-\_\-\-P\-L\-U\-G\-\_\-\-T\-Y\-P\-E\-\_\-\-M\-A\-S\-K}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-U\-F\-P\-\_\-\-C\-A\-B\-L\-E\-\_\-\-P\-L\-U\-G\-\_\-\-T\-Y\-P\-E\-\_\-\-M\-A\-S\-K}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-D\-M\-\_\-\-I\-D\-\_\-\-H\-E\-A\-D\-E\-R\-\_\-\-V\-D\-O\-\_\-\-U\-F\-P\-\_\-\-C\-A\-B\-L\-E\-\_\-\-P\-L\-U\-G\-\_\-\-T\-Y\-P\-E\-\_\-\-M\-A\-S\-K~(0x38000000u)}}\label{usb__pd__policy_8c_ab6ea63979d7a148dd6c0a3b4004464cb}


\subsection{Typedef Documentation}
\hypertarget{usb__pd__policy_8c_ae26d1cc8c96d3a46f84955c58438edbc}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!pd\-\_\-state\-\_\-machine\-\_\-state\-\_\-t@{pd\-\_\-state\-\_\-machine\-\_\-state\-\_\-t}}
\index{pd\-\_\-state\-\_\-machine\-\_\-state\-\_\-t@{pd\-\_\-state\-\_\-machine\-\_\-state\-\_\-t}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{pd\-\_\-state\-\_\-machine\-\_\-state\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef enum {\bf \-\_\-pd\-\_\-state\-\_\-machine\-\_\-state}  {\bf pd\-\_\-state\-\_\-machine\-\_\-state\-\_\-t}}}\label{usb__pd__policy_8c_ae26d1cc8c96d3a46f84955c58438edbc}
\hypertarget{usb__pd__policy_8c_a902c7797d01630122934bdbf84e2cb3b}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!psm\-\_\-trigger\-\_\-info\-\_\-t@{psm\-\_\-trigger\-\_\-info\-\_\-t}}
\index{psm\-\_\-trigger\-\_\-info\-\_\-t@{psm\-\_\-trigger\-\_\-info\-\_\-t}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{psm\-\_\-trigger\-\_\-info\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf \-\_\-psm\-\_\-trigger\-\_\-info}  {\bf psm\-\_\-trigger\-\_\-info\-\_\-t}}}\label{usb__pd__policy_8c_a902c7797d01630122934bdbf84e2cb3b}
\hypertarget{usb__pd__policy_8c_a12264f4dd9ec181a02f7b659aedebe52}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!trigger\-\_\-event\-\_\-t@{trigger\-\_\-event\-\_\-t}}
\index{trigger\-\_\-event\-\_\-t@{trigger\-\_\-event\-\_\-t}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{trigger\-\_\-event\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef enum {\bf \-\_\-trigger\-\_\-event}  {\bf trigger\-\_\-event\-\_\-t}}}\label{usb__pd__policy_8c_a12264f4dd9ec181a02f7b659aedebe52}


\subsection{Enumeration Type Documentation}
\hypertarget{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!\-\_\-pd\-\_\-state\-\_\-machine\-\_\-state@{\-\_\-pd\-\_\-state\-\_\-machine\-\_\-state}}
\index{\-\_\-pd\-\_\-state\-\_\-machine\-\_\-state@{\-\_\-pd\-\_\-state\-\_\-machine\-\_\-state}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{\-\_\-pd\-\_\-state\-\_\-machine\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf \-\_\-pd\-\_\-state\-\_\-machine\-\_\-state}}}\label{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{k\-S\-M\-\_\-\-None@{k\-S\-M\-\_\-\-None}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!k\-S\-M\-\_\-\-None@{k\-S\-M\-\_\-\-None}}\item[{\em 
\hypertarget{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a0db9773d8c18493ddff27ea9c3fc80f2}{k\-S\-M\-\_\-\-None}\label{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a0db9773d8c18493ddff27ea9c3fc80f2}
}]\index{k\-S\-M\-\_\-\-Continue@{k\-S\-M\-\_\-\-Continue}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!k\-S\-M\-\_\-\-Continue@{k\-S\-M\-\_\-\-Continue}}\item[{\em 
\hypertarget{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{k\-S\-M\-\_\-\-Continue}\label{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}
}]\index{k\-S\-M\-\_\-\-Wait\-Event@{k\-S\-M\-\_\-\-Wait\-Event}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!k\-S\-M\-\_\-\-Wait\-Event@{k\-S\-M\-\_\-\-Wait\-Event}}\item[{\em 
\hypertarget{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a7cacf9f3344176be4f627e097c8fa5ff}{k\-S\-M\-\_\-\-Wait\-Event}\label{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a7cacf9f3344176be4f627e097c8fa5ff}
}]\index{k\-S\-M\-\_\-\-Error\-Recovery@{k\-S\-M\-\_\-\-Error\-Recovery}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!k\-S\-M\-\_\-\-Error\-Recovery@{k\-S\-M\-\_\-\-Error\-Recovery}}\item[{\em 
\hypertarget{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}{k\-S\-M\-\_\-\-Error\-Recovery}\label{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}
}]\end{description}
\end{Desc}

\begin{DoxyCode}
83 \{
84     \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a0db9773d8c18493ddff27ea9c3fc80f2}{kSM\_None} = 0,
85     \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{kSM\_Continue},
86     \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a7cacf9f3344176be4f627e097c8fa5ff}{kSM\_WaitEvent},
87     \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}{kSM\_ErrorRecovery},
88 \} \hyperlink{usb__pd__policy_8c_ae26d1cc8c96d3a46f84955c58438edbc}{pd\_state\_machine\_state\_t};
\end{DoxyCode}
\hypertarget{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169f}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!\-\_\-trigger\-\_\-event@{\-\_\-trigger\-\_\-event}}
\index{\-\_\-trigger\-\_\-event@{\-\_\-trigger\-\_\-event}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{\-\_\-trigger\-\_\-event}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf \-\_\-trigger\-\_\-event}}}\label{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169f}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-E@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-E}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-E@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-E}}\item[{\em 
\hypertarget{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-E}\label{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}
}]\index{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-\_\-\-S\-T\-A\-R\-T@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-\_\-\-S\-T\-A\-R\-T}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-\_\-\-S\-T\-A\-R\-T@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-\_\-\-S\-T\-A\-R\-T}}\item[{\em 
\hypertarget{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa4a98effc36f9ecea5ec74a115571da10}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-N\-O\-N\-\_\-\-S\-T\-A\-R\-T}\label{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa4a98effc36f9ecea5ec74a115571da10}
}]\index{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-D\-P\-M\-\_\-\-M\-S\-G@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-D\-P\-M\-\_\-\-M\-S\-G}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-D\-P\-M\-\_\-\-M\-S\-G@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-D\-P\-M\-\_\-\-M\-S\-G}}\item[{\em 
\hypertarget{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-D\-P\-M\-\_\-\-M\-S\-G}\label{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}
}]\index{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-P\-D\-\_\-\-M\-S\-G@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-P\-D\-\_\-\-M\-S\-G}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-P\-D\-\_\-\-M\-S\-G@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-P\-D\-\_\-\-M\-S\-G}}\item[{\em 
\hypertarget{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-P\-D\-\_\-\-M\-S\-G}\label{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}
}]\index{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-R\-E\-C\-E\-I\-V\-E\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-R\-E\-C\-E\-I\-V\-E\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T}!usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}}\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-R\-E\-C\-E\-I\-V\-E\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T@{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-R\-E\-C\-E\-I\-V\-E\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T}}\item[{\em 
\hypertarget{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fad322f67900d1d0c0a1b685ad33522c3e}{P\-S\-M\-\_\-\-T\-R\-I\-G\-G\-E\-R\-\_\-\-R\-E\-C\-E\-I\-V\-E\-\_\-\-H\-A\-R\-D\-\_\-\-R\-E\-S\-E\-T}\label{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fad322f67900d1d0c0a1b685ad33522c3e}
}]\end{description}
\end{Desc}

\begin{DoxyCode}
58 \{
59     \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE},
60     \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa4a98effc36f9ecea5ec74a115571da10}{PSM\_TRIGGER\_NON\_START},
61     \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{PSM\_TRIGGER\_DPM\_MSG},
62     \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG},
63     \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fad322f67900d1d0c0a1b685ad33522c3e}{PSM\_TRIGGER\_RECEIVE\_HARD\_RESET},
64 \} \hyperlink{usb__pd__policy_8c_a12264f4dd9ec181a02f7b659aedebe52}{trigger\_event\_t};
\end{DoxyCode}


\subsection{Function Documentation}
\hypertarget{usb__pd__policy_8c_af415d8897be39b06937aa0c1316abca9}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Connect\-Alt\-Mode\-Enter\-Fail@{P\-D\-\_\-\-Connect\-Alt\-Mode\-Enter\-Fail}}
\index{P\-D\-\_\-\-Connect\-Alt\-Mode\-Enter\-Fail@{P\-D\-\_\-\-Connect\-Alt\-Mode\-Enter\-Fail}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Connect\-Alt\-Mode\-Enter\-Fail}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Connect\-Alt\-Mode\-Enter\-Fail (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{pd\-Connected}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_af415d8897be39b06937aa0c1316abca9}

\begin{DoxyCode}
1766 \{
1767     \textcolor{keywordflow}{if} (pdConnected)
1768     \{
1769         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} == 
      \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a52743b32e531cf3605d534ae3d2bf014}{TYPEC\_POWERED\_ACCESSORY})
1770         \{
1771             pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} = 
      \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a33dafd4e9c965a76d5bb1ac199374a5d}{TYPEC\_UNSUPPORTED\_ACCESSORY};
1772             \hyperlink{usb__pd__connect_8c_a0608faf2438b33700fc4680061ae69ab}{PD\_ConnectSetupNewState}(pdInstance, 0);
1773         \}
1774     \}
1775     \textcolor{keywordflow}{else}
1776     \{
1777         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} == 
      \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a52743b32e531cf3605d534ae3d2bf014}{TYPEC\_POWERED\_ACCESSORY})
1778         \{
1779             pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a98e3fb19049ca9cde6495dd9f803e1bf}{TYPEC\_UNATTACHED\_SNK};
1780             \hyperlink{usb__pd__connect_8c_a0608faf2438b33700fc4680061ae69ab}{PD\_ConnectSetupNewState}(pdInstance, 0);
1781         \}
1782     \}
1783 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_af415d8897be39b06937aa0c1316abca9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_af415d8897be39b06937aa0c1316abca9_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a25116c60801fe4f4def90e3e42614b54}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Connect\-Check@{P\-D\-\_\-\-Connect\-Check}}
\index{P\-D\-\_\-\-Connect\-Check@{P\-D\-\_\-\-Connect\-Check}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Connect\-Check}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Connect\-Check (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a25116c60801fe4f4def90e3e42614b54}

\begin{DoxyCode}
1786 \{
1787     \hyperlink{usb__pd__connect_8c_a6147b33e99b7812c8de585d73af2f2c4}{PD\_ConnectStateMachine}(pdInstance);
1788     \textcolor{keywordflow}{return} \hyperlink{usb__pd__connect_8c_ab61b3d8329ec92553e670b6b0997fa81}{PD\_ConnectState}(pdInstance);
1789 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a25116c60801fe4f4def90e3e42614b54_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a25116c60801fe4f4def90e3e42614b54_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aa173143bdf6b1a4a301e5576b364d5d6}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Connect\-Get\-Init\-Role\-State@{P\-D\-\_\-\-Connect\-Get\-Init\-Role\-State}}
\index{P\-D\-\_\-\-Connect\-Get\-Init\-Role\-State@{P\-D\-\_\-\-Connect\-Get\-Init\-Role\-State}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Connect\-Get\-Init\-Role\-State}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Type\-C\-State\-\_\-t} P\-D\-\_\-\-Connect\-Get\-Init\-Role\-State (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint32\-\_\-t}]{typec\-Role}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_aa173143bdf6b1a4a301e5576b364d5d6}

\begin{DoxyCode}
1608 \{
1609     \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338}{TypeCState\_t} newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338ae804ea52cb577a1087ceedc86d227285}{TYPEC\_DISABLED};
1610 
1611     \textcolor{keywordflow}{switch} (typecRole)
1612     \{
1613         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a38da91c9c7115f0e6866a557601ad9b0}{kPowerConfig\_SourceOnly}:
1614         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a9656266d9665fce5cad114863e549798}{kPowerConfig\_SourceDefault}:
1615             newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338ad3a44a4534b93aaf59db03272710a580}{TYPEC\_UNATTACHED\_SRC};
1616             \textcolor{keywordflow}{break};
1617 
1618         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a437645be6176b52731290288dfdb65de}{kPowerConfig\_SinkOnly}:
1619         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9aff4b2380c8b265bbbe69d2eaa1ab207c}{kPowerConfig\_SinkDefault}:
1620             newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a98e3fb19049ca9cde6495dd9f803e1bf}{TYPEC\_UNATTACHED\_SNK};
1621             \textcolor{keywordflow}{break};
1622 
1623         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a9b59768282ea23a087cc0912e4516cae}{kPowerConfig\_DRPToggling}:
1624         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a2669bea019494464b15f2a4e4904d385}{kPowerConfig\_DRPSourcingDevice}:
1625         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9aba8782be77976d2ffc9830f1106e80f3}{kPowerConfig\_DRPSinkingHost}:
1626             \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole} == 
      \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a9b59768282ea23a087cc0912e4516cae}{kPowerConfig\_DRPToggling}) &&
1627                 (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a6e72ee6532ef61497b162a28b4500433}{drpTryFunction} == 
      \hyperlink{group__usb__pd__stack_gga4794fa8903a011ba6f0be0f04925411ea4326df028c06c1618941dfac6645decd}{kTypecTry\_Src}))
1628             \{
1629                 newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338af63a615d3eb1e5a83c087437209c81b9}{TYPEC\_TOGGLE\_SRC\_FIRST};
1630             \}
1631             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole} == 
      \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a9b59768282ea23a087cc0912e4516cae}{kPowerConfig\_DRPToggling}) &&
1632                      (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->
      \hyperlink{struct__pd__power__port__config_a6e72ee6532ef61497b162a28b4500433}{drpTryFunction} == \hyperlink{group__usb__pd__stack_gga4794fa8903a011ba6f0be0f04925411ea96a98ce2756ccbcd3c300db89ae9be67}{kTypecTry\_Snk}))
1633             \{
1634                 newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a1b001a7ceaf22f44b51faa345597b5b9}{TYPEC\_TOGGLE\_SNK\_FIRST};
1635             \}
1636             \textcolor{keywordflow}{else}
1637             \{
1638                 newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338af63a615d3eb1e5a83c087437209c81b9}{TYPEC\_TOGGLE\_SRC\_FIRST};
1639             \}
1640             \textcolor{keywordflow}{break};
1641 
1642         \textcolor{keywordflow}{default}:
1643             \textcolor{keywordflow}{break}; \textcolor{comment}{/* error */}
1644     \}
1645 
1646     \textcolor{keywordflow}{return} newState;
1647 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa173143bdf6b1a4a301e5576b364d5d6_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Connect\-Get\-State\-Machine@{P\-D\-\_\-\-Connect\-Get\-State\-Machine}}
\index{P\-D\-\_\-\-Connect\-Get\-State\-Machine@{P\-D\-\_\-\-Connect\-Get\-State\-Machine}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Connect\-Get\-State\-Machine}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Type\-C\-State\-\_\-t} P\-D\-\_\-\-Connect\-Get\-State\-Machine (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02}

\begin{DoxyCode}
1792 \{
1793     \textcolor{keywordflow}{return} pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState};
1794 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Connect\-Init\-Role@{P\-D\-\_\-\-Connect\-Init\-Role}}
\index{P\-D\-\_\-\-Connect\-Init\-Role@{P\-D\-\_\-\-Connect\-Init\-Role}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Connect\-Init\-Role}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Connect\-Init\-Role (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint32\-\_\-t}]{typec\-Role, }
\item[{uint8\-\_\-t}]{error\-Recovery}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4}

\begin{DoxyCode}
1657 \{
1658     \textcolor{comment}{//state in Type-C Spec}
1659     \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338}{TypeCState\_t} newState;
1660     uint32\_t infoVal;
1661 
1662     newState = pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState};
1663     pdInstance->\hyperlink{struct__pd__instance_aea1b390f81517cb7ef24eacda944f4ec}{enterAttachedSrcFromAttachWaitSNK} = 0;
1664 
1665     \textcolor{comment}{/*}
1666 \textcolor{comment}{    The ErrorRecovery state is where the port removes the terminations from the CC1 and CC2}
1667 \textcolor{comment}{    pins for tErrorRecovery followed by transitioning to the appropriate Unattached.SNK or}
1668 \textcolor{comment}{    Unattached.SRC state based on port type. This is the equivalent of forcing a detach event}
1669 \textcolor{comment}{    and looking for a new attach.}
1670 \textcolor{comment}{    */}
1671     \textcolor{comment}{/* error recovery 两件事}
1672 \textcolor{comment}{     * 1. remove terminations for CC1 and CC2 for tErrorRecovery}
1673 \textcolor{comment}{     * 2. transition to unattached state}
1674 \textcolor{comment}{     */}
1675     \textcolor{keywordflow}{if} (errorRecovery)
1676     \{
1677         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} != \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338abbb8f217eb3a1e48e8801810e67c94b6}{TYPEC\_ERROR\_RECOVERY})
1678         \{
1679             pdInstance->\hyperlink{struct__pd__instance_a0087c1b246d026c864194bf77ebcf654}{ccUsed} = \hyperlink{group__usb__pd__phy__drv_ggab23c0fba94b457218944bc5284d0d08da38c70fd9b523ca5666dea46ae65119ce}{kPD\_CCInvalid};
1680             \hyperlink{usb__pd__connect_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
1681             pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338abbb8f217eb3a1e48e8801810e67c94b6}{TYPEC\_ERROR\_RECOVERY};
1682             \textcolor{comment}{//设置CC，包括Vconn}
1683             \hyperlink{usb__pd__connect_8c_a0608faf2438b33700fc4680061ae69ab}{PD\_ConnectSetupNewState}(pdInstance, 0);
1684         \}
1685 
1686         \textcolor{comment}{// 这里是tErrorRecovery的延迟，那么上面是做remove terminations?}
1687         \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a03f942c439c95ea4ea901cd5e1d66e55}{T\_ERROR\_RECOVERY});
1688 
1689         \textcolor{keywordflow}{while} (!\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}))
1690         \{
1691         \}
1692     \}
1693     \textcolor{comment}{// Question: 经过上述操作可以保证state transition to unattached.xxx ?}
1694 
1695     \textcolor{comment}{// Question: 设置power progress -> stable的作用 ? }
1696     \textcolor{comment}{/* 以下四种都是初始状态 */}
1697     \textcolor{comment}{// set phy pwr\_inprogress state}
1698     \hyperlink{usb__pd__connect_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
1699     pdInstance->\hyperlink{struct__pd__instance_a4905e96236b6de63bba2c1d34c5a0a8b}{vbusDischargeInProgress} = 
      \hyperlink{usb__pd__connect_8c_a99f1687ace9dc35cfd53f6669eca30afa5b700ae7ca999552a849bb914cb0b08c}{kVbus\_NoDischarge};
1700     pdInstance->\hyperlink{struct__pd__instance_a0087c1b246d026c864194bf77ebcf654}{ccUsed} = \hyperlink{group__usb__pd__phy__drv_ggab23c0fba94b457218944bc5284d0d08da38c70fd9b523ca5666dea46ae65119ce}{kPD\_CCInvalid};
1701     pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338ae804ea52cb577a1087ceedc86d227285}{TYPEC\_DISABLED};
1702 
1703     \textcolor{comment}{// set cc initial state according to power role, confirm cc state tendency}
1704     newState = \hyperlink{usb__pd__connect_8c_aa173143bdf6b1a4a301e5576b364d5d6}{PD\_ConnectGetInitRoleState}(pdInstance, typecRole);
1705     \textcolor{comment}{// 注意，这里的curConnectState在上面刚刚被置为TYPEC\_DISABLED}
1706     \textcolor{keywordflow}{if} (newState != pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState})
1707     \{
1708         \textcolor{comment}{/* In the process of connecting, just change the role */}
1709         \textcolor{keywordflow}{if} (((newState == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a98e3fb19049ca9cde6495dd9f803e1bf}{TYPEC\_UNATTACHED\_SNK}) && (pdInstance->
      \hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a124465c7bd8e60c18a2d0d232faea211}{TYPEC\_ATTACH\_WAIT\_SNK})) ||
1710             ((newState == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338ad3a44a4534b93aaf59db03272710a580}{TYPEC\_UNATTACHED\_SRC}) && (pdInstance->
      \hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a0175480705eb6d9c36ab579036e9bbc7}{TYPEC\_ATTACH\_WAIT\_SRC})))
1711         \{
1712             \textcolor{comment}{/* continue the original state machine */}
1713         \}
1714         \textcolor{comment}{/* Not connected */}
1715         \textcolor{keywordflow}{else}
1716         \{
1717             \textcolor{keywordflow}{if} (newState != \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338ae804ea52cb577a1087ceedc86d227285}{TYPEC\_DISABLED})
1718             \{
1719                 \textcolor{comment}{// get vbus info, save it to infoVal}
1720                 \hyperlink{usb__pd__connect_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, &infoVal);
1721                 \textcolor{keywordflow}{if} (infoVal & \hyperlink{group__usb__pd__phy__drv_gaa02e3880c4e9954439522efb9a6af5c5}{PD\_VBUS\_POWER\_STATE\_VSYS\_MASK})
1722                 \{
1723                     \hyperlink{usb__pd__connect_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, &infoVal);
1724                     \textcolor{keywordflow}{if} (!(infoVal & \hyperlink{group__usb__pd__phy__drv_gabf05bb09647628f3556c817e1f059175}{PD\_VBUS\_POWER\_STATE\_VSAFE0V\_MASK}))
1725                     \{
1726                         \textcolor{comment}{/* VBUS Discharge:}
1727 \textcolor{comment}{                           If state is not disabled, and we are not in dead battery, enable vbus discharge
       on startup */}
1728                         pdInstance->\hyperlink{struct__pd__instance_a4905e96236b6de63bba2c1d34c5a0a8b}{vbusDischargeInProgress} = 
      \hyperlink{usb__pd__connect_8c_a99f1687ace9dc35cfd53f6669eca30afab0152ba85efd984aa8ed55d4a98b3f32}{kVbus\_ApplyTypecDischarge};
1729                     \}
1730                 \}
1731             \}
1732 
1733             pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} = newState;
1734             pdInstance->\hyperlink{struct__pd__instance_a0087c1b246d026c864194bf77ebcf654}{ccUsed} = \hyperlink{group__usb__pd__phy__drv_ggab23c0fba94b457218944bc5284d0d08da38c70fd9b523ca5666dea46ae65119ce}{kPD\_CCInvalid};
1735             \hyperlink{usb__pd__connect_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
1736             \hyperlink{usb__pd__connect_8c_a0608faf2438b33700fc4680061ae69ab}{PD\_ConnectSetupNewState}(pdInstance, 1);
1737         \}
1738     \}
1739 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Connect\-Set\-Power\-Progress@{P\-D\-\_\-\-Connect\-Set\-Power\-Progress}}
\index{P\-D\-\_\-\-Connect\-Set\-Power\-Progress@{P\-D\-\_\-\-Connect\-Set\-Power\-Progress}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Connect\-Set\-Power\-Progress}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Connect\-Set\-Power\-Progress (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{state}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}

\begin{DoxyCode}
1591 \{
1592     \textcolor{keywordflow}{if} ((state != \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771babd57680a848fb2ffdfcb7ce62b380348}{kVbusPower\_Invalid}) && (pdInstance->
      \hyperlink{struct__pd__instance_af4167196731cf1a846f23c4d6473181c}{inProgress} != state))
1593     \{
1594         \textcolor{comment}{// 设置power progress}
1595         pdInstance->\hyperlink{struct__pd__instance_af4167196731cf1a846f23c4d6473181c}{inProgress} = state;
1596         \textcolor{comment}{// 告知phy driver vbus的状态}
1597         \hyperlink{usb__pd__connect_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4b062c83b48914ee8edc74523699871d}{PD\_PHY\_SET\_VBUS\_TRANSFORM\_STATE}
      , &state);
1598     \}
1599 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Connect\-Set\-P\-R\-Swap\-Role@{P\-D\-\_\-\-Connect\-Set\-P\-R\-Swap\-Role}}
\index{P\-D\-\_\-\-Connect\-Set\-P\-R\-Swap\-Role@{P\-D\-\_\-\-Connect\-Set\-P\-R\-Swap\-Role}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Connect\-Set\-P\-R\-Swap\-Role}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Connect\-Set\-P\-R\-Swap\-Role (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{power\-Role}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe}

\begin{DoxyCode}
1742 \{
1743     \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338}{TypeCState\_t} newState;
1744 
1745     newState = pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState};
1746     \textcolor{keywordflow}{if} ((newState == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a08ce67bf9e0a4d46237c40642b049bcc}{TYPEC\_ATTACHED\_SRC}) && (powerRole == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink}))
1747     \{
1748         newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a06a469da27f359966648eda899622706}{TYPEC\_ATTACHED\_SNK};
1749     \}
1750     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((newState == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a06a469da27f359966648eda899622706}{TYPEC\_ATTACHED\_SNK}) && (powerRole == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource}))
1751     \{
1752         newState = \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a08ce67bf9e0a4d46237c40642b049bcc}{TYPEC\_ATTACHED\_SRC};
1753     \}
1754     \textcolor{keywordflow}{else}
1755     \{
1756         \textcolor{keywordflow}{return}; \textcolor{comment}{/* ERROR */}
1757     \}
1758     \textcolor{keywordflow}{if} (newState != pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState})
1759     \{
1760         pdInstance->\hyperlink{struct__pd__instance_a2c4dd56715311bcb898a01a7cbec1609}{curConnectState} = newState;
1761         \hyperlink{usb__pd__connect_8c_a0608faf2438b33700fc4680061ae69ab}{PD\_ConnectSetupNewState}(pdInstance, 1);
1762     \}
1763 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-App\-Callback@{P\-D\-\_\-\-Dpm\-App\-Callback}}
\index{P\-D\-\_\-\-Dpm\-App\-Callback@{P\-D\-\_\-\-Dpm\-App\-Callback}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-App\-Callback}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Dpm\-App\-Callback (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint32\-\_\-t}]{event, }
\item[{void $\ast$}]{param, }
\item[{uint8\-\_\-t}]{done}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}

\begin{DoxyCode}
7337 \{
7338     \textcolor{comment}{// Question: Done的含义是什么？}
7339     \textcolor{keywordflow}{if} (done)
7340     \{
7341         \textcolor{comment}{// power role as source}
7342         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
7343         \{
7344             \textcolor{comment}{//set SinkTxOK}
7345             \hyperlink{usb__pd__policy_8c_a90012fae056618ce9b4431bd004a852a}{PD\_MsgSrcEndCommand}(pdInstance);
7346         \}
7347 
7348         \textcolor{comment}{/* in case the power is not reset to normal operation */}
7349         \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
7350         \textcolor{comment}{// Question: 表示当前没有command正在处理？}
7351         pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = 0;
7352     \}
7353 
7354     \textcolor{comment}{// 实际调用的是通过PD\_InstanceInit初始化的PD\_DpmDemoAppCallback函数}
7355     \textcolor{keywordflow}{return} pdInstance->\hyperlink{struct__pd__instance_a3718a4d773d48136d66706ac063ef948}{pdCallback}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, event, param);
7356 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Check\-Less\-Or\-Equal\-Vsafe5v@{P\-D\-\_\-\-Dpm\-Check\-Less\-Or\-Equal\-Vsafe5v}}
\index{P\-D\-\_\-\-Dpm\-Check\-Less\-Or\-Equal\-Vsafe5v@{P\-D\-\_\-\-Dpm\-Check\-Less\-Or\-Equal\-Vsafe5v}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Check\-Less\-Or\-Equal\-Vsafe5v}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Dpm\-Check\-Less\-Or\-Equal\-Vsafe5v (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}

\begin{DoxyCode}
6594 \{
6595     uint8\_t powerState;
6596     \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, &
      powerState);
6597     \textcolor{keywordflow}{if} (powerState & \hyperlink{group__usb__pd__phy__drv_ga1f2e4aed47a47caec2aba9edb2236e42}{PD\_VBUS\_POWER\_STATE\_VSAFE5V\_MASK})
6598     \{
6599         \textcolor{keywordflow}{return} 1;
6600     \}
6601     \textcolor{keywordflow}{if} (powerState & \hyperlink{group__usb__pd__phy__drv_gabf05bb09647628f3556c817e1f059175}{PD\_VBUS\_POWER\_STATE\_VSAFE0V\_MASK})
6602     \{
6603         \textcolor{keywordflow}{return} 1;
6604     \}
6605     \textcolor{keywordflow}{if} ((!(powerState & PD\_VBUS\_POWER\_STATE\_VSAFE5V\_MASK)) && (!(powerState & 
      \hyperlink{group__usb__pd__phy__drv_gabe6758409c7aeff91de688fe7cefa195}{PD\_VBUS\_POWER\_STATE\_VBUS\_MASK})))
6606     \{
6607         \textcolor{keywordflow}{return} 1;
6608     \}
6609 
6610     \textcolor{keywordflow}{return} 0;
6611 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ade792f3a5e9ffb477a9598ad4a3fb697}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Check\-Vbus@{P\-D\-\_\-\-Dpm\-Check\-Vbus}}
\index{P\-D\-\_\-\-Dpm\-Check\-Vbus@{P\-D\-\_\-\-Dpm\-Check\-Vbus}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Check\-Vbus}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Dpm\-Check\-Vbus (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_ade792f3a5e9ffb477a9598ad4a3fb697}

\begin{DoxyCode}
6583 \{
6584     uint8\_t powerState;
6585     \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, &
      powerState);
6586     \textcolor{keywordflow}{if} ((powerState & \hyperlink{group__usb__pd__phy__drv_ga1f2e4aed47a47caec2aba9edb2236e42}{PD\_VBUS\_POWER\_STATE\_VSAFE5V\_MASK}) || (powerState & 
      \hyperlink{group__usb__pd__phy__drv_gabe6758409c7aeff91de688fe7cefa195}{PD\_VBUS\_POWER\_STATE\_VBUS\_MASK}))
6587     \{
6588         \textcolor{keywordflow}{return} 1;
6589     \}
6590     \textcolor{keywordflow}{return} 0;
6591 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ade792f3a5e9ffb477a9598ad4a3fb697_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ade792f3a5e9ffb477a9598ad4a3fb697_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Check\-Vsafe0\-V@{P\-D\-\_\-\-Dpm\-Check\-Vsafe0\-V}}
\index{P\-D\-\_\-\-Dpm\-Check\-Vsafe0\-V@{P\-D\-\_\-\-Dpm\-Check\-Vsafe0\-V}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Check\-Vsafe0\-V}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Dpm\-Check\-Vsafe0\-V (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e}

\begin{DoxyCode}
6614 \{
6615     uint8\_t powerState;
6616 
6617     \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, &
      powerState);
6618     \textcolor{keywordflow}{return} (powerState & \hyperlink{group__usb__pd__phy__drv_gabf05bb09647628f3556c817e1f059175}{PD\_VBUS\_POWER\_STATE\_VSAFE0V\_MASK});
6619 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a8478bb46d180cbe30f733a859d18547f}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Clear\-Msg@{P\-D\-\_\-\-Dpm\-Clear\-Msg}}
\index{P\-D\-\_\-\-Dpm\-Clear\-Msg@{P\-D\-\_\-\-Dpm\-Clear\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Clear\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Clear\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf pd\-\_\-command\-\_\-t}}]{id}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a8478bb46d180cbe30f733a859d18547f}

\begin{DoxyCode}
6642 \{
6643     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
6644 
6645     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
6646     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a6fb96c0e5c3f5f6f05f9964541078e3a}{dpmMsgBits} & (0x01u << \textcolor{keywordtype}{id}))
6647     \{
6648         pdInstance->\hyperlink{struct__pd__instance_a6fb96c0e5c3f5f6f05f9964541078e3a}{dpmMsgBits} &= (~(0x01u << id));
6649     \}
6650     \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
6651 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a8478bb46d180cbe30f733a859d18547f_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a150b2573c8bfe54de3d77cd020d85bc0}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Connect@{P\-D\-\_\-\-Dpm\-Connect}}
\index{P\-D\-\_\-\-Dpm\-Connect@{P\-D\-\_\-\-Dpm\-Connect}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Connect}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Connect (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a150b2573c8bfe54de3d77cd020d85bc0}

\begin{DoxyCode}
6472 \{
6473     \hyperlink{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}{PD\_TimerCancelAllTimers}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2033278364993300e5dbf3c5a088cc78}{\_tStartTimer}, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa18ebe20854093d25a292b738d04147f}{\_tMaxDpmTimer});
6474     pdInstance->\hyperlink{struct__pd__instance_a3638013563f1cb1208f12b5930970fa2}{dpmCableMaxCurrent} = 3000 / 10; \textcolor{comment}{/* 3A */}
6475     \textcolor{comment}{/* Source should provide VSafe5V by default */}
6476     \textcolor{comment}{/* do in the connect callback */}
6477 
6478     pdInstance->\hyperlink{struct__pd__instance_a6e12cc53d94812cf2a28973fae7c6a7e}{dpmStateMachine} = 0;
6479     \hyperlink{usb__pd__policy_8c_aec90d4fab260652b95f5027a080bff6b}{PD\_PsmConnect}(pdInstance);
6480 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a150b2573c8bfe54de3d77cd020d85bc0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a150b2573c8bfe54de3d77cd020d85bc0_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Discharge\-Vbus@{P\-D\-\_\-\-Dpm\-Discharge\-Vbus}}
\index{P\-D\-\_\-\-Dpm\-Discharge\-Vbus@{P\-D\-\_\-\-Dpm\-Discharge\-Vbus}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Discharge\-Vbus}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Discharge\-Vbus (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{enable}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa}

\begin{DoxyCode}
6534 \{
6535     \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edae705da68d4de3104b6852d84715bb71b}{PD\_PHY\_DISCHARGE\_VBUS}, &enable);
6536 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a0dee3662096589c64561a02b662b602a}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Discharge\-Vconn@{P\-D\-\_\-\-Dpm\-Discharge\-Vconn}}
\index{P\-D\-\_\-\-Dpm\-Discharge\-Vconn@{P\-D\-\_\-\-Dpm\-Discharge\-Vconn}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Discharge\-Vconn}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Discharge\-Vconn (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{enable}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a0dee3662096589c64561a02b662b602a}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a0dee3662096589c64561a02b662b602a_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Disconnect@{P\-D\-\_\-\-Dpm\-Disconnect}}
\index{P\-D\-\_\-\-Dpm\-Disconnect@{P\-D\-\_\-\-Dpm\-Disconnect}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Disconnect}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Disconnect (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344}

\begin{DoxyCode}
6466 \{
6467     \hyperlink{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}{PD\_TimerCancelAllTimers}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2033278364993300e5dbf3c5a088cc78}{\_tStartTimer}, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa18ebe20854093d25a292b738d04147f}{\_tMaxDpmTimer});
6468     \hyperlink{usb__pd__policy_8c_aa2694544089f6e2d123810cd48b27d6e}{PD\_PsmDisconnect}(pdInstance);
6469 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_afe9fa5f2f570274127c5a163adb5cd90}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Get\-Msg@{P\-D\-\_\-\-Dpm\-Get\-Msg}}
\index{P\-D\-\_\-\-Dpm\-Get\-Msg@{P\-D\-\_\-\-Dpm\-Get\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Get\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Dpm\-Get\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_afe9fa5f2f570274127c5a163adb5cd90}

\begin{DoxyCode}
6622 \{
6623     uint8\_t reVal = 0;
6624     uint8\_t commandIndex;
6625 
6626     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a6fb96c0e5c3f5f6f05f9964541078e3a}{dpmMsgBits})
6627     \{
6628         \textcolor{keywordflow}{for} (commandIndex = \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa30530dc299e85a527d236c16e68bff36}{PD\_DPM\_CONTROL\_POWER\_NEGOTIATION}; commandIndex 
      < \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa5eca4c7abaa74e09ff6d747c4eb73c7c}{PD\_DPM\_CONTROL\_COUNT}; ++commandIndex)
6629         \{
6630             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a6fb96c0e5c3f5f6f05f9964541078e3a}{dpmMsgBits} & (0x01u << commandIndex))
6631             \{
6632                 reVal = commandIndex;
6633                 \textcolor{keywordflow}{break};
6634             \}
6635         \}
6636     \}
6637 
6638     \textcolor{keywordflow}{return} reVal;
6639 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_afe9fa5f2f570274127c5a163adb5cd90_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a4f173065c59e2f188edd90264410c503}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Send\-Msg@{P\-D\-\_\-\-Dpm\-Send\-Msg}}
\index{P\-D\-\_\-\-Dpm\-Send\-Msg@{P\-D\-\_\-\-Dpm\-Send\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Send\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Send\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-handle}}]{pd\-Handle, }
\item[{uint8\-\_\-t}]{id}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a4f173065c59e2f188edd90264410c503}

\begin{DoxyCode}
6654 \{
6655     \hyperlink{struct__pd__instance}{pd\_instance\_t} *pdInstance = (\hyperlink{struct__pd__instance}{pd\_instance\_t} *)pdHandle;
6656     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
6657 
6658     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
6659     pdInstance->\hyperlink{struct__pd__instance_a6fb96c0e5c3f5f6f05f9964541078e3a}{dpmMsgBits} |= (0x00000001u << id);
6660     \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
6661     \hyperlink{group__usb__os__abstraction_gaa83073c31cced5742027d4046bd633db}{USB\_OsaEventSet}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981a8d7dadfaeb7942924ec2e0b32f654c35}{PD\_TASK\_EVENT\_DPM\_MSG});
6662 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=316pt]{usb__pd__policy_8c_a4f173065c59e2f188edd90264410c503_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a4f173065c59e2f188edd90264410c503_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Set\-Vconn@{P\-D\-\_\-\-Dpm\-Set\-Vconn}}
\index{P\-D\-\_\-\-Dpm\-Set\-Vconn@{P\-D\-\_\-\-Dpm\-Set\-Vconn}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Set\-Vconn}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Set\-Vconn (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{enable}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a}

\begin{DoxyCode}
6549 \{
6550     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_aa552a27c5747ea789ad185fefac44194}{vconnSupported})
6551     \{
6552         \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda68ad1faa15b73743adf7f5a58013937b}{PD\_PHY\_CONTROL\_VCONN}, &enable);
6553 \textcolor{preprocessor}{#if (PD\_CONFIG\_OLD\_INTERFACE)}
6554 \textcolor{preprocessor}{}        \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, PD\_PHY\_CONNECT\_CONTROL\_FLUSH, NULL);
6555 \textcolor{preprocessor}{#endif}
6556 \textcolor{preprocessor}{}    \}
6557 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a3d563de469ea4f02119bc23fa5a55f6c}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Dpm\-Src\-Transition\-To\-Newpwr@{P\-D\-\_\-\-Dpm\-Src\-Transition\-To\-Newpwr}}
\index{P\-D\-\_\-\-Dpm\-Src\-Transition\-To\-Newpwr@{P\-D\-\_\-\-Dpm\-Src\-Transition\-To\-Newpwr}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Dpm\-Src\-Transition\-To\-Newpwr}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Dpm\-Src\-Transition\-To\-Newpwr (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf pd\-\_\-rdo\-\_\-t}}]{rdo, }
\item[{uint8\-\_\-t}]{goto\-Min}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a3d563de469ea4f02119bc23fa5a55f6c}


The P\-S\-M has accepted a new power contract as source. 



 \begin{DoxyNote}{Note}
We need to wait t\-Snk\-Transition before the D\-P\-M can act on this new request (U\-S\-B\-P\-D requirement is to wait t\-Snk\-Transition before D\-P\-M is informed) 

Only called from C\-L\-P task context 
\end{DoxyNote}

\begin{DoxyCode}
6566 \{
6567     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a554f44f58a1507b74149f30952441f3a}{T\_SRC\_TRANSITION});
6568     \textcolor{keywordflow}{while} (!\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}))
6569         ;
6570 
6571     \textcolor{keywordflow}{if} (gotoMin)
6572     \{
6573         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a50891e9bf6ceb5d45b27ec49e46b11fc}{PD\_SrcGotoMinReducePower}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam});
6574     \}
6575     \textcolor{keywordflow}{else}
6576     \{
6577         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_ab7d47b7b6babdf2f74c6d1344c685168}{PD\_SrcTurnOnRequestVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, rdo);
6578     \}
6579 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a3d563de469ea4f02119bc23fa5a55f6c_cgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a4c31fc7951e54e4e153f64d3a8e229ef}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Disable@{P\-D\-\_\-\-Msg\-Disable}}
\index{P\-D\-\_\-\-Msg\-Disable@{P\-D\-\_\-\-Msg\-Disable}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Disable}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Msg\-Disable (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a4c31fc7951e54e4e153f64d3a8e229ef}

\begin{DoxyCode}
81 \{
82     \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda0c9ed5435eeaf83461a852f4180a9c3e}{PD\_PHY\_DISABLE\_MSG\_TX}, NULL);
83     \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda82e2f7a81ec4b132e98ed42740a4f7ec}{PD\_PHY\_DISABLE\_MSG\_RX}, NULL);
84 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=290pt]{usb__pd__policy_8c_a4c31fc7951e54e4e153f64d3a8e229ef_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a4c31fc7951e54e4e153f64d3a8e229ef_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a19c2d2c30e1d818cf1b730f60f866f44}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Get\-Receive\-Result@{P\-D\-\_\-\-Msg\-Get\-Receive\-Result}}
\index{P\-D\-\_\-\-Msg\-Get\-Receive\-Result@{P\-D\-\_\-\-Msg\-Get\-Receive\-Result}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Get\-Receive\-Result}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Msg\-Get\-Receive\-Result (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a19c2d2c30e1d818cf1b730f60f866f44}

\begin{DoxyCode}
472 \{
473     uint8\_t retVal = 0;
474     uint32\_t receiveLength;
475 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
476 \textcolor{preprocessor}{}    uint32\_t index;
477     uint8\_t *destBuffer;
478     uint8\_t *sourceBuffer;
479     uint8\_t needCopy = 0;
480     \hyperlink{struct__pd__msg__header}{pd\_msg\_header\_t} msgHeader;
481     \hyperlink{struct__pd__extended__msg__header}{pd\_extended\_msg\_header\_t} extHeader;
482 \textcolor{preprocessor}{#endif}
483 \textcolor{preprocessor}{}
484     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} == 2)
485     \{
486         pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} = 0;
487         receiveLength = pdInstance->\hyperlink{struct__pd__instance_a0d570b6b188a0e6756df839f35f346b5}{receivedLength};
488 
489 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
490 \textcolor{preprocessor}{}        sourceBuffer = (uint8\_t *)pdInstance->\hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer};
491         sourceBuffer += 2;
492         msgHeader.\hyperlink{struct__pd__msg__header_a3be91c1e7084d53533ddf706f450c28b}{msgHeaderVal} = (uint16\_t)(
      \hyperlink{usb__misc_8h_ad653e9416e47d6669d5b8e57c48e2d6f}{USB\_SHORT\_FROM\_LITTLE\_ENDIAN\_ADDRESS}(sourceBuffer));
493         \textcolor{keywordflow}{if} (msgHeader.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.extended)
494         \{
495             sourceBuffer += 2;
496             extHeader.\hyperlink{struct__pd__extended__msg__header_a1d247099ea671c66798b32e603697c5d}{extendedMsgHeaderVal} = (uint32\_t)(
      \hyperlink{usb__misc_8h_ad653e9416e47d6669d5b8e57c48e2d6f}{USB\_SHORT\_FROM\_LITTLE\_ENDIAN\_ADDRESS}(sourceBuffer));
497 
498             \textcolor{comment}{/* chunked ext msg need copy, because it may be larger than 28 bytes and are chunked */}
499             \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{void} *)pdInstance->\hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer} == (\textcolor{keywordtype}{void} *)pdInstance->
      receivingChunkedData)
500             \{
501                 needCopy = 1;
502 
503                 destBuffer = (uint8\_t *)pdInstance->\hyperlink{struct__pd__instance_a1112b16cc2add6100cbf81134f74caf1}{receivingData};
504                 destBuffer += 4;
505                 sourceBuffer = (uint8\_t *)pdInstance->\hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer};
506                 sourceBuffer += 4;
507 
508                 destBuffer[0] = sourceBuffer[0]; \textcolor{comment}{/* ext header */}
509                 destBuffer[1] = sourceBuffer[1];
510                 destBuffer += 2;
511                 sourceBuffer += 2; \textcolor{comment}{/* ext header */}
512             \}
513             \textcolor{keywordflow}{else}
514             \{
515                 needCopy = 0;
516             \}
517 
518             \textcolor{keywordflow}{if} ((!extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunked))
519             \{
520                 \textcolor{comment}{/* unchunked ext msg */}
521                 \textcolor{keywordflow}{if} (receiveLength > 260)
522                 \{
523                     receiveLength = 260;
524                 \}
525             \}
526             \textcolor{keywordflow}{else}
527             \{
528                 \textcolor{comment}{/* chunked ext msg */}
529                 \textcolor{keywordflow}{if} (receiveLength > 32)
530                 \{
531                     receiveLength = 32;
532                 \}
533 
534                 \textcolor{keywordflow}{if} (needCopy)
535                 \{
536                     destBuffer += (extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber * 26);
537                 \}
538             \}
539         \}
540         \textcolor{keywordflow}{else}
541 \textcolor{preprocessor}{#endif}
542 \textcolor{preprocessor}{}        \{
543             \textcolor{keywordflow}{if} (receiveLength > 32)
544             \{
545                 receiveLength = 32;
546             \}
547         \}
548 
549         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a64014dae5dccd1adb710c12fcc8b23cf}{receiveResult} == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success})
550         \{
551 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
552 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (needCopy)
553             \{
554                 pdInstance->\hyperlink{struct__pd__instance_a1112b16cc2add6100cbf81134f74caf1}{receivingData}[0] = ((uint32\_t *)pdInstance->
      \hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer})[0]; \textcolor{comment}{/* msg header */}
555                 receiveLength -= 4; \textcolor{comment}{/* reduce the normal header and ext header */}
556                 \textcolor{keywordflow}{for} (index = 0; index < (receiveLength); ++index)
557                 \{
558                     destBuffer[index] = sourceBuffer[index];
559                 \}
560                 pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData} = (uint32\_t *)&(pdInstance->
      \hyperlink{struct__pd__instance_a1112b16cc2add6100cbf81134f74caf1}{receivingData}[0]);
561             \}
562             \textcolor{keywordflow}{else}
563 \textcolor{preprocessor}{#endif}
564 \textcolor{preprocessor}{}            \{
565                 pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData} = (uint32\_t *)pdInstance->
      \hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer};
566             \}
567         \}
568 
569         retVal = (pdInstance->\hyperlink{struct__pd__instance_a64014dae5dccd1adb710c12fcc8b23cf}{receiveResult} == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success} ? 1 : 0);
570     \}
571 
572     \textcolor{keywordflow}{return} retVal;
573 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a19c2d2c30e1d818cf1b730f60f866f44_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Receive@{P\-D\-\_\-\-Msg\-Receive}}
\index{P\-D\-\_\-\-Msg\-Receive@{P\-D\-\_\-\-Msg\-Receive}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Receive}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Msg\-Receive (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}

\begin{DoxyCode}
428 \{
429     uint32\_t receiveLength;
430 
431     \textcolor{keywordflow}{if} (!(pdInstance->\hyperlink{struct__pd__instance_a7ac775fb724d971003420ee22adc0fbe}{enableReceive}))
432     \{
433         \textcolor{keywordflow}{return};
434     \}
435 
436     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} == 0)
437     \{
438 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
439 \textcolor{preprocessor}{}        receiveLength = 260;
440 \textcolor{preprocessor}{#else}
441 \textcolor{preprocessor}{}        receiveLength = 32;
442 \textcolor{preprocessor}{#endif}
443 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer} == NULL)
444         \{
445 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
446 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature})
447             \{
448                 pdInstance->\hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer} = (uint8\_t *)pdInstance->
      \hyperlink{struct__pd__instance_a1112b16cc2add6100cbf81134f74caf1}{receivingData};
449             \}
450             \textcolor{keywordflow}{else}
451             \{
452                 pdInstance->\hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer} = (uint8\_t *)pdInstance->
      receivingChunkedData;
453             \}
454 \textcolor{preprocessor}{#else}
455 \textcolor{preprocessor}{}            pdInstance->\hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer} = (uint8\_t *)pdInstance->
      \hyperlink{struct__pd__instance_a1112b16cc2add6100cbf81134f74caf1}{receivingData};
456 #endif
457         \}
458         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_adbed7b2cd53df40e0611a8879c903339}{phyInterface}->\hyperlink{struct__pd__phy__api__interface_a3c8508914afbcb4f55578a0d61cd90e3}{pdPhyReceive}(pdInstance->
      \hyperlink{struct__pd__instance_a7c1184292efe9a5ae30b6ac422c1e9f4}{pdPhyHandle}, pdInstance->\hyperlink{struct__pd__instance_a007de2aa1ac9ae814d10d26a949dd61d}{pendingSOP},
459                                                    pdInstance->
      \hyperlink{struct__pd__instance_aa2afb566f855b4b00bcdf335d8d997a3}{receivingDataBuffer} + 2,
460                                                    receiveLength) == 
      \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success})
461         \{
462             pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} = 1;
463         \}
464         \textcolor{keywordflow}{else}
465         \{
466             \hyperlink{group__usb__os__abstraction_gaa83073c31cced5742027d4046bd633db}{USB\_OsaEventSet}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ab7866880ca831b0f650c837287bbd60f}{PD\_TASK\_EVENT\_PD\_MSG});
467         \}
468     \}
469 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=310pt]{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Recv\-Pending@{P\-D\-\_\-\-Msg\-Recv\-Pending}}
\index{P\-D\-\_\-\-Msg\-Recv\-Pending@{P\-D\-\_\-\-Msg\-Recv\-Pending}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Recv\-Pending}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Msg\-Recv\-Pending (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4}

\begin{DoxyCode}
576 \{
577     \textcolor{keywordflow}{return} (pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} == 2);
578 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Reset@{P\-D\-\_\-\-Msg\-Reset}}
\index{P\-D\-\_\-\-Msg\-Reset@{P\-D\-\_\-\-Msg\-Reset}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Reset}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Msg\-Reset (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653}

\begin{DoxyCode}
71 \{
72     \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda05d1be67ea7a2972c165dd67a0196839}{PD\_PHY\_CANCEL\_MSG\_TX}, NULL);
73     pdInstance->\hyperlink{struct__pd__instance_ad19f652f47e237558f18b224b5d57e23}{sendingState} = 0;
74     \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edad29607158e8977b9bb140b407b9e6cc4}{PD\_PHY\_CANCEL\_MSG\_RX}, NULL);
75     pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} = 0;
76 
77     \hyperlink{usb__pd__msg_8c_a8efd2af273b221ad6fe948153b704c96}{PD\_MsgInit}(pdInstance);
78 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send@{P\-D\-\_\-\-Msg\-Send}}
\index{P\-D\-\_\-\-Msg\-Send@{P\-D\-\_\-\-Msg\-Send}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf start\-\_\-of\-\_\-packet\-\_\-t}}]{sop, }
\item[{{\bf message\-\_\-type\-\_\-t}}]{msg\-Type, }
\item[{uint32\-\_\-t}]{data\-Length, }
\item[{uint8\-\_\-t $\ast$}]{data\-Buffer}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d}

\begin{DoxyCode}
143 \{
144     uint8\_t index;
145     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
146 
147     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
148     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_af70b04cd5c8187c6a0424dea57205e8c}{hardResetReceived}) || (pdInstance->
      \hyperlink{struct__pd__instance_ad19f652f47e237558f18b224b5d57e23}{sendingState} == 1))
149     \{
150         \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
151         \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073a4d58370b8ee8d3d2a4c477f7a3f84dda}{kStatus\_PD\_Error};
152     \}
153 
154     pdInstance->\hyperlink{struct__pd__instance_ad19f652f47e237558f18b224b5d57e23}{sendingState} = 1;
155     \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
156 
157     \textcolor{comment}{/* set msg header */}
158     pdInstance->\hyperlink{struct__pd__instance_a6c867a07c66667ea3eab5ec882090e09}{sendingData}[0] = (pdInstance->\hyperlink{struct__pd__instance_a6031ed1c3ec10c04ea5daf9a76485f68}{sendingMsgHeader}.
      \hyperlink{struct__pd__msg__header_a3be91c1e7084d53533ddf706f450c28b}{msgHeaderVal} | (msgType & \hyperlink{usb__pd__spec_8h_afbe845f7ee998a739bae14cf4b2d36b8}{PD\_MSG\_TYPE\_VALUE\_MASK}) |
159                                   (((dataLength - 2) >> 2) << 
      \hyperlink{usb__pd__spec_8h_a1cf3acbacd01a46bb61d2418ccadb292}{PD\_MSG\_HEADER\_NUMBER\_OF\_DATA\_OBJECTS\_POS}))
160                                  << 16;
161     \textcolor{comment}{/* copy msg data */}
162     \textcolor{keywordflow}{if} (msgType != \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba398e213caf8239ca95470df3bb2cdbf8}{kPD\_MsgSourceCapabilities})
163     \{
164         \textcolor{keywordflow}{for} (index = 0; index < ((dataLength - 2 + 3) >> 2); ++index)
165         \{
166             pdInstance->\hyperlink{struct__pd__instance_a6c867a07c66667ea3eab5ec882090e09}{sendingData}[index + 1] = 
      \hyperlink{usb__misc_8h_ab94871389a0730a311e19a217b223d4d}{USB\_LONG\_FROM\_LITTLE\_ENDIAN\_ADDRESS}((dataBuffer + index * 4));
167         \}
168     \}
169 
170     \hyperlink{usb__pd__msg_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance);
171     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_adbed7b2cd53df40e0611a8879c903339}{phyInterface}->\hyperlink{struct__pd__phy__api__interface_ab9b74f09035836be811dc6aae682074f}{pdPhySend}(pdInstance->
      \hyperlink{struct__pd__instance_a7c1184292efe9a5ae30b6ac422c1e9f4}{pdPhyHandle}, sop,
172                                             ((uint8\_t *)&(pdInstance->
      \hyperlink{struct__pd__instance_a6c867a07c66667ea3eab5ec882090e09}{sendingData}[0])) + 2,
173                                             (dataLength)) == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success})
174     \{
175         \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success};
176     \}
177     \textcolor{keywordflow}{else}
178     \{
179         pdInstance->\hyperlink{struct__pd__instance_ad19f652f47e237558f18b224b5d57e23}{sendingState} = 0;
180     \}
181 
182     \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073a4d58370b8ee8d3d2a4c477f7a3f84dda}{kStatus\_PD\_Error};
183 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Chunked\-Extended\-Msg@{P\-D\-\_\-\-Msg\-Send\-Chunked\-Extended\-Msg}}
\index{P\-D\-\_\-\-Msg\-Send\-Chunked\-Extended\-Msg@{P\-D\-\_\-\-Msg\-Send\-Chunked\-Extended\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Chunked\-Extended\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send\-Chunked\-Extended\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf start\-\_\-of\-\_\-packet\-\_\-t}}]{sop, }
\item[{{\bf message\-\_\-type\-\_\-t}}]{ext\-Msg\-Type, }
\item[{{\bf pd\-\_\-extended\-\_\-msg\-\_\-header\-\_\-t}}]{ext\-Header, }
\item[{uint32\-\_\-t}]{data\-Length, }
\item[{uint8\-\_\-t $\ast$}]{data\-Buffer}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Control\-Transition@{P\-D\-\_\-\-Msg\-Send\-Control\-Transition}}
\index{P\-D\-\_\-\-Msg\-Send\-Control\-Transition@{P\-D\-\_\-\-Msg\-Send\-Control\-Transition}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Control\-Transition}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Msg\-Send\-Control\-Transition (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{msg\-Type, }
\item[{{\bf pd\-\_\-psm\-\_\-state\-\_\-t}}]{success\-Next\-State, }
\item[{uint8\-\_\-t}]{interrupted\-State, }
\item[{{\bf pd\-\_\-psm\-\_\-state\-\_\-t}}]{error\-State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}

\begin{DoxyCode}
242 \{
243     \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d}{PD\_MsgSend}(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, (\hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\_type\_t})msgType, 2, 
      NULL) == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success}) &&
244         \hyperlink{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}{PD\_MsgWaitSendResult}(pdInstance))
245     \{
246         \textcolor{keywordflow}{if} (successNextState != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE})
247         \{
248             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = successNextState;
249         \}
250         \textcolor{keywordflow}{return} 1; \textcolor{comment}{/* success */}
251     \}
252 
253     \hyperlink{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c}{PD\_PsmTransitionOnMsgSendError}(pdInstance, interruptedState, errorState);
254 
255     \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* fail */}
256 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Data\-Transition@{P\-D\-\_\-\-Msg\-Send\-Data\-Transition}}
\index{P\-D\-\_\-\-Msg\-Send\-Data\-Transition@{P\-D\-\_\-\-Msg\-Send\-Data\-Transition}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Data\-Transition}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Msg\-Send\-Data\-Transition (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{msg\-Type, }
\item[{uint32\-\_\-t}]{do\-Count, }
\item[{uint32\-\_\-t $\ast$}]{dos, }
\item[{{\bf pd\-\_\-psm\-\_\-state\-\_\-t}}]{success\-Next\-State, }
\item[{uint8\-\_\-t}]{interrupted\-State, }
\item[{{\bf pd\-\_\-psm\-\_\-state\-\_\-t}}]{error\-State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}

\begin{DoxyCode}
272 \{
273     \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d}{PD\_MsgSend}(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, (\hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\_type\_t})msgType, 2 + 
      (doCount * 4), (uint8\_t *)dos) ==
274          \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success}) &&
275         \hyperlink{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}{PD\_MsgWaitSendResult}(pdInstance))
276     \{
277         \textcolor{keywordflow}{if} (successNextState != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE})
278         \{
279             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = successNextState;
280         \}
281         \textcolor{keywordflow}{return} 1; \textcolor{comment}{/* success */}
282     \}
283 
284     \hyperlink{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c}{PD\_PsmTransitionOnMsgSendError}(pdInstance, interruptedState, errorState);
285 
286     \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* fail */}
287 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aad334e14a1b8c980ae68a9978a46daa5}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Extended\-Msg@{P\-D\-\_\-\-Msg\-Send\-Extended\-Msg}}
\index{P\-D\-\_\-\-Msg\-Send\-Extended\-Msg@{P\-D\-\_\-\-Msg\-Send\-Extended\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Extended\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send\-Extended\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf start\-\_\-of\-\_\-packet\-\_\-t}}]{sop, }
\item[{{\bf message\-\_\-type\-\_\-t}}]{ext\-Msg\-Type, }
\item[{uint32\-\_\-t}]{data\-Length, }
\item[{uint8\-\_\-t $\ast$}]{data\-Buffer}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_aad334e14a1b8c980ae68a9978a46daa5}
\hypertarget{usb__pd__policy_8c_ab97edd8ad822d84ac4c3c60716d949e6}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Hard\-Reset@{P\-D\-\_\-\-Msg\-Send\-Hard\-Reset}}
\index{P\-D\-\_\-\-Msg\-Send\-Hard\-Reset@{P\-D\-\_\-\-Msg\-Send\-Hard\-Reset}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Hard\-Reset}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send\-Hard\-Reset (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_ab97edd8ad822d84ac4c3c60716d949e6}

\begin{DoxyCode}
386 \{
387     \textcolor{keywordflow}{return} \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda1d45b97b5d29cbce1117fa4c77202cbf}{PD\_PHY\_SEND\_HARD\_RESET}, NULL);
388 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=328pt]{usb__pd__policy_8c_ab97edd8ad822d84ac4c3c60716d949e6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ab97edd8ad822d84ac4c3c60716d949e6_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aef67884d9408a328e52733a0535109e1}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Request\-Chunk\-Msg@{P\-D\-\_\-\-Msg\-Send\-Request\-Chunk\-Msg}}
\index{P\-D\-\_\-\-Msg\-Send\-Request\-Chunk\-Msg@{P\-D\-\_\-\-Msg\-Send\-Request\-Chunk\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Request\-Chunk\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send\-Request\-Chunk\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf start\-\_\-of\-\_\-packet\-\_\-t}}]{sop, }
\item[{{\bf message\-\_\-type\-\_\-t}}]{ext\-Msg\-Type, }
\item[{{\bf pd\-\_\-extended\-\_\-msg\-\_\-header\-\_\-t}}]{ext\-Header}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_aef67884d9408a328e52733a0535109e1}
\hypertarget{usb__pd__policy_8c_a1bc0b8a0146a3a133023eda572e3adc7}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Structured\-V\-D\-M\-And\-Wait@{P\-D\-\_\-\-Msg\-Send\-Structured\-V\-D\-M\-And\-Wait}}
\index{P\-D\-\_\-\-Msg\-Send\-Structured\-V\-D\-M\-And\-Wait@{P\-D\-\_\-\-Msg\-Send\-Structured\-V\-D\-M\-And\-Wait}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Structured\-V\-D\-M\-And\-Wait}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send\-Structured\-V\-D\-M\-And\-Wait (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf start\-\_\-of\-\_\-packet\-\_\-t}}]{sop, }
\item[{{\bf pd\-\_\-structured\-\_\-vdm\-\_\-header\-\_\-t}}]{reponse\-Vdm\-Header, }
\item[{uint8\-\_\-t}]{count, }
\item[{uint32\-\_\-t $\ast$}]{vdos}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a1bc0b8a0146a3a133023eda572e3adc7}
\hypertarget{usb__pd__policy_8c_aafe1563428401cff5a9f430cba8043e1}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Unchunked\-Extended\-Msg@{P\-D\-\_\-\-Msg\-Send\-Unchunked\-Extended\-Msg}}
\index{P\-D\-\_\-\-Msg\-Send\-Unchunked\-Extended\-Msg@{P\-D\-\_\-\-Msg\-Send\-Unchunked\-Extended\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Unchunked\-Extended\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send\-Unchunked\-Extended\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf start\-\_\-of\-\_\-packet\-\_\-t}}]{sop, }
\item[{{\bf message\-\_\-type\-\_\-t}}]{ext\-Msg\-Type, }
\item[{uint32\-\_\-t}]{data\-Length, }
\item[{uint8\-\_\-t $\ast$}]{data\-Buffer}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_aafe1563428401cff5a9f430cba8043e1}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aafe1563428401cff5a9f430cba8043e1_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a19872ab9fb1085c5425f9e0d15b0395a}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Send\-Unstructured\-V\-D\-M@{P\-D\-\_\-\-Msg\-Send\-Unstructured\-V\-D\-M}}
\index{P\-D\-\_\-\-Msg\-Send\-Unstructured\-V\-D\-M@{P\-D\-\_\-\-Msg\-Send\-Unstructured\-V\-D\-M}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Send\-Unstructured\-V\-D\-M}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Msg\-Send\-Unstructured\-V\-D\-M (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf start\-\_\-of\-\_\-packet\-\_\-t}}]{sop, }
\item[{uint8\-\_\-t $\ast$}]{data\-Buffer, }
\item[{uint32\-\_\-t}]{data\-Length}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a19872ab9fb1085c5425f9e0d15b0395a}
\hypertarget{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Set\-Port\-Role@{P\-D\-\_\-\-Msg\-Set\-Port\-Role}}
\index{P\-D\-\_\-\-Msg\-Set\-Port\-Role@{P\-D\-\_\-\-Msg\-Set\-Port\-Role}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Set\-Port\-Role}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Msg\-Set\-Port\-Role (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{power\-Role, }
\item[{uint8\-\_\-t}]{data\-Role}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}

\begin{DoxyCode}
87 \{
88     \hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} headerInfo;
89     pdInstance->\hyperlink{struct__pd__instance_a6031ed1c3ec10c04ea5daf9a76485f68}{sendingMsgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.portPowerRoleOrCablePlug = powerRole;
90     pdInstance->\hyperlink{struct__pd__instance_a6031ed1c3ec10c04ea5daf9a76485f68}{sendingMsgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.portDataRole = dataRole;
91     pdInstance->\hyperlink{struct__pd__instance_a6031ed1c3ec10c04ea5daf9a76485f68}{sendingMsgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.specRevision = pdInstance->
      \hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision};
92 
93     headerInfo.\hyperlink{struct__pd__phy__msg__header__info_a7f921ee0d685a1f6818dce56ee1ef8f2}{dataRole} = dataRole;
94     headerInfo.\hyperlink{struct__pd__phy__msg__header__info_a11c74e61a0e7ab66caf6c73321d9d016}{powerRole} = powerRole;
95     headerInfo.\hyperlink{struct__pd__phy__msg__header__info_a068ae6e534efaaa108dbd0aa75256a63}{cablePlug} = 0;
96     headerInfo.\hyperlink{struct__pd__phy__msg__header__info_a64122118bd2c482eea1b178b459e1aae}{revision} = pdInstance->\hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision};
97     \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab459c8f89653d73a0d318cd30c0a1fc5}{PD\_PHY\_SET\_MSG\_HEADER\_INFO}, &
      headerInfo);
98 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=310pt]{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a90012fae056618ce9b4431bd004a852a}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Src\-End\-Command@{P\-D\-\_\-\-Msg\-Src\-End\-Command}}
\index{P\-D\-\_\-\-Msg\-Src\-End\-Command@{P\-D\-\_\-\-Msg\-Src\-End\-Command}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Src\-End\-Command}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Msg\-Src\-End\-Command (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a90012fae056618ce9b4431bd004a852a}

\begin{DoxyCode}
608 \{
609 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_PD3\_AMS\_COLLISION\_AVOID\_ENABLE) && (PD\_CONFIG\_PD3\_AMS\_COLLISION\_AVOID\_ENABLE)}
610 \textcolor{preprocessor}{}    \textcolor{comment}{//3A means SinkTxOK}
611     uint8\_t rpVal = \hyperlink{group__usb__pd__stack_ggaf956bb4d3d27df52fb694311b8219b0ead97ab9ef94b70e7dfca45f9aa0883299}{kCurrent\_3A};
612     pdInstance->\hyperlink{struct__pd__instance_ac9c3ed52c22920ccea6ecd0d1e0f6651}{commandSrcOwner} = 0;
613     \textcolor{comment}{// control phy to change rp value by rpVal}
614     \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda47b31ad92865627f7e074f52e8532854}{PD\_PHY\_SRC\_SET\_TYPEC\_CURRENT\_CAP}
      , &rpVal);
615 \textcolor{preprocessor}{#endif}
616 \textcolor{preprocessor}{}\}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{usb__pd__policy_8c_a90012fae056618ce9b4431bd004a852a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a90012fae056618ce9b4431bd004a852a_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a6ab430500b707d49e6f44a32e91d1aa9}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Start\-Receive@{P\-D\-\_\-\-Msg\-Start\-Receive}}
\index{P\-D\-\_\-\-Msg\-Start\-Receive@{P\-D\-\_\-\-Msg\-Start\-Receive}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Start\-Receive}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Msg\-Start\-Receive (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a6ab430500b707d49e6f44a32e91d1aa9}

\begin{DoxyCode}
419 \{
420     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
421     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
422     pdInstance->\hyperlink{struct__pd__instance_a7ac775fb724d971003420ee22adc0fbe}{enableReceive} = 1;
423     \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
424     \hyperlink{usb__pd__msg_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance);
425 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a6ab430500b707d49e6f44a32e91d1aa9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a6ab430500b707d49e6f44a32e91d1aa9_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a76b0f4cfb65f3523c10e8e472f42d9c4}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Stop\-Receive@{P\-D\-\_\-\-Msg\-Stop\-Receive}}
\index{P\-D\-\_\-\-Msg\-Stop\-Receive@{P\-D\-\_\-\-Msg\-Stop\-Receive}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Stop\-Receive}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Msg\-Stop\-Receive (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a76b0f4cfb65f3523c10e8e472f42d9c4}

\begin{DoxyCode}
402 \{
403     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
404     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
405     pdInstance->\hyperlink{struct__pd__instance_a7ac775fb724d971003420ee22adc0fbe}{enableReceive} = 0;
406     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} == 1)
407     \{
408         pdInstance->\hyperlink{struct__pd__instance_ac2c84f6b1ff2b7c8a1b1ac9ee358ef0e}{receiveState} = 0;
409         \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
410         \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edad29607158e8977b9bb140b407b9e6cc4}{PD\_PHY\_CANCEL\_MSG\_RX}, NULL);
411     \}
412     \textcolor{keywordflow}{else}
413     \{
414         \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
415     \}
416 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=314pt]{usb__pd__policy_8c_a76b0f4cfb65f3523c10e8e472f42d9c4_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a76b0f4cfb65f3523c10e8e472f42d9c4_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Msg\-Wait\-Send\-Result@{P\-D\-\_\-\-Msg\-Wait\-Send\-Result}}
\index{P\-D\-\_\-\-Msg\-Wait\-Send\-Result@{P\-D\-\_\-\-Msg\-Wait\-Send\-Result}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Msg\-Wait\-Send\-Result}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Msg\-Wait\-Send\-Result (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}

\begin{DoxyCode}
116 \{
117     uint32\_t eventSet;
118     \textcolor{keywordflow}{do}
119     \{
120         eventSet = 0u;
121         \hyperlink{group__usb__os__abstraction_ga5ce587209d676871f3ec62900054febd}{USB\_OsaEventWait}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 0xffu, 0, 5, &eventSet
      );
122         \hyperlink{usb__pd__msg_8c_a39aa541f6a8e3843b3ab18fdcf533768}{PD\_PortTaskEventProcess}(pdInstance, eventSet);
123         \textcolor{keywordflow}{if} (eventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981a01e917815dd3d2d16283e6ff86f9b1c6}{PD\_TASK\_EVENT\_SEND\_DONE})
124         \{
125             \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      PD\_TASK\_EVENT\_SEND\_DONE);
126             \textcolor{keywordflow}{break};
127         \}
128 
129         \textcolor{comment}{/* Disconnected */}
130         \textcolor{keywordflow}{if} (\hyperlink{usb__pd__msg_8c_a25116c60801fe4f4def90e3e42614b54}{PD\_ConnectCheck}(pdInstance) == (uint8\_t)
      \hyperlink{usb__pd__interface_8h_a924ee365c422092460915bc8cd8b9cbbaea13843a3c8cfb639d76fc9a4e387b53}{kConnectState\_Disconnected})
131         \{
132             \hyperlink{usb__pd__msg_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda05d1be67ea7a2972c165dd67a0196839}{PD\_PHY\_CANCEL\_MSG\_TX}, NULL);
133             pdInstance->\hyperlink{struct__pd__instance_ad19f652f47e237558f18b224b5d57e23}{sendingState} = 0;
134             \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073a4d58370b8ee8d3d2a4c477f7a3f84dda}{kStatus\_PD\_Error};
135         \}
136     \} \textcolor{keywordflow}{while} (1);
137 
138     \textcolor{keywordflow}{return} ((pdInstance->\hyperlink{struct__pd__instance_ac02af68a4c0e36f39a1b3203c5638c2b}{sendingResult} == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success}) ? 1 : 0);
139 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Phy\-Control@{P\-D\-\_\-\-Phy\-Control}}
\index{P\-D\-\_\-\-Phy\-Control@{P\-D\-\_\-\-Phy\-Control}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Phy\-Control}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Phy\-Control (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint32\-\_\-t}]{control, }
\item[{void $\ast$}]{param}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}

\begin{DoxyCode}
123 \{
124     \textcolor{comment}{// usb\_pd\_phy.h: pd\_phy\_control\_t enum}
125     \textcolor{keywordflow}{if} ((control == \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edadd7a49b2857f7cc9b4708cb899950eec}{PD\_PHY\_UPDATE\_STATE}) ||
126         (\hyperlink{group__usb__os__abstraction_gab25fb5d93d3b665ca8eadf2a670d3361}{USB\_OsaEventCheck}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ac05d4679325cb8c3a8491b9812e28924}{PD\_TASK\_EVENT\_PHY\_STATE\_CHAGNE}, NULL) ==
127          \hyperlink{group__usb__os__abstraction_gga453ebd2f93aafb8c938c3a23c815f9bdab90805fb75297fda1ca60dbb2283f933}{kStatus\_USB\_OSA\_Success}))
128     \{
129         \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ac05d4679325cb8c3a8491b9812e28924}{PD\_TASK\_EVENT\_PHY\_STATE\_CHAGNE});
130         \textcolor{comment}{// pd/usb\_pd\_interface.c中初始化，对应phy中的control函数}
131         pdInstance->\hyperlink{struct__pd__instance_adbed7b2cd53df40e0611a8879c903339}{phyInterface}->\hyperlink{struct__pd__phy__api__interface_a5e422dbfd66fca34934e39b451f17094}{pdPhyControl}(pdInstance->
      \hyperlink{struct__pd__instance_a7c1184292efe9a5ae30b6ac422c1e9f4}{pdPhyHandle}, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edadd7a49b2857f7cc9b4708cb899950eec}{PD\_PHY\_UPDATE\_STATE}, NULL);
132         NVIC\_EnableIRQ((IRQn\_Type)pdInstance->\hyperlink{struct__pd__instance_a2d9a457d63da9c4cb5e3feece0cbf3ec}{pdConfig}->\hyperlink{struct__pd__instance__config_a131f930f58f1a9bfe1488acb62aa2725}{phyInterruptNum});
133     \}
134 
135     \textcolor{comment}{// call PDPTN5110\_Control}
136     \textcolor{keywordflow}{if} (control != \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edadd7a49b2857f7cc9b4708cb899950eec}{PD\_PHY\_UPDATE\_STATE})
137     \{
138         \textcolor{keywordflow}{return} pdInstance->\hyperlink{struct__pd__instance_adbed7b2cd53df40e0611a8879c903339}{phyInterface}->\hyperlink{struct__pd__phy__api__interface_a5e422dbfd66fca34934e39b451f17094}{pdPhyControl}(pdInstance->
      \hyperlink{struct__pd__instance_a7c1184292efe9a5ae30b6ac422c1e9f4}{pdPhyHandle}, control, param);
139     \}
140     \textcolor{keywordflow}{else}
141     \{
142         \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success};
143     \}
144 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=318pt]{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a39aa541f6a8e3843b3ab18fdcf533768}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Port\-Task\-Event\-Process@{P\-D\-\_\-\-Port\-Task\-Event\-Process}}
\index{P\-D\-\_\-\-Port\-Task\-Event\-Process@{P\-D\-\_\-\-Port\-Task\-Event\-Process}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Port\-Task\-Event\-Process}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Port\-Task\-Event\-Process (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint32\-\_\-t}]{event\-Set}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a39aa541f6a8e3843b3ab18fdcf533768}

\begin{DoxyCode}
663 \{
664     \textcolor{comment}{// 如果phy state change, 则通过call back调用alert handler}
665     \textcolor{comment}{// alert interrupt handler will set PD\_TASK\_EVENT\_PHY\_STATE\_CHAGNE and
       PD\_TASK\_EVENT\_TYPEC\_STATE\_PROCESS, 中断只是设置flag，而不做处理}
666     \textcolor{keywordflow}{if} (eventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ac05d4679325cb8c3a8491b9812e28924}{PD\_TASK\_EVENT\_PHY\_STATE\_CHAGNE})
667     \{
668         \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edadd7a49b2857f7cc9b4708cb899950eec}{PD\_PHY\_UPDATE\_STATE}, NULL);
669     \}
670 
671     \textcolor{comment}{// Question: other event 的作用}
672     \textcolor{keywordflow}{if} (eventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981acf345f0b57466940ab6b574ee9c3c2bc}{PD\_TASK\_EVENT\_OTHER})
673     \{
674         \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, PD\_TASK\_EVENT\_OTHER)
      ;
675     \}
676 
677     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected})
678     \{
679         eventSet &= (~(PD\_TASK\_EVENT\_PHY\_STATE\_CHAGNE | PD\_TASK\_EVENT\_OTHER | 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ace1c61e1c2c9768ffea7e4ed3552dabd}{PD\_TASK\_EVENT\_FR\_SWAP\_SINGAL} |
680                        \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981a8d7dadfaeb7942924ec2e0b32f654c35}{PD\_TASK\_EVENT\_DPM\_MSG}));
681     \}
682     \textcolor{keywordflow}{else}
683     \{
684         eventSet &= (~(PD\_TASK\_EVENT\_PHY\_STATE\_CHAGNE | PD\_TASK\_EVENT\_OTHER | 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ace1c61e1c2c9768ffea7e4ed3552dabd}{PD\_TASK\_EVENT\_FR\_SWAP\_SINGAL}));
685     \}
686 
687     \textcolor{comment}{/* clear the events that aren't processed in this condition */}
688     \textcolor{keywordflow}{if} (eventSet)
689     \{
690         \textcolor{comment}{// 如果dpm state machine不存在}
691         \textcolor{keywordflow}{if} (!((pdInstance->\hyperlink{struct__pd__instance_a6e12cc53d94812cf2a28973fae7c6a7e}{dpmStateMachine} == 1) && (pdInstance->
      \hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected})))
692         \{
693             \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, eventSet);
694         \}
695     \}
696 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a39aa541f6a8e3843b3ab18fdcf533768_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a39aa541f6a8e3843b3ab18fdcf533768_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aa84db2763770b08d1dd666c12e4ec45b}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Can\-Pending\-Receive@{P\-D\-\_\-\-Psm\-Can\-Pending\-Receive}}
\index{P\-D\-\_\-\-Psm\-Can\-Pending\-Receive@{P\-D\-\_\-\-Psm\-Can\-Pending\-Receive}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Can\-Pending\-Receive}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Psm\-Can\-Pending\-Receive (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_aa84db2763770b08d1dd666c12e4ec45b}

\begin{DoxyCode}
2375 \{
2376     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac19a0ca772773bf8cdecb2f2000e0b9e}{PSM\_PE\_SNK\_STARTUP}) || (pdInstance->
      \hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a57438b2126556f03e6423fceef89c8a9}{PSM\_PE\_SNK\_DISCOVERY}) ||
2377         (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4ed497a81e543cc7428fcec9e2510f17}{PSM\_PE\_SNK\_TRANSITION\_TO\_DEFAULT}
      ) || (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET}))
2378     \{
2379         \textcolor{keywordflow}{return} 0;
2380     \}
2381 
2382     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac19a0ca772773bf8cdecb2f2000e0b9e}{PSM\_PE\_SNK\_STARTUP}) || (pdInstance->
      \hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a57438b2126556f03e6423fceef89c8a9}{PSM\_PE\_SNK\_DISCOVERY}) ||
2383         (pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4ed497a81e543cc7428fcec9e2510f17}{PSM\_PE\_SNK\_TRANSITION\_TO\_DEFAULT}
      ) || (pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET}))
2384     \{
2385         \textcolor{keywordflow}{return} 0;
2386     \}
2387 
2388     \textcolor{keywordflow}{return} 1;
2389 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa84db2763770b08d1dd666c12e4ec45b_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Command\-Fail@{P\-D\-\_\-\-Psm\-Command\-Fail}}
\index{P\-D\-\_\-\-Psm\-Command\-Fail@{P\-D\-\_\-\-Psm\-Command\-Fail}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Command\-Fail}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Command\-Fail (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{command}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046}

\begin{DoxyCode}
734 \{
735     uint32\_t commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
736     uint32\_t \textcolor{keyword}{event} = 0xFFFFFFFFu;
737 
738     \textcolor{keywordflow}{switch} (command)
739     \{
740         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa30530dc299e85a527d236c16e68bff36}{PD\_DPM\_CONTROL\_POWER\_NEGOTIATION}:
741         \{
742             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aece677cf125a9acd9546c1bc0f75b5b9}{commandIsInitiator})
743             \{
744                 \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a83108cfc7a063655541fa36c59b8ace8}{PD\_DPM\_SRC\_RDO\_FAIL};
745             \}
746             \textcolor{keywordflow}{else}
747             \{
748                 \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aa3476563b037797a05c3aeaeb347dc7c}{PD\_DPM\_SNK\_RDO\_FAIL};
749             \}
750             \textcolor{keywordflow}{break};
751         \}
752         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaba6e4b2d7dedd71db8266ca2c496af71}{PD\_DPM\_CONTROL\_REQUEST}:
753         \{
754             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
755             \{
756                 \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aa3476563b037797a05c3aeaeb347dc7c}{PD\_DPM\_SNK\_RDO\_FAIL};
757             \}
758             \textcolor{keywordflow}{else}
759             \{
760                 \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a83108cfc7a063655541fa36c59b8ace8}{PD\_DPM\_SRC\_RDO\_FAIL};
761             \}
762             \textcolor{keywordflow}{break};
763         \}
764         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa489f1c5b0996d8e8c13ba13bc89da9f8}{PD\_DPM\_CONTROL\_GOTO\_MIN}:
765         \{
766             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aece677cf125a9acd9546c1bc0f75b5b9}{commandIsInitiator})
767             \{
768                 \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8af4df2566f7dfb5614eab4183fd49d3bb}{PD\_DPM\_SRC\_GOTOMIN\_FAIL};
769             \}
770             \textcolor{keywordflow}{else}
771             \{
772                 \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac8eef85341e9ed1414592961c242e1e2}{PD\_DPM\_SNK\_GOTOMIN\_FAIL};
773             \}
774             \textcolor{keywordflow}{break};
775         \}
776         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET}:
777         \{
778             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a0c22065d3fb71fbfef9abe1a385dd661}{PD\_DPM\_SOFT\_RESET\_FAIL};
779             \textcolor{keywordflow}{break};
780         \}
781         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aabd4e605546d67fb4bbfad35ea77f5589}{PD\_DPM\_CONTROL\_HARD\_RESET}:
782         \{
783             \textcolor{comment}{/* hard reset will always success */}
784             \textcolor{keywordflow}{break};
785         \}
786 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
787 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa5bf96cb3d2c1316e33303794e70be8a4}{PD\_DPM\_CONTROL\_PR\_SWAP}:
788         \{
789             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a34537a7fbc8f9182d14d4ef32607f7c5}{PD\_DPM\_PR\_SWAP\_FAIL};
790             \textcolor{keywordflow}{break};
791         \}
792 \textcolor{preprocessor}{#endif}
793 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if (defined PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
794 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa7baf188a71537ab45cc32ff871765ef0}{PD\_DPM\_CONTROL\_DR\_SWAP}:
795         \{
796             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac43a8c3be37b3c4c33dd213e2bb1662d}{PD\_DPM\_DR\_SWAP\_FAIL};
797             \textcolor{keywordflow}{break};
798         \}
799 \textcolor{preprocessor}{#endif}
800 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if (defined PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
801 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa9be0b6c27f6eb87d6466b9697915f460}{PD\_DPM\_CONTROL\_VCONN\_SWAP}:
802         \{
803             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a7d1d0c1a00df8f90177fef2eaf7f1831}{PD\_DPM\_VCONN\_SWAP\_FAIL};
804             \textcolor{keywordflow}{break};
805         \}
806 \textcolor{preprocessor}{#endif}
807 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aae21522a20dc98bf1e6a27fd41104158a}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SOURCE\_CAPABILITIES}:
808         \{
809             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aee9e5991d19424456884d183c3892e84}{PD\_DPM\_GET\_PARTNER\_SRC\_CAP\_FAIL};
810             \textcolor{keywordflow}{break};
811         \}
812         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa4ea4864194875bf84ea3b2cf923a6f14}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SINK\_CAPABILITIES}:
813         \{
814             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a2b5e3e788da63ca93c05e4723fbd6046}{PD\_DPM\_GET\_PARTNER\_SNK\_CAP\_FAIL};
815             \textcolor{keywordflow}{break};
816         \}
817 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
818 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa9db050ca92168863b9d0d02111a62d1f}{PD\_DPM\_CONTROL\_DISCOVERY\_IDENTITY}:
819         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaee8cd08286d5286bdf2284f9af10e3ad}{PD\_DPM\_CONTROL\_DISCOVERY\_SVIDS}:
820         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaf975cd0b8e1039525d282a872236eb96}{PD\_DPM\_CONTROL\_DISCOVERY\_MODES}:
821         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaa2c72dc0674fc14bc03afbf89da88e2b}{PD\_DPM\_CONTROL\_ENTER\_MODE}:
822         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa979f0d2508a56e60739866d338599f73}{PD\_DPM\_CONTROL\_EXIT\_MODE}:
823         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaa667bfb403fe6661d8f5719edd81a281}{PD\_DPM\_CONTROL\_SEND\_ATTENTION}:
824         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa436be299ae6338153908ef5b59d5f84e}{PD\_DPM\_SEND\_VENDOR\_STRUCTURED\_VDM}:
825         \{
826             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a695e8a864e1ec8d4af67e207ff4a3496}{PD\_DPM\_STRUCTURED\_VDM\_FAIL};
827             \textcolor{keywordflow}{break};
828         \}
829         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaa91f5407fe2e9e626a11c16f151dced1}{PD\_DPM\_SEND\_UNSTRUCTURED\_VDM}:
830         \{
831             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ad3a77273432ced03f24d234487c6f072}{PD\_DPM\_SEND\_UNSTRUCTURED\_VDM\_FAIL};
832             \textcolor{keywordflow}{break};
833         \}
834 \textcolor{preprocessor}{#endif}
835 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if (defined PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
836 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aae13452ea340b015ac0aee25132562737}{PD\_DPM\_CONTROL\_CABLE\_RESET}:
837         \{
838             \textcolor{keywordflow}{break};
839         \}
840 \textcolor{preprocessor}{#endif}
841 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
842 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa878ef19e6ac385bd02876ceb23629865}{PD\_DPM\_GET\_SRC\_EXT\_CAP}:
843         \{
844             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a616a08f0f899286d5e61d8b56ceb8fc2}{PD\_DPM\_GET\_SRC\_EXT\_CAP\_FAIL};
845             \textcolor{keywordflow}{break};
846         \}
847         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aad86c8e205d8307f0e9891f594f801fd3}{PD\_DPM\_GET\_STATUS}:
848         \{
849             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a440bbb508768a0bccca64ebc450a001b}{PD\_DPM\_GET\_STATUS\_FAIL};
850             \textcolor{keywordflow}{break};
851         \}
852         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aac2fe93d0e29fa39cef8bd57f45ee5a05}{PD\_DPM\_GET\_BATTERY\_CAP}:
853         \{
854             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a728741dabfcf75b6187b16075e644879}{PD\_DPM\_GET\_BATTERY\_CAP\_FAIL};
855             \textcolor{keywordflow}{break};
856         \}
857         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaf908c79595be0dd645a1edd222cfa471}{PD\_DPM\_GET\_BATTERY\_STATUS}:
858         \{
859             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ae9bc65c9f7dad30f80fddc56d0d9b3b9}{PD\_DPM\_GET\_BATTERY\_STATUS\_FAIL};
860             \textcolor{keywordflow}{break};
861         \}
862         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa59afaaae85a74936ea0cc5f66b9fb4ae}{PD\_DPM\_GET\_MANUFACTURER\_INFO}:
863         \{
864             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aaf6af38ecf21f44fbd95f190eb8bee7c}{PD\_DPM\_GET\_MANUFACTURER\_INFO\_FAIL};
865             \textcolor{keywordflow}{break};
866         \}
867 \textcolor{preprocessor}{#if 0}
868 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} PD\_DPM\_SECURITY\_REQUEST:
869         \{
870             \textcolor{keyword}{event} = PD\_DPM\_SECURITY\_REQUEST\_FAIL;
871             \textcolor{keywordflow}{break};
872         \}
873         \textcolor{keywordflow}{case} PD\_DPM\_FIRMWARE\_UPDATE\_REQUEST:
874         \{
875             \textcolor{keywordflow}{break};
876         \}
877 \textcolor{preprocessor}{#endif}
878 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa8c3275bb19f98d5824b531743b7777a8}{PD\_DPM\_ALERT}:
879         \{
880             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a0cbb394fa1a8c85368a4d84c1e5647c2}{PD\_DPM\_SEND\_ALERT\_FAIL};
881             \textcolor{keywordflow}{break};
882         \}
883 \textcolor{preprocessor}{#endif}
884 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if (defined PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE) && (PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE)}
885 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa1af15d89c350437f5f4e8a95ea841f5b}{PD\_DPM\_FAST\_ROLE\_SWAP}:
886         \{
887             \textcolor{keyword}{event} = \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a410336358bacd4292bc294c26d850275}{PD\_DPM\_FR\_SWAP\_FAIL};
888             \textcolor{keywordflow}{break};
889         \}
890 \textcolor{preprocessor}{#endif}
891 \textcolor{preprocessor}{}
892         \textcolor{keywordflow}{default}:
893             \textcolor{keywordflow}{break};
894     \}
895 
896     \textcolor{keywordflow}{if} (event != 0xFFFFFFFFu)
897     \{
898         \textcolor{keywordflow}{if} (event != \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a695e8a864e1ec8d4af67e207ff4a3496}{PD\_DPM\_STRUCTURED\_VDM\_FAIL})
899         \{
900             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, event, &commandResultCallback, 1);
901         \}
902 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
903 \textcolor{preprocessor}{}        \textcolor{keywordflow}{else}
904         \{
905             \hyperlink{struct__pd__svdm__command__result}{pd\_svdm\_command\_result\_t} commandVdmResult;
906             commandVdmResult.\hyperlink{struct__pd__svdm__command__result_af52b0485285dda6a8eda1154989dc84e}{vdmCommandResult} = 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
907             commandVdmResult.\hyperlink{struct__pd__svdm__command__result_af1f46eb3cd5009b29a5f3ba293a5fc84}{vdmCommand} = pdInstance->
      \hyperlink{struct__pd__instance_a37746abee0ebb0169f8a1e7227d8645b}{structuredVdmCommandParameter}.\hyperlink{struct__pd__svdm__param_aaebc50d834d15e862f264a4e4d8421b4}{vdmHeader}.
      \hyperlink{struct__pd__structured__vdm__header_afc8471a70fa430820836286de3cf2281}{bitFields}.command;
908             commandVdmResult.\hyperlink{struct__pd__svdm__command__result_acd15ff8f7fe85b7e8ed891199339053f}{vdoData} = NULL;
909             commandVdmResult.\hyperlink{struct__pd__svdm__command__result_a347c19dd5209bb9ef874aa11caf4c07b}{vdoCount} = 0;
910 
911             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, event, &commandVdmResult, 1);
912         \}
913 \textcolor{preprocessor}{#endif}
914 \textcolor{preprocessor}{}    \}
915 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aec90d4fab260652b95f5027a080bff6b}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Connect@{P\-D\-\_\-\-Psm\-Connect}}
\index{P\-D\-\_\-\-Psm\-Connect@{P\-D\-\_\-\-Psm\-Connect}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Connect}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Connect (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_aec90d4fab260652b95f5027a080bff6b}

\begin{DoxyCode}
6420 \{
6421     \textcolor{comment}{/* Initialise static flags */}
6422     \hyperlink{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61}{PD\_PsmReset}(pdInstance);
6423 
6424     \textcolor{comment}{/* Enable Msg hardware at SNK/SRC STARTUP */}
6425 
6426     pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN};
6427 
6428     \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->
      \hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
6429 
6430     pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
6431     pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected} = 0;
6432 
6433     pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted} = 0;
6434     pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature} = 0;
6435     pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = 0;
6436     pdInstance->\hyperlink{struct__pd__instance_a6fb96c0e5c3f5f6f05f9964541078e3a}{dpmMsgBits} = 0;
6437     pdInstance->\hyperlink{struct__pd__instance_a2505651a0001ea647306dbd800927778}{waitTime} = \hyperlink{usb__pd__interface_8h_ac3471f042971fd1641303f2622b844c1}{PD\_WAIT\_EVENT\_TIME};
6438 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aec90d4fab260652b95f5027a080bff6b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aec90d4fab260652b95f5027a080bff6b_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aa2694544089f6e2d123810cd48b27d6e}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Disconnect@{P\-D\-\_\-\-Psm\-Disconnect}}
\index{P\-D\-\_\-\-Psm\-Disconnect@{P\-D\-\_\-\-Psm\-Disconnect}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Disconnect}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Disconnect (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_aa2694544089f6e2d123810cd48b27d6e}

\begin{DoxyCode}
6441 \{
6442     uint8\_t uint8Tmp;
6443 
6444     \hyperlink{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}{PD\_TimerCancelAllTimers}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89479a25c88b992d3de7e33b044d9ed9}{\_tMaxPSMTimer});
6445 
6446     uint8Tmp = 0;
6447     \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab364b8f9461757d17739cce20263b117}{PD\_PHY\_CONTROL\_FR\_SWAP}, &uint8Tmp);
6448 
6449     pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
6450     pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected} = 0;
6451 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
6452 \textcolor{preprocessor}{}    pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28ae0360c02ff4cf3244238399eab41ff6d}{kPD\_VconnNone};
6453 \textcolor{preprocessor}{#endif}
6454 \textcolor{preprocessor}{}    pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN};
6455     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN};
6456     pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature} = 0;
6457     pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = 0;
6458     pdInstance->\hyperlink{struct__pd__instance_a6fb96c0e5c3f5f6f05f9964541078e3a}{dpmMsgBits} = 0;
6459     pdInstance->\hyperlink{struct__pd__instance_a2505651a0001ea647306dbd800927778}{waitTime} = \hyperlink{usb__pd__interface_8h_ac3471f042971fd1641303f2622b844c1}{PD\_WAIT\_EVENT\_TIME};
6460 
6461     \textcolor{comment}{/* disconnect message layer */}
6462     \hyperlink{usb__pd__policy_8c_a4c31fc7951e54e4e153f64d3a8e229ef}{PD\_MsgDisable}(pdInstance);
6463 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa2694544089f6e2d123810cd48b27d6e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa2694544089f6e2d123810cd48b27d6e_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a9bfe23523b40ee86c423c43291017cc5}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-End\-Command@{P\-D\-\_\-\-Psm\-End\-Command}}
\index{P\-D\-\_\-\-Psm\-End\-Command@{P\-D\-\_\-\-Psm\-End\-Command}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-End\-Command}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-End\-Command (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{psm\-State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_a9bfe23523b40ee86c423c43291017cc5}

\begin{DoxyCode}
938 \{
939     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 0)
940     \{
941         \textcolor{keywordflow}{return};
942     \}
943     \textcolor{keywordflow}{else}
944     \{
945         uint8\_t commandFail = 0;
946 
947         \textcolor{keywordflow}{switch} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing})
948         \{
949             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aabd4e605546d67fb4bbfad35ea77f5589}{PD\_DPM\_CONTROL\_HARD\_RESET}:
950             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET}:
951             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aae13452ea340b015ac0aee25132562737}{PD\_DPM\_CONTROL\_CABLE\_RESET}:
952             \{
953                 \textcolor{comment}{/* process in the state machine */}
954                 \textcolor{keywordflow}{break};
955             \}
956 
957 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
958 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa5bf96cb3d2c1316e33303794e70be8a4}{PD\_DPM\_CONTROL\_PR\_SWAP}:
959             \{
960                 \textcolor{keywordflow}{switch} (psmState)
961                 \{
962                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7db6919f3f55617dd34bc46abf29161e}{PSM\_PE\_PRS\_SRC\_SNK\_EVALUATE\_PR\_SWAP}:
963                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4a2e496292036b37df3b8bdad96e77ad}{PSM\_PE\_PRS\_SRC\_SNK\_ACCEPT\_PR\_SWAP}:
964                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a6682413184083874a372c9279d133506}{PSM\_PE\_PRS\_SRC\_SNK\_TRANSITION\_TO\_OFF}:
965                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a165a967c143ef0f1f26c303f5040cc}{PSM\_PE\_PRS\_SRC\_SNK\_ASSERT\_RD}:
966                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af82fd0bf4ab2cb83e1b87082d53614c5}{PSM\_PE\_PRS\_SRC\_SNK\_WAIT\_SOURCE\_ON}:
967                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a90a6fac6bf8ce34a0c582b6e12a57f93}{PSM\_PE\_PRS\_SRC\_SNK\_SEND\_PR\_SWAP}:
968                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9965534c9faab71052dac41bd25c3dd6}{PSM\_PE\_PRS\_SRC\_SNK\_REJECT\_PR\_SWAP}:
969                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54e9738bc105950ed3e1d0d64db15003}{PSM\_PE\_PRS\_SNK\_SRC\_EVALUATE\_PR\_SWAP}:
970                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a05fb0276960dd087c9cf9bd2881c30fd}{PSM\_PE\_PRS\_SNK\_SRC\_ACCEPT\_PR\_SWAP}:
971                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF}:
972                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a33436131bac32830697c3445d9c7e633}{PSM\_PE\_PRS\_SNK\_SRC\_ASSERT\_RP}:
973                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af1c9746136c41bf190396db70f45b5fd}{PSM\_PE\_PRS\_SNK\_SRC\_SOURCE\_ON}:
974                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af3dfe785a6dc68a892001143f3a833c1}{PSM\_PE\_PRS\_SNK\_SRC\_SEND\_PR\_SWAP}:
975                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaf68bdaee11cc3cdb6828b0fa28a9870}{PSM\_PE\_PRS\_SNK\_SRC\_REJECT\_PR\_SWAP}:
976                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a97a2b4897b9f785e3cfbf2d641d54c85}{PSM\_PE\_PRS\_EVALUATE\_PR\_SWAP\_WAIT\_TIMER\_TIME\_OUT}
      :
977                         \textcolor{comment}{/* these states means the pr\_swap ams is processing */}
978                         \textcolor{keywordflow}{break};
979 
980                     \textcolor{keywordflow}{default}:
981                         \textcolor{comment}{/* PD\_DpmAppCallback(pdInstance, PD\_DPM\_PR\_SWAP\_FAIL, NULL, 1); */}
982                         commandFail = 1;
983                         \textcolor{keywordflow}{break};
984                 \}
985                 \textcolor{keywordflow}{break};
986             \}
987 \textcolor{preprocessor}{#endif}
988 \textcolor{preprocessor}{}
989             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaba6e4b2d7dedd71db8266ca2c496af71}{PD\_DPM\_CONTROL\_REQUEST}:
990                 \textcolor{keywordflow}{switch} (psmState)
991                 \{
992                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07e42e3c7b35e7235b32acef3caf77ca}{PSM\_PE\_SRC\_NEGOTIATE\_CAPABILITY}:
993                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf18258bbab5a008fe7f4b781df35055}{PSM\_PE\_SRC\_TRANSITION\_SUPPLY}:
994                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf98b7f6641597ec99b6fd883d2f13a9}{PSM\_PE\_SNK\_EVALUATE\_CAPABILITY}:
995                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK}:
996                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY}:
997                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8192e4ed5803b5a54d466ae63825869b}{PSM\_PE\_SNK\_SELECT\_CAPABILITY\_WAIT\_TIMER\_TIME\_OUT}
      :
998                         \textcolor{keywordflow}{break};
999 
1000                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}:
1001                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a685445e828df5a05b1084fd0ea75c10a}{psmSnkReceiveRdoWaitRetry})
1002                         \{
1003                             \textcolor{comment}{/* even in snk\_rdy bu it is wait reply */}
1004                         \}
1005                         \textcolor{keywordflow}{else}
1006                         \{
1007                             \textcolor{comment}{/* PD\_DpmAppCallback(pdInstance, PD\_DPM\_SNK\_RDO\_FAIL, NULL, 1); */}
1008                             commandFail = 1;
1009                         \}
1010                         \textcolor{keywordflow}{break};
1011 
1012                     \textcolor{keywordflow}{default}:
1013                         commandFail = 1;
1014                         \textcolor{keywordflow}{break};
1015                 \}
1016                 \textcolor{keywordflow}{break};
1017 
1018             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa30530dc299e85a527d236c16e68bff36}{PD\_DPM\_CONTROL\_POWER\_NEGOTIATION}:
1019                 \textcolor{keywordflow}{switch} (psmState)
1020                 \{
1021                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2adc31136486905eb9c680bdba8a6cc1}{PSM\_PE\_SRC\_DISCOVERY}:
1022                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07e42e3c7b35e7235b32acef3caf77ca}{PSM\_PE\_SRC\_NEGOTIATE\_CAPABILITY}:
1023                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf18258bbab5a008fe7f4b781df35055}{PSM\_PE\_SRC\_TRANSITION\_SUPPLY}:
1024                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK}:
1025                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY}:
1026                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8192e4ed5803b5a54d466ae63825869b}{PSM\_PE\_SNK\_SELECT\_CAPABILITY\_WAIT\_TIMER\_TIME\_OUT}
      :
1027                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES}:
1028                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES}:
1029                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a40e24a76e6666339493163131c5f697b}{PSM\_PE\_SNK\_GIVE\_SINK\_CAP}:
1030                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF}:
1031                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af3dfe785a6dc68a892001143f3a833c1}{PSM\_PE\_PRS\_SNK\_SRC\_SEND\_PR\_SWAP}:
1032                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0361f53d1396153b1405ab4b92c72b57}{PSM\_PE\_DR\_SNK\_GET\_SINK\_CAP}:
1033                         \textcolor{keywordflow}{break};
1034 
1035                     \textcolor{keywordflow}{default}:
1036                         commandFail = 1;
1037                         \textcolor{keywordflow}{break};
1038                 \}
1039                 \textcolor{keywordflow}{break};
1040 
1041             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aae21522a20dc98bf1e6a27fd41104158a}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SOURCE\_CAPABILITIES}
      :
1042                 \textcolor{keywordflow}{switch} (psmState)
1043                 \{
1044                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab06c1b31af9a26e8dc4d36a2091c2de5}{PSM\_PE\_DR\_SRC\_GET\_SOURCE\_CAP}:
1045                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a678da0d3de15c7db60380866e910151a}{PSM\_PE\_SNK\_GET\_SOURCE\_CAP}:
1046                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}:
1047                         \textcolor{keywordflow}{break};
1048 
1049                     \textcolor{keywordflow}{default}:
1050                         commandFail = 1;
1051                         \textcolor{keywordflow}{break};
1052                 \}
1053                 \textcolor{keywordflow}{break};
1054 
1055             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa4ea4864194875bf84ea3b2cf923a6f14}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SINK\_CAPABILITIES}:
1056                 \textcolor{keywordflow}{switch} (psmState)
1057                 \{
1058                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0361f53d1396153b1405ab4b92c72b57}{PSM\_PE\_DR\_SNK\_GET\_SINK\_CAP}:
1059                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a15beb3355a693f37d31884ede62f762b}{PSM\_PE\_SRC\_GET\_SINK\_CAP}:
1060                         \textcolor{keywordflow}{break};
1061 
1062                     \textcolor{keywordflow}{default}:
1063                         commandFail = 1;
1064                         \textcolor{keywordflow}{break};
1065                 \}
1066                 \textcolor{keywordflow}{break};
1067 
1068             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa489f1c5b0996d8e8c13ba13bc89da9f8}{PD\_DPM\_CONTROL\_GOTO\_MIN}:
1069                 \textcolor{keywordflow}{switch} (psmState)
1070                 \{
1071                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK}:
1072                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf18258bbab5a008fe7f4b781df35055}{PSM\_PE\_SRC\_TRANSITION\_SUPPLY}:
1073                         \textcolor{keywordflow}{break};
1074 
1075                     \textcolor{keywordflow}{default}:
1076                         commandFail = 1;
1077                         \textcolor{keywordflow}{break};
1078                 \}
1079                 \textcolor{keywordflow}{break};
1080 
1081 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
1082 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa7baf188a71537ab45cc32ff871765ef0}{PD\_DPM\_CONTROL\_DR\_SWAP}:
1083                 \textcolor{keywordflow}{switch} (psmState)
1084                 \{
1085                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a34b7b536dbe97967c88705e17a6476c9}{PSM\_PE\_DRS\_SEND\_DR\_SWAP}:
1086                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afe7bcc67019729a7d03718ab20e12ba1}{PSM\_PE\_DRS\_EVALUATE\_DR\_SWAP}:
1087                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a24ca713fa290717abf3128fe0a1ee8f3}{PSM\_PE\_DRS\_ACCEPT\_DR\_SWAP}:
1088                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a029215ad35201c3a7b851350004eb5e6}{PSM\_PE\_DRS\_REJECT\_DR\_SWAP}:
1089                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7df0dcbb30ba18f2d20055d1647f8a5d}{PSM\_PE\_DRS\_CHANGE\_TO\_DFP\_OR\_UFP}:
1090                         \textcolor{keywordflow}{break};
1091 
1092                     \textcolor{keywordflow}{default}:
1093                         commandFail = 1;
1094                         \textcolor{keywordflow}{break};
1095                 \}
1096                 \textcolor{keywordflow}{break};
1097 \textcolor{preprocessor}{#endif}
1098 \textcolor{preprocessor}{}
1099 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
1100 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa9be0b6c27f6eb87d6466b9697915f460}{PD\_DPM\_CONTROL\_VCONN\_SWAP}:
1101                 \textcolor{keywordflow}{switch} (psmState)
1102                 \{
1103                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53adbca6a8a2998452362aaab4a162429f1}{PSM\_PE\_VCS\_SEND\_SWAP}:
1104                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aacc2ab29ac13e773a3f3ed25896b4558}{PSM\_PE\_VCS\_WAIT\_FOR\_VCONN}:
1105                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a63b57ac70529dfc60b6ef5ed6d376ab9}{PSM\_PE\_VCS\_TURN\_OFF\_VCONN}:
1106                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af40a2f2088294611eeea6139d7aea036}{PSM\_PE\_VCS\_TURN\_ON\_VCONN}:
1107                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a86c2f73cb6f0cfdcf8eb50a2cd059b67}{PSM\_PE\_VCS\_SEND\_PS\_RDY}:
1108                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af2a6cc4fda5cb17811ba28a6ccd6d655}{PSM\_PE\_VCS\_EVALUATE\_SWAP}:
1109                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0e11220552b9c86fc31fbba16f79d407}{PSM\_PE\_VCS\_ACCEPT\_SWAP}:
1110                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2c1da5cc0e54d0a7bff4ce8572f80355}{PSM\_PE\_VCS\_REJECT\_SWAP}:
1111                         \textcolor{keywordflow}{break};
1112 
1113                     \textcolor{keywordflow}{default}:
1114                         commandFail = 1;
1115                         \textcolor{keywordflow}{break};
1116                 \}
1117                 \textcolor{keywordflow}{break};
1118 \textcolor{preprocessor}{#endif}
1119 \textcolor{preprocessor}{}
1120             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa878ef19e6ac385bd02876ceb23629865}{PD\_DPM\_GET\_SRC\_EXT\_CAP}:
1121                 \textcolor{keywordflow}{switch} (psmState)
1122                 \{
1123                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53abfae41fb2e0b07c69972b7f867f481a2}{PE\_SNK\_GET\_SOURCE\_CAP\_EXT}:
1124                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5bac4330356f778b9e20754522461eda}{PE\_DR\_SRC\_GET\_SOURCE\_CAP\_EXT}:
1125                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5f13bce14390ab3def43ae3686c0c6bc}{PE\_SRC\_GIVE\_SOURCE\_CAP\_EXT}:
1126                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0d85591e71aecb4f469db52ddc0e93f1}{PE\_DR\_SNK\_GIVE\_SOURCE\_CAP\_EXT}:
1127                         \textcolor{keywordflow}{break};
1128 
1129                     \textcolor{keywordflow}{default}:
1130                         commandFail = 1;
1131                         \textcolor{keywordflow}{break};
1132                 \}
1133                 \textcolor{keywordflow}{break};
1134 
1135 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
1136 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aad86c8e205d8307f0e9891f594f801fd3}{PD\_DPM\_GET\_STATUS}:
1137                 \textcolor{keywordflow}{switch} (psmState)
1138                 \{
1139                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afcd6a556470cb00cee096f4dd9733c25}{PE\_SNK\_Get\_Source\_Status}:
1140                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a629beb778f1bc627886c404652e35f6e}{PE\_SRC\_Give\_Source\_Status}:
1141                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53affec79782a2b4897fa8d1913c5be4760}{PE\_SRC\_Get\_Sink\_Status}:
1142                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a46420dcce07f7327115051c8c6a31588}{PE\_SNK\_Give\_Sink\_Status}:
1143                         \textcolor{keywordflow}{break};
1144 
1145                     \textcolor{keywordflow}{default}:
1146                         commandFail = 1;
1147                         \textcolor{keywordflow}{break};
1148                 \}
1149                 \textcolor{keywordflow}{break};
1150 
1151             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aac2fe93d0e29fa39cef8bd57f45ee5a05}{PD\_DPM\_GET\_BATTERY\_CAP}:
1152                 \textcolor{keywordflow}{switch} (psmState)
1153                 \{
1154                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af57f1b28d1d2e5c70927ab5be1fc8d1f}{PE\_Give\_Battery\_Cap}:
1155                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a80ecd4021c5388f51469f70534bc96c4}{PE\_Get\_Battery\_Cap}:
1156                         \textcolor{keywordflow}{break};
1157 
1158                     \textcolor{keywordflow}{default}:
1159                         commandFail = 1;
1160                         \textcolor{keywordflow}{break};
1161                 \}
1162                 \textcolor{keywordflow}{break};
1163 
1164             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaf908c79595be0dd645a1edd222cfa471}{PD\_DPM\_GET\_BATTERY\_STATUS}:
1165                 \textcolor{keywordflow}{switch} (psmState)
1166                 \{
1167                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5c59fac69248ef645437145785e5f13a}{PE\_Get\_Battery\_Status}:
1168                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3786ef2885ab7d4ff175973e2c0f7953}{PE\_Give\_Battery\_Status}:
1169                         \textcolor{keywordflow}{break};
1170 
1171                     \textcolor{keywordflow}{default}:
1172                         commandFail = 1;
1173                         \textcolor{keywordflow}{break};
1174                 \}
1175                 \textcolor{keywordflow}{break};
1176 
1177             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa59afaaae85a74936ea0cc5f66b9fb4ae}{PD\_DPM\_GET\_MANUFACTURER\_INFO}:
1178                 \textcolor{keywordflow}{switch} (psmState)
1179                 \{
1180                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a77041c81b4c648b823006673db2f5cc8}{PE\_Get\_Manfacturer\_Info}:
1181                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a395aa353974c638755b42084e94b1eef}{PE\_Give\_Manufacturer\_Info}:
1182                         \textcolor{keywordflow}{break};
1183 
1184                     \textcolor{keywordflow}{default}:
1185                         commandFail = 1;
1186                         \textcolor{keywordflow}{break};
1187                 \}
1188                 \textcolor{keywordflow}{break};
1189 
1190 \textcolor{preprocessor}{#if 0}
1191 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} PD\_DPM\_SECURITY\_REQUEST:
1192                 \textcolor{keywordflow}{switch} (psmState)
1193                 \{
1194                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac39b4eb7ba5e8588f0e1de6ae536471c}{PE\_Send\_Security\_Request}:
1195                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9044ca4d4b7a47e0cc8a2573f1fc2bc0}{PE\_Send\_Security\_Response}:
1196                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ad7045267a261d8ee3f7c91e73df6d4ae}{PE\_Security\_Response\_Received}:
1197                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}:
1198                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY}:
1199                         \textcolor{keywordflow}{break};
1200 
1201                     \textcolor{keywordflow}{default}:
1202                         commandFail = 1;
1203                         \textcolor{keywordflow}{break};
1204                 \}
1205                 \textcolor{keywordflow}{break};
1206 \textcolor{preprocessor}{#endif}
1207 \textcolor{preprocessor}{}
1208             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa8c3275bb19f98d5824b531743b7777a8}{PD\_DPM\_ALERT}:
1209                 \textcolor{keywordflow}{switch} (psmState)
1210                 \{
1211                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2dcb3235f416900d5e592106f412fb52}{PE\_SRC\_Send\_Source\_Alert}:
1212                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4a655ea5b215db30df1459c393425729}{PE\_SNK\_Source\_Alert\_Received}:
1213                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a935b7e5abe53a0d4540a90b9fac249c9}{PE\_SNK\_Send\_Sink\_Alert}:
1214                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afb6007f96712d3851d3a865e8a537013}{PE\_SRC\_Sink\_Alert\_Received}:
1215                         \textcolor{keywordflow}{break};
1216 
1217                     \textcolor{keywordflow}{default}:
1218                         commandFail = 1;
1219                         \textcolor{keywordflow}{break};
1220                 \}
1221                 \textcolor{keywordflow}{break};
1222 \textcolor{preprocessor}{#endif}
1223 \textcolor{preprocessor}{}
1224 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE) && (PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE)}
1225 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa1af15d89c350437f5f4e8a95ea841f5b}{PD\_DPM\_FAST\_ROLE\_SWAP}:
1226                 \textcolor{keywordflow}{switch} (psmState)
1227                 \{
1228                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aca9891b871efc6127b397c6b17857e08}{PE\_FRS\_SRC\_SNK\_CC\_Signal}:
1229                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a89ca1efc4d454ffafc177960fae69142}{PE\_FRS\_SRC\_SNK\_Evaluate\_Swap}:
1230                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a635136bc155da92ff2ddf4d7ff117bc5}{PE\_FRS\_SRC\_SNK\_Accept\_Swap}:
1231                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a19390f414f766b3ea0e0fbae002bb448}{PE\_FRS\_SRC\_SNK\_Transition\_to\_off}:
1232                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7bf4eddebf37afd4745a11794066b2c8}{PE\_FRS\_SRC\_SNK\_Assert\_Rd}:
1233                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a2a2b0b602f73ff578e9643e90e22ec}{PE\_FRS\_SRC\_SNK\_Wait\_Source\_on}:
1234                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aa1ded4aeaaf1546c7d1b30f9a72d8233}{PE\_FRS\_SNK\_SRC\_Send\_Swap}:
1235                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a22771f42025488c2aa330eee49a96f46}{PE\_FRS\_SNK\_SRC\_Transition\_to\_off}:
1236                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a53aba4689937ad582cd75f1dc965829a}{PE\_FRS\_SNK\_SRC\_Vbus\_Applied}:
1237                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a60d82df8a488c0e926e61c63a400c3cb}{PE\_FRS\_SNK\_SRC\_Assert\_Rp}:
1238                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4565bf4c2747ac56426468c852d9f03d}{PE\_FRS\_SNK\_SRC\_Source\_on}:
1239                         \textcolor{keywordflow}{break};
1240 
1241                     \textcolor{keywordflow}{default}:
1242                         commandFail = 1;
1243                         \textcolor{keywordflow}{break};
1244                 \}
1245                 \textcolor{keywordflow}{break};
1246 \textcolor{preprocessor}{#endif}
1247 \textcolor{preprocessor}{}
1248             \textcolor{keywordflow}{default}:
1249             \{
1250                 \textcolor{keywordflow}{break};
1251             \}
1252         \}
1253 
1254         \textcolor{keywordflow}{if} (commandFail)
1255         \{
1256             \hyperlink{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046}{PD\_PsmCommandFail}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing});
1257         \}
1258     \}
1259 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a9bfe23523b40ee86c423c43291017cc5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a9bfe23523b40ee86c423c43291017cc5_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_afbd2eb3bceb62f29229f0bff6eed6844}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Enter\-State@{P\-D\-\_\-\-Psm\-Enter\-State}}
\index{P\-D\-\_\-\-Psm\-Enter\-State@{P\-D\-\_\-\-Psm\-Enter\-State}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Enter\-State}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Psm\-Enter\-State (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_afbd2eb3bceb62f29229f0bff6eed6844}

\begin{DoxyCode}
4214 \{
4215     \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t} prevState;
4216     uint32\_t inCase32Tmp = 0;
4217     \textcolor{comment}{// error code}
4218     \hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\_status\_t} sendStatus = \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073a4d58370b8ee8d3d2a4c477f7a3f84dda}{kStatus\_PD\_Error};
4219     uint8\_t didNothingC = 1;
4220 
4221     (void)sendStatus;
4222     \textcolor{comment}{// 如果之前是unknown state， 则New置为idle}
4223     \textcolor{keywordflow}{while} (pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} != pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState})
4224     \{
4225         didNothingC = 0;
4226         \textcolor{comment}{// 保存当前state, 将当前state置为new state}
4227         prevState = pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState};
4228         pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} = pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState};
4229 
4230         \textcolor{keywordflow}{switch} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState})
4231         \{
4232             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}: \textcolor{comment}{/* (C) */}
4233                 pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} = 0;
4234 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SOURCE\_ROLE\_ENABLE) && (PD\_CONFIG\_SOURCE\_ROLE\_ENABLE)}
4235 \textcolor{preprocessor}{}                pdInstance->\hyperlink{struct__pd__instance_aec485d99451925aec7a6237f92791cd3}{psmCapsCounter} = 0;
4236 \textcolor{preprocessor}{#endif}
4237 \textcolor{preprocessor}{}                \textcolor{comment}{/* kVbusPower\_InHardReset is end */}
4238                 \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
4239                 \hyperlink{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653}{PD\_MsgReset}(pdInstance);
4240                 \hyperlink{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61}{PD\_PsmReset}(pdInstance);
4241                 \textcolor{comment}{// 该timer的作用？ Spec中没有记录}
4242                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a2d9a457d63da9c4cb5e3feece0cbf3ec}{pdConfig}->\hyperlink{struct__pd__instance__config_a68e8aae835b95ae67d48701973864acf}{deviceType} == 
      \hyperlink{group__usb__pd__stack_gga922338772b41ceba51f7881c74b9e20aa529a07dcc02eddbe7318fb5d98d6d9a8}{kDeviceType\_AlternateModeProduct})
4243                 \{
4244                     \textcolor{comment}{/* If we are an alternate mode adapter, then set tAMETimeout. */}
4245                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa30444778033546172c76622995ada281}{tAMETimeoutTimer}, 
      \hyperlink{usb__pd__timer_8h_ac7da483b951347f964a3a96309855eb7}{T\_AME\_TIMEOUT});
4246                 \}
4247 
4248                 \textcolor{comment}{// 如果配置成source， 但是stack的source role相关没有enable，则newstate = bypass}
4249                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
4250                 \{
4251 \textcolor{comment}{// 两个条件，定义了，并且定义了非零值}
4252 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SOURCE\_ROLE\_ENABLE) && (PD\_CONFIG\_SOURCE\_ROLE\_ENABLE)}
4253 \textcolor{preprocessor}{}                    pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
4254                     pdInstance->\hyperlink{struct__pd__instance_a3b09927227c17d95712a2af3d5f921f2}{enterSrcFromSwap} = 0;
4255                     \textcolor{comment}{// 这里开始了pe state的变化}
4256                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ae9194b9c8e1e319ab3a3c3bb25fd51}{PSM\_PE\_SRC\_STARTUP};
4257 \textcolor{preprocessor}{#else}
4258 \textcolor{preprocessor}{}                    pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a31811e7eea7b85fabd5d14eae04869d1}{PSM\_BYPASS};
4259 \textcolor{preprocessor}{#endif}
4260 \textcolor{preprocessor}{}                \}
4261                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
4262                 \{
4263 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SINK\_ROLE\_ENABLE) && (PD\_CONFIG\_SINK\_ROLE\_ENABLE)}
4264 \textcolor{preprocessor}{}                    pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink};
4265                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac19a0ca772773bf8cdecb2f2000e0b9e}{PSM\_PE\_SNK\_STARTUP};
4266 \textcolor{preprocessor}{#else}
4267 \textcolor{preprocessor}{}                    pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a31811e7eea7b85fabd5d14eae04869d1}{PSM\_BYPASS};
4268 \textcolor{preprocessor}{#endif}
4269 \textcolor{preprocessor}{}                \}
4270                 \textcolor{keywordflow}{break};
4271 
4272             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ee6a2f41bbfa406b9492016783b6b18}{PSM\_INTERRUPTED\_REQUEST}: \textcolor{comment}{/* (C) */}
4273                 \textcolor{keywordflow}{break};
4274 
4275             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET}: \textcolor{comment}{/* (C) */}
4276 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SINK\_ROLE\_ENABLE) && (PD\_CONFIG\_SINK\_ROLE\_ENABLE)}
4277 \textcolor{preprocessor}{}                \textcolor{comment}{/* Do this as early as possible, to prevent disconnects */}
4278                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
4279                 \{
4280                     \textcolor{comment}{/* Hard Reset is in progress, ignore VBus going away */}
4281                     \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771ba08bcf27d29365689235f1a3f6b683a09}{kVbusPower\_InHardReset});
4282                 \}
4283 \textcolor{preprocessor}{#endif}
4284 \textcolor{preprocessor}{}                \hyperlink{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61}{PD\_PsmReset}(pdInstance);
4285                 \textcolor{comment}{/* Delay for 1ms to make sure any previous GoodCRC tranmission has ended. */}
4286                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a3d7e832f23ba73275f9245159dfe475c}{mSec}(1));
4287                 \textcolor{keywordflow}{while} (!(\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer})))
4288                 \{
4289                     ;
4290                 \}
4291                 \textcolor{comment}{/* source send hard\_reset, 1. send hard\_reset msg. */}
4292                 \hyperlink{usb__pd__policy_8c_ab97edd8ad822d84ac4c3c60716d949e6}{PD\_MsgSendHardReset}(pdInstance);
4293                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
4294                 \{
4295                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa50101b7f5beaa5d160ec488d4a47a57a}{tPSHardResetTimer}, 
      \hyperlink{usb__pd__timer_8h_a637462f763d08a187183fd8c067ae6e4}{T\_PS\_HARD\_RESET});
4296                 \}
4297                 pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount}++;
4298                 \textcolor{keywordflow}{break};
4299 
4300             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}: \textcolor{comment}{/* (C) */}
4301             \{
4302                 \textcolor{comment}{/* Interate at least 1 time to cover an RX between our initial discard, and tx completion 
      */}
4303                 inCase32Tmp = 1; \textcolor{comment}{/* as retry time variable */}
4304 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
4305 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (0 \textcolor{comment}{/*pdInstance->psmSoftResetSop != kPD\_MsgSOP */})
4306                 \{
4307                     PD\_PsmSecondaryStateHandlerTerminate(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_a80a39754275c80b96db63d02b7e049ec}{psmSoftResetSop});
4308                     \textcolor{comment}{/*Pd\_PsmSecondaryStateHandler(pdInstance, pdInstance->psmSoftResetSop,
       pdInstance->psmSoftResetSop,}
4309 \textcolor{comment}{                     */}
4310                     \textcolor{comment}{/*&triggerInfo); */}
4311                 \}
4312 \textcolor{preprocessor}{#endif}
4313 \textcolor{preprocessor}{}
4314                 \textcolor{keywordflow}{while} (1)
4315                 \{
4316                     \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__policy_8c_a3020cc9ec6198c8c996b4c0dbdba937d}{PD\_MsgSend}(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bac009832ce574102c19d98de13758e68f}{kPD\_MsgSoftReset}, 2, NULL) == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success}) &&
4317                         \hyperlink{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}{PD\_MsgWaitSendResult}(pdInstance))
4318                     \{
4319                         \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4320                         \textcolor{keywordflow}{break};
4321                     \}
4322                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4}{PD\_MsgRecvPending}(pdInstance) &&
4323                               (((\hyperlink{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}{MSG\_DATA\_HEADER} & 
      \hyperlink{usb__pd__spec_8h_a13f0f9266cf4b2158dfb505a2322684a}{PD\_MSG\_HEADER\_MESSAGE\_TYPE\_MASK}) >>
4324                                 \hyperlink{usb__pd__spec_8h_a86a7dc4b5a4755e8ead223d653adfcbe}{PD\_MSG\_HEADER\_MESSAGE\_TYPE\_POS}) == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bac009832ce574102c19d98de13758e68f}{kPD\_MsgSoftReset})) ||
4325                              (pdInstance->\hyperlink{struct__pd__instance_af70b04cd5c8187c6a0424dea57205e8c}{hardResetReceived}))
4326                     \{
4327                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET})
4328                         \{
4329                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ad1d3a3dd48dcbb93d29eee4e09093770}{PD\_DPM\_SOFT\_RESET\_SUCCESS}, NULL, 1);
4330                         \}
4331                         \textcolor{keywordflow}{else}
4332                         \{
4333                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a55e5b428b44bfbcef61a8fc137370c60}{PD\_DPM\_SOFT\_RESET\_REQUEST}, NULL, 0);
4334                         \}
4335                         \textcolor{keywordflow}{break};
4336                     \}
4337                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4}{PD\_MsgRecvPending}(pdInstance))
4338                     \{
4339                         \textcolor{keywordflow}{if} (inCase32Tmp > 0)
4340                         \{
4341                             inCase32Tmp--;
4342                             \textcolor{keywordflow}{continue};
4343                         \}
4344                         \textcolor{keywordflow}{else}
4345                         \{
4346                             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET})
4347                             \{
4348                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a0c22065d3fb71fbfef9abe1a385dd661}{PD\_DPM\_SOFT\_RESET\_FAIL}, NULL, 1);
4349                             \}
4350                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
4351                             \textcolor{comment}{/* TODO: else send cable reset */}
4352                             \textcolor{keywordflow}{break};
4353                         \}
4354                     \}
4355                     \textcolor{keywordflow}{else}
4356                     \{
4357                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET})
4358                         \{
4359                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a0c22065d3fb71fbfef9abe1a385dd661}{PD\_DPM\_SOFT\_RESET\_FAIL}, NULL, 1);
4360                         \}
4361                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
4362                         \textcolor{keywordflow}{break};
4363                     \}
4364                 \}
4365                 \textcolor{keywordflow}{break};
4366             \}
4367 
4368             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac33b51e9f31d333a18f537e5d0be8579}{PSM\_SOFT\_RESET}: \textcolor{comment}{/* (C) */}
4369                 \textcolor{comment}{/* Alert the DPM so it can reset it's state */}
4370                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
4371                 \{
4372                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7b68a9659f79097c9ddb0a11144eab1d}{PSM\_PE\_SRC\_IMPLICIT\_CABLE\_DISCOVERY};
4373                 \}
4374                 \textcolor{keywordflow}{else}
4375                 \{
4376                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES};
4377                 \}
4378 
4379                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET},
4380                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET}))
4381                 \{
4382                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a55e5b428b44bfbcef61a8fc137370c60}{PD\_DPM\_SOFT\_RESET\_REQUEST}, NULL, 0);
4383                 \}
4384                 \textcolor{keywordflow}{break};
4385 
4386 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SOURCE\_ROLE\_ENABLE) && (PD\_CONFIG\_SOURCE\_ROLE\_ENABLE)}
4387 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ae9194b9c8e1e319ab3a3c3bb25fd51}{PSM\_PE\_SRC\_STARTUP}: \textcolor{comment}{/* (C) */}
4388                 pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
4389                 pdInstance->\hyperlink{struct__pd__instance_aec485d99451925aec7a6237f92791cd3}{psmCapsCounter} = 0;
4390 
4391                 \textcolor{comment}{/* kVbusPower\_InHardReset is end */}
4392                 \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
4393                 \textcolor{comment}{/* Delay for 1ms to make sure any previous GoodCRC tranmission has ended. */}
4394                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a3d7e832f23ba73275f9245159dfe475c}{mSec}(1));
4395                 \textcolor{keywordflow}{while} (!(\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer})))
4396                 \{
4397                     ;
4398                 \}
4399                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
4400                 ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->dataRole = pdInstance->
      \hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole};
4401                 ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->powerRole = pdInstance
      ->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole};
4402                 ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->cablePlug = 0;
4403 \textcolor{preprocessor}{#if (defined PD\_SPEC\_REVISION\_ISSUE\_FIX) && (PD\_SPEC\_REVISION\_ISSUE\_FIX)}
4404 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision} >= \hyperlink{group__usb__pd__stack_ga4be9f8c2d24914f46c855883891789e0}{PD\_SPEC\_REVISION\_30})
4405                 \{
4406                     ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->revision = 
      \hyperlink{group__usb__pd__stack_ga24966fea2a4e7d202653403ffb4dc4a4}{PD\_SPEC\_REVISION\_20};
4407                 \}
4408                 \textcolor{keywordflow}{else}
4409 \textcolor{preprocessor}{#endif}
4410 \textcolor{preprocessor}{}                \{
4411                     ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->revision = 
      pdInstance->\hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision};
4412                 \}
4413                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab459c8f89653d73a0d318cd30c0a1fc5}{PD\_PHY\_SET\_MSG\_HEADER\_INFO}, &inCase32Tmp);
4414                 \hyperlink{usb__pd__policy_8c_a6ab430500b707d49e6f44a32e91d1aa9}{PD\_MsgStartReceive}(pdInstance);
4415 
4416                 \textcolor{comment}{/* A large value allows the sink to debounce CC and VBUS after the connection. */}
4417                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3b09927227c17d95712a2af3d5f921f2}{enterSrcFromSwap})
4418                 \{
4419                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fab577ba31a79927d95fc5d5e7b8e4c967}{tSwapSourceStartTimer}, 
      \hyperlink{usb__pd__timer_8h_a6249a496e146a1e8474f3f24d0cd7a4a}{T\_SEND\_SOURCE\_CAP});
4420                 \}
4421                 \textcolor{keywordflow}{else}
4422                 \{
4423                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7b68a9659f79097c9ddb0a11144eab1d}{PSM\_PE\_SRC\_IMPLICIT\_CABLE\_DISCOVERY};
4424                 \}
4425                 \textcolor{keywordflow}{break};
4426 
4427             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2adc31136486905eb9c680bdba8a6cc1}{PSM\_PE\_SRC\_DISCOVERY}: \textcolor{comment}{/* (C) */}
4428                 pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
4429                 \textcolor{comment}{/* Do not clear previouslyPdConnected here */}
4430                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fac35ed3ca07f48b47d9642e95404c25ce}{tSourceCapabilityTimer}, 
      \hyperlink{usb__pd__timer_8h_a6249a496e146a1e8474f3f24d0cd7a4a}{T\_SEND\_SOURCE\_CAP});
4431                 \textcolor{keywordflow}{break};
4432 
4433             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7b68a9659f79097c9ddb0a11144eab1d}{PSM\_PE\_SRC\_IMPLICIT\_CABLE\_DISCOVERY}: \textcolor{comment}{/* (C) */}
4434 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SRC\_AUTO\_DISCOVER\_CABLE\_PLUG) && (PD\_CONFIG\_SRC\_AUTO\_DISCOVER\_CABLE\_PLUG)}
4435 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a5905690cc5a12a0758be0574d4bc262e}{raPresent}) && (pdInstance->
      \hyperlink{struct__pd__instance_af7a143c0a8141d2a359a5ce18eb708f6}{psmCableDiscoveried} == 0))
4436                 \{
4437 \textcolor{preprocessor}{#if 0}
4438 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ee6a2f41bbfa406b9492016783b6b18}{PSM\_INTERRUPTED\_REQUEST}) &&
4439                         (pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[1] == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}) &&
4440                         (pdInstance->\hyperlink{struct__pd__instance_a539e99b475d489e955238343ca800918}{psmNewSecondaryState}[1] == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN}))
4441 \textcolor{preprocessor}{#endif}
4442 \textcolor{preprocessor}{}                    \{
4443                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a7be408d709efe6ec210d68a3d4098cc9}{psmCablePlugResetNeeded})
4444                         \{
4445                             pdInstance->\hyperlink{struct__pd__instance_a539e99b475d489e955238343ca800918}{psmNewSecondaryState}[1] = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a683cd0be21856436ef4b97f8d0d6cca7}{PSM\_PE\_SRC\_IMPLICIT\_CABLE\_SOFT\_RESET};
4446                         \}
4447                         \textcolor{keywordflow}{else}
4448                         \{
4449                             pdInstance->\hyperlink{struct__pd__instance_a539e99b475d489e955238343ca800918}{psmNewSecondaryState}[1] = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac14566abe82d32c9b6ad7ebd6910add7}{PSM\_PE\_SRC\_VDM\_IDENTITY\_REQUEST};
4450                         \}
4451                     \}
4452                 \}
4453                 \textcolor{keywordflow}{else}
4454 \textcolor{preprocessor}{#endif}
4455 \textcolor{preprocessor}{}                \{
4456                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES};
4457                 \}
4458                 \textcolor{keywordflow}{break};
4459 
4460             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES}: \textcolor{comment}{/* (C) */}
4461                 pdInstance->\hyperlink{struct__pd__instance_ad5c623ba7be298aa8ecdad50a298d609}{selfOrPartnerFirstSourcePDO}.
      \hyperlink{struct__pd__source__pdo_ae7c1220b81dd8506c6731d7a6adc6ac9}{PDOValue} = pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a12847f31ee382d4bdee4067c9ee177f4}{sourceCaps}[0];
4462                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 0)
4463                 \{
4464                     \textcolor{comment}{/* case1: the start-up state machine; case2: dpm msg PD\_DPM\_CONTROL\_POWER\_NEGOTIATION 
      */}
4465                     \textcolor{keywordflow}{if} (!\hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{PD\_PsmStartCommand}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa30530dc299e85a527d236c16e68bff36}{PD\_DPM\_CONTROL\_POWER\_NEGOTIATION}, 1))
4466                     \{
4467                         \textcolor{comment}{/* invalid code, for coverity fix. */}
4468                         pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = 0;
4469                     \}
4470                 \}
4471                 pdInstance->\hyperlink{struct__pd__instance_aec485d99451925aec7a6237f92791cd3}{psmCapsCounter}++;
4472                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(
4473                         pdInstance, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba398e213caf8239ca95470df3bb2cdbf8}{kPD\_MsgSourceCapabilities}, pdInstance->
      \hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a7cf6689616437623deb3b42e5467e26f}{sourceCapCount},
4474                         PD\_PsmGetSourcePDOs(pdInstance), \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX},
4475                         pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} ? 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET} : \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2adc31136486905eb9c680bdba8a6cc1}{PSM\_PE\_SRC\_DISCOVERY}))
4476                 \{
4477                     pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 1;
4478                     pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected} = 1;
4479                     \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer});
4480                     pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} = 0;
4481                     pdInstance->\hyperlink{struct__pd__instance_aec485d99451925aec7a6237f92791cd3}{psmCapsCounter} = 0;
4482                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4483                 \}
4484                 \textcolor{keywordflow}{break};
4485 
4486             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07e42e3c7b35e7235b32acef3caf77ca}{PSM\_PE\_SRC\_NEGOTIATE\_CAPABILITY}: \textcolor{comment}{/* (C) */}
4487             \{
4488                 \hyperlink{struct__pd__negotiate__power__request}{pd\_negotiate\_power\_request\_t} negotiateResult;
4489 
4490                 \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_ad8cdcafc4b643a8f147febada1cd5704}{partnerRdoRequest}.\hyperlink{struct__pd__rdo_acd03d551b682b870d0e30be5819d013e}{bitFields}.unchunkedSupported) 
      &&
4491                     (pdInstance->\hyperlink{struct__pd__instance_ad5c623ba7be298aa8ecdad50a298d609}{selfOrPartnerFirstSourcePDO}.
      \hyperlink{struct__pd__source__pdo_a2405f8ee75a370cba4a48b94080958b1}{fixedPDO}.\hyperlink{struct__pd__source__fixed__pdo_a6e793acf2c695c57030e59f28dc5b65a}{unchunkedSupported}))
4492                 \{
4493                     pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature} = 1;
4494                 \}
4495                 \textcolor{keywordflow}{else}
4496                 \{
4497                     pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature} = 0;
4498                 \}
4499 
4500                 negotiateResult.\hyperlink{struct__pd__negotiate__power__request_a6a2c0c69d7a8506ef0334d0718a28191}{rdo} = pdInstance->\hyperlink{struct__pd__instance_ad8cdcafc4b643a8f147febada1cd5704}{partnerRdoRequest};
4501                 negotiateResult.\hyperlink{struct__pd__negotiate__power__request_ac2aedb2edf9cb0038c459dface0494bf}{negotiateResult} = 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca5cbc28129fbc8ef711e9af7a9400d858}{kCommandResult\_Accept};
4502                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a49dbf9ff2b5fba3ef05e0bf4da9ee7f6}{PD\_DPM\_SRC\_RDO\_REQUEST}, &negotiateResult, 0);
4503                 \textcolor{keywordflow}{if} (negotiateResult.\hyperlink{struct__pd__negotiate__power__request_ac2aedb2edf9cb0038c459dface0494bf}{negotiateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca5cbc28129fbc8ef711e9af7a9400d858}{kCommandResult\_Accept})
4504                 \{
4505                     pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx} = 0;
4506                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf18258bbab5a008fe7f4b781df35055}{PSM\_PE\_SRC\_TRANSITION\_SUPPLY};
4507                 \}
4508                 \textcolor{keywordflow}{else}
4509                 \{
4510                     pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} = negotiateResult.
      \hyperlink{struct__pd__negotiate__power__request_ac2aedb2edf9cb0038c459dface0494bf}{negotiateResult};
4511                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a682c505e7fe7715ccaa592381fd6991b}{PSM\_PE\_SRC\_CAPABILITY\_RESPONSE};
4512                 \}
4513                 \textcolor{keywordflow}{break};
4514             \}
4515 
4516             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf18258bbab5a008fe7f4b781df35055}{PSM\_PE\_SRC\_TRANSITION\_SUPPLY}: \textcolor{comment}{/* (C) */}
4517                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx})
4518                 \{
4519                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba732396571141818b340dad03d43aa467}{kPD\_MsgGotoMin};
4520                 \}
4521                 \textcolor{keywordflow}{else}
4522                 \{
4523                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept};
4524                 \}
4525 
4526                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, (
      \hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\_type\_t})inCase32Tmp, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE},
4527                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
4528                 \{
4529                     \textcolor{comment}{/* transition power */}
4530                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a554f44f58a1507b74149f30952441f3a}{T\_SRC\_TRANSITION});
4531                     \textcolor{keywordflow}{while} (!\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}))
4532                         ;
4533                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx})
4534                     \{
4535                         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a50891e9bf6ceb5d45b27ec49e46b11fc}{PD\_SrcGotoMinReducePower}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam});
4536                     \}
4537                     \textcolor{keywordflow}{else}
4538                     \{
4539                         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_ab7d47b7b6babdf2f74c6d1344c685168}{PD\_SrcTurnOnRequestVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam},
4540                                                                          pdInstance->
      \hyperlink{struct__pd__instance_ad8cdcafc4b643a8f147febada1cd5704}{partnerRdoRequest});
4541                     \}
4542                 \}
4543                 \textcolor{keywordflow}{else}
4544                 \{
4545                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx})
4546                     \{
4547                         pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx} = 0;
4548                     \}
4549                 \}
4550                 \textcolor{keywordflow}{break};
4551 
4552             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY}: \textcolor{comment}{/* (C) */}
4553                 pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[0] = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE};
4554                 pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[1] = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE};
4555                 pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[2] = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE};
4556                 pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted} = 1;
4557 \textcolor{comment}{/* cannot receive SOP' until explicit contract */}
4558 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
4559 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP})
4560                 \{
4561                     pdInstance->\hyperlink{struct__pd__instance_a007de2aa1ac9ae814d10d26a949dd61d}{pendingSOP} = \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1aaa62220b2caaa3d1273068a3e03969d4}{kPD\_MsgSOPMask} | 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a69d059ddf531dc5f20c67fa58e4976c5}{kPD\_MsgSOPpMask} | \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1addd75dfd8f5aa9af17ddfa15ed385201}{kPD\_MsgSOPppMask};
4562                 \}
4563 \textcolor{preprocessor}{#endif}
4564 \textcolor{preprocessor}{}                \textcolor{keywordflow}{break};
4565 
4566             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9bd78db53d0a51005b2cc67585a5a96a}{PSM\_PE\_SRC\_WAIT\_NEW\_CAPABILITIES}: \textcolor{comment}{/* (C) */}
4567                 \textcolor{keywordflow}{break};
4568 
4569             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a493e1fe84c3cce59c37d36dc048c04}{PSM\_PE\_SRC\_DISABLED}: \textcolor{comment}{/* (C) */}
4570                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda82e2f7a81ec4b132e98ed42740a4f7ec}{PD\_PHY\_DISABLE\_MSG\_RX}, NULL);
4571                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a65d5475667c8b5d17a217f8fc3f8a870}{PD\_FUNCTION\_DISABLED}, NULL, 0);
4572                 \textcolor{keywordflow}{break};
4573 
4574             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a682c505e7fe7715ccaa592381fd6991b}{PSM\_PE\_SRC\_CAPABILITY\_RESPONSE}: \textcolor{comment}{/* (C) */}
4575                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject})
4576                 \{
4577                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject};
4578                 \}
4579                 \textcolor{keywordflow}{else}
4580                 \{
4581                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait};
4582                 \}
4583 
4584                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, (
      \hyperlink{usb__pd__spec_8h_ad25fc6470288b79ee9d2fb8e94ba998f}{message\_type\_t})inCase32Tmp, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE},
4585                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET}))
4586                 \{
4587                     \textcolor{keywordflow}{if} (!pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted})
4588                     \{
4589                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9bd78db53d0a51005b2cc67585a5a96a}{PSM\_PE\_SRC\_WAIT\_NEW\_CAPABILITIES};
4590                     \}
4591                     \textcolor{keywordflow}{else}
4592                     \{
4593                         uint8\_t stillValid = 0;
4594                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a2ec99737c513a5308eaf1dabf39b7486}{PD\_DPM\_SRC\_CONTRACT\_STILL\_VALID}, &stillValid, 0);
4595                         \textcolor{keywordflow}{if} ((stillValid) || (inCase32Tmp == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait}))
4596                         \{
4597                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
4598                         \}
4599                         \textcolor{keywordflow}{else}
4600                         \{
4601                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
4602                         \}
4603                     \}
4604                 \}
4605                 \textcolor{keywordflow}{break};
4606 
4607             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0127bb2a9bf34c7eec60d93a4bab8d3f}{PSM\_PE\_SRC\_HARD\_RESET\_RECEIVED}: \textcolor{comment}{/* (C) */}
4608                 \textcolor{keywordflow}{break};
4609 
4610             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac2cf2928f82b4a269bf222bafd340397}{PSM\_PE\_SRC\_TRANSITION\_TO\_DEFAULT}: \textcolor{comment}{/* (C) */}
4611                 pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
4612                 pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted} = 0u;
4613                 pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V} = 1;
4614 
4615                 \textcolor{comment}{/* source send hard\_reset, 2. change to supply vsafe5v. */}
4616                 \textcolor{comment}{/* source receive hard\_reset, 2. change to supply vsafe5v. */}
4617                 \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa54b3efed00381dbca168c67336d84913}{tSrcRecoverTimer});
4618                 pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a1afed4126bcbe1ba278eb27f31e99c9c}{PD\_SrcTurnOffVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771ba08bcf27d29365689235f1a3f6b683a09}{kVbusPower\_InHardReset});
4619                 \hyperlink{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa}{PD\_DpmDischargeVbus}(pdInstance, 1);
4620                 \textcolor{keywordflow}{while} (!\hyperlink{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e}{PD\_DpmCheckVsafe0V}(pdInstance))
4621                 \{
4622                 \}
4623                 \hyperlink{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa}{PD\_DpmDischargeVbus}(pdInstance, 0);
4624                 \textcolor{comment}{/* source send hard\_reset, 3. start tSrcRecover timer. */}
4625                 \textcolor{comment}{/* source receive hard\_reset, 3. start tSrcRecover timer. */}
4626                 \textcolor{comment}{/* 1. vbus is vsafe0v -> start the tSrcRecover timer -> After tSrcRecover the Source
       applies power to}
4627 \textcolor{comment}{                 * VBUS */}
4628                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa54b3efed00381dbca168c67336d84913}{tSrcRecoverTimer}, 
      \hyperlink{usb__pd__timer_8h_a5a5b16df0c34e21c2c5cfc54651b0eaf}{T\_SRC\_RECOVER});
4629 
4630                 \textcolor{comment}{/* Message reception should not be re-enabled until PE\_SNK\_Startup */}
4631                 \hyperlink{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653}{PD\_MsgReset}(pdInstance);
4632                 \textcolor{comment}{/* Change our data role to DFP, and turn off vconn */}
4633                 pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP};
4634                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
4635 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
4636 \textcolor{preprocessor}{}                \textcolor{comment}{/* Request DPM to turn off vconn */}
4637                 \hyperlink{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a}{PD\_DpmSetVconn}(pdInstance, 0);
4638 \textcolor{preprocessor}{#ifdef USBPD\_ENABLE\_VCONN\_DISCHARGE}
4639 \textcolor{preprocessor}{}                \hyperlink{usb__pd__policy_8c_a0dee3662096589c64561a02b662b602a}{PD\_DpmDischargeVconn}(pdInstance, 1);
4640 \textcolor{preprocessor}{#endif}
4641 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
4642 \textcolor{preprocessor}{}                \textcolor{keywordflow}{break};
4643 
4644             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae2ef2e7864f30f2e2d48b6e8d3a3e37b}{PSM\_PE\_SRC\_GIVE\_SOURCE\_CAP}: \textcolor{comment}{/* (C) */}
4645                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a12847f31ee382d4bdee4067c9ee177f4}{sourceCaps} != NULL)
4646                 \{
4647                     \hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(
4648                         pdInstance, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba398e213caf8239ca95470df3bb2cdbf8}{kPD\_MsgSourceCapabilities}, pdInstance->
      \hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a7cf6689616437623deb3b42e5467e26f}{sourceCapCount},
4649                         PD\_PsmGetSourcePDOs(pdInstance), \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
4650                 \}
4651                 \textcolor{keywordflow}{else}
4652                 \{
4653                     \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, 
      \hyperlink{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{PD\_NOT\_SUPPORT\_REPLY\_MSG}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY});
4654                 \}
4655                 \textcolor{keywordflow}{break};
4656 \textcolor{preprocessor}{#endif}
4657 \textcolor{preprocessor}{}
4658 \textcolor{preprocessor}{#if ((defined PD\_CONFIG\_SOURCE\_ROLE\_ENABLE) && (PD\_CONFIG\_SOURCE\_ROLE\_ENABLE)) || \(\backslash\)}
4659 \textcolor{preprocessor}{    (defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE))}
4660 \textcolor{preprocessor}{}
4661 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SOURCE\_ROLE\_ENABLE) && (PD\_CONFIG\_SOURCE\_ROLE\_ENABLE)}
4662 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a15beb3355a693f37d31884ede62f762b}{PSM\_PE\_SRC\_GET\_SINK\_CAP}: \textcolor{comment}{/* (C) */}
4663 \textcolor{preprocessor}{#endif}
4664 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
4665 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0361f53d1396153b1405ab4b92c72b57}{PSM\_PE\_DR\_SNK\_GET\_SINK\_CAP}: \textcolor{comment}{/* (C) */}
4666 \textcolor{preprocessor}{#endif}
4667 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba136505dbc0254a273af3291afc2e2141}{kPD\_MsgGetSinkCap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
4668                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
4669                 \{
4670                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4671                 \}
4672                 \textcolor{keywordflow}{break};
4673 \textcolor{preprocessor}{#endif}
4674 \textcolor{preprocessor}{}
4675 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
4676 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab06c1b31af9a26e8dc4d36a2091c2de5}{PSM\_PE\_DR\_SRC\_GET\_SOURCE\_CAP}: \textcolor{comment}{/* (C) */}
4677                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bae5a3e99f39042c047827a21bc152788c}{kPD\_MsgGetSourceCap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
4678                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
4679                 \{
4680                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4681                 \}
4682                 \textcolor{keywordflow}{break};
4683 \textcolor{preprocessor}{#endif}
4684 \textcolor{preprocessor}{}
4685 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SINK\_ROLE\_ENABLE) && (PD\_CONFIG\_SINK\_ROLE\_ENABLE)}
4686 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a678da0d3de15c7db60380866e910151a}{PSM\_PE\_SNK\_GET\_SOURCE\_CAP}: \textcolor{comment}{/* (C) */}
4687                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bae5a3e99f39042c047827a21bc152788c}{kPD\_MsgGetSourceCap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}, prevState,
4688                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
4689                 \{
4690                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4691                 \}
4692                 \textcolor{keywordflow}{break};
4693 \textcolor{preprocessor}{#endif}
4694 \textcolor{preprocessor}{}
4695 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
4696 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a45cc4899f978df2dd16ca0218aba5324}{PSM\_PE\_DR\_SRC\_GIVE\_SINK\_CAP}: \textcolor{comment}{/* (C) */}
4697                 \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole} != 
      \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a38da91c9c7115f0e6866a557601ad9b0}{kPowerConfig\_SourceOnly}) &&
4698                     (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_ab247068e26ad76b2670eb96da39969e1}{sinkCaps} != NULL))
4699                 \{
4700                     \hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad3e4952f56af0a6ddb5b6cec31fdc4cf}{kPD\_MsgSinkCapabilities},
4701                                              pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->
      \hyperlink{struct__pd__power__port__config_aa1d58bf75fbebad4b8c7e29b0cc4c64e}{sinkCapCount},
4702                                              pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->
      \hyperlink{struct__pd__power__port__config_ab247068e26ad76b2670eb96da39969e1}{sinkCaps}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY},
4703                                              \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
4704                 \}
4705                 \textcolor{keywordflow}{else}
4706                 \{
4707                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{PD\_NOT\_SUPPORT\_REPLY\_MSG}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY},
4708                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
4709                 \}
4710                 \textcolor{keywordflow}{break};
4711 
4712             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7db6919f3f55617dd34bc46abf29161e}{PSM\_PE\_PRS\_SRC\_SNK\_EVALUATE\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4713                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a92e06fee7178623887fe1d895ae3ffa3}{PD\_DPM\_PR\_SWAP\_REQUEST}, &pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult}, 0);
4714                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca5cbc28129fbc8ef711e9af7a9400d858}{kCommandResult\_Accept})
4715                 \{
4716                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4a2e496292036b37df3b8bdad96e77ad}{PSM\_PE\_PRS\_SRC\_SNK\_ACCEPT\_PR\_SWAP};
4717                 \}
4718                 \textcolor{keywordflow}{else}
4719                 \{
4720                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9965534c9faab71052dac41bd25c3dd6}{PSM\_PE\_PRS\_SRC\_SNK\_REJECT\_PR\_SWAP};
4721                 \}
4722                 \textcolor{keywordflow}{break};
4723 
4724             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4a2e496292036b37df3b8bdad96e77ad}{PSM\_PE\_PRS\_SRC\_SNK\_ACCEPT\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4725                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a6682413184083874a372c9279d133506}{PSM\_PE\_PRS\_SRC\_SNK\_TRANSITION\_TO\_OFF});
4726                 \textcolor{keywordflow}{break};
4727 
4728             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a6682413184083874a372c9279d133506}{PSM\_PE\_PRS\_SRC\_SNK\_TRANSITION\_TO\_OFF}: \textcolor{comment}{/* (C) */}
4729                 \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771bac6be16e80130e6e9909ce3075565f39b}{kVbusPower\_InPRSwap});
4730 
4731                 \textcolor{comment}{/* pr swap transition to standby */}
4732                 \textcolor{comment}{/* 1. tSrcTransition */}
4733                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a554f44f58a1507b74149f30952441f3a}{T\_SRC\_TRANSITION});
4734                 \textcolor{keywordflow}{while} (!\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}))
4735                     ;
4736                 \textcolor{comment}{/* 2. start enter to standby tSrcSwapStdby */}
4737                 pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a1afed4126bcbe1ba278eb27f31e99c9c}{PD\_SrcTurnOffVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771bac6be16e80130e6e9909ce3075565f39b}{kVbusPower\_InPRSwap});
4738                 \hyperlink{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa}{PD\_DpmDischargeVbus}(pdInstance, 1);
4739                 \textcolor{keywordflow}{break};
4740 
4741             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a165a967c143ef0f1f26c303f5040cc}{PSM\_PE\_PRS\_SRC\_SNK\_ASSERT\_RD}: \textcolor{comment}{/* (C) */}
4742                 pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink};
4743                 \hyperlink{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe}{PD\_ConnectSetPRSwapRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole});
4744                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af82fd0bf4ab2cb83e1b87082d53614c5}{PSM\_PE\_PRS\_SRC\_SNK\_WAIT\_SOURCE\_ON};
4745                 \textcolor{keywordflow}{break};
4746 
4747             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af82fd0bf4ab2cb83e1b87082d53614c5}{PSM\_PE\_PRS\_SRC\_SNK\_WAIT\_SOURCE\_ON}: \textcolor{comment}{/* (C) */}
4748                 pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink};
4749                 \textcolor{comment}{/* 0 Role stays as standby until we receive the PS\_RDY message */}
4750                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
4751                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE},
4752                                                 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY},
4753                                                 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}))
4754                 \{
4755                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa6f5ed20252712989645935ecb73be46}{tPSSourceOnTimer}, 
      \hyperlink{usb__pd__timer_8h_adf742f3beaf20aa2e9f82fe7cc0c2055}{T\_PS\_SOURCE\_ON});
4756                 \}
4757                 \textcolor{keywordflow}{break};
4758 
4759             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a90a6fac6bf8ce34a0c582b6e12a57f93}{PSM\_PE\_PRS\_SRC\_SNK\_SEND\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4760                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba1271c8289efd60348364b0a14097e8f4}{kPD\_MsgPrSwap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
4761                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
4762                 \{
4763                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4764                 \}
4765                 \textcolor{keywordflow}{break};
4766 
4767             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9965534c9faab71052dac41bd25c3dd6}{PSM\_PE\_PRS\_SRC\_SNK\_REJECT\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4768                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject})
4769                 \{
4770                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject};
4771                 \}
4772                 \textcolor{keywordflow}{else}
4773                 \{
4774                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait};
4775                 \}
4776                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, inCase32Tmp, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY});
4777                 \textcolor{keywordflow}{break};
4778 \textcolor{preprocessor}{#endif}
4779 \textcolor{preprocessor}{}
4780 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SINK\_ROLE\_ENABLE) && (PD\_CONFIG\_SINK\_ROLE\_ENABLE)}
4781 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac19a0ca772773bf8cdecb2f2000e0b9e}{PSM\_PE\_SNK\_STARTUP}: \textcolor{comment}{/* (C) */}
4782                 \textcolor{comment}{/* Delay for 1ms to make sure any previous GoodCRC tranmission has ended. */}
4783                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a3d7e832f23ba73275f9245159dfe475c}{mSec}(1));
4784                 \textcolor{keywordflow}{while} (!(\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer})))
4785                 \{
4786                     ;
4787                 \}
4788                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
4789 
4790                 pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
4791                 \textcolor{comment}{/* Do not clear previouslyPdConnected here */}
4792                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a57438b2126556f03e6423fceef89c8a9}{PSM\_PE\_SNK\_DISCOVERY};
4793                 \textcolor{keywordflow}{break};
4794 
4795             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a57438b2126556f03e6423fceef89c8a9}{PSM\_PE\_SNK\_DISCOVERY}: \textcolor{comment}{/* (C) */}
4796                 \textcolor{keywordflow}{break};
4797 
4798             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES}: \textcolor{comment}{/* (C) */}
4799                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
4800                 \hyperlink{usb__pd__policy_8c_a6ab430500b707d49e6f44a32e91d1aa9}{PD\_MsgStartReceive}(pdInstance);
4801                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fad8ac3ca013bf381c3d9349a2b33e4d65}{tSinkWaitCapTimer}, 
      \hyperlink{usb__pd__timer_8h_ae869371424f98a5d3b003dfafeb5b983}{T\_SINK\_WAIT\_CAP});
4802                 \textcolor{keywordflow}{break};
4803 
4804             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf98b7f6641597ec99b6fd883d2f13a9}{PSM\_PE\_SNK\_EVALUATE\_CAPABILITY}: \textcolor{comment}{/* (C) */}
4805                 pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} = 0;
4806                 \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer});
4807                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a7ae766d14391a18afed566fc89aab26a}{PD\_DPM\_SNK\_GET\_RDO}, &pdInstance->\hyperlink{struct__pd__instance_a199dd2b0ea66f8eb7e67714c4a4264a5}{rdoRequest}, 0);
4808                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 0)
4809                 \{
4810                     \hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{PD\_PsmStartCommand}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaba6e4b2d7dedd71db8266ca2c496af71}{PD\_DPM\_CONTROL\_REQUEST}, 0);
4811                 \}
4812                 \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a199dd2b0ea66f8eb7e67714c4a4264a5}{rdoRequest}.\hyperlink{struct__pd__rdo_acd03d551b682b870d0e30be5819d013e}{bitFields}.unchunkedSupported) &&
4813                     (pdInstance->\hyperlink{struct__pd__instance_ad5c623ba7be298aa8ecdad50a298d609}{selfOrPartnerFirstSourcePDO}.
      \hyperlink{struct__pd__source__pdo_a2405f8ee75a370cba4a48b94080958b1}{fixedPDO}.\hyperlink{struct__pd__source__fixed__pdo_a6e793acf2c695c57030e59f28dc5b65a}{unchunkedSupported}))
4814                 \{
4815                     pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature} = 1;
4816                 \}
4817                 \textcolor{keywordflow}{else}
4818                 \{
4819                     pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature} = 0;
4820                 \}
4821                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY};
4822                 \textcolor{keywordflow}{break};
4823 
4824             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY}: \textcolor{comment}{/* (C) */}
4825                 \textcolor{comment}{/* TX interrupted by RX */}
4826                 \textcolor{keywordflow}{if} (prevState == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY})
4827                 \{
4828                     inCase32Tmp = prevState;
4829                 \}
4830                 \textcolor{keywordflow}{else}
4831                 \{
4832                     \textcolor{comment}{/* receive packet */}
4833                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX};
4834                 \}
4835 
4836                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba05b1ffccfe00a874c8bc02065746352d}{kPD\_MsgRequest}, 1, (uint32\_t *)(&pdInstance->\hyperlink{struct__pd__instance_a199dd2b0ea66f8eb7e67714c4a4264a5}{rdoRequest}),
4837                                              \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, inCase32Tmp, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
4838                 \{
4839                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4840                 \}
4841                 \textcolor{keywordflow}{break};
4842 
4843             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8192e4ed5803b5a54d466ae63825869b}{PSM\_PE\_SNK\_SELECT\_CAPABILITY\_WAIT\_TIMER\_TIME\_OUT}
      : \textcolor{comment}{/* (C) */}
4844                 \textcolor{keywordflow}{break};
4845 
4846             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK}: \textcolor{comment}{/* (C) */}
4847                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2a9680637c4a08ea8ec5a463f00ab28a}{tPSTransitionTimer}, 
      \hyperlink{usb__pd__timer_8h_a508ff0d9b81da9a47176c15bcc0ac9a4}{T\_PS\_TRANSITION});
4848                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_af189a6cdfc3021280df10fe8a7a86a8f}{psmGotoMinRx})
4849                 \{
4850                     pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a6db9643def50ef309e1d66abd6943e1d}{PD\_SnkGotoMinReducePower}(
      pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam});
4851                 \}
4852                 \textcolor{keywordflow}{else}
4853                 \{
4854                     \textcolor{comment}{/* Start ignoring droops on VBus */}
4855                     \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771ba31235f584f9dde60cbd31c93bac65788}{kVbusPower\_ChangeInProgress});
4856                 \}
4857                 \textcolor{keywordflow}{break};
4858 
4859             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}: \textcolor{comment}{/* (C) */}
4860                 inCase32Tmp = 1;
4861                 pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[0] = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE};
4862                 pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[1] = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE};
4863                 pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[2] = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE};
4864                 pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted} = 1;
4865 \textcolor{comment}{/* cannot receive SOP' until explicit contract */}
4866 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
4867 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP})
4868                 \{
4869                     pdInstance->\hyperlink{struct__pd__instance_a007de2aa1ac9ae814d10d26a949dd61d}{pendingSOP} = \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1aaa62220b2caaa3d1273068a3e03969d4}{kPD\_MsgSOPMask} | 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a69d059ddf531dc5f20c67fa58e4976c5}{kPD\_MsgSOPpMask} | \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1addd75dfd8f5aa9af17ddfa15ed385201}{kPD\_MsgSOPppMask};
4870                 \}
4871 \textcolor{preprocessor}{#endif}
4872 \textcolor{preprocessor}{}
4873                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab364b8f9461757d17739cce20263b117}{PD\_PHY\_CONTROL\_FR\_SWAP}, &
      inCase32Tmp);
4874 
4875                 \textcolor{comment}{/* Stop ignoring droops on VBus */}
4876                 \textcolor{comment}{/* kVbusPower\_ChangeInProgress is done */}
4877                 \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
4878                 \textcolor{keywordflow}{break};
4879 
4880             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4ed497a81e543cc7428fcec9e2510f17}{PSM\_PE\_SNK\_TRANSITION\_TO\_DEFAULT}: \textcolor{comment}{/* (C) */}
4881                 \textcolor{comment}{/* Message reception should not be re-enabled until PE\_SNK\_Startup */}
4882                 \hyperlink{usb__pd__policy_8c_a82812de846825e22cc625886aa4ed653}{PD\_MsgReset}(pdInstance);
4883                 pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted} = 0u;
4884                 pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
4885                 pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP};
4886                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
4887 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
4888 \textcolor{preprocessor}{}                \textcolor{comment}{/* Request DPM to turn off vconn */}
4889                 \hyperlink{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a}{PD\_DpmSetVconn}(pdInstance, 0);
4890 \textcolor{preprocessor}{#endif}
4891 \textcolor{preprocessor}{}
4892                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a0c5bb0cba96e137fd72a49aded310c08}{T\_NO\_RESPONSE});
4893                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, &inCase32Tmp);
4894                 \textcolor{keywordflow}{if} (!(inCase32Tmp & \hyperlink{group__usb__pd__phy__drv_gabf05bb09647628f3556c817e1f059175}{PD\_VBUS\_POWER\_STATE\_VSAFE0V\_MASK}))
4895                 \{
4896                     pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V} = 1;
4897                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa50101b7f5beaa5d160ec488d4a47a57a}{tPSHardResetTimer}, 
      \hyperlink{usb__pd__timer_8h_a637462f763d08a187183fd8c067ae6e4}{T\_PS\_HARD\_RESET} + 10);
4898                 \}
4899                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac19a0ca772773bf8cdecb2f2000e0b9e}{PSM\_PE\_SNK\_STARTUP};
4900                 \textcolor{keywordflow}{break};
4901 
4902             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a40e24a76e6666339493163131c5f697b}{PSM\_PE\_SNK\_GIVE\_SINK\_CAP}: \textcolor{comment}{/* (C) */}
4903                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_ab247068e26ad76b2670eb96da39969e1}{sinkCaps} != NULL)
4904                 \{
4905                     \hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad3e4952f56af0a6ddb5b6cec31fdc4cf}{kPD\_MsgSinkCapabilities},
4906                                              pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->
      \hyperlink{struct__pd__power__port__config_aa1d58bf75fbebad4b8c7e29b0cc4c64e}{sinkCapCount},
4907                                              pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->
      \hyperlink{struct__pd__power__port__config_ab247068e26ad76b2670eb96da39969e1}{sinkCaps}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY},
4908                                              \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
4909                 \}
4910                 \textcolor{keywordflow}{else}
4911                 \{
4912                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{PD\_NOT\_SUPPORT\_REPLY\_MSG}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY},
4913                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
4914                 \}
4915                 \textcolor{keywordflow}{break};
4916 \textcolor{preprocessor}{#endif}
4917 \textcolor{preprocessor}{}
4918 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
4919 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2119967c48ee64e28629ae6f3ec0ba12}{PSM\_PE\_DR\_SNK\_GIVE\_SOURCE\_CAP}: \textcolor{comment}{/* (C) */}
4920                 \textcolor{keywordflow}{if} (((pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole} == 
      \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a38da91c9c7115f0e6866a557601ad9b0}{kPowerConfig\_SourceOnly}) ||
4921                      (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole} == 
      \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9aff4b2380c8b265bbbe69d2eaa1ab207c}{kPowerConfig\_SinkDefault}) ||
4922                      (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole} == 
      \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a9b59768282ea23a087cc0912e4516cae}{kPowerConfig\_DRPToggling})) &&
4923                     (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a12847f31ee382d4bdee4067c9ee177f4}{sourceCaps} != NULL))
4924                 \{
4925                     \hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(
4926                         pdInstance, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba398e213caf8239ca95470df3bb2cdbf8}{kPD\_MsgSourceCapabilities}, pdInstance->
      \hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a7cf6689616437623deb3b42e5467e26f}{sourceCapCount},
4927                         PD\_PsmGetSourcePDOs(pdInstance), \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
4928                 \}
4929                 \textcolor{keywordflow}{else}
4930                 \{
4931                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{PD\_NOT\_SUPPORT\_REPLY\_MSG}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY},
4932                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
4933                 \}
4934                 \textcolor{keywordflow}{break};
4935 
4936             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54e9738bc105950ed3e1d0d64db15003}{PSM\_PE\_PRS\_SNK\_SRC\_EVALUATE\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4937                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a92e06fee7178623887fe1d895ae3ffa3}{PD\_DPM\_PR\_SWAP\_REQUEST}, &pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult}, 0);
4938                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca5cbc28129fbc8ef711e9af7a9400d858}{kCommandResult\_Accept})
4939                 \{
4940                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a05fb0276960dd087c9cf9bd2881c30fd}{PSM\_PE\_PRS\_SNK\_SRC\_ACCEPT\_PR\_SWAP};
4941                 \}
4942                 \textcolor{keywordflow}{else}
4943                 \{
4944                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaf68bdaee11cc3cdb6828b0fa28a9870}{PSM\_PE\_PRS\_SNK\_SRC\_REJECT\_PR\_SWAP};
4945                 \}
4946                 \textcolor{keywordflow}{break};
4947 
4948             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a05fb0276960dd087c9cf9bd2881c30fd}{PSM\_PE\_PRS\_SNK\_SRC\_ACCEPT\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4949                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF});
4950                 \textcolor{keywordflow}{break};
4951 
4952             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF}: \textcolor{comment}{/* (C) */}
4953                 pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted} = 0;
4954                 inCase32Tmp = 0u;
4955                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab364b8f9461757d17739cce20263b117}{PD\_PHY\_CONTROL\_FR\_SWAP}, &
      inCase32Tmp);
4956                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa58fa563b3c588ec13b08efd9ce323b64}{tPSSourceOffTimer}, 
      \hyperlink{usb__pd__timer_8h_a6cccfcba8063433e202f3c27e228ffd4}{T\_PS\_SOURCE\_OFF});
4957                 \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771bac6be16e80130e6e9909ce3075565f39b}{kVbusPower\_InPRSwap});
4958                 \textcolor{comment}{/* sink transition to standby. */}
4959                 pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a18806d06567f385463bba77f8202da49}{PD\_SnkStopDrawVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771bac6be16e80130e6e9909ce3075565f39b}{kVbusPower\_InPRSwap});
4960                 \textcolor{keywordflow}{break};
4961 
4962             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a33436131bac32830697c3445d9c7e633}{PSM\_PE\_PRS\_SNK\_SRC\_ASSERT\_RP}: \textcolor{comment}{/* (C) */}
4963                 pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
4964                 \textcolor{comment}{/* We must assume a new default role */}
4965                 pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
4966                 \textcolor{comment}{/* For reliability, do not start driving VBus before tSwapSourceStart */}
4967                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af1c9746136c41bf190396db70f45b5fd}{PSM\_PE\_PRS\_SNK\_SRC\_SOURCE\_ON};
4968                 \hyperlink{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe}{PD\_ConnectSetPRSwapRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole});
4969                 \textcolor{keywordflow}{break};
4970 
4971             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af1c9746136c41bf190396db70f45b5fd}{PSM\_PE\_PRS\_SNK\_SRC\_SOURCE\_ON}: \textcolor{comment}{/* (C) */}
4972                 pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a81922cf6a4f22bcee69123e95fac7758}{PD\_SrcTurnOnTypeCVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771bac6be16e80130e6e9909ce3075565f39b}{kVbusPower\_InPRSwap});
4973                 \textcolor{keywordflow}{break};
4974 
4975             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af3dfe785a6dc68a892001143f3a833c1}{PSM\_PE\_PRS\_SNK\_SRC\_SEND\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4976                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba1271c8289efd60348364b0a14097e8f4}{kPD\_MsgPrSwap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
4977                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
4978                 \{
4979                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
4980                 \}
4981                 \textcolor{keywordflow}{break};
4982 
4983             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaf68bdaee11cc3cdb6828b0fa28a9870}{PSM\_PE\_PRS\_SNK\_SRC\_REJECT\_PR\_SWAP}: \textcolor{comment}{/* (C) */}
4984                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject})
4985                 \{
4986                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject};
4987                 \}
4988                 \textcolor{keywordflow}{else}
4989                 \{
4990                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait};
4991                 \}
4992                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, inCase32Tmp, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY});
4993                 \textcolor{keywordflow}{break};
4994 \textcolor{preprocessor}{#endif}
4995 \textcolor{preprocessor}{}
4996             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07a0e09f3ef502e87cc88da3124920d5}{PSM\_PE\_BIST\_TEST\_DATA\_MODE}: \textcolor{comment}{/* (C) */}
4997                 \textcolor{keywordflow}{break};
4998 
4999             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4196d00c604ca0624a80835573551686}{PSM\_PE\_BIST\_CARRIER\_MODE\_2}: \textcolor{comment}{/* (C) */}
5000 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_COMPLIANCE\_TEST\_ENABLE) && (PD\_CONFIG\_COMPLIANCE\_TEST\_ENABLE)}
5001 \textcolor{preprocessor}{}                \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faf2be170d04083d1ce7c3666218f9c725}{tBISTContModeTimer}, 
      \hyperlink{usb__pd__timer_8h_a440050af80d35580cc17afaa139e3bea}{T\_BIST\_CONT\_MODE});
5002                 \textcolor{comment}{/* Delay for 1ms to make sure any previous GoodCRC tranmission has ended. */}
5003                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a3d7e832f23ba73275f9245159dfe475c}{mSec}(1));
5004                 \textcolor{keywordflow}{while} (!\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}))
5005                 \{
5006                 \}
5007                 inCase32Tmp = \hyperlink{group__usb__pd__phy__drv_gga6e9f5312eacb47634a8cb7a9ef88ea2ea376a9e89909ae22b43414d1feebda94b}{kBIST\_CarrierMode2};
5008                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda49c349410dcd972b652d355139f112a7}{PD\_PHY\_ENTER\_BIST}, &inCase32Tmp);
5009 \textcolor{preprocessor}{#endif}
5010 \textcolor{preprocessor}{}                \textcolor{keywordflow}{break};
5011 
5012             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}: \textcolor{comment}{/* (C) */}
5013                 \textcolor{keywordflow}{break};
5014 
5015             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a31811e7eea7b85fabd5d14eae04869d1}{PSM\_BYPASS}: \textcolor{comment}{/* (C) */}
5016                 \textcolor{keywordflow}{break};
5017 
5018 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
5019 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afe7bcc67019729a7d03718ab20e12ba1}{PSM\_PE\_DRS\_EVALUATE\_DR\_SWAP}: \textcolor{comment}{/* (C) */}
5020                 pdInstance->\hyperlink{struct__pd__instance_a708b6e13ca54fe83d4200c3fff80a820}{psmDrSwapPrevState} = prevState;
5021                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a5f42f19b50481c9b5819e556fba25b94}{PD\_DPM\_DR\_SWAP\_REQUEST}, &pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult}, 0);
5022                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca5cbc28129fbc8ef711e9af7a9400d858}{kCommandResult\_Accept})
5023                 \{
5024                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a24ca713fa290717abf3128fe0a1ee8f3}{PSM\_PE\_DRS\_ACCEPT\_DR\_SWAP};
5025                 \}
5026                 \textcolor{keywordflow}{else}
5027                 \{
5028                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a029215ad35201c3a7b851350004eb5e6}{PSM\_PE\_DRS\_REJECT\_DR\_SWAP};
5029                 \}
5030                 \textcolor{keywordflow}{break};
5031 
5032             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7fdfa8eec5d0a18ad209c8213932e170}{PSM\_PE\_DRS\_EVALUATE\_DR\_SWAP\_WAIT\_TIMER\_TIME\_OUT}
      : \textcolor{comment}{/* (C) */}
5033             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a97a2b4897b9f785e3cfbf2d641d54c85}{PSM\_PE\_PRS\_EVALUATE\_PR\_SWAP\_WAIT\_TIMER\_TIME\_OUT}
      : \textcolor{comment}{/* (C) */}
5034                 \textcolor{keywordflow}{break};
5035 
5036             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a029215ad35201c3a7b851350004eb5e6}{PSM\_PE\_DRS\_REJECT\_DR\_SWAP}: \textcolor{comment}{/* (C) */}
5037                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(
5038                     pdInstance,
5039                     ((pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject}) ? \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject} : 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait}),
5040                     (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->\hyperlink{struct__pd__instance_a708b6e13ca54fe83d4200c3fff80a820}{psmDrSwapPrevState});
5041                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject})
5042                 \{
5043                     inCase32Tmp = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
5044                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac43a8c3be37b3c4c33dd213e2bb1662d}{PD\_DPM\_DR\_SWAP\_FAIL}, &inCase32Tmp, 0);
5045                 \}
5046                 \textcolor{keywordflow}{else}
5047                 \{
5048                     inCase32Tmp = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045cabbcc951c401dbb830050a5ece204079a}{kCommandResult\_Wait};
5049                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac43a8c3be37b3c4c33dd213e2bb1662d}{PD\_DPM\_DR\_SWAP\_FAIL}, &inCase32Tmp, 0);
5050                 \}
5051                 \textcolor{keywordflow}{break};
5052 
5053             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a34b7b536dbe97967c88705e17a6476c9}{PSM\_PE\_DRS\_SEND\_DR\_SWAP}:                   \textcolor{comment}{/* (C) */}
5054                 pdInstance->\hyperlink{struct__pd__instance_a708b6e13ca54fe83d4200c3fff80a820}{psmDrSwapPrevState} = prevState; \textcolor{comment}{/* snk\_rdy or src\_rdy */}
5055                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba87edb093e97fda055357bf84eca97272}{kPD\_MsgDrSwap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
5056                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5057                 \{
5058                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5059                 \}
5060                 \textcolor{keywordflow}{break};
5061 
5062             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a24ca713fa290717abf3128fe0a1ee8f3}{PSM\_PE\_DRS\_ACCEPT\_DR\_SWAP}: \textcolor{comment}{/* (C) */}
5063                 ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->dataRole =
5064                     ((pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP}) ? 
      \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP} : \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP});
5065                 ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->powerRole = pdInstance
      ->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole};
5066                 ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->cablePlug = 0;
5067                 ((\hyperlink{struct__pd__phy__msg__header__info}{pd\_phy\_msg\_header\_info\_t} *)&inCase32Tmp)->revision = pdInstance->
      \hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision};
5068                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab459c8f89653d73a0d318cd30c0a1fc5}{PD\_PHY\_SET\_MSG\_HEADER\_INFO}, &inCase32Tmp);
5069                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7df0dcbb30ba18f2d20055d1647f8a5d}{PSM\_PE\_DRS\_CHANGE\_TO\_DFP\_OR\_UFP});
5070                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7df0dcbb30ba18f2d20055d1647f8a5d}{PSM\_PE\_DRS\_CHANGE\_TO\_DFP\_OR\_UFP})
5071                 \{
5072                     pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} =
5073                         (pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP}) ? 
      \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP} : kPD\_DataRoleUFP;
5074                     pdInstance->\hyperlink{struct__pd__instance_a6031ed1c3ec10c04ea5daf9a76485f68}{sendingMsgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.portDataRole = 
      pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole};
5075                 \}
5076                 \textcolor{keywordflow}{break};
5077 
5078             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7df0dcbb30ba18f2d20055d1647f8a5d}{PSM\_PE\_DRS\_CHANGE\_TO\_DFP\_OR\_UFP}: \textcolor{comment}{/* (C) */}
5079                 \textcolor{comment}{/* Exit any active alternate mode */}
5080 
5081                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP})
5082                 \{
5083                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a6e361b395106973070aef142ed93a6f8}{PD\_DPM\_DR\_SWAP\_SUCCESS}, NULL, 1);
5084 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
5085 \textcolor{preprocessor}{}                    pdInstance->\hyperlink{struct__pd__instance_a007de2aa1ac9ae814d10d26a949dd61d}{pendingSOP} = \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1aaa62220b2caaa3d1273068a3e03969d4}{kPD\_MsgSOPMask} | 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a69d059ddf531dc5f20c67fa58e4976c5}{kPD\_MsgSOPpMask} | \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1addd75dfd8f5aa9af17ddfa15ed385201}{kPD\_MsgSOPppMask};
5086 \textcolor{preprocessor}{#endif}
5087 \textcolor{preprocessor}{}                \}
5088                 \textcolor{keywordflow}{else}
5089                 \{
5090                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a6e361b395106973070aef142ed93a6f8}{PD\_DPM\_DR\_SWAP\_SUCCESS}, NULL, 1);
5091 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
5092 \textcolor{preprocessor}{}                    pdInstance->\hyperlink{struct__pd__instance_a007de2aa1ac9ae814d10d26a949dd61d}{pendingSOP} = \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1aaa62220b2caaa3d1273068a3e03969d4}{kPD\_MsgSOPMask};
5093 \textcolor{preprocessor}{#endif}
5094 \textcolor{preprocessor}{}                \}
5095 
5096                 \textcolor{comment}{/* Raise the interrupt */}
5097                 \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP}) || (pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource}))
5098                 \{
5099 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
5100 \textcolor{preprocessor}{}                    \textcolor{comment}{/* Cable plug will need a soft reset */}
5101                     pdInstance->\hyperlink{struct__pd__instance_a7be408d709efe6ec210d68a3d4098cc9}{psmCablePlugResetNeeded} = 1;
5102 \textcolor{preprocessor}{#endif}
5103 \textcolor{preprocessor}{}                \}
5104                 \textcolor{comment}{/* return to previous state */}
5105                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = pdInstance->
      \hyperlink{struct__pd__instance_a708b6e13ca54fe83d4200c3fff80a820}{psmDrSwapPrevState};
5106                 \textcolor{keywordflow}{break};
5107 \textcolor{preprocessor}{#endif}
5108 \textcolor{preprocessor}{}
5109 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
5110 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53adbca6a8a2998452362aaab4a162429f1}{PSM\_PE\_VCS\_SEND\_SWAP}: \textcolor{comment}{/* (C) */}
5111                 pdInstance->\hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState} = prevState;
5112                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba70b9d5097137321352571e665e8963e0}{kPD\_MsgVconnSwap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE},
5113                                                 pdInstance->
      \hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5114                 \{
5115                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5116                 \}
5117                 \textcolor{keywordflow}{break};
5118 
5119             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aacc2ab29ac13e773a3f3ed25896b4558}{PSM\_PE\_VCS\_WAIT\_FOR\_VCONN}: \textcolor{comment}{/* (C) */}
5120                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa83e0c687f22e8f4115673c91f8813160}{tVconnOnTimer}, 
      \hyperlink{usb__pd__timer_8h_afcf4a043359554247059816f914ef4e1}{T\_VCONN\_SOURCE\_ON});
5121                 \textcolor{keywordflow}{break};
5122 
5123             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a63b57ac70529dfc60b6ef5ed6d376ab9}{PSM\_PE\_VCS\_TURN\_OFF\_VCONN}: \textcolor{comment}{/* (C) */}
5124                 pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28ad27a489c262689fb72562c3a59cb9727}{kPD\_NotVconnSource};
5125                 \textcolor{comment}{/* Inform the DPM */}
5126                 pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a406d88fa8818ca8257f005c5097859e9}{PD\_ControlVconn}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, 0);
5127                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a599ef1b2e4b2ac816d5eebb00afc6bd6}{PD\_DPM\_VCONN\_SWAP\_SUCCESS}, NULL, 1);
5128                 \textcolor{comment}{/* return to previous state */}
5129                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = pdInstance->
      \hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState};
5130                 \textcolor{keywordflow}{break};
5131 
5132             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af40a2f2088294611eeea6139d7aea036}{PSM\_PE\_VCS\_TURN\_ON\_VCONN}: \textcolor{comment}{/* (C) */}
5133                 pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28a239cd9fcbe39abba0bc8959dc1a24e37}{kPD\_IsVconnSource};
5134                 \textcolor{comment}{/* Inform the DPM */}
5135                 pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a406d88fa8818ca8257f005c5097859e9}{PD\_ControlVconn}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, 1);
5136                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa83e0c687f22e8f4115673c91f8813160}{tVconnOnTimer}, 
      \hyperlink{usb__pd__timer_8h_afcf4a043359554247059816f914ef4e1}{T\_VCONN\_SOURCE\_ON} / 2);
5137                 \textcolor{keywordflow}{break};
5138 
5139             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a86c2f73cb6f0cfdcf8eb50a2cd059b67}{PSM\_PE\_VCS\_SEND\_PS\_RDY}: \textcolor{comment}{/* (C) */}
5140                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}, pdInstance->\hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState},
5141                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5142                 \{
5143                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a599ef1b2e4b2ac816d5eebb00afc6bd6}{PD\_DPM\_VCONN\_SWAP\_SUCCESS}, NULL, 1);
5144                 \}
5145                 \textcolor{keywordflow}{break};
5146 
5147             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af2a6cc4fda5cb17811ba28a6ccd6d655}{PSM\_PE\_VCS\_EVALUATE\_SWAP}: \textcolor{comment}{/* (C) */}
5148                 pdInstance->\hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState} = prevState;
5149                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ab62a576276285565837d94af7a289378}{PD\_DPM\_VCONN\_SWAP\_REQUEST}, &pdInstance->
      \hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult}, 0);
5150                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca5cbc28129fbc8ef711e9af7a9400d858}{kCommandResult\_Accept})
5151                 \{
5152                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0e11220552b9c86fc31fbba16f79d407}{PSM\_PE\_VCS\_ACCEPT\_SWAP};
5153                 \}
5154                 \textcolor{keywordflow}{else}
5155                 \{
5156                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2c1da5cc0e54d0a7bff4ce8572f80355}{PSM\_PE\_VCS\_REJECT\_SWAP};
5157                 \}
5158                 \textcolor{keywordflow}{break};
5159 
5160             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0e11220552b9c86fc31fbba16f79d407}{PSM\_PE\_VCS\_ACCEPT\_SWAP}: \textcolor{comment}{/* (C) */}
5161                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept},
5162                                                  pdInstance->
      \hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} == \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28a239cd9fcbe39abba0bc8959dc1a24e37}{kPD\_IsVconnSource} ?
5163                                                      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aacc2ab29ac13e773a3f3ed25896b4558}{PSM\_PE\_VCS\_WAIT\_FOR\_VCONN} :
5164                                                      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af40a2f2088294611eeea6139d7aea036}{PSM\_PE\_VCS\_TURN\_ON\_VCONN});
5165 
5166                 \textcolor{keywordflow}{break};
5167 
5168             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2c1da5cc0e54d0a7bff4ce8572f80355}{PSM\_PE\_VCS\_REJECT\_SWAP}: \textcolor{comment}{/* (C) */}
5169                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(
5170                     pdInstance,
5171                     (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject}) ? \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject} : 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait},
5172                     (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->
      \hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState});
5173                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject})
5174                 \{
5175                     inCase32Tmp = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
5176                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a7d1d0c1a00df8f90177fef2eaf7f1831}{PD\_DPM\_VCONN\_SWAP\_FAIL}, &inCase32Tmp, 1);
5177                 \}
5178                 \textcolor{keywordflow}{else}
5179                 \{
5180                     inCase32Tmp = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045cabbcc951c401dbb830050a5ece204079a}{kCommandResult\_Wait};
5181                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a7d1d0c1a00df8f90177fef2eaf7f1831}{PD\_DPM\_VCONN\_SWAP\_FAIL}, &inCase32Tmp, 1);
5182                 \}
5183                 \textcolor{keywordflow}{break};
5184 \textcolor{preprocessor}{#endif}
5185 \textcolor{preprocessor}{}
5186 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
5187 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53abfae41fb2e0b07c69972b7f867f481a2}{PE\_SNK\_GET\_SOURCE\_CAP\_EXT}:    \textcolor{comment}{/* C */}
5188             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5bac4330356f778b9e20754522461eda}{PE\_DR\_SRC\_GET\_SOURCE\_CAP\_EXT}: \textcolor{comment}{/* C */}
5189                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba3af799b1ac867b89af6607a57cf5dfd2}{kPD\_MsgGetSourceCapExtended}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE},
5190                                                 prevState, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5191                 \{
5192                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5193                 \}
5194                 \textcolor{keywordflow}{break};
5195 
5196             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5f13bce14390ab3def43ae3686c0c6bc}{PE\_SRC\_GIVE\_SOURCE\_CAP\_EXT}:    \textcolor{comment}{/* C */}
5197             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0d85591e71aecb4f469db52ddc0e93f1}{PE\_DR\_SNK\_GIVE\_SOURCE\_CAP\_EXT}: \textcolor{comment}{/* C */}
5198                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a670316f4975a4e2731f51ee420b99ba6}{PD\_DPM\_GIVE\_SRC\_EXT\_CAP}, &pdInstance->
      \hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}, 0);
5199                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0d85591e71aecb4f469db52ddc0e93f1}{PE\_DR\_SNK\_GIVE\_SOURCE\_CAP\_EXT})
5200                 \{
5201                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5202                 \}
5203                 \textcolor{keywordflow}{else}
5204                 \{
5205                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5206                 \}
5207 
5208                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_ae615100fed31d9a3b0d14df3e88b427f}{resultStatus} != \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported})
5209                 \{
5210                     PD\_MsgSendExtTransition(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba95e7d327bd7d8c4673816217f380845f}{kPD\_MsgSourceCapExtended},
5211                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength},
5212                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5213                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5214                 \}
5215                 \textcolor{keywordflow}{else}
5216                 \{
5217                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5218                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5219                 \}
5220                 \textcolor{keywordflow}{break};
5221 
5222             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53affec79782a2b4897fa8d1913c5be4760}{PE\_SRC\_Get\_Sink\_Status}:   \textcolor{comment}{/* C */}
5223             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afcd6a556470cb00cee096f4dd9733c25}{PE\_SNK\_Get\_Source\_Status}: \textcolor{comment}{/* C */}
5224                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368baa83d3f3aa1b2a5e28a4437c021f4666e}{kPD\_MsgGetStatus}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
5225                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5226                 \{
5227                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5228                 \}
5229                 \textcolor{keywordflow}{break};
5230 
5231             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a629beb778f1bc627886c404652e35f6e}{PE\_SRC\_Give\_Source\_Status}: \textcolor{comment}{/* C */}
5232             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a46420dcce07f7327115051c8c6a31588}{PE\_SNK\_Give\_Sink\_Status}:   \textcolor{comment}{/* C */}
5233                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a20b164e82d99ac69c299ad7cd634e1af}{PD\_DPM\_GIVE\_STATUS}, &pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}, 0);
5234                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a46420dcce07f7327115051c8c6a31588}{PE\_SNK\_Give\_Sink\_Status})
5235                 \{
5236                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5237                 \}
5238                 \textcolor{keywordflow}{else}
5239                 \{
5240                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5241                 \}
5242 
5243                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_ae615100fed31d9a3b0d14df3e88b427f}{resultStatus} != \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported})
5244                 \{
5245                     PD\_MsgSendExtTransition(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368babafb5d368c1bae1ef7b8d141cdd1a54b}{kPD\_MsgStatus},
5246                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength},
5247                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5248                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5249                 \}
5250                 \textcolor{keywordflow}{else}
5251                 \{
5252                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5253                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5254                 \}
5255                 \textcolor{keywordflow}{break};
5256 
5257             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a80ecd4021c5388f51469f70534bc96c4}{PE\_Get\_Battery\_Cap}: \textcolor{comment}{/* C */}
5258             \{
5259                 \textcolor{keywordflow}{if} (PD\_MsgSendExtTransition(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bac3a2ecb4c14453ad29ce5ed40f9ab46a}{kPD\_MsgGetBatteryCap}, 1,
5260                                             &pdInstance->\hyperlink{struct__pd__instance_a26c06a89ab6d2c3fbf265abd7dfc04a3}{getBatteryCapDataBlock}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
5261                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5262                 \{
5263                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5264                 \}
5265                 \textcolor{keywordflow}{break};
5266             \}
5267 
5268             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af57f1b28d1d2e5c70927ab5be1fc8d1f}{PE\_Give\_Battery\_Cap}: \textcolor{comment}{/* C */}
5269                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a5e3c5980f5866884637cef416af45ab2}{PD\_DPM\_GIVE\_BATTERY\_CAP}, &pdInstance->
      \hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}, 0);
5270                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
5271                 \{
5272                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5273                 \}
5274                 \textcolor{keywordflow}{else}
5275                 \{
5276                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5277                 \}
5278                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_ae615100fed31d9a3b0d14df3e88b427f}{resultStatus} != \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported})
5279                 \{
5280                     PD\_MsgSendExtTransition(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba7ef9806a0da412c423d2eba24922e54b}{kPD\_MsgBatteryCapabilities},
5281                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength},
5282                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5283                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5284                 \}
5285                 \textcolor{keywordflow}{else}
5286                 \{
5287                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5288                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5289                 \}
5290                 \textcolor{keywordflow}{break};
5291 
5292             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5c59fac69248ef645437145785e5f13a}{PE\_Get\_Battery\_Status}: \textcolor{comment}{/* C */}
5293                 \textcolor{keywordflow}{if} (PD\_MsgSendExtTransition(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bafdbc3afe02d076186203e1fb5cebe78a}{kPD\_MsgGetBatteryStatus}, 1,
5294                                             &pdInstance->\hyperlink{struct__pd__instance_a26c06a89ab6d2c3fbf265abd7dfc04a3}{getBatteryCapDataBlock}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState,
5295                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5296                 \{
5297                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5298                 \}
5299                 \textcolor{keywordflow}{break};
5300 
5301             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3786ef2885ab7d4ff175973e2c0f7953}{PE\_Give\_Battery\_Status}: \textcolor{comment}{/* C */}
5302                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a884eedc8a4ed6f0d1cdbf6c582a0dc36}{PD\_DPM\_GIVE\_BATTERY\_STATUS}, &pdInstance->
      \hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}, 0);
5303 
5304                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
5305                 \{
5306                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5307                 \}
5308                 \textcolor{keywordflow}{else}
5309                 \{
5310                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5311                 \}
5312                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_ae615100fed31d9a3b0d14df3e88b427f}{resultStatus} != \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported})
5313                 \{
5314                     \hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba100d935afa07cabcb1e4ae905685b679}{kPD\_MsgBatteryStatus},
5315                                              pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} >> 2,
5316                                              (uint32\_t *)pdInstance->
      \hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer},
5317                                              (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5318                 \}
5319                 \textcolor{keywordflow}{else}
5320                 \{
5321                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{PD\_NOT\_SUPPORT\_REPLY\_MSG}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5322                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5323                 \}
5324                 \textcolor{keywordflow}{break};
5325 
5326             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a77041c81b4c648b823006673db2f5cc8}{PE\_Get\_Manfacturer\_Info}: \textcolor{comment}{/* C */}
5327                 \textcolor{keywordflow}{if} (PD\_MsgSendExtTransition(pdInstance, (\hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop},
5328                                             \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bab7714bb078012f97329fa2aa02cb5ca6}{kPD\_MsgGetManufacturerInfo}, 2, 
      pdInstance->\hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer},
5329                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE}, prevState, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5330                 \{
5331                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5332                 \}
5333                 \textcolor{keywordflow}{break};
5334 
5335             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a395aa353974c638755b42084e94b1eef}{PE\_Give\_Manufacturer\_Info}: \textcolor{comment}{/* C */}
5336                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a4eaf5fd4f50a711d55543fd52d58218a}{PD\_DPM\_GIVE\_MANUFACTURER\_INFO}, &pdInstance->
      \hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}, 0);
5337                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
5338                 \{
5339                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5340                 \}
5341                 \textcolor{keywordflow}{else}
5342                 \{
5343                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5344                 \}
5345                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_ae615100fed31d9a3b0d14df3e88b427f}{resultStatus} != \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported})
5346                 \{
5347                     PD\_MsgSendExtTransition(pdInstance, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba3b1d9a1a12b16bd99758c6647a09ac80}{kPD\_MsgManufacturerInfo},
5348                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength},
5349                                             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5350                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5351                 \}
5352                 \textcolor{keywordflow}{else}
5353                 \{
5354                     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}, (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp,
5355                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5356                 \}
5357                 \textcolor{keywordflow}{break};
5358 
5359 \textcolor{preprocessor}{#if 0}
5360 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac39b4eb7ba5e8588f0e1de6ae536471c}{PE\_Send\_Security\_Request}: \textcolor{comment}{/* C */}
5361             \{
5362                 uint32\_t sendLength;
5363 
5364                 \hyperlink{struct__pd__extended__msg__header}{pd\_extended\_msg\_header\_t} extHeader = pdInstance->
      extRequestChunkHeader;
5365 
5366                 \textcolor{keywordflow}{if} (!(extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk))
5367                 \{
5368                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature})
5369                     \{
5370                         sendLength = pdInstance->extAllDataSize;
5371                         \textcolor{keywordflow}{if} (sendLength > 26)
5372                         \{
5373                             sendLength = 26;
5374                         \}
5375                         extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunked = 1;
5376                         extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber = 0;
5377                         extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk = 0;
5378                         extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize = pdInstance->extAllDataSize;
5379                         sendStatus = \hyperlink{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a}{PD\_MsgSendChunkedExtendedMsg}(
5380                             pdInstance, (\hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop}, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba94163ce483808757dbfb58405a1bff03}{kPD\_MsgSecurityRequest},
5381                             extHeader, sendLength, pdInstance->extDataBuffer);
5382                     \}
5383                     \textcolor{keywordflow}{else}
5384                     \{
5385                         sendStatus = \hyperlink{usb__pd__policy_8c_aafe1563428401cff5a9f430cba8043e1}{PD\_MsgSendUnchunkedExtendedMsg}(
5386                             pdInstance, (\hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop}, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba94163ce483808757dbfb58405a1bff03}{kPD\_MsgSecurityRequest},
5387                             pdInstance->extAllDataSize, pdInstance->extDataBuffer);
5388                     \}
5389                 \}
5390                 \textcolor{keywordflow}{else}
5391                 \{
5392                     extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk = 0;
5393                     sendLength = (pdInstance->extAllDataSize - (extHeader.
      \hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber * 26));
5394                     \textcolor{keywordflow}{if} (sendLength > 26)
5395                     \{
5396                         sendLength = 26;
5397                     \}
5398                     sendStatus = \hyperlink{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a}{PD\_MsgSendChunkedExtendedMsg}(
5399                         pdInstance, (\hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop}, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba94163ce483808757dbfb58405a1bff03}{kPD\_MsgSecurityRequest}, extHeader,
5400                         sendLength, (pdInstance->extDataBuffer + extHeader.
      \hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber * 26));
5401                 \}
5402 
5403                 \textcolor{keywordflow}{if} ((sendStatus == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success}) && 
      \hyperlink{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}{PD\_MsgWaitSendResult}(pdInstance))
5404                 \{
5405                     \textcolor{keywordflow}{if} (extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber * 26 >= extHeader.
      \hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize)
5406                     \{
5407                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, PD\_DPM\_SECURITY\_REQUEST\_SUCCESS, 
      NULL, 1);
5408                     \}
5409 
5410                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
5411                     \{
5412                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5413                     \}
5414                     \textcolor{keywordflow}{else}
5415                     \{
5416                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5417                     \}
5418                 \}
5419                 \textcolor{keywordflow}{else}
5420                 \{
5421                     inCase32Tmp = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
5422                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, PD\_DPM\_SECURITY\_REQUEST\_FAIL, &
      inCase32Tmp, 1);
5423                     \hyperlink{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c}{PD\_PsmTransitionOnMsgSendError}(pdInstance, prevState, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5424                 \}
5425 
5426                 \textcolor{keywordflow}{break};
5427             \}
5428 
5429             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9044ca4d4b7a47e0cc8a2573f1fc2bc0}{PE\_Send\_Security\_Response}: \textcolor{comment}{/* C */}
5430             \{
5431                 uint32\_t sendLength;
5432 
5433                 \hyperlink{struct__pd__extended__msg__header}{pd\_extended\_msg\_header\_t} extHeader = pdInstance->
      extRequestChunkHeader;
5434 
5435                 \textcolor{keywordflow}{if} (!(extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk))
5436                 \{
5437                     \textcolor{comment}{/* first time */}
5438                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, PD\_DPM\_RESPONSE\_SECURITY\_REQUEST, &
      pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback},
5439                                       0);
5440                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_ae615100fed31d9a3b0d14df3e88b427f}{resultStatus} != \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported})
5441                     \{
5442                         pdInstance->extAllDataSize = pdInstance->
      \hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength};
5443                         pdInstance->extDataBuffer = pdInstance->
      \hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer};
5444 
5445                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature})
5446                         \{
5447                             sendLength = pdInstance->extAllDataSize;
5448                             \textcolor{keywordflow}{if} (sendLength > 26)
5449                             \{
5450                                 sendLength = 26;
5451                             \}
5452                             extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunked = 1;
5453                             extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber = 0;
5454                             extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk = 0;
5455                             extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize = pdInstance->extAllDataSize;
5456                             sendStatus = \hyperlink{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a}{PD\_MsgSendChunkedExtendedMsg}(
5457                                 pdInstance, (\hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop}, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bab4407cf4f44a8c11dd35980f6c541640}{kPD\_MsgSecurityResponse},
5458                                 extHeader, sendLength, pdInstance->extDataBuffer);
5459                         \}
5460                         \textcolor{keywordflow}{else}
5461                         \{
5462                             sendStatus = \hyperlink{usb__pd__policy_8c_aafe1563428401cff5a9f430cba8043e1}{PD\_MsgSendUnchunkedExtendedMsg}(
5463                                 pdInstance, (\hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop}, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bab4407cf4f44a8c11dd35980f6c541640}{kPD\_MsgSecurityResponse},
5464                                 pdInstance->extAllDataSize, pdInstance->extDataBuffer);
5465                         \}
5466                     \}
5467                     \textcolor{keywordflow}{else}
5468                     \{
5469                         sendStatus = PD\_MsgSendDefaultControl(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported});
5470                     \}
5471                 \}
5472                 \textcolor{keywordflow}{else}
5473                 \{
5474                     extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk = 0;
5475                     sendLength = (pdInstance->extAllDataSize - (extHeader.
      \hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber * 26));
5476                     \textcolor{keywordflow}{if} (sendLength > 26)
5477                     \{
5478                         sendLength = 26;
5479                     \}
5480                     sendStatus = \hyperlink{usb__pd__policy_8c_a4555ffee3a6a4858fe00163cd035a30a}{PD\_MsgSendChunkedExtendedMsg}(
5481                         pdInstance, (\hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop}, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba94163ce483808757dbfb58405a1bff03}{kPD\_MsgSecurityRequest}, extHeader,
5482                         sendLength, (pdInstance->extDataBuffer + extHeader.
      \hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber * 26));
5483                 \}
5484 
5485                 \textcolor{keywordflow}{if} ((sendStatus == \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success}) && (
      \hyperlink{usb__pd__policy_8c_a31725b2a47c3137de52deb06cfb27e56}{PD\_MsgWaitSendResult}(pdInstance)))
5486                 \{
5487                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
5488                     \{
5489                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5490                     \}
5491                     \textcolor{keywordflow}{else}
5492                     \{
5493                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5494                     \}
5495                 \}
5496                 \textcolor{keywordflow}{else}
5497                 \{
5498                     \hyperlink{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c}{PD\_PsmTransitionOnMsgSendError}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
5499                 \}
5500                 \textcolor{keywordflow}{break};
5501             \}
5502 
5503             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ad7045267a261d8ee3f7c91e73df6d4ae}{PE\_Security\_Response\_Received}: \textcolor{comment}{/* C */}
5504                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, PD\_DPM\_SECURITY\_RESPONSE\_RECEIVED, &
      pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}, 0);
5505                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
5506                 \{
5507                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5508                 \}
5509                 \textcolor{keywordflow}{else}
5510                 \{
5511                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5512                 \}
5513                 \textcolor{keywordflow}{break};
5514 \textcolor{preprocessor}{#endif}
5515 \textcolor{preprocessor}{}
5516             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2dcb3235f416900d5e592106f412fb52}{PE\_SRC\_Send\_Source\_Alert}: \textcolor{comment}{/* C */}
5517             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a935b7e5abe53a0d4540a90b9fac249c9}{PE\_SNK\_Send\_Sink\_Alert}:   \textcolor{comment}{/* C */}
5518                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a935b7e5abe53a0d4540a90b9fac249c9}{PE\_SNK\_Send\_Sink\_Alert})
5519                 \{
5520                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5521                 \}
5522                 \textcolor{keywordflow}{else}
5523                 \{
5524                     inCase32Tmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5525                 \}
5526 
5527                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a954ab3161cbbe8dcb01c1904d4796ec5}{PD\_MsgSendDataTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368baa8f159f471074375887c51aa4e6c1856}{kPD\_MsgAlert}, 1, &pdInstance->\hyperlink{struct__pd__instance_a483c8ee561c9edc878c4462f8b073027}{alertADO},
5528                                              (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})inCase32Tmp, prevState, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}))
5529                 \{
5530                     pdInstance->\hyperlink{struct__pd__instance_ae144ddf17de553d955ce28afa535d4f9}{alertWaitReply} = 1u;
5531                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a7a58d683f0a94b0634aca4ea76df7800}{PD\_DPM\_SEND\_ALERT\_SUCCESS}, NULL, 1);
5532                 \}
5533                 \textcolor{keywordflow}{else}
5534                 \{
5535                     inCase32Tmp = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
5536                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a0cbb394fa1a8c85368a4d84c1e5647c2}{PD\_DPM\_SEND\_ALERT\_FAIL}, &inCase32Tmp, 1);
5537                 \}
5538                 \textcolor{keywordflow}{break};
5539 
5540             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4a655ea5b215db30df1459c393425729}{PE\_SNK\_Source\_Alert\_Received}: \textcolor{comment}{/* C */}
5541             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afb6007f96712d3851d3a865e8a537013}{PE\_SRC\_Sink\_Alert\_Received}:   \textcolor{comment}{/* C */}
5542                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4a655ea5b215db30df1459c393425729}{PE\_SNK\_Source\_Alert\_Received})
5543                 \{
5544                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
5545                 \}
5546                 \textcolor{keywordflow}{else}
5547                 \{
5548                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
5549                 \}
5550                 \textcolor{keywordflow}{break};
5551 \textcolor{preprocessor}{#endif}
5552 \textcolor{preprocessor}{}
5553 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE) && (PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE)}
5554 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aca9891b871efc6127b397c6b17857e08}{PE\_FRS\_SRC\_SNK\_CC\_Signal}: \textcolor{comment}{/* C */}
5555             \{
5556                 \hyperlink{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance);
5557                 \textcolor{keywordflow}{break};
5558             \}
5559 
5560             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a89ca1efc4d454ffafc177960fae69142}{PE\_FRS\_SRC\_SNK\_Evaluate\_Swap}: \textcolor{comment}{/* C */}
5561                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ab8e9c9690239a89c37d446bf4b35122c}{PD\_DPM\_FR\_SWAP\_REQUEST}, &pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult}, 0);
5562                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca5cbc28129fbc8ef711e9af7a9400d858}{kCommandResult\_Accept})
5563                 \{
5564                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a635136bc155da92ff2ddf4d7ff117bc5}{PE\_FRS\_SRC\_SNK\_Accept\_Swap};
5565                 \}
5566                 \textcolor{keywordflow}{else}
5567                 \{
5568                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
5569                 \}
5570                 \textcolor{keywordflow}{break};
5571 
5572             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a635136bc155da92ff2ddf4d7ff117bc5}{PE\_FRS\_SRC\_SNK\_Accept\_Swap}: \textcolor{comment}{/* C */}
5573                 \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a19390f414f766b3ea0e0fbae002bb448}{PE\_FRS\_SRC\_SNK\_Transition\_to\_off}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET},
5574                                             \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET});
5575                 \textcolor{keywordflow}{break};
5576 
5577             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a19390f414f766b3ea0e0fbae002bb448}{PE\_FRS\_SRC\_SNK\_Transition\_to\_off}: \textcolor{comment}{/* C */}
5578                 \textcolor{keywordflow}{break};
5579 
5580             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7bf4eddebf37afd4745a11794066b2c8}{PE\_FRS\_SRC\_SNK\_Assert\_Rd}: \textcolor{comment}{/* C */}
5581                 pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink};
5582                 \hyperlink{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe}{PD\_ConnectSetPRSwapRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole});
5583                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a2a2b0b602f73ff578e9643e90e22ec}{PE\_FRS\_SRC\_SNK\_Wait\_Source\_on};
5584                 \textcolor{keywordflow}{break};
5585 
5586             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a2a2b0b602f73ff578e9643e90e22ec}{PE\_FRS\_SRC\_SNK\_Wait\_Source\_on}: \textcolor{comment}{/* C */}
5587                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
5588                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE},
5589                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY}))
5590                 \{
5591                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa6f5ed20252712989645935ecb73be46}{tPSSourceOnTimer}, 
      \hyperlink{usb__pd__timer_8h_adf742f3beaf20aa2e9f82fe7cc0c2055}{T\_PS\_SOURCE\_ON});
5592                 \}
5593                 \textcolor{keywordflow}{break};
5594 
5595             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aa1ded4aeaaf1546c7d1b30f9a72d8233}{PE\_FRS\_SNK\_SRC\_Send\_Swap}: \textcolor{comment}{/* C */}
5596                 inCase32Tmp = 0;
5597                 pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} = 0;
5598                 \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab364b8f9461757d17739cce20263b117}{PD\_PHY\_CONTROL\_FR\_SWAP}, &
      inCase32Tmp);
5599                 \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} == 0) && 
      \hyperlink{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}{PD\_DpmCheckLessOrEqualVsafe5v}(pdInstance))
5600                 \{
5601                     pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a81922cf6a4f22bcee69123e95fac7758}{PD\_SrcTurnOnTypeCVbus}(
      pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badfb60998cac82d001b52af44674eef18}{kVbusPower\_InFRSwap});
5602                     pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} = 1;
5603                 \}
5604                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba04e529f0c9df5cf995ef7e9e3391eb24}{kPD\_MsgFrSwap}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ae8d6ae94e8f720763ff0409c4bb2f2b6}{PE\_PSM\_STATE\_NO\_CHANGE},
5605                                                 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY},
5606                                                 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}))
5607                 \{
5608                     \hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{PD\_PsmStartCommand}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa1af15d89c350437f5f4e8a95ea841f5b}{PD\_DPM\_FAST\_ROLE\_SWAP}, 0);
5609                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a643f2a23aafe91428d6f9dfef8a841b0}{T\_SENDER\_RESPONSE});
5610                 \}
5611                 \textcolor{keywordflow}{else}
5612                 \{
5613                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY};
5614                 \}
5615                 \textcolor{keywordflow}{break};
5616 
5617             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a22771f42025488c2aa330eee49a96f46}{PE\_FRS\_SNK\_SRC\_Transition\_to\_off}: \textcolor{comment}{/* C */}
5618                 \textcolor{comment}{/* uint8\_t enable = 0; */}
5619                 \textcolor{comment}{/* PD\_PhyControl(pdInstance, PD\_PHY\_CONTROL\_FR\_SWAP, &enable); */}
5620                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa58fa563b3c588ec13b08efd9ce323b64}{tPSSourceOffTimer}, 
      \hyperlink{usb__pd__timer_8h_a6cccfcba8063433e202f3c27e228ffd4}{T\_PS\_SOURCE\_OFF});
5621                 \textcolor{keywordflow}{break};
5622 
5623             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a53aba4689937ad582cd75f1dc965829a}{PE\_FRS\_SNK\_SRC\_Vbus\_Applied}: \textcolor{comment}{/* C */}
5624                 \textcolor{keywordflow}{break};
5625 
5626             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a60d82df8a488c0e926e61c63a400c3cb}{PE\_FRS\_SNK\_SRC\_Assert\_Rp}: \textcolor{comment}{/* C */}
5627                 pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
5628                 \hyperlink{usb__pd__policy_8c_a3aa051f964b97e729b999996b3cf4efe}{PD\_ConnectSetPRSwapRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole});
5629                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4565bf4c2747ac56426468c852d9f03d}{PE\_FRS\_SNK\_SRC\_Source\_on};
5630                 \textcolor{keywordflow}{break};
5631 
5632             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4565bf4c2747ac56426468c852d9f03d}{PE\_FRS\_SNK\_SRC\_Source\_on}: \textcolor{comment}{/* C */}
5633                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ae9194b9c8e1e319ab3a3c3bb25fd51}{PSM\_PE\_SRC\_STARTUP},
5634                                                 \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY}, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY}))
5635                 \{
5636                     \textcolor{comment}{/* pr swap end */}
5637                     \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
5638 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
5639 \textcolor{preprocessor}{}                    \textcolor{comment}{/* Cable plug will need a soft reset */}
5640                     pdInstance->\hyperlink{struct__pd__instance_a7be408d709efe6ec210d68a3d4098cc9}{psmCablePlugResetNeeded} = 1;
5641 \textcolor{preprocessor}{#endif}
5642 \textcolor{preprocessor}{}                    pdInstance->\hyperlink{struct__pd__instance_a3b09927227c17d95712a2af3d5f921f2}{enterSrcFromSwap} = 1;
5643                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a2d0a8b5453cd82a137805d3b023b264d}{PD\_DPM\_FR\_SWAP\_SUCCESS}, NULL, 1);
5644                 \}
5645                 \textcolor{keywordflow}{break};
5646 \textcolor{preprocessor}{#endif}
5647 \textcolor{preprocessor}{}
5648             \textcolor{keywordflow}{default}:
5649                 \textcolor{keywordflow}{break};
5650         \}
5651 
5652         \hyperlink{usb__pd__policy_8c_a9bfe23523b40ee86c423c43291017cc5}{PD\_PsmEndCommand}(pdInstance, pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState});
5653         \hyperlink{usb__pd__policy_8c_ac674e40520a08c8895ec4e852a3751c7}{PD\_PsmSetNormalPower}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState});
5654     \}
5655 
5656     \textcolor{keywordflow}{if} (didNothingC == 1)
5657     \{
5658         \textcolor{keywordflow}{return} \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a7cacf9f3344176be4f627e097c8fa5ff}{kSM\_WaitEvent};
5659     \}
5660     \textcolor{keywordflow}{else}
5661     \{
5662         \textcolor{keywordflow}{return} \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{kSM\_Continue};
5663     \}
5664 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_afbd2eb3bceb62f29229f0bff6eed6844_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_afbd2eb3bceb62f29229f0bff6eed6844_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ad25940850feb762e329a32f90726c59a}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Dpm\-Msg@{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Dpm\-Msg}}
\index{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Dpm\-Msg@{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Dpm\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Dpm\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Dpm\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t $\ast$}]{return\-New\-State, }
\item[{{\bf psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$}]{trigger\-Info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_ad25940850feb762e329a32f90726c59a}

\begin{DoxyCode}
366 \{
367     uint8\_t newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN};
368     uint8\_t didNothing = 1;
369 
370     \textcolor{comment}{/* assume the message is processed */}
371     triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
372     \textcolor{keywordflow}{switch} (triggerInfo->\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg})
373     \{
374         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aabd4e605546d67fb4bbfad35ea77f5589}{PD\_DPM\_CONTROL\_HARD\_RESET}:
375             newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
376             didNothing = 0;
377             \textcolor{keywordflow}{break};
378 
379         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET}:
380             \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{PD\_PsmStartCommand}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET}, 1))
381             \{
382                 newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
383                 didNothing = 0;
384             \}
385             \textcolor{keywordflow}{else}
386             \{
387                 \hyperlink{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046}{PD\_PsmCommandFail}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET});
388             \}
389             \textcolor{keywordflow}{break};
390 \textcolor{preprocessor}{#if 0}
391 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa979f0d2508a56e60739866d338599f73}{PD\_DPM\_CONTROL\_EXIT\_MODE}:
392             pdInstance->\hyperlink{struct__pd__instance_afcd5caf46554e0640a45ac547d7bacf0}{vdmExitReceived}[pdInstance->
      \hyperlink{struct__pd__instance_a37746abee0ebb0169f8a1e7227d8645b}{structuredVdmCommandParameter}.\hyperlink{struct__pd__svdm__param_a8047c38bf19593f6d467256b1696587e}{vdmSop}] = 1;
393             \textcolor{keywordflow}{break};
394 \textcolor{preprocessor}{#endif}
395 \textcolor{preprocessor}{}
396 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE) && (PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE)}
397 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa1af15d89c350437f5f4e8a95ea841f5b}{PD\_DPM\_FAST\_ROLE\_SWAP}:
398             \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{PD\_PsmStartCommand}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa1af15d89c350437f5f4e8a95ea841f5b}{PD\_DPM\_FAST\_ROLE\_SWAP}, 1))
399             \{
400                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aca9891b871efc6127b397c6b17857e08}{PE\_FRS\_SRC\_SNK\_CC\_Signal};
401             \}
402             \textcolor{keywordflow}{break};
403 \textcolor{preprocessor}{#endif}
404 \textcolor{preprocessor}{}
405         \textcolor{keywordflow}{default}:
406             \textcolor{comment}{/* the event is not processed */}
407             triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{PSM\_TRIGGER\_DPM\_MSG};
408             \textcolor{keywordflow}{break};
409     \}
410 
411     \textcolor{keywordflow}{if} (newStateTmp != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN})
412     \{
413         *returnNewState = newStateTmp;
414     \}
415 
416     \textcolor{keywordflow}{return} didNothing;
417 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ad25940850feb762e329a32f90726c59a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ad25940850feb762e329a32f90726c59a_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a094d9150746a4bc943e34a883ed51c38}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Pd\-Msg@{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Pd\-Msg}}
\index{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Pd\-Msg@{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Pd\-Msg}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Pd\-Msg}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Psm\-Primary\-State\-Process\-Pd\-Msg (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t $\ast$}]{return\-New\-State, }
\item[{{\bf psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$}]{trigger\-Info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_a094d9150746a4bc943e34a883ed51c38}

\begin{DoxyCode}
422 \{
423     uint8\_t newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN};
424     uint8\_t didNothing = 1;
425 
426     \textcolor{keywordflow}{if} (triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fad322f67900d1d0c0a1b685ad33522c3e}{PSM\_TRIGGER\_RECEIVE\_HARD\_RESET}
      )
427     \{
428         triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
429 
430         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07a0e09f3ef502e87cc88da3124920d5}{PSM\_PE\_BIST\_TEST\_DATA\_MODE})
431         \{
432             \textcolor{comment}{/* From the IAS: There is no exit from this test mode except some chip level reset.}
433 \textcolor{comment}{               Reset the protocol layer to exit carrier mode */}
434             \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab337f6edf4077d3082bd3a7450612531}{PD\_PHY\_EXIT\_BIST}, NULL);
435         \}
436         \textcolor{comment}{/* Exit any active alternate mode */}
437         \textcolor{comment}{/* All timers and secondary states are reset during this call */}
438         \hyperlink{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61}{PD\_PsmReset}(pdInstance);
439 
440         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
441         \{
442             \textcolor{comment}{/* source receive hard\_reset, 1. start tPSHardReset */}
443             \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa50101b7f5beaa5d160ec488d4a47a57a}{tPSHardResetTimer}, 
      \hyperlink{usb__pd__timer_8h_a637462f763d08a187183fd8c067ae6e4}{T\_PS\_HARD\_RESET});
444             newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0127bb2a9bf34c7eec60d93a4bab8d3f}{PSM\_PE\_SRC\_HARD\_RESET\_RECEIVED};
445         \}
446         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
447         \{
448             pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a18806d06567f385463bba77f8202da49}{PD\_SnkStopDrawVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771ba08bcf27d29365689235f1a3f6b683a09}{kVbusPower\_InHardReset});
449             pdInstance->\hyperlink{struct__pd__instance_a7420286a3fc5b58010ff2dc607a8d77a}{asmHardResetSnkProcessing} = 1;
450             newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4ed497a81e543cc7428fcec9e2510f17}{PSM\_PE\_SNK\_TRANSITION\_TO\_DEFAULT};
451         \}
452         \textcolor{keywordflow}{else}
453         \{
454         \}
455         didNothing = 0;
456     \}
457     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG}) && (
      triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba7cb2a64a91c8eca49dd536625da6fdfc}{kPD\_MsgBIST}))
458     \{
459 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_COMPLIANCE\_TEST\_ENABLE) && (PD\_CONFIG\_COMPLIANCE\_TEST\_ENABLE)}
460 \textcolor{preprocessor}{}        \hyperlink{struct__pd__bist__object}{pd\_bist\_object\_t} bistObj;
461         bistObj.\hyperlink{struct__pd__bist__object_a780969d466c2145fb4e91c308f62682d}{objVal} = \hyperlink{usb__misc_8h_ab94871389a0730a311e19a217b223d4d}{USB\_LONG\_FROM\_LITTLE\_ENDIAN\_ADDRESS}(
      triggerInfo->\hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer});
462         \textcolor{keywordflow}{if} (bistObj.\hyperlink{struct__pd__bist__object_a849300b1862887c8f556ed20b6e444af}{bitFields}.testMode == \hyperlink{group__usb__pd__phy__drv_gga6e9f5312eacb47634a8cb7a9ef88ea2ea311a5b2f8176208f0d9fcc73e461a2d0}{kBIST\_TestData})
463         \{
464             \textcolor{comment}{/* Do nothing, the HW does not have a mode for kBIST\_TestData */}
465             newStateTmp = \hyperlink{group__usb__pd__phy__drv_gga6e9f5312eacb47634a8cb7a9ef88ea2ea311a5b2f8176208f0d9fcc73e461a2d0}{kBIST\_TestData};
466             \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda49c349410dcd972b652d355139f112a7}{PD\_PHY\_ENTER\_BIST}, &newStateTmp);
467             newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07a0e09f3ef502e87cc88da3124920d5}{PSM\_PE\_BIST\_TEST\_DATA\_MODE};
468         \}
469         \textcolor{keywordflow}{else}
470         \{
471             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer});
472             newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4196d00c604ca0624a80835573551686}{PSM\_PE\_BIST\_CARRIER\_MODE\_2};
473         \}
474 \textcolor{preprocessor}{#endif}
475 \textcolor{preprocessor}{}        triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
476     \}
477     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG}) && (
      triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bac009832ce574102c19d98de13758e68f}{kPD\_MsgSoftReset}))
478     \{
479         triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
480         \textcolor{comment}{/* Soft reset is ignored when in BIST carrier mode */}
481         \textcolor{comment}{/* Soft reset is ignored during fast role swap signalling */}
482         \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4196d00c604ca0624a80835573551686}{PSM\_PE\_BIST\_CARRIER\_MODE\_2}) &&
483             (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aca9891b871efc6127b397c6b17857e08}{PE\_FRS\_SRC\_SNK\_CC\_Signal}))
484         \{
485             \hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{PD\_PsmStartCommand}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET}, 0);
486             newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac33b51e9f31d333a18f537e5d0be8579}{PSM\_SOFT\_RESET};
487             didNothing = 0;
488         \}
489     \}
490     \textcolor{comment}{/* The received message's data role is not right */}
491     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == triggerInfo->\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.
      \hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.portDataRole) &&
492              (triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba0ef9dbd0f4015a5e580471a4c3553407}{kPD\_MsgGoodCRC}))
493     \{
494         triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa4a98effc36f9ecea5ec74a115571da10}{PSM\_TRIGGER\_NON\_START};
495         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY};
496         didNothing = 0;
497     \}
498     \textcolor{comment}{/* received source\_capabilities */}
499     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a57438b2126556f03e6423fceef89c8a9}{PSM\_PE\_SNK\_DISCOVERY}) && (
      triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba398e213caf8239ca95470df3bb2cdbf8}{kPD\_MsgSourceCapabilities}))
500     \{
501         uint32\_t u32Tmp = 0;
502 
503         (void)u32Tmp;
504         triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
505         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole} == 
      \hyperlink{group__usb__pd__stack_ggaffef947540aace08ecf6fd25f69720a9a38da91c9c7115f0e6866a557601ad9b0}{kPowerConfig\_SourceOnly})
506         \{
507             \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, 
      \hyperlink{usb__pd__policy_8c_ade02c6d1954d62b7153f6c9070e7b905}{PD\_NOT\_SUPPORT\_REPLY\_MSG}, pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState});
508         \}
509         \textcolor{keywordflow}{else}
510         \{
511             \textcolor{keywordflow}{switch} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState})
512             \{
513 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SOURCE\_ROLE\_ENABLE) && (PD\_CONFIG\_SOURCE\_ROLE\_ENABLE)}
514 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2adc31136486905eb9c680bdba8a6cc1}{PSM\_PE\_SRC\_DISCOVERY}:
515                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES}:
516                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf18258bbab5a008fe7f4b781df35055}{PSM\_PE\_SRC\_TRANSITION\_SUPPLY}:
517                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY}:
518                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a15beb3355a693f37d31884ede62f762b}{PSM\_PE\_SRC\_GET\_SINK\_CAP}:
519 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
520 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == triggerInfo->
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.portDataRole) &&
521                         (triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba0ef9dbd0f4015a5e580471a4c3553407}{kPD\_MsgGoodCRC}))
522                     \{
523                         \textcolor{comment}{/* Conflicting data roles (with delay for good crc tx) */}
524                         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}
      ;
525                     \}
526                     \textcolor{keywordflow}{else}
527 \textcolor{preprocessor}{#endif}
528 \textcolor{preprocessor}{}                    \{
529                         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
530                     \}
531                     \textcolor{keywordflow}{break};
532 
533 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
534 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a6682413184083874a372c9279d133506}{PSM\_PE\_PRS\_SRC\_SNK\_TRANSITION\_TO\_OFF}:
535                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af82fd0bf4ab2cb83e1b87082d53614c5}{PSM\_PE\_PRS\_SRC\_SNK\_WAIT\_SOURCE\_ON}:
536                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a90a6fac6bf8ce34a0c582b6e12a57f93}{PSM\_PE\_PRS\_SRC\_SNK\_SEND\_PR\_SWAP}:
537                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af1c9746136c41bf190396db70f45b5fd}{PSM\_PE\_PRS\_SNK\_SRC\_SOURCE\_ON}:
538 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
539 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == triggerInfo->
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.portDataRole) &&
540                         (triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba0ef9dbd0f4015a5e580471a4c3553407}{kPD\_MsgGoodCRC}))
541                     \{
542                         \textcolor{comment}{/* Conflicting data roles (with delay for good crc tx) */}
543                         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}
      ;
544                     \}
545                     \textcolor{keywordflow}{else}
546 \textcolor{preprocessor}{#endif}
547 \textcolor{preprocessor}{}                    \{
548                         \textcolor{comment}{/* A protocol error during power role swap triggers a Hard Reset */}
549                         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
550                     \}
551                     \textcolor{keywordflow}{break};
552 \textcolor{preprocessor}{#endif}
553 \textcolor{preprocessor}{}
554 \textcolor{preprocessor}{#endif}
555 \textcolor{preprocessor}{}
556 \textcolor{comment}{/* Source state, message expected */}
557 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
558 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab06c1b31af9a26e8dc4d36a2091c2de5}{PSM\_PE\_DR\_SRC\_GET\_SOURCE\_CAP}:
559                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a678da0d3de15c7db60380866e910151a}{PSM\_PE\_SNK\_GET\_SOURCE\_CAP}:
560                 \{
561                     \hyperlink{struct__pd__capabilities}{pd\_capabilities\_t} sourceCapa;
562                     \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
563                     \textcolor{comment}{/* Clear any pending message now that we have the latest */}
564                     (void)\hyperlink{usb__pd__policy_8c_a8478bb46d180cbe30f733a859d18547f}{PD\_DpmClearMsg}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aae21522a20dc98bf1e6a27fd41104158a}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SOURCE\_CAPABILITIES});
565                     sourceCapa.\hyperlink{struct__pd__capabilities_a559fdae7ddb5376491caf869366e7e71}{capabilities} = \hyperlink{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{MSG\_DATA\_BUFFER};
566                     sourceCapa.\hyperlink{struct__pd__capabilities_a240b859a2ffe7e634479a22c3f3e4feb}{capabilitiesCount} = (triggerInfo->
      \hyperlink{struct__psm__trigger__info_a66249e3b8cea619fbf9a42e72fba5c18}{pdMsgDataLength});
567                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aae21522a20dc98bf1e6a27fd41104158a}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SOURCE\_CAPABILITIES})
568                     \{
569                         pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = 0;
570                     \}
571                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aad63fc26b7c90d0b0882d09609f03c82}{PD\_DPM\_GET\_PARTNER\_SRC\_CAP\_SUCCESS}, &sourceCapa, 1);
572                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a678da0d3de15c7db60380866e910151a}{PSM\_PE\_SNK\_GET\_SOURCE\_CAP})
573                     \{
574                         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
575                     \}
576                     \textcolor{keywordflow}{else}
577                     \{
578                         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
579                     \}
580                     \textcolor{keywordflow}{break};
581                 \}
582 \textcolor{preprocessor}{#endif}
583 \textcolor{preprocessor}{}
584 \textcolor{comment}{/* Sink states, message accepted: */}
585 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SINK\_ROLE\_ENABLE) && (PD\_CONFIG\_SINK\_ROLE\_ENABLE)}
586 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES}:
587                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY}:
588                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK}:
589                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}:
590                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a40e24a76e6666339493163131c5f697b}{PSM\_PE\_SNK\_GIVE\_SINK\_CAP}:
591 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
592 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF}:
593                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af3dfe785a6dc68a892001143f3a833c1}{PSM\_PE\_PRS\_SNK\_SRC\_SEND\_PR\_SWAP}:
594                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0361f53d1396153b1405ab4b92c72b57}{PSM\_PE\_DR\_SNK\_GET\_SINK\_CAP}:
595 \textcolor{preprocessor}{#endif}
596 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
597 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == triggerInfo->
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.portDataRole) &&
598                         (triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba0ef9dbd0f4015a5e580471a4c3553407}{kPD\_MsgGoodCRC}))
599                     \{
600                         \textcolor{comment}{/* Conflicting data roles (with delay for good crc tx) */}
601                         newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}
      ;
602                     \}
603                     \textcolor{keywordflow}{else}
604 \textcolor{preprocessor}{#endif}
605 \textcolor{preprocessor}{}                    \{
606                         \hyperlink{struct__pd__capabilities}{pd\_capabilities\_t} sourceCapa;
607                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision} > triggerInfo->
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.specRevision)
608                         \{
609                             pdInstance->\hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision} = triggerInfo->
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.specRevision;
610                             \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
611                         \}
612                         \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fad8ac3ca013bf381c3d9349a2b33e4d65}{tSinkWaitCapTimer});
613                         pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 1;
614                         pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected} = 1;
615 
616                         \textcolor{comment}{/* Update the PDOs for the EC and send interrupt */}
617                         sourceCapa.\hyperlink{struct__pd__capabilities_a559fdae7ddb5376491caf869366e7e71}{capabilities} = \hyperlink{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{MSG\_DATA\_BUFFER};
618                         sourceCapa.\hyperlink{struct__pd__capabilities_a240b859a2ffe7e634479a22c3f3e4feb}{capabilitiesCount} = (triggerInfo->
      \hyperlink{struct__psm__trigger__info_a66249e3b8cea619fbf9a42e72fba5c18}{pdMsgDataLength});
619                         pdInstance->\hyperlink{struct__pd__instance_ad5c623ba7be298aa8ecdad50a298d609}{selfOrPartnerFirstSourcePDO}.
      \hyperlink{struct__pd__source__pdo_ae7c1220b81dd8506c6731d7a6adc6ac9}{PDOValue} = sourceCapa.\hyperlink{struct__pd__capabilities_a559fdae7ddb5376491caf869366e7e71}{capabilities}[0];
620                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aae21522a20dc98bf1e6a27fd41104158a}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SOURCE\_CAPABILITIES})
621                         \{
622                             pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = 0;
623                         \}
624                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a73f52811ed1d7307f82f21ec46a09f24}{PD\_DPM\_SNK\_RECEIVE\_PARTNER\_SRC\_CAP}, &sourceCapa, 0);
625 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
626 \textcolor{preprocessor}{}                        \textcolor{comment}{/* Ensure secondary state machine does not transition primary state machine */}
627                         PD\_PsmSecondaryStateHandlerTerminate(pdInstance, 0xffu);
628 \textcolor{preprocessor}{#endif}
629 \textcolor{preprocessor}{}                        newStateTmp = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf98b7f6641597ec99b6fd883d2f13a9}{PSM\_PE\_SNK\_EVALUATE\_CAPABILITY};
630                     \}
631                     \textcolor{keywordflow}{break};
632 \textcolor{preprocessor}{#endif}
633 \textcolor{preprocessor}{}
634                 \textcolor{keywordflow}{default}:
635                     \textcolor{keywordflow}{break};
636             \}
637         \}
638 
639         didNothing = 0;
640     \}
641 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
642 \textcolor{preprocessor}{}    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG}) && (
      triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba66aafd87acfa6b79caa2331114cd632a}{kPD\_MsgVendorDefined}) &&
643              (triggerInfo->\hyperlink{struct__psm__trigger__info_a7a85c1bb9ac095e9b66d4c147496d5f4}{vdmHeader}.\hyperlink{struct__pd__structured__vdm__header_afc8471a70fa430820836286de3cf2281}{bitFields}.command == 
      \hyperlink{group__usb__pd__stack_ggac4a67ecdc78b1a071ca6505a765a301fa1457e1ea577c3e45e1d4a657cd5005d7}{kVDM\_ExitMode}) &&
644              (triggerInfo->\hyperlink{struct__psm__trigger__info_a7a85c1bb9ac095e9b66d4c147496d5f4}{vdmHeader}.\hyperlink{struct__pd__structured__vdm__header_afc8471a70fa430820836286de3cf2281}{bitFields}.commandType == 
      \hyperlink{group__usb__pd__stack_ggaa6b2f8f6620280d0d17ab102c5992ca8a0081a7547bb0feb88cd34c46cc1e9146}{kVDM\_Initiator}))
645     \{
646         pdInstance->\hyperlink{struct__pd__instance_afcd5caf46554e0640a45ac547d7bacf0}{vdmExitReceived}[triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop}] = triggerInfo->
      \hyperlink{struct__psm__trigger__info_a7a85c1bb9ac095e9b66d4c147496d5f4}{vdmHeader}.\hyperlink{struct__pd__structured__vdm__header_afc8471a70fa430820836286de3cf2281}{bitFields}.objPos;
647     \}
648 \textcolor{preprocessor}{#endif}
649 \textcolor{preprocessor}{}    \textcolor{keywordflow}{else}
650     \{
651     \}
652 
653     \textcolor{keywordflow}{if} (newStateTmp != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN})
654     \{
655         *returnNewState = newStateTmp;
656     \}
657 
658     \textcolor{keywordflow}{return} didNothing;
659 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a094d9150746a4bc943e34a883ed51c38_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a094d9150746a4bc943e34a883ed51c38_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ac46d497d9fc03b0096c2977f6a203e02}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Process\-State@{P\-D\-\_\-\-Psm\-Process\-State}}
\index{P\-D\-\_\-\-Psm\-Process\-State@{P\-D\-\_\-\-Psm\-Process\-State}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Process\-State}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Psm\-Process\-State (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_ac46d497d9fc03b0096c2977f6a203e02}

\begin{DoxyCode}
2393 \{
2394     uint32\_t taskEventSet;
2395     uint32\_t commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
2396     uint32\_t inCase32Tmp = 0;
2397     \hyperlink{struct__psm__trigger__info}{psm\_trigger\_info\_t} triggerInfo;
2398     uint8\_t didNothingStepA = 1;
2399     uint8\_t didNothingStepB = 1;
2400     uint8\_t msgReceived = 0;
2401 
2402     (void)commandResultCallback;
2403     (void)inCase32Tmp;
2404 
2405     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN})
2406     \{
2407         triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
2408         triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} = \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba8e261ea49608c646738b8028b0a63a58}{kPD\_MsgInvalid};
2409         triggerInfo.\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg} = 0;
2410 
2411         \textcolor{comment}{/* get the newest events */}
2412         \textcolor{keywordflow}{if} (\hyperlink{group__usb__os__abstraction_gab25fb5d93d3b665ca8eadf2a670d3361}{USB\_OsaEventCheck}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 0xffu, &
      taskEventSet) == \hyperlink{group__usb__os__abstraction_gga453ebd2f93aafb8c938c3a23c815f9bdab90805fb75297fda1ca60dbb2283f933}{kStatus\_USB\_OSA\_Success})
2413         \{
2414             \textcolor{keywordflow}{if} (taskEventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ad67d7de3ba6594e125904b656e3f4798}{PD\_TASK\_EVENT\_TIME\_OUT})
2415             \{
2416                 \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      PD\_TASK\_EVENT\_TIME\_OUT);
2417             \}
2418             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (taskEventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981acb2bb966833cec20095d00c288533e51}{PD\_TASK\_EVENT\_RECEIVED\_HARD\_RESET})
2419             \{
2420                 \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ab7866880ca831b0f650c837287bbd60f}{PD\_TASK\_EVENT\_PD\_MSG});
2421                 \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      PD\_TASK\_EVENT\_RECEIVED\_HARD\_RESET);
2422                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4196d00c604ca0624a80835573551686}{PSM\_PE\_BIST\_CARRIER\_MODE\_2})
2423                 \{
2424                     \textcolor{comment}{/* Hard reset is ignored when in BIST carrier mode */}
2425                     pdInstance->\hyperlink{struct__pd__instance_af70b04cd5c8187c6a0424dea57205e8c}{hardResetReceived} = 0;
2426                     triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fad322f67900d1d0c0a1b685ad33522c3e}{PSM\_TRIGGER\_RECEIVE\_HARD\_RESET};
2427                 \}
2428             \}
2429             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (taskEventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ace1c61e1c2c9768ffea7e4ed3552dabd}{PD\_TASK\_EVENT\_FR\_SWAP\_SINGAL})
2430             \{
2431                 \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      PD\_TASK\_EVENT\_FR\_SWAP\_SINGAL);
2432                 \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink}) && (
      pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted}))
2433                 \{
2434                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aa1ded4aeaaf1546c7d1b30f9a72d8233}{PE\_FRS\_SNK\_SRC\_Send\_Swap};
2435                 \}
2436             \}
2437             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (taskEventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ab7866880ca831b0f650c837287bbd60f}{PD\_TASK\_EVENT\_PD\_MSG})
2438             \{
2439                 \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      PD\_TASK\_EVENT\_PD\_MSG);
2440                 msgReceived = 1;
2441 
2442                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07a0e09f3ef502e87cc88da3124920d5}{PSM\_PE\_BIST\_TEST\_DATA\_MODE})
2443                 \{
2444 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
2445 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a21c5a4229c4d099a6840ac2d13a5a32e}{receivedSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1ac884af27fd06f1ae0c9e148c596ac5fa}{kPD\_MsgSOPp}) || (pdInstance->
      \hyperlink{struct__pd__instance_a21c5a4229c4d099a6840ac2d13a5a32e}{receivedSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a9e34c9f67e13b4b9ba3d5d3c609a2f07}{kPD\_MsgSOPpp}))
2446                     \{
2447                         \hyperlink{usb__pd__policy_8c_a19c2d2c30e1d818cf1b730f60f866f44}{PD\_MsgGetReceiveResult}(pdInstance);
2448                         \hyperlink{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance);
2449                         msgReceived = 0;
2450                     \}
2451                     \textcolor{keywordflow}{else}
2452 \textcolor{preprocessor}{#endif}
2453 \textcolor{preprocessor}{}                        \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a21c5a4229c4d099a6840ac2d13a5a32e}{receivedSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && 
      \hyperlink{usb__pd__policy_8c_a19c2d2c30e1d818cf1b730f60f866f44}{PD\_MsgGetReceiveResult}(pdInstance))
2454                     \{
2455                         triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a3be91c1e7084d53533ddf706f450c28b}{msgHeaderVal} = (uint16\_t)(
      \hyperlink{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}{MSG\_DATA\_HEADER});
2456                         triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} = pdInstance->\hyperlink{struct__pd__instance_a21c5a4229c4d099a6840ac2d13a5a32e}{receivedSop};
2457 
2458                         \textcolor{keywordflow}{if} (!(triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.extended))
2459                         \{
2460                             \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0)
2461                             \{
2462                                 triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType;
2463                                 \textcolor{comment}{/* There are three places: two message will be sent continuously by one
       port.}
2464 \textcolor{comment}{                                 * 1. fast role swap.}
2465 \textcolor{comment}{                                 * 2. sink beginning power role swap.}
2466 \textcolor{comment}{                                 * 3. rdo request in source.}
2467 \textcolor{comment}{                                 */}
2468                                 \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}))
2469                                 \{
2470                                     \hyperlink{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance);
2471                                 \}
2472                                 \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba04e529f0c9df5cf995ef7e9e3391eb24}{kPD\_MsgFrSwap})
2473                                 \{
2474                                     pdInstance->\hyperlink{struct__pd__instance_ac9684a4a5a96ac21f503ad702a245a7e}{frSwapReceived} = 1;
2475                                 \}
2476                             \}
2477                             \textcolor{keywordflow}{else}
2478                             \{
2479                                 triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} =
2480                                     (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType | 
      \hyperlink{usb__pd__spec_8h_acdd206add7fcdbb82964deb180e0b100}{PD\_MSG\_DATA\_TYPE\_MASK});
2481                                 \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba05b1ffccfe00a874c8bc02065746352d}{kPD\_MsgRequest}) &&
2482                                     (pdInstance->\hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision} > triggerInfo.
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.specRevision))
2483                                 \{
2484                                     pdInstance->\hyperlink{struct__pd__instance_af7c28b72771ce442ee733892186c4e6c}{revision} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.specRevision;
2485                                     \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
2486                                 \}
2487                             \}
2488                             triggerInfo.\hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer} = (uint8\_t *)
      \hyperlink{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{MSG\_DATA\_BUFFER};
2489                             triggerInfo.\hyperlink{struct__psm__trigger__info_a66249e3b8cea619fbf9a42e72fba5c18}{pdMsgDataLength} =
2490                                 ((\hyperlink{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}{MSG\_DATA\_HEADER} & 
      \hyperlink{usb__pd__spec_8h_abe092f59b5c596f35d397e80e583b059}{PD\_MSG\_HEADER\_NUMBER\_OF\_DATA\_OBJECTS\_MASK}) >>
2491                                  \hyperlink{usb__pd__spec_8h_a1cf3acbacd01a46bb61d2418ccadb292}{PD\_MSG\_HEADER\_NUMBER\_OF\_DATA\_OBJECTS\_POS}
      );
2492                         \}
2493                         \textcolor{keywordflow}{else}
2494                         \{
2495                             triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} =
2496                                 (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType | 
      \hyperlink{usb__pd__spec_8h_a0be754733709bebbe885f0ae1d3153a0}{PD\_MSG\_EXT\_TYPE\_MASK});
2497                             triggerInfo.\hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer} = (uint8\_t *)
      \hyperlink{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{MSG\_DATA\_BUFFER};
2498                             triggerInfo.\hyperlink{struct__psm__trigger__info_a66249e3b8cea619fbf9a42e72fba5c18}{pdMsgDataLength} =
2499                                 ((\hyperlink{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}{MSG\_DATA\_HEADER} & 
      \hyperlink{usb__pd__spec_8h_abe092f59b5c596f35d397e80e583b059}{PD\_MSG\_HEADER\_NUMBER\_OF\_DATA\_OBJECTS\_MASK}) >>
2500                                  \hyperlink{usb__pd__spec_8h_a1cf3acbacd01a46bb61d2418ccadb292}{PD\_MSG\_HEADER\_NUMBER\_OF\_DATA\_OBJECTS\_POS}
      );
2501                             \textcolor{keywordflow}{if} (!(triggerInfo.\hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer}[1] & 0x80u))
2502                             \{
2503                                 triggerInfo.\hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength} =
2504                                     (triggerInfo.\hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer}[0] + (triggerInfo.
      \hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer}[1] & 0x01u) * 16);
2505                             \}
2506                             \textcolor{keywordflow}{else}
2507                             \{
2508                                 triggerInfo.\hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_a66249e3b8cea619fbf9a42e72fba5c18}{pdMsgDataLength} * 4 - 2;
2509                             \}
2510                         \}
2511                         triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG};
2512 
2513                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba66aafd87acfa6b79caa2331114cd632a}{kPD\_MsgVendorDefined})
2514                         \{
2515                             triggerInfo.\hyperlink{struct__psm__trigger__info_a7a85c1bb9ac095e9b66d4c147496d5f4}{vdmHeader}.
      \hyperlink{struct__pd__structured__vdm__header_a0544fc4b30468ec5d5b435a05b30ced1}{structuredVdmHeaderVal} = (uint32\_t)\hyperlink{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{MSG\_DATA\_BUFFER}[0];
2516                         \}
2517                     \}
2518                     \textcolor{keywordflow}{else}
2519                     \{
2520                     \}
2521                 \}
2522                 \textcolor{keywordflow}{else}
2523                 \{
2524                     \textcolor{comment}{/* Ignore everything except Hard Reset and disconnect */}
2525                 \}
2526             \}
2527             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (taskEventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981a8d7dadfaeb7942924ec2e0b32f654c35}{PD\_TASK\_EVENT\_DPM\_MSG})
2528             \{
2529                 uint8\_t command;
2530                 command = \hyperlink{usb__pd__policy_8c_afe9fa5f2f570274127c5a163adb5cd90}{PD\_DpmGetMsg}(pdInstance);
2531                 triggerInfo.\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg} = 0;
2532                 \textcolor{keywordflow}{if} (command)
2533                 \{
2534                     triggerInfo.\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg} = command;
2535                     \textcolor{keywordflow}{switch} (command)
2536                     \{
2537                         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET}:
2538                         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aabd4e605546d67fb4bbfad35ea77f5589}{PD\_DPM\_CONTROL\_HARD\_RESET}:
2539                         \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa1af15d89c350437f5f4e8a95ea841f5b}{PD\_DPM\_FAST\_ROLE\_SWAP}:
2540                             \textcolor{keywordflow}{break};
2541 
2542                         \textcolor{keywordflow}{default}:
2543                             \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}) &&
2544                                 (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY}))
2545                             \{
2546                                 triggerInfo.\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg} = 0;
2547                             \}
2548                             \textcolor{keywordflow}{break};
2549                     \}
2550                 \}
2551                 \textcolor{keywordflow}{else}
2552                 \{
2553                     \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->
      \hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, PD\_TASK\_EVENT\_DPM\_MSG);
2554                 \}
2555 
2556                 \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg} != 0)
2557                 \{
2558                     \hyperlink{usb__pd__policy_8c_a8478bb46d180cbe30f733a859d18547f}{PD\_DpmClearMsg}(pdInstance, (\hyperlink{group__usb__pd__stack_ga91457cf9522e345a0efa2e2a7424bb0d}{pd\_command\_t})triggerInfo.
      \hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg});
2559                     \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->
      \hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, PD\_TASK\_EVENT\_DPM\_MSG);
2560                     triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{PSM\_TRIGGER\_DPM\_MSG};
2561                 \}
2562             \}
2563             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (taskEventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981a01e917815dd3d2d16283e6ff86f9b1c6}{PD\_TASK\_EVENT\_SEND\_DONE})
2564             \{
2565                 \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      PD\_TASK\_EVENT\_SEND\_DONE);
2566             \}
2567             \textcolor{keywordflow}{else}
2568             \{
2569                 \hyperlink{usb__pd__policy_8c_a39aa541f6a8e3843b3ab18fdcf533768}{PD\_PortTaskEventProcess}(pdInstance, taskEventSet);
2570                 triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
2571             \}
2572         \}
2573 
2574         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG}) ||
2575             (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fad322f67900d1d0c0a1b685ad33522c3e}{PSM\_TRIGGER\_RECEIVE\_HARD\_RESET}))
2576         \{
2577             didNothingStepA &=
2578                 \hyperlink{usb__pd__policy_8c_a094d9150746a4bc943e34a883ed51c38}{PD\_PsmPrimaryStateProcessPdMsg}(pdInstance, (uint8\_t *)&
      pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState}, &triggerInfo);
2579         \}
2580         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{PSM\_TRIGGER\_DPM\_MSG})
2581         \{
2582             didNothingStepA &=
2583                 \hyperlink{usb__pd__policy_8c_ad25940850feb762e329a32f90726c59a}{PD\_PsmPrimaryStateProcessDpmMsg}(pdInstance, (uint8\_t *)&
      pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState}, &triggerInfo);
2584         \}
2585         \textcolor{keywordflow}{else}
2586         \{
2587         \}
2588 
2589         \textcolor{keywordflow}{if} (!didNothingStepA)
2590         \{
2591             \textcolor{keywordflow}{if} ((msgReceived) && (\hyperlink{usb__pd__policy_8c_aa84db2763770b08d1dd666c12e4ec45b}{PD\_PsmCanPendingReceive}(pdInstance)))
2592             \{
2593                 \hyperlink{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance); \textcolor{comment}{/* msg has been processed, receiving next msg */}
2594             \}
2595             \textcolor{keywordflow}{return} \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{kSM\_Continue};
2596         \}
2597 
2598         \textcolor{comment}{/* different timeout need hard\_reset */}
2599         \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fad8ac3ca013bf381c3d9349a2b33e4d65}{tSinkWaitCapTimer}) ||
2600              \hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2a9680637c4a08ea8ec5a463f00ab28a}{tPSTransitionTimer}) ||
2601              \hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer})) &&
2602             (pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} <= 
      \hyperlink{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{N\_HARD\_RESET\_COUNT}) && (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink}))
2603         \{
2604             \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fad8ac3ca013bf381c3d9349a2b33e4d65}{tSinkWaitCapTimer}))
2605             \{
2606                 \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fad8ac3ca013bf381c3d9349a2b33e4d65}{tSinkWaitCapTimer});
2607             \}
2608 
2609             \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2a9680637c4a08ea8ec5a463f00ab28a}{tPSTransitionTimer}))
2610             \{
2611                 \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2a9680637c4a08ea8ec5a463f00ab28a}{tPSTransitionTimer});
2612             \}
2613 
2614             \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}))
2615             \{
2616                 \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer});
2617             \}
2618 
2619             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
2620             didNothingStepA = 0;
2621         \}
2622 
2623         \textcolor{comment}{/* alternate mode tAMETimeoutTimer */}
2624         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa30444778033546172c76622995ada281}{tAMETimeoutTimer}))
2625         \{
2626             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa30444778033546172c76622995ada281}{tAMETimeoutTimer});
2627             \hyperlink{usb__pd__policy_8c_af415d8897be39b06937aa0c1316abca9}{PD\_ConnectAltModeEnterFail}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected});
2628 
2629 \textcolor{preprocessor}{#ifdef USBPD\_ENABLE\_USB\_BILLBOARD}
2630 \textcolor{preprocessor}{}            UsbbSetAltModeConfigResult(AMR\_CONFIG\_FAILED);
2631 \textcolor{preprocessor}{#endif}
2632 \textcolor{preprocessor}{}        \}
2633 
2634         \textcolor{comment}{/* Check if we are waiting for an event for state transition */}
2635         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState})
2636         \{
2637             didNothingStepB = 0;
2638             \textcolor{keywordflow}{switch} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState})
2639             \{
2640                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY}:            \textcolor{comment}{/* (B) */}
2641                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}: \textcolor{comment}{/* (B) */}
2642                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY})
2643                     \{
2644                         \textcolor{comment}{/* Delay for 1ms to make sure any previous GoodCRC transmission has ended. */}
2645                         \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer}, 
      \hyperlink{usb__pd__timer_8h_a3d7e832f23ba73275f9245159dfe475c}{mSec}(1));
2646                         \textcolor{keywordflow}{while} (!(\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa918421e184737508bd7e4b501a70cb13}{tDelayTimer})))
2647                         \{
2648                             ;
2649                         \}
2650                     \}
2651                     \hyperlink{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344}{PD\_DpmDisconnect}(pdInstance);
2652                     \textcolor{comment}{/* Exit to CLP in disconnected state */}
2653                     \textcolor{keywordflow}{return} \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}{kSM\_ErrorRecovery};
2654                     \textcolor{keywordflow}{break};
2655 
2656 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
2657 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ee6a2f41bbfa406b9492016783b6b18}{PSM\_INTERRUPTED\_REQUEST}: \textcolor{comment}{/* (B) */}
2658                     \textcolor{comment}{/* Transitioned back here after VDM handling, re attempt the request */}
2659                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = pdInstance->
      \hyperlink{struct__pd__instance_a4a53a203e61b44957d56747fb7c8a312}{psmInterruptedState};
2660                     pdInstance->\hyperlink{struct__pd__instance_a4a53a203e61b44957d56747fb7c8a312}{psmInterruptedState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN};
2661                     \textcolor{keywordflow}{break};
2662 \textcolor{preprocessor}{#endif}
2663 \textcolor{preprocessor}{}
2664                 \textcolor{comment}{/* do har\_reset actively do in (C) */}
2665                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET}: \textcolor{comment}{/* (B) */}
2666                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
2667                     \{
2668                         \textcolor{comment}{/* source send hard\_reset, 2. after tpstimer. */}
2669                         \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa50101b7f5beaa5d160ec488d4a47a57a}{tPSHardResetTimer}))
2670                         \{
2671                             \textcolor{comment}{/* Hard reset is complete */}
2672                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac2cf2928f82b4a269bf222bafd340397}{PSM\_PE\_SRC\_TRANSITION\_TO\_DEFAULT};
2673                         \}
2674                         \textcolor{keywordflow}{else}
2675                         \{
2676                             didNothingStepB = 1;
2677                         \}
2678                     \}
2679                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
2680                     \{
2681                         \textcolor{comment}{/* sink send hard\_reset */}
2682                         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a18806d06567f385463bba77f8202da49}{PD\_SnkStopDrawVbus}(pdInstance
      ->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771ba08bcf27d29365689235f1a3f6b683a09}{kVbusPower\_InHardReset});
2683                         pdInstance->\hyperlink{struct__pd__instance_a7420286a3fc5b58010ff2dc607a8d77a}{asmHardResetSnkProcessing} = 1;
2684                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4ed497a81e543cc7428fcec9e2510f17}{PSM\_PE\_SNK\_TRANSITION\_TO\_DEFAULT};
2685                     \}
2686                     \textcolor{keywordflow}{else}
2687                     \{
2688                     \}
2689                     \textcolor{keywordflow}{break};
2690 
2691                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET}: \textcolor{comment}{/* (B) */}
2692                     \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG}) && (triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) &&
2693                         (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}))
2694                     \{
2695                         \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
2696                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET})
2697                         \{
2698                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ad1d3a3dd48dcbb93d29eee4e09093770}{PD\_DPM\_SOFT\_RESET\_SUCCESS}, NULL, 1);
2699                         \}
2700                         \textcolor{keywordflow}{else}
2701                         \{
2702                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a55e5b428b44bfbcef61a8fc137370c60}{PD\_DPM\_SOFT\_RESET\_REQUEST}, NULL, 0);
2703                         \}
2704 
2705                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
2706                         \{
2707                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7b68a9659f79097c9ddb0a11144eab1d}{PSM\_PE\_SRC\_IMPLICIT\_CABLE\_DISCOVERY};
2708                         \}
2709                         \textcolor{keywordflow}{else}
2710                         \{
2711                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES};
2712                         \}
2713                     \}
2714                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
2715                     \{
2716                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa047c61de46f8d33e6944b8c6971ae5f6}{PD\_DPM\_CONTROL\_SOFT\_RESET})
2717                         \{
2718                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a0c22065d3fb71fbfef9abe1a385dd661}{PD\_DPM\_SOFT\_RESET\_FAIL}, NULL, 1);
2719                         \}
2720                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
2721                     \}
2722                     \textcolor{keywordflow}{else}
2723                     \{
2724                         didNothingStepB = 1;
2725                     \}
2726                     \textcolor{keywordflow}{break};
2727 
2728                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac33b51e9f31d333a18f537e5d0be8579}{PSM\_SOFT\_RESET}: \textcolor{comment}{/* (B) */}
2729                     \textcolor{comment}{/* If we get here, then recover with a hard reset */}
2730                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
2731                     \textcolor{keywordflow}{break};
2732 
2733                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}: \textcolor{comment}{/* (B) */}
2734                     \textcolor{comment}{/* The async conditions at the top of the loop have been evaluated */}
2735                     \textcolor{comment}{/* continue to soft reset */}
2736                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
2737                     \textcolor{keywordflow}{break};
2738 
2739                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a31811e7eea7b85fabd5d14eae04869d1}{PSM\_BYPASS}: \textcolor{comment}{/* (B) */}
2740                     \textcolor{comment}{/* We do nothing here. */}
2741                     didNothingStepB = 1;
2742                     \textcolor{keywordflow}{break};
2743 
2744 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SOURCE\_ROLE\_ENABLE) && (PD\_CONFIG\_SOURCE\_ROLE\_ENABLE)}
2745 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ae9194b9c8e1e319ab3a3c3bb25fd51}{PSM\_PE\_SRC\_STARTUP}: \textcolor{comment}{/* (B) */}
2746                     \textcolor{comment}{/* only for pr\_swap, the state will enter this */}
2747                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
2748                     \{
2749                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
2750                     \}
2751                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fab577ba31a79927d95fc5d5e7b8e4c967}{tSwapSourceStartTimer}))
2752                     \{
2753                         \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fab577ba31a79927d95fc5d5e7b8e4c967}{tSwapSourceStartTimer});
2754                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7b68a9659f79097c9ddb0a11144eab1d}{PSM\_PE\_SRC\_IMPLICIT\_CABLE\_DISCOVERY};
2755                     \}
2756                     \textcolor{keywordflow}{else}
2757                     \{
2758                         didNothingStepB = 1;
2759                     \}
2760                     \textcolor{keywordflow}{break};
2761 
2762                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a2adc31136486905eb9c680bdba8a6cc1}{PSM\_PE\_SRC\_DISCOVERY}: \textcolor{comment}{/* (B) */}
2763                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
2764                     \{
2765                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
2766                     \}
2767                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fac35ed3ca07f48b47d9642e95404c25ce}{tSourceCapabilityTimer}))
2768                     \{
2769                         \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_aec485d99451925aec7a6237f92791cd3}{psmCapsCounter} > 
      \hyperlink{usb__pd__policy_8c_aa1cb572e01e6e6e53632c7996691bef0}{N\_CAPS\_COUNT}))
2770                         \{
2771                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a493e1fe84c3cce59c37d36dc048c04}{PSM\_PE\_SRC\_DISABLED};
2772                         \}
2773                         \textcolor{keywordflow}{else}
2774                         \{
2775                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES};
2776                         \}
2777                     \}
2778                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}) &&
2779                              (pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} > 
      \hyperlink{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{N\_HARD\_RESET\_COUNT}))
2780                     \{
2781                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected})
2782                         \{
2783                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
2784                         \}
2785                         \textcolor{keywordflow}{else}
2786                         \{
2787                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a493e1fe84c3cce59c37d36dc048c04}{PSM\_PE\_SRC\_DISABLED};
2788                         \}
2789                     \}
2790                     \textcolor{keywordflow}{else}
2791                     \{
2792                         didNothingStepB = 1;
2793                     \}
2794                     \textcolor{keywordflow}{break};
2795 
2796                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7b68a9659f79097c9ddb0a11144eab1d}{PSM\_PE\_SRC\_IMPLICIT\_CABLE\_DISCOVERY}: \textcolor{comment}{/* (B) */}
2797 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
2798 \textcolor{preprocessor}{}                    Pd\_PsmSecondaryStateHandler(pdInstance, 1, \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1ac884af27fd06f1ae0c9e148c596ac5fa}{kPD\_MsgSOPp}, &triggerInfo);
2799                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[1] == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE})
2800                     \{
2801                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES};
2802                     \}
2803 \textcolor{preprocessor}{#endif}
2804 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{break};
2805 
2806                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES}: \textcolor{comment}{/* (B) */}
2807                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
2808                     \{
2809                         \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
2810                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba05b1ffccfe00a874c8bc02065746352d}{kPD\_MsgRequest})
2811                         \{
2812                             pdInstance->\hyperlink{struct__pd__instance_ad8cdcafc4b643a8f147febada1cd5704}{partnerRdoRequest}.
      \hyperlink{struct__pd__rdo_a66cd4e249b3284e7d1acc9714fa0ce0a}{rdoVal} = *((uint32\_t *)(&(triggerInfo.\hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer}[0])));
2813                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07e42e3c7b35e7235b32acef3caf77ca}{PSM\_PE\_SRC\_NEGOTIATE\_CAPABILITY};
2814                         \}
2815                         \textcolor{keywordflow}{else}
2816                         \{
2817                             \textcolor{comment}{/* discard vendor defined message at here */}
2818                             \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba66aafd87acfa6b79caa2331114cd632a}{kPD\_MsgVendorDefined})
2819                             \{
2820                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = pdInstance->
      \hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState};
2821                             \}
2822                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
2823                         \}
2824                     \}
2825                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
2826                     \{
2827                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
2828                     \}
2829                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}) &&
2830                              (pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} > 
      \hyperlink{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{N\_HARD\_RESET\_COUNT}))
2831                     \{
2832                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected})
2833                         \{
2834                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
2835                         \}
2836                         \textcolor{keywordflow}{else}
2837                         \{
2838                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a493e1fe84c3cce59c37d36dc048c04}{PSM\_PE\_SRC\_DISABLED};
2839                         \}
2840                     \}
2841                     \textcolor{keywordflow}{else}
2842                     \{
2843                         didNothingStepB = 1;
2844                     \}
2845                     \textcolor{keywordflow}{break};
2846 
2847                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acf18258bbab5a008fe7f4b781df35055}{PSM\_PE\_SRC\_TRANSITION\_SUPPLY}: \textcolor{comment}{/* (B) */}
2848                     \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY});
2849                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx})
2850                     \{
2851                         pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx} = 0;
2852                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a818c91e1b20cc978318777720f2c7a3b}{PD\_DPM\_SRC\_GOTOMIN\_SUCCESS}, NULL, 1);
2853                     \}
2854                     \textcolor{keywordflow}{else}
2855                     \{
2856                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY})
2857                         \{
2858                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a212a13db5a2a86d25d5e4e9bd9bd9d40}{PD\_DPM\_SRC\_RDO\_SUCCESS}, NULL, 1);
2859                         \}
2860                     \}
2861                     \textcolor{keywordflow}{break};
2862 
2863                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY}: \textcolor{comment}{/* (B) */}
2864                                        \textcolor{comment}{/* state machine */}
2865 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
2866 \textcolor{preprocessor}{}                    inCase32Tmp = 1;
2867                     inCase32Tmp &= Pd\_PsmSecondaryStateHandler(pdInstance, 0, 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, &triggerInfo);
2868                     inCase32Tmp &= Pd\_PsmSecondaryStateHandler(pdInstance, 1, 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1ac884af27fd06f1ae0c9e148c596ac5fa}{kPD\_MsgSOPp}, &triggerInfo);
2869                     inCase32Tmp &= Pd\_PsmSecondaryStateHandler(pdInstance, 2, 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a9e34c9f67e13b4b9ba3d5d3c609a2f07}{kPD\_MsgSOPpp}, &triggerInfo);
2870                     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[0] != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}) ||
2871                         (pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[1] != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}) ||
2872                         (pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[2] != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}))
2873                     \{
2874                         \textcolor{keywordflow}{if} (inCase32Tmp)
2875                         \{
2876                             didNothingStepB = 0;
2877                         \}
2878                         \textcolor{keywordflow}{break};
2879                     \}
2880 \textcolor{preprocessor}{#endif}
2881 \textcolor{preprocessor}{}
2882                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
2883                     \{
2884                         didNothingStepB = 0;
2885                         PD\_PsmSourceRdyProcessPdMessage(pdInstance, &triggerInfo);
2886                     \}
2887                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{PSM\_TRIGGER\_DPM\_MSG})
2888                     \{
2889                         didNothingStepB = 0;
2890                         PD\_PsmSourceRdyProcessDpmMessage(pdInstance, &triggerInfo);
2891                     \}
2892                     \textcolor{keywordflow}{else}
2893                     \{
2894                         didNothingStepB = 1;
2895                     \}
2896                     \textcolor{keywordflow}{break};
2897 
2898                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a493e1fe84c3cce59c37d36dc048c04}{PSM\_PE\_SRC\_DISABLED}: \textcolor{comment}{/* (B) */}
2899                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected} &&
2900                         \hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}) &&
2901                         (pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} > 
      \hyperlink{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{N\_HARD\_RESET\_COUNT}))
2902                     \{
2903                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
2904                     \}
2905                     \textcolor{keywordflow}{else}
2906                     \{
2907                         didNothingStepB = 1;
2908                     \}
2909                     \textcolor{keywordflow}{break};
2910 
2911                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9bd78db53d0a51005b2cc67585a5a96a}{PSM\_PE\_SRC\_WAIT\_NEW\_CAPABILITIES}: \textcolor{comment}{/* (B) */}
2912                     \textcolor{comment}{/* The exit transition is handled by the global state transitions */}
2913                     didNothingStepB = 1;
2914                     \textcolor{keywordflow}{break};
2915 
2916                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0127bb2a9bf34c7eec60d93a4bab8d3f}{PSM\_PE\_SRC\_HARD\_RESET\_RECEIVED}: \textcolor{comment}{/* (B) */}
2917                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa50101b7f5beaa5d160ec488d4a47a57a}{tPSHardResetTimer}))
2918                     \{
2919                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac2cf2928f82b4a269bf222bafd340397}{PSM\_PE\_SRC\_TRANSITION\_TO\_DEFAULT};
2920                     \}
2921                     \textcolor{keywordflow}{else}
2922                     \{
2923                         didNothingStepB = 1;
2924                     \}
2925                     \textcolor{keywordflow}{break};
2926 
2927                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac2cf2928f82b4a269bf222bafd340397}{PSM\_PE\_SRC\_TRANSITION\_TO\_DEFAULT}: \textcolor{comment}{/* (B) */}
2928                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V})
2929                     \{
2930                         \textcolor{comment}{/* source send hard\_reset, 4. after tSrcRecover, open vsafe5v. */}
2931                         \textcolor{comment}{/* source receive hard\_reset, 4. after tSrcRecover, open vsafe5v. */}
2932                         \textcolor{comment}{/* 2. wait tSrcRecover */}
2933                         \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa54b3efed00381dbca168c67336d84913}{tSrcRecoverTimer}))
2934                         \{
2935                             pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V} = 0;
2936                             pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a81922cf6a4f22bcee69123e95fac7758}{PD\_SrcTurnOnTypeCVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam},
2937                                                                            
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771ba08bcf27d29365689235f1a3f6b683a09}{kVbusPower\_InHardReset});
2938 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
2939 \textcolor{preprocessor}{}\textcolor{preprocessor}{#ifdef USBPD\_ENABLE\_VCONN\_DISCHARGE}
2940 \textcolor{preprocessor}{}                            \hyperlink{usb__pd__policy_8c_a0dee3662096589c64561a02b662b602a}{PD\_DpmDischargeVconn}(pdInstance, 0);
2941 \textcolor{preprocessor}{#endif}
2942 \textcolor{preprocessor}{}                            \hyperlink{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a}{PD\_DpmSetVconn}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_a5905690cc5a12a0758be0574d4bc262e}{raPresent});
2943 \textcolor{preprocessor}{#endif}
2944 \textcolor{preprocessor}{}                        \}
2945                         \textcolor{keywordflow}{else}
2946                         \{
2947                             didNothingStepB = 1;
2948                         \}
2949                     \}
2950                     \textcolor{comment}{/* source send hard\_reset, 5. wait vsafe5v. */}
2951                     \textcolor{comment}{/* source receive hard\_reset, 5. wait vsafe5v. */}
2952                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_ade792f3a5e9ffb477a9598ad4a3fb697}{PD\_DpmCheckVbus}(pdInstance))
2953                     \{
2954                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a64e92f523589e05e41df27ce310855ae}{PD\_DPM\_SRC\_HARD\_RESET\_REQUEST}, NULL, 1);
2955                         \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}, 
      \hyperlink{usb__pd__timer_8h_a0c5bb0cba96e137fd72a49aded310c08}{T\_NO\_RESPONSE});
2956                         pdInstance->\hyperlink{struct__pd__instance_a3b09927227c17d95712a2af3d5f921f2}{enterSrcFromSwap} = 0;
2957                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ae9194b9c8e1e319ab3a3c3bb25fd51}{PSM\_PE\_SRC\_STARTUP};
2958                     \}
2959                     \textcolor{keywordflow}{else}
2960                     \{
2961                         \textcolor{comment}{/* Wait until the power supply transitions to default. */}
2962                         didNothingStepB = 0;
2963                     \}
2964                     \textcolor{keywordflow}{break};
2965 
2966 \textcolor{preprocessor}{#endif}
2967 \textcolor{preprocessor}{}
2968 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
2969 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab06c1b31af9a26e8dc4d36a2091c2de5}{PSM\_PE\_DR\_SRC\_GET\_SOURCE\_CAP}: \textcolor{comment}{/* (B) */}
2970                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
2971                     \{
2972                         \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
2973                         \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global section. */}
2974                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && ((triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject}) ||
2975                                                                      (triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported})))
2976                         \{
2977                             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab06c1b31af9a26e8dc4d36a2091c2de5}{PSM\_PE\_DR\_SRC\_GET\_SOURCE\_CAP})
2978                             \{
2979                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
2980                             \}
2981                             \textcolor{keywordflow}{else}
2982                             \{
2983                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
2984                             \}
2985 
2986                             \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject})
2987                             \{
2988                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
2989                             \}
2990                             \textcolor{keywordflow}{else}
2991                             \{
2992                                 commandResultCallback = 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
2993                             \}
2994                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aee9e5991d19424456884d183c3892e84}{PD\_DPM\_GET\_PARTNER\_SRC\_CAP\_FAIL}, &commandResultCallback, 1);
2995                         \}
2996                         \textcolor{keywordflow}{else}
2997                         \{
2998                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
2999                         \}
3000                     \}
3001                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3002                     \{
3003                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab06c1b31af9a26e8dc4d36a2091c2de5}{PSM\_PE\_DR\_SRC\_GET\_SOURCE\_CAP})
3004                         \{
3005                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3006                         \}
3007                         \textcolor{keywordflow}{else}
3008                         \{
3009                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3010                         \}
3011                     \}
3012                     \textcolor{keywordflow}{else}
3013                     \{
3014                         didNothingStepB = 1;
3015                     \}
3016                     \textcolor{keywordflow}{break};
3017 
3018                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a6682413184083874a372c9279d133506}{PSM\_PE\_PRS\_SRC\_SNK\_TRANSITION\_TO\_OFF}: \textcolor{comment}{/* (B) */}
3019                     \textcolor{comment}{/* check source is standby */}
3020                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e}{PD\_DpmCheckVsafe0V}(pdInstance))
3021                     \{
3022                         \textcolor{comment}{/* NOTE : DPM will actively discharge VBUS, and use a timer to ensure at least a
       min discharge}
3023 \textcolor{comment}{                         * time}
3024 \textcolor{comment}{                         */}
3025                         \textcolor{comment}{/* have enter standby */}
3026                         \hyperlink{usb__pd__policy_8c_a8afdb6c45b33f168a2fb95395714bdfa}{PD\_DpmDischargeVbus}(pdInstance, 0);
3027                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a165a967c143ef0f1f26c303f5040cc}{PSM\_PE\_PRS\_SRC\_SNK\_ASSERT\_RD};
3028                     \}
3029                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3030                     \{
3031                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX};
3032                     \}
3033                     \textcolor{keywordflow}{else}
3034                     \{
3035                         didNothingStepB = 0; \textcolor{comment}{/* need check vbus constantly */}
3036                     \}
3037                     \textcolor{keywordflow}{break};
3038 
3039                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af82fd0bf4ab2cb83e1b87082d53614c5}{PSM\_PE\_PRS\_SRC\_SNK\_WAIT\_SOURCE\_ON}: \textcolor{comment}{/* (B) */}
3040                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3041                     \{
3042                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && (triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}))
3043                         \{
3044                             \hyperlink{usb__pd__policy_8c_a76b0f4cfb65f3523c10e8e472f42d9c4}{PD\_MsgStopReceive}(pdInstance);
3045                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa6f5ed20252712989645935ecb73be46}{tPSSourceOnTimer});
3046                             \textcolor{comment}{/* Swap from SOURCE to SINK */}
3047                             \textcolor{comment}{/* pr swap end */}
3048                             \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
3049 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
3050 \textcolor{preprocessor}{}                            \textcolor{comment}{/* Cable plug will need a soft reset */}
3051                             pdInstance->\hyperlink{struct__pd__instance_a7be408d709efe6ec210d68a3d4098cc9}{psmCablePlugResetNeeded} = 1;
3052 \textcolor{preprocessor}{#endif}
3053 \textcolor{preprocessor}{}
3054                             \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edae1406149d183dba960809596aa525528}{PD\_PHY\_SNK\_GET\_TYPEC\_CURRENT\_CAP}, &inCase32Tmp);
3055                             pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a2a64b10db4e1644e17ee04e0a19cc412}{PD\_SnkDrawTypeCVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam},
3056                                                                          (uint8\_t)inCase32Tmp, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771bac6be16e80130e6e9909ce3075565f39b}{kVbusPower\_InPRSwap});
3057                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a97a7759c15d78fc8c7a1e53f522c7799}{PD\_DPM\_PR\_SWAP\_SUCCESS}, NULL, 1);
3058 
3059                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac19a0ca772773bf8cdecb2f2000e0b9e}{PSM\_PE\_SNK\_STARTUP};
3060                         \}
3061                         \textcolor{keywordflow}{else}
3062                         \{
3063                             \textcolor{comment}{/* A protocol error during power role swap triggers a Hard Reset */}
3064                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
3065                         \}
3066                     \}
3067                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa6f5ed20252712989645935ecb73be46}{tPSSourceOnTimer}))
3068                     \{
3069                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
3070                     \}
3071                     \textcolor{keywordflow}{else}
3072                     \{
3073                         didNothingStepB = 1;
3074                     \}
3075                     \textcolor{keywordflow}{break};
3076 
3077                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a90a6fac6bf8ce34a0c582b6e12a57f93}{PSM\_PE\_PRS\_SRC\_SNK\_SEND\_PR\_SWAP}: \textcolor{comment}{/* (B) */}
3078                 \{
3079                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3080                     \{
3081                         \textcolor{keywordflow}{switch} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType})
3082                         \{
3083                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}:
3084                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a6682413184083874a372c9279d133506}{PSM\_PE\_PRS\_SRC\_SNK\_TRANSITION\_TO\_OFF};
3085                                 \textcolor{keywordflow}{break};
3086 
3087                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject}:
3088                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3089                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
3090                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a34537a7fbc8f9182d14d4ef32607f7c5}{PD\_DPM\_PR\_SWAP\_FAIL}, &commandResultCallback, 1);
3091                                 \textcolor{keywordflow}{break};
3092 
3093                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait}:
3094                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3095                                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa8626f6e33d17c020d31518bb5f74b4d5}{tPrSwapWaitTimer}, \hyperlink{usb__pd__timer_8h_a88eb545011ba1c4a7684b6d268d73f5a}{T\_PRSWAP\_WAIT});
3096                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045cabbcc951c401dbb830050a5ece204079a}{kCommandResult\_Wait};
3097                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a34537a7fbc8f9182d14d4ef32607f7c5}{PD\_DPM\_PR\_SWAP\_FAIL}, &commandResultCallback, 1);
3098                                 \textcolor{keywordflow}{break};
3099 
3100                             \textcolor{keywordflow}{default}:
3101                                 \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba8e261ea49608c646738b8028b0a63a58}{kPD\_MsgInvalid})
3102                                 \{
3103                                     \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global
       section. */}
3104                                     \textcolor{comment}{/* soft reset other packets */}
3105                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3106                                 \}
3107                                 \textcolor{keywordflow}{break};
3108                         \}
3109                     \}
3110                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3111                     \{
3112                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3113                     \}
3114                     \textcolor{keywordflow}{else}
3115                     \{
3116                         didNothingStepB = 1;
3117                     \}
3118                 \}
3119                 \textcolor{keywordflow}{break};
3120 \textcolor{preprocessor}{#endif}
3121 \textcolor{preprocessor}{}
3122 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_SINK\_ROLE\_ENABLE) && (PD\_CONFIG\_SINK\_ROLE\_ENABLE)}
3123 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a57438b2126556f03e6423fceef89c8a9}{PSM\_PE\_SNK\_DISCOVERY}: \textcolor{comment}{/* (B) */}
3124                     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected} &&
3125                         \hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}) &&
3126                         (pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} > 
      \hyperlink{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{N\_HARD\_RESET\_COUNT}))
3127                     \{
3128                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
3129                     \}
3130                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V})
3131                     \{
3132                         \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__policy_8c_a95fba600d6ef64c773c5bbe23666aa6e}{PD\_DpmCheckVsafe0V}(pdInstance)) ||
3133                             (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa50101b7f5beaa5d160ec488d4a47a57a}{tPSHardResetTimer})))
3134                         \{
3135                             pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V} = 0;
3136                         \}
3137                         \textcolor{keywordflow}{else}
3138                         \{
3139                             \textcolor{comment}{/* No change in state, we should stay in low power mode */}
3140                             didNothingStepB = 1;
3141                         \}
3142                     \}
3143                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, &taskEventSet) ==
3144                               \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success}) &&
3145                              (taskEventSet & \hyperlink{group__usb__pd__phy__drv_gabe6758409c7aeff91de688fe7cefa195}{PD\_VBUS\_POWER\_STATE\_VBUS\_MASK}))
3146                     \{
3147                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a7420286a3fc5b58010ff2dc607a8d77a}{asmHardResetSnkProcessing})
3148                         \{
3149                             pdInstance->\hyperlink{struct__pd__instance_a7420286a3fc5b58010ff2dc607a8d77a}{asmHardResetSnkProcessing} = 0;
3150                             \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edae1406149d183dba960809596aa525528}{PD\_PHY\_SNK\_GET\_TYPEC\_CURRENT\_CAP}, &inCase32Tmp);
3151                             pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a2a64b10db4e1644e17ee04e0a19cc412}{PD\_SnkDrawTypeCVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam},
3152                                                                          (uint8\_t)inCase32Tmp, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771ba08bcf27d29365689235f1a3f6b683a09}{kVbusPower\_InHardReset});
3153                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a65ddff38ff9b959107bdabc53a1d1713}{PD\_DPM\_SNK\_HARD\_RESET\_REQUEST}, NULL, 1);
3154                         \}
3155 
3156                         \textcolor{comment}{/* Hard Reset is no longer in progress, allow VBus monitoring */}
3157                         \textcolor{comment}{/* kVbusPower\_InHardReset is end */}
3158                         \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
3159                         pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V} = 0;
3160 
3161                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES};
3162                     \}
3163                     \textcolor{keywordflow}{else}
3164                     \{
3165                         \textcolor{comment}{/* need check vbus constantly */}
3166                         didNothingStepB = 0;
3167                     \}
3168                     \textcolor{keywordflow}{break};
3169 
3170                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES}: \textcolor{comment}{/* (B) */}
3171                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3172                     \{
3173                         \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global section. */}
3174                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3175                     \}
3176                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ab15695a76307bdc413424030ad701a47}{psmPreviouslyPdConnected} &&
3177                              \hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa586df3a2d10728ba29d33d2a596be420}{tNoResponseTimer}) &&
3178                              (pdInstance->\hyperlink{struct__pd__instance_adb289c40585aa5170d8208d0202f55e5}{psmHardResetCount} > 
      \hyperlink{usb__pd__policy_8c_af078807396daa561faca5657b552c2aa}{N\_HARD\_RESET\_COUNT}))
3179                     \{
3180                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
3181                     \}
3182                     \textcolor{keywordflow}{else}
3183                     \{
3184                         didNothingStepB = 1;
3185                     \}
3186                     \textcolor{keywordflow}{break};
3187 
3188                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY}: \textcolor{comment}{/* (B) */}
3189                 \{
3190                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3191                     \{
3192                         \textcolor{keywordflow}{switch} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType})
3193                         \{
3194                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}:
3195                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK};
3196                                 \textcolor{keywordflow}{break};
3197 
3198                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait}:
3199                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3200                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045cabbcc951c401dbb830050a5ece204079a}{kCommandResult\_Wait};
3201                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aa3476563b037797a05c3aeaeb347dc7c}{PD\_DPM\_SNK\_RDO\_FAIL}, &commandResultCallback, 1);
3202                                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted})
3203                                 \{
3204                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3205                                     pdInstance->\hyperlink{struct__pd__instance_a685445e828df5a05b1084fd0ea75c10a}{psmSnkReceiveRdoWaitRetry} = 1;
3206                                     \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fae30a3bc6da9fba9869604643cd5cd5ab}{tSinkRequestTimer}, \hyperlink{usb__pd__timer_8h_aa1f7398059e38b50481313a3d746e607}{T\_SINK\_REQUEST});
3207                                 \}
3208                                 \textcolor{keywordflow}{else}
3209                                 \{
3210                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES};
3211                                 \}
3212                                 \textcolor{keywordflow}{break};
3213 
3214                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject}:
3215                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3216                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
3217                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aa3476563b037797a05c3aeaeb347dc7c}{PD\_DPM\_SNK\_RDO\_FAIL}, &commandResultCallback, 1);
3218                                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a23dce9c00575a5fd5ed120e08e9c4412}{psmExplicitContractExisted})
3219                                 \{
3220                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3221                                 \}
3222                                 \textcolor{keywordflow}{else}
3223                                 \{
3224                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES};
3225                                 \}
3226                                 \textcolor{keywordflow}{break};
3227 
3228                             \textcolor{keywordflow}{default}:
3229                                 \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba8e261ea49608c646738b8028b0a63a58}{kPD\_MsgInvalid})
3230                                 \{
3231                                     \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global
       section. */}
3232                                     \textcolor{comment}{/* soft reset other packets */}
3233                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9fa47ee129b0558c4c265af2fbbeada7}{PSM\_CHECK\_SINK\_SOURCE\_CAP\_RX};
3234                                 \}
3235                                 \textcolor{keywordflow}{break};
3236                         \}
3237                     \}
3238                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3239                     \{
3240                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
3241                     \}
3242                     \textcolor{keywordflow}{else}
3243                     \{
3244                         didNothingStepB = 1;
3245                     \}
3246                 \}
3247                 \textcolor{keywordflow}{break};
3248 
3249                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8192e4ed5803b5a54d466ae63825869b}{PSM\_PE\_SNK\_SELECT\_CAPABILITY\_WAIT\_TIMER\_TIME\_OUT}
      : \textcolor{comment}{/* (B) */}
3250                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fae30a3bc6da9fba9869604643cd5cd5ab}{tSinkRequestTimer}))
3251                     \{
3252                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY};
3253                     \}
3254                     \textcolor{keywordflow}{break};
3255 
3256                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK}: \textcolor{comment}{/* (B) */}
3257                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3258                     \{
3259                         \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global section. */}
3260                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && (triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba4caab1b70eba97b3827faeb6caa0f9e7}{kPD\_MsgPing}))
3261                         \{
3262                             \textcolor{comment}{/* Remain in the same state */}
3263                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab401f525589e172315732ad579c8d1d2}{PSM\_PE\_SNK\_TRANSITION\_SINK};
3264                         \}
3265                         \textcolor{keywordflow}{else}
3266                         \{
3267                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2a9680637c4a08ea8ec5a463f00ab28a}{tPSTransitionTimer});
3268                             \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && (triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}))
3269                             \{
3270                                 \hyperlink{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance);
3271                                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_af189a6cdfc3021280df10fe8a7a86a8f}{psmGotoMinRx})
3272                                 \{
3273                                     pdInstance->\hyperlink{struct__pd__instance_af189a6cdfc3021280df10fe8a7a86a8f}{psmGotoMinRx} = 0;
3274                                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ae8334e4d49acc42ad9f6365c19f4cad1}{PD\_DPM\_SNK\_GOTOMIN\_SUCCESS}, NULL, 1);
3275                                 \}
3276                                 \textcolor{keywordflow}{else}
3277                                 \{
3278                                     pdInstance->\hyperlink{struct__pd__instance_a3e7e606f531f84a6f70e3a49de313f41}{rdoSuccessRequest} = pdInstance->
      \hyperlink{struct__pd__instance_a199dd2b0ea66f8eb7e67714c4a4264a5}{rdoRequest};
3279                                     pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_ac1b908d8a0b3cad5c449cde3e7b169b4}{PD\_SnkDrawRequestVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam},
3280                                                                                    pdInstance->
      \hyperlink{struct__pd__instance_a199dd2b0ea66f8eb7e67714c4a4264a5}{rdoRequest});
3281                                     \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a1439b92e5316a3eac87950f7ee737890}{PD\_DPM\_SNK\_RDO\_SUCCESS}, NULL, 1);
3282                                 \}
3283                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3284                             \}
3285                             \textcolor{keywordflow}{else}
3286                             \{
3287                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
3288                             \}
3289                         \}
3290                     \}
3291                     \textcolor{keywordflow}{else}
3292                     \{
3293                         didNothingStepB = 1;
3294                     \}
3295                     \textcolor{keywordflow}{break};
3296 
3297                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}: \textcolor{comment}{/* (B) */}
3298                                        \textcolor{comment}{/* state machine */}
3299 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
3300 \textcolor{preprocessor}{}                    inCase32Tmp = 1;
3301                     inCase32Tmp &= Pd\_PsmSecondaryStateHandler(pdInstance, 0, 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}, &triggerInfo);
3302                     inCase32Tmp &= Pd\_PsmSecondaryStateHandler(pdInstance, 1, 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1ac884af27fd06f1ae0c9e148c596ac5fa}{kPD\_MsgSOPp}, &triggerInfo);
3303                     inCase32Tmp &= Pd\_PsmSecondaryStateHandler(pdInstance, 2, 
      \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a9e34c9f67e13b4b9ba3d5d3c609a2f07}{kPD\_MsgSOPpp}, &triggerInfo);
3304                     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[0] != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}) ||
3305                         (pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[1] != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}) ||
3306                         (pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[2] != 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE}))
3307                     \{
3308                         \textcolor{keywordflow}{if} (inCase32Tmp)
3309                         \{
3310                             didNothingStepB = 0;
3311                         \}
3312                         \textcolor{keywordflow}{break};
3313                     \}
3314 \textcolor{preprocessor}{#endif}
3315 \textcolor{preprocessor}{}
3316                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3317                     \{
3318                         didNothingStepB = 0;
3319                         PD\_PsmSinkRdyProcessPdMessage(pdInstance, &triggerInfo);
3320                     \}
3321                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{PSM\_TRIGGER\_DPM\_MSG})
3322                     \{
3323                         didNothingStepB = 0;
3324                         PD\_PsmSinkRdyProcessDpmMessage(pdInstance, &triggerInfo);
3325                     \}
3326                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fae30a3bc6da9fba9869604643cd5cd5ab}{tSinkRequestTimer}))
3327                     \{
3328                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a685445e828df5a05b1084fd0ea75c10a}{psmSnkReceiveRdoWaitRetry})
3329                         \{
3330                             pdInstance->\hyperlink{struct__pd__instance_a685445e828df5a05b1084fd0ea75c10a}{psmSnkReceiveRdoWaitRetry} = 0;
3331                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a515dc8f42560018bd2f556a8bda7b07c}{PSM\_PE\_SNK\_SELECT\_CAPABILITY};
3332                         \}
3333                     \}
3334                     \textcolor{keywordflow}{else}
3335                     \{
3336                         didNothingStepB = 1;
3337                     \}
3338                     \textcolor{keywordflow}{break};
3339 
3340                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4ed497a81e543cc7428fcec9e2510f17}{PSM\_PE\_SNK\_TRANSITION\_TO\_DEFAULT}: \textcolor{comment}{/* (B) */}
3341                     \textcolor{keywordflow}{break};
3342 \textcolor{preprocessor}{#endif}
3343 \textcolor{preprocessor}{}
3344 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_POWER\_ROLE\_ENABLE)}
3345 \textcolor{preprocessor}{}
3346                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a0361f53d1396153b1405ab4b92c72b57}{PSM\_PE\_DR\_SNK\_GET\_SINK\_CAP}: \textcolor{comment}{/* (B) */}
3347                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a15beb3355a693f37d31884ede62f762b}{PSM\_PE\_SRC\_GET\_SINK\_CAP}:    \textcolor{comment}{/* (B) */}
3348                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3349                     \{
3350                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a15beb3355a693f37d31884ede62f762b}{PSM\_PE\_SRC\_GET\_SINK\_CAP})
3351                         \{
3352                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3353                         \}
3354                         \textcolor{keywordflow}{else}
3355                         \{
3356                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3357                         \}
3358 
3359                         \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global section. */}
3360                         \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3361                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad3e4952f56af0a6ddb5b6cec31fdc4cf}{kPD\_MsgSinkCapabilities})
3362                         \{
3363                             \hyperlink{struct__pd__capabilities}{pd\_capabilities\_t} sinkCapa;
3364                             \textcolor{comment}{/* Clear any pending message now that we have the latest */}
3365                             (void)\hyperlink{usb__pd__policy_8c_a8478bb46d180cbe30f733a859d18547f}{PD\_DpmClearMsg}(pdInstance, 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa4ea4864194875bf84ea3b2cf923a6f14}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SINK\_CAPABILITIES});
3366                             \textcolor{comment}{/* Update the PDOs for the EC and send interrupt */}
3367                             sinkCapa.\hyperlink{struct__pd__capabilities_a559fdae7ddb5376491caf869366e7e71}{capabilities} = \hyperlink{usb__pd__policy_8c_a6114114472b1c6cb1c114c28c3913bd0}{MSG\_DATA\_BUFFER};
3368                             sinkCapa.\hyperlink{struct__pd__capabilities_a240b859a2ffe7e634479a22c3f3e4feb}{capabilitiesCount} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_a66249e3b8cea619fbf9a42e72fba5c18}{pdMsgDataLength};
3369                             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == 
      \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa4ea4864194875bf84ea3b2cf923a6f14}{PD\_DPM\_CONTROL\_GET\_PARTNER\_SINK\_CAPABILITIES})
3370                             \{
3371                                 pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = 0;
3372                             \}
3373                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8acf7e85712657f05298823cf3cbb530dd}{PD\_DPM\_GET\_PARTNER\_SNK\_CAP\_SUCCESS}, &sinkCapa, 1);
3374                         \}
3375                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject}) ||
3376                                  (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}))
3377                         \{
3378                             \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject})
3379                             \{
3380                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
3381                             \}
3382                             \textcolor{keywordflow}{else}
3383                             \{
3384                                 commandResultCallback = 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
3385                             \}
3386                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a2b5e3e788da63ca93c05e4723fbd6046}{PD\_DPM\_GET\_PARTNER\_SNK\_CAP\_FAIL}, &commandResultCallback, 1);
3387                         \}
3388                         \textcolor{keywordflow}{else}
3389                         \{
3390                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3391                         \}
3392                     \}
3393                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3394                     \{
3395                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a15beb3355a693f37d31884ede62f762b}{PSM\_PE\_SRC\_GET\_SINK\_CAP})
3396                         \{
3397                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3398                         \}
3399                         \textcolor{keywordflow}{else}
3400                         \{
3401                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3402                         \}
3403                     \}
3404                     \textcolor{keywordflow}{else}
3405                     \{
3406                         didNothingStepB = 1;
3407                     \}
3408                     \textcolor{keywordflow}{break};
3409 
3410                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF}: \textcolor{comment}{/* (B) */}
3411                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3412                     \{
3413                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && (triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}))
3414                         \{
3415                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa58fa563b3c588ec13b08efd9ce323b64}{tPSSourceOffTimer});
3416                             pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
3417                             \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
3418                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a33436131bac32830697c3445d9c7e633}{PSM\_PE\_PRS\_SNK\_SRC\_ASSERT\_RP};
3419                         \}
3420                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && (triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba4caab1b70eba97b3827faeb6caa0f9e7}{kPD\_MsgPing}))
3421                         \{
3422                             \textcolor{comment}{/* Remain in the same state */}
3423                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF};
3424                         \}
3425                         \textcolor{keywordflow}{else}
3426                         \{
3427                             \textcolor{comment}{/* A protocol error during power role swap triggers a Hard Reset */}
3428                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
3429                         \}
3430                     \}
3431                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa58fa563b3c588ec13b08efd9ce323b64}{tPSSourceOffTimer}))
3432                     \{
3433                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
3434                     \}
3435                     \textcolor{keywordflow}{else}
3436                     \{
3437                         didNothingStepB = 1;
3438                     \}
3439                     \textcolor{keywordflow}{break};
3440 
3441                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af1c9746136c41bf190396db70f45b5fd}{PSM\_PE\_PRS\_SNK\_SRC\_SOURCE\_ON}: \textcolor{comment}{/* (B) */}
3442                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_ade792f3a5e9ffb477a9598ad4a3fb697}{PD\_DpmCheckVbus}(pdInstance))
3443                     \{
3444                         \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ae9194b9c8e1e319ab3a3c3bb25fd51}{PSM\_PE\_SRC\_STARTUP},
3445                                                         
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY},
3446                                                         
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}))
3447                         \{
3448                             \textcolor{comment}{/* Swap from SINK to SOURCE */}
3449                             \textcolor{comment}{/* pr swap end */}
3450                             \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
3451 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
3452 \textcolor{preprocessor}{}                            \textcolor{comment}{/* Cable plug will need a soft reset */}
3453                             pdInstance->\hyperlink{struct__pd__instance_a7be408d709efe6ec210d68a3d4098cc9}{psmCablePlugResetNeeded} = 1;
3454 \textcolor{preprocessor}{#endif}
3455 \textcolor{preprocessor}{}                            pdInstance->\hyperlink{struct__pd__instance_a3b09927227c17d95712a2af3d5f921f2}{enterSrcFromSwap} = 1;
3456                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a97a7759c15d78fc8c7a1e53f522c7799}{PD\_DPM\_PR\_SWAP\_SUCCESS}, NULL, 1);
3457                         \}
3458                     \}
3459                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3460                     \{
3461                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX};
3462                     \}
3463                     \textcolor{keywordflow}{else}
3464                     \{
3465                         \textcolor{comment}{/* need check vbus constantly */}
3466                         didNothingStepB = 0;
3467                     \}
3468                     \textcolor{keywordflow}{break};
3469 
3470                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af3dfe785a6dc68a892001143f3a833c1}{PSM\_PE\_PRS\_SNK\_SRC\_SEND\_PR\_SWAP}: \textcolor{comment}{/* (B) */}
3471                 \{
3472                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3473                     \{
3474                         \textcolor{keywordflow}{switch} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType})
3475                         \{
3476                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}:
3477                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a8b8041a3ff6fd9123c1e2150ad9c645a}{PSM\_PE\_PRS\_SNK\_SRC\_TRANSITION\_TO\_OFF};
3478                                 \textcolor{keywordflow}{break};
3479 
3480                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject}:
3481                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3482                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
3483                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a34537a7fbc8f9182d14d4ef32607f7c5}{PD\_DPM\_PR\_SWAP\_FAIL}, &commandResultCallback, 1);
3484                                 \textcolor{keywordflow}{break};
3485 
3486                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait}:
3487                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3488                                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa8626f6e33d17c020d31518bb5f74b4d5}{tPrSwapWaitTimer}, \hyperlink{usb__pd__timer_8h_a88eb545011ba1c4a7684b6d268d73f5a}{T\_PRSWAP\_WAIT});
3489                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045cabbcc951c401dbb830050a5ece204079a}{kCommandResult\_Wait};
3490                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a34537a7fbc8f9182d14d4ef32607f7c5}{PD\_DPM\_PR\_SWAP\_FAIL}, &commandResultCallback, 1);
3491                                 \textcolor{keywordflow}{break};
3492 
3493                             \textcolor{keywordflow}{default}:
3494                                 \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba8e261ea49608c646738b8028b0a63a58}{kPD\_MsgInvalid})
3495                                 \{
3496                                     \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global
       section. */}
3497                                     \textcolor{comment}{/* soft reset other packets */}
3498                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3499                                 \}
3500                                 \textcolor{keywordflow}{break};
3501                         \}
3502                     \}
3503                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3504                     \{
3505                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3506                     \}
3507                     \textcolor{keywordflow}{else}
3508                     \{
3509                         didNothingStepB = 1;
3510                     \}
3511                 \}
3512                 \textcolor{keywordflow}{break};
3513 
3514                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a97a2b4897b9f785e3cfbf2d641d54c85}{PSM\_PE\_PRS\_EVALUATE\_PR\_SWAP\_WAIT\_TIMER\_TIME\_OUT}
      : \textcolor{comment}{/* (B) */}
3515                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa8626f6e33d17c020d31518bb5f74b4d5}{tPrSwapWaitTimer}))
3516                     \{
3517                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
3518                         \{
3519                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a90a6fac6bf8ce34a0c582b6e12a57f93}{PSM\_PE\_PRS\_SRC\_SNK\_SEND\_PR\_SWAP};
3520                         \}
3521                         \textcolor{keywordflow}{else}
3522                         \{
3523                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af3dfe785a6dc68a892001143f3a833c1}{PSM\_PE\_PRS\_SNK\_SRC\_SEND\_PR\_SWAP};
3524                         \}
3525                     \}
3526                     \textcolor{keywordflow}{break};
3527 \textcolor{preprocessor}{#endif}
3528 \textcolor{preprocessor}{}
3529 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
3530 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a34b7b536dbe97967c88705e17a6476c9}{PSM\_PE\_DRS\_SEND\_DR\_SWAP}: \textcolor{comment}{/* (B) */}
3531                 \{
3532                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3533                     \{
3534                         \textcolor{keywordflow}{switch} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType})
3535                         \{
3536                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}:
3537                                 pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} =
3538                                     (pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} == 
      \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP}) ? \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP} : 
      \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP};
3539                                 \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
3540                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7df0dcbb30ba18f2d20055d1647f8a5d}{PSM\_PE\_DRS\_CHANGE\_TO\_DFP\_OR\_UFP};
3541                                 \textcolor{keywordflow}{break};
3542 
3543                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject}:
3544                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (
      \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->\hyperlink{struct__pd__instance_a708b6e13ca54fe83d4200c3fff80a820}{psmDrSwapPrevState};
3545                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
3546                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac43a8c3be37b3c4c33dd213e2bb1662d}{PD\_DPM\_DR\_SWAP\_FAIL}, &commandResultCallback, 1);
3547                                 \textcolor{keywordflow}{break};
3548 
3549                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait}:
3550                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (
      \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->\hyperlink{struct__pd__instance_a708b6e13ca54fe83d4200c3fff80a820}{psmDrSwapPrevState};
3551                                 \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{PD\_TimerStart}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa4b5a0c5d3a294276454fefd1e6eab44d}{tDrSwapWaitTimer}, \hyperlink{usb__pd__timer_8h_aa043bf36ff1e5772e4f4559500221598}{T\_DRSWAP\_WAIT});
3552                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045cabbcc951c401dbb830050a5ece204079a}{kCommandResult\_Wait};
3553                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac43a8c3be37b3c4c33dd213e2bb1662d}{PD\_DPM\_DR\_SWAP\_FAIL}, &commandResultCallback, 1);
3554                                 \textcolor{keywordflow}{break};
3555 
3556                             \textcolor{keywordflow}{default}:
3557                                 \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba8e261ea49608c646738b8028b0a63a58}{kPD\_MsgInvalid})
3558                                 \{
3559                                     \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global
       section. */}
3560                                     \textcolor{comment}{/* soft reset other packets */}
3561                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3562                                 \}
3563                                 \textcolor{keywordflow}{break};
3564                         \}
3565                     \}
3566                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3567                     \{
3568                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->
      \hyperlink{struct__pd__instance_a708b6e13ca54fe83d4200c3fff80a820}{psmDrSwapPrevState};
3569                     \}
3570                     \textcolor{keywordflow}{else}
3571                     \{
3572                         didNothingStepB = 1;
3573                     \}
3574                 \}
3575                 \textcolor{keywordflow}{break};
3576 
3577                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7fdfa8eec5d0a18ad209c8213932e170}{PSM\_PE\_DRS\_EVALUATE\_DR\_SWAP\_WAIT\_TIMER\_TIME\_OUT}
      : \textcolor{comment}{/* (B) */}
3578                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa4b5a0c5d3a294276454fefd1e6eab44d}{tDrSwapWaitTimer}))
3579                     \{
3580                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a34b7b536dbe97967c88705e17a6476c9}{PSM\_PE\_DRS\_SEND\_DR\_SWAP};
3581                     \}
3582                     \textcolor{keywordflow}{break};
3583 \textcolor{preprocessor}{#endif}
3584 \textcolor{preprocessor}{}
3585 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
3586 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53adbca6a8a2998452362aaab4a162429f1}{PSM\_PE\_VCS\_SEND\_SWAP}: \textcolor{comment}{/* (B) */}
3587                 \{
3588                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3589                     \{
3590                         \textcolor{keywordflow}{switch} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType})
3591                         \{
3592                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}:
3593                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (pdInstance->
      \hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} == \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28a239cd9fcbe39abba0bc8959dc1a24e37}{kPD\_IsVconnSource} ?
3594                                                                
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aacc2ab29ac13e773a3f3ed25896b4558}{PSM\_PE\_VCS\_WAIT\_FOR\_VCONN} :
3595                                                                
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af40a2f2088294611eeea6139d7aea036}{PSM\_PE\_VCS\_TURN\_ON\_VCONN});
3596                                 \textcolor{keywordflow}{break};
3597 
3598                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba2fb8987093e63e9012a1c8a724dce1b8}{kPD\_MsgReject}:
3599                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (
      \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->\hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState};
3600                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca1f47bf73466bcfd41a0e492b4ee77221}{kCommandResult\_Reject};
3601                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a7d1d0c1a00df8f90177fef2eaf7f1831}{PD\_DPM\_VCONN\_SWAP\_FAIL}, &commandResultCallback, 1);
3602                                 \textcolor{keywordflow}{break};
3603 
3604                             \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad31bd29a44d64051c3a9dc353b85aca8}{kPD\_MsgWait}:
3605                                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (
      \hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->\hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState};
3606                                 commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045cabbcc951c401dbb830050a5ece204079a}{kCommandResult\_Wait};
3607                                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a7d1d0c1a00df8f90177fef2eaf7f1831}{PD\_DPM\_VCONN\_SWAP\_FAIL}, &commandResultCallback, 1);
3608                                 \textcolor{keywordflow}{break};
3609 
3610                             \textcolor{keywordflow}{default}:
3611                                 \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} != 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba8e261ea49608c646738b8028b0a63a58}{kPD\_MsgInvalid})
3612                                 \{
3613                                     \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global
       section. */}
3614                                     \textcolor{comment}{/* soft reset other packets */}
3615                                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3616                                 \}
3617                                 \textcolor{keywordflow}{break};
3618                         \}
3619                     \}
3620                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3621                     \{
3622                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})pdInstance->
      \hyperlink{struct__pd__instance_a9446b569ba4bb1c6df4367bad40bf987}{psmVconnSwapPrevState};
3623                     \}
3624                     \textcolor{keywordflow}{else}
3625                     \{
3626                         didNothingStepB = 1;
3627                     \}
3628                 \}
3629                 \textcolor{keywordflow}{break};
3630 
3631                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aacc2ab29ac13e773a3f3ed25896b4558}{PSM\_PE\_VCS\_WAIT\_FOR\_VCONN}: \textcolor{comment}{/* (B) */}
3632                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3633                     \{
3634                         \textcolor{comment}{/* SourceCapabilities and VendorDefined are handled in the global section. */}
3635                         \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa83e0c687f22e8f4115673c91f8813160}{tVconnOnTimer});
3636                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) && (triggerInfo.
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}))
3637                         \{
3638                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a63b57ac70529dfc60b6ef5ed6d376ab9}{PSM\_PE\_VCS\_TURN\_OFF\_VCONN};
3639                         \}
3640                         \textcolor{keywordflow}{else}
3641                         \{
3642                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3643                         \}
3644                     \}
3645                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa83e0c687f22e8f4115673c91f8813160}{tVconnOnTimer}))
3646                     \{
3647                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
3648                     \}
3649                     \textcolor{keywordflow}{else}
3650                     \{
3651                         didNothingStepB = 1;
3652                     \}
3653                     \textcolor{keywordflow}{break};
3654 
3655                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af40a2f2088294611eeea6139d7aea036}{PSM\_PE\_VCS\_TURN\_ON\_VCONN}: \textcolor{comment}{/* (B) */}
3656                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa83e0c687f22e8f4115673c91f8813160}{tVconnOnTimer}))
3657                     \{
3658                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a86c2f73cb6f0cfdcf8eb50a2cd059b67}{PSM\_PE\_VCS\_SEND\_PS\_RDY};
3659                     \}
3660                     \textcolor{keywordflow}{else}
3661                     \{
3662                         didNothingStepB = 1;
3663                     \}
3664                     \textcolor{keywordflow}{break};
3665 \textcolor{preprocessor}{#endif}
3666 \textcolor{preprocessor}{}
3667 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
3668 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5bac4330356f778b9e20754522461eda}{PE\_DR\_SRC\_GET\_SOURCE\_CAP\_EXT}: \textcolor{comment}{/* B */}
3669                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53abfae41fb2e0b07c69972b7f867f481a2}{PE\_SNK\_GET\_SOURCE\_CAP\_EXT}:    \textcolor{comment}{/* B */}
3670                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3671                     \{
3672                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53abfae41fb2e0b07c69972b7f867f481a2}{PE\_SNK\_GET\_SOURCE\_CAP\_EXT})
3673                         \{
3674                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3675                         \}
3676                         \textcolor{keywordflow}{else}
3677                         \{
3678                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3679                         \}
3680 
3681                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba95e7d327bd7d8c4673816217f380845f}{kPD\_MsgSourceCapExtended})
3682                         \{
3683                             \hyperlink{struct__pd__command__data__param}{pd\_command\_data\_param\_t} extMsgParam;
3684                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3685 
3686                             \textcolor{comment}{/* the fixed 23 bytes length */}
3687                             extMsgParam.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (triggerInfo.
      \hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer} + 2);
3688                             \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength}) >= 
      \hyperlink{usb__pd__policy_8c_a499898e85b1889f50250bff6505d2ed5}{PD\_EXTENDED\_SRC\_CAP\_DATA\_LENGTH})
3689                             \{
3690                                 extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = 
      \hyperlink{usb__pd__policy_8c_a499898e85b1889f50250bff6505d2ed5}{PD\_EXTENDED\_SRC\_CAP\_DATA\_LENGTH};
3691                             \}
3692                             \textcolor{keywordflow}{else}
3693                             \{
3694                                 extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength};
3695                             \}
3696                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a767e582b283be0e9c85a03a8fa2a7ad7}{PD\_DPM\_GET\_SRC\_EXT\_CAP\_SUCCESS}, &extMsgParam, 1);
3697                         \}
3698                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
3699                                  (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}))
3700                         \{
3701                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3702 
3703                             commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
3704                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a616a08f0f899286d5e61d8b56ceb8fc2}{PD\_DPM\_GET\_SRC\_EXT\_CAP\_FAIL}, &commandResultCallback, 1);
3705                         \}
3706                         \textcolor{keywordflow}{else}
3707                         \{
3708                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3709                         \}
3710                     \}
3711                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3712                     \{
3713                         commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
3714                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a616a08f0f899286d5e61d8b56ceb8fc2}{PD\_DPM\_GET\_SRC\_EXT\_CAP\_FAIL}, &commandResultCallback, 1);
3715                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53abfae41fb2e0b07c69972b7f867f481a2}{PE\_SNK\_GET\_SOURCE\_CAP\_EXT})
3716                         \{
3717                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3718                         \}
3719                         \textcolor{keywordflow}{else}
3720                         \{
3721                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3722                         \}
3723                     \}
3724                     \textcolor{keywordflow}{else}
3725                     \{
3726                         didNothingStepB = 1;
3727                     \}
3728                     \textcolor{keywordflow}{break};
3729 
3730                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53affec79782a2b4897fa8d1913c5be4760}{PE\_SRC\_Get\_Sink\_Status}:   \textcolor{comment}{/* B */}
3731                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afcd6a556470cb00cee096f4dd9733c25}{PE\_SNK\_Get\_Source\_Status}: \textcolor{comment}{/* B */}
3732                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3733                     \{
3734                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afcd6a556470cb00cee096f4dd9733c25}{PE\_SNK\_Get\_Source\_Status})
3735                         \{
3736                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3737                         \}
3738                         \textcolor{keywordflow}{else}
3739                         \{
3740                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3741                         \}
3742 
3743                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368babafb5d368c1bae1ef7b8d141cdd1a54b}{kPD\_MsgStatus})
3744                         \{
3745                             \hyperlink{struct__pd__command__data__param}{pd\_command\_data\_param\_t} extMsgParam;
3746                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3747 
3748                             \textcolor{comment}{/* the fixed 3 bytes length */}
3749                             extMsgParam.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (triggerInfo.
      \hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer} + 2);
3750                             \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength}) >= 
      \hyperlink{usb__pd__policy_8c_a3bde83665d64a1e3941edd01d0d67865}{PD\_EXTENDED\_STATUS\_MSG\_DATA\_LENGTH})
3751                             \{
3752                                 extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = 
      \hyperlink{usb__pd__policy_8c_a3bde83665d64a1e3941edd01d0d67865}{PD\_EXTENDED\_STATUS\_MSG\_DATA\_LENGTH};
3753                             \}
3754                             \textcolor{keywordflow}{else}
3755                             \{
3756                                 extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength};
3757                             \}
3758                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a8e8ad1c091c6bd98f7d0b2d081ecba93}{PD\_DPM\_GET\_STATUS\_SUCCESS}, &extMsgParam, 1);
3759                         \}
3760                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
3761                                  (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}))
3762                         \{
3763                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3764 
3765                             commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
3766                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a440bbb508768a0bccca64ebc450a001b}{PD\_DPM\_GET\_STATUS\_FAIL}, &commandResultCallback, 1);
3767                         \}
3768                         \textcolor{keywordflow}{else}
3769                         \{
3770                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3771                         \}
3772                     \}
3773                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3774                     \{
3775                         commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
3776                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a440bbb508768a0bccca64ebc450a001b}{PD\_DPM\_GET\_STATUS\_FAIL}, &commandResultCallback, 1);
3777                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afcd6a556470cb00cee096f4dd9733c25}{PE\_SNK\_Get\_Source\_Status})
3778                         \{
3779                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3780                         \}
3781                         \textcolor{keywordflow}{else}
3782                         \{
3783                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3784                         \}
3785                     \}
3786                     \textcolor{keywordflow}{else}
3787                     \{
3788                         didNothingStepB = 1;
3789                     \}
3790                     \textcolor{keywordflow}{break};
3791 
3792                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a80ecd4021c5388f51469f70534bc96c4}{PE\_Get\_Battery\_Cap}: \textcolor{comment}{/* B */}
3793                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3794                     \{
3795                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
3796                         \{
3797                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3798                         \}
3799                         \textcolor{keywordflow}{else}
3800                         \{
3801                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3802                         \}
3803 
3804                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba7ef9806a0da412c423d2eba24922e54b}{kPD\_MsgBatteryCapabilities})
3805                         \{
3806                             \hyperlink{struct__pd__command__data__param}{pd\_command\_data\_param\_t} extMsgParam;
3807                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3808 
3809                             \textcolor{comment}{/* the fixed 3 bytes length */}
3810                             extMsgParam.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (triggerInfo.
      \hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer} + 2);
3811                             \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength}) >= 
      \hyperlink{usb__pd__policy_8c_ae8642782a2afa1c649b7a4356229a635}{PD\_EXTENDED\_BATTERY\_CAP\_MSG\_DATA\_LENGTH})
3812                             \{
3813                                 extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = 
      \hyperlink{usb__pd__policy_8c_ae8642782a2afa1c649b7a4356229a635}{PD\_EXTENDED\_BATTERY\_CAP\_MSG\_DATA\_LENGTH};
3814                             \}
3815                             \textcolor{keywordflow}{else}
3816                             \{
3817                                 extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength};
3818                             \}
3819                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a22fb818c8b5aacce85cfdc2e713901cb}{PD\_DPM\_GET\_BATTERY\_CAP\_SUCCESS}, &extMsgParam, 1);
3820                         \}
3821                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
3822                                  (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}))
3823                         \{
3824                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3825 
3826                             commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
3827                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a728741dabfcf75b6187b16075e644879}{PD\_DPM\_GET\_BATTERY\_CAP\_FAIL}, &commandResultCallback, 1);
3828                         \}
3829                         \textcolor{keywordflow}{else}
3830                         \{
3831                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3832                         \}
3833                     \}
3834                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3835                     \{
3836                         commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
3837                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a728741dabfcf75b6187b16075e644879}{PD\_DPM\_GET\_BATTERY\_CAP\_FAIL}, &commandResultCallback, 1);
3838                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
3839                         \{
3840                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3841                         \}
3842                         \textcolor{keywordflow}{else}
3843                         \{
3844                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3845                         \}
3846                     \}
3847                     \textcolor{keywordflow}{else}
3848                     \{
3849                         didNothingStepB = 1;
3850                     \}
3851                     \textcolor{keywordflow}{break};
3852 
3853                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5c59fac69248ef645437145785e5f13a}{PE\_Get\_Battery\_Status}: \textcolor{comment}{/* B */}
3854                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3855                     \{
3856                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
3857                         \{
3858                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3859                         \}
3860                         \textcolor{keywordflow}{else}
3861                         \{
3862                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3863                         \}
3864 
3865                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba100d935afa07cabcb1e4ae905685b679}{kPD\_MsgBatteryStatus})
3866                         \{
3867                             \hyperlink{struct__pd__command__data__param}{pd\_command\_data\_param\_t} extMsgParam;
3868                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3869 
3870                             extMsgParam.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (triggerInfo.
      \hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer});
3871                             extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength};
3872                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a9e1518da0f1b44c13a019abc96cedfbe}{PD\_DPM\_GET\_BATTERY\_STATUS\_SUCCESS}, &extMsgParam, 1);
3873                         \}
3874                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
3875                                  (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}))
3876                         \{
3877                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3878 
3879                             commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
3880                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ae9bc65c9f7dad30f80fddc56d0d9b3b9}{PD\_DPM\_GET\_BATTERY\_STATUS\_FAIL}, &commandResultCallback, 1);
3881                         \}
3882                         \textcolor{keywordflow}{else}
3883                         \{
3884                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3885                         \}
3886                     \}
3887                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3888                     \{
3889                         commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
3890                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ae9bc65c9f7dad30f80fddc56d0d9b3b9}{PD\_DPM\_GET\_BATTERY\_STATUS\_FAIL}, &commandResultCallback, 1);
3891                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
3892                         \{
3893                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3894                         \}
3895                         \textcolor{keywordflow}{else}
3896                         \{
3897                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3898                         \}
3899                     \}
3900                     \textcolor{keywordflow}{else}
3901                     \{
3902                         didNothingStepB = 1;
3903                     \}
3904                     \textcolor{keywordflow}{break};
3905 
3906                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a77041c81b4c648b823006673db2f5cc8}{PE\_Get\_Manfacturer\_Info}: \textcolor{comment}{/* B */}
3907                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3908                     \{
3909                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
3910                         \{
3911                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3912                         \}
3913                         \textcolor{keywordflow}{else}
3914                         \{
3915                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3916                         \}
3917 
3918                         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba3b1d9a1a12b16bd99758c6647a09ac80}{kPD\_MsgManufacturerInfo})
3919                         \{
3920                             \hyperlink{struct__pd__command__data__param}{pd\_command\_data\_param\_t} extMsgParam;
3921                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3922 
3923                             \textcolor{comment}{/* 4 ~ 26 bytes length */}
3924                             extMsgParam.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (triggerInfo.
      \hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer} + 2);
3925                             extMsgParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = triggerInfo.
      \hyperlink{struct__psm__trigger__info_af56dc6655fd68a5ff26971f036d93383}{pdExtMsgLength};
3926                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a425eb7f716e1240fccc53e3b1bbb7ab7}{PD\_DPM\_GET\_MANUFACTURER\_INFO\_SUCCESS}, &extMsgParam, 1);
3927                         \}
3928                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
3929                                  (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}))
3930                         \{
3931                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer});
3932 
3933                             commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
3934                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aaf6af38ecf21f44fbd95f190eb8bee7c}{PD\_DPM\_GET\_MANUFACTURER\_INFO\_FAIL}, &commandResultCallback, 1);
3935                         \}
3936                         \textcolor{keywordflow}{else}
3937                         \{
3938                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET};
3939                         \}
3940                     \}
3941                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
3942                     \{
3943                         commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045ca2037b8a85f98d8d2413d589dbe7ea4fd}{kCommandResult\_Error};
3944                         \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8aaf6af38ecf21f44fbd95f190eb8bee7c}{PD\_DPM\_GET\_MANUFACTURER\_INFO\_FAIL}, &commandResultCallback, 1);
3945                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
3946                         \{
3947                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY};
3948                         \}
3949                         \textcolor{keywordflow}{else}
3950                         \{
3951                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY};
3952                         \}
3953                     \}
3954                     \textcolor{keywordflow}{else}
3955                     \{
3956                         didNothingStepB = 1;
3957                     \}
3958                     \textcolor{keywordflow}{break};
3959 \textcolor{preprocessor}{#endif}
3960 \textcolor{preprocessor}{}
3961 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE) && (PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE)}
3962 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aca9891b871efc6127b397c6b17857e08}{PE\_FRS\_SRC\_SNK\_CC\_Signal}: \textcolor{comment}{/* B */}
3963                     didNothingStepB = 1;
3964                     \textcolor{keywordflow}{if} (((triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG}) &&
3965                          (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
3966                          (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba04e529f0c9df5cf995ef7e9e3391eb24}{kPD\_MsgFrSwap})) ||
3967                         (pdInstance->\hyperlink{struct__pd__instance_ac9684a4a5a96ac21f503ad702a245a7e}{frSwapReceived}))
3968                     \{
3969                         pdInstance->\hyperlink{struct__pd__instance_ac9684a4a5a96ac21f503ad702a245a7e}{frSwapReceived} = 0;
3970                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a89ca1efc4d454ffafc177960fae69142}{PE\_FRS\_SRC\_SNK\_Evaluate\_Swap};
3971                         didNothingStepB = 0;
3972                     \}
3973                     \textcolor{keywordflow}{break};
3974 
3975                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a19390f414f766b3ea0e0fbae002bb448}{PE\_FRS\_SRC\_SNK\_Transition\_to\_off}: \textcolor{comment}{/* B */}
3976                 \{
3977                     \textcolor{comment}{/* wait vbus reach <= vSafe5V */}
3978                     \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}{PD\_DpmCheckLessOrEqualVsafe5v}(pdInstance))
3979                     \{
3980                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7bf4eddebf37afd4745a11794066b2c8}{PE\_FRS\_SRC\_SNK\_Assert\_Rd};
3981                     \}
3982                     \textcolor{keywordflow}{else}
3983                     \{
3984                         \textcolor{comment}{/* need check vbus constantly */}
3985                         didNothingStepB = 0;
3986                     \}
3987                     \textcolor{keywordflow}{break};
3988                 \}
3989 
3990                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a2a2b0b602f73ff578e9643e90e22ec}{PE\_FRS\_SRC\_SNK\_Wait\_Source\_on}: \textcolor{comment}{/* B */}
3991                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
3992                     \{
3993                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) &&
3994                             (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}))
3995                         \{
3996                             \hyperlink{usb__pd__policy_8c_a76b0f4cfb65f3523c10e8e472f42d9c4}{PD\_MsgStopReceive}(pdInstance);
3997                             \textcolor{comment}{/* pr swap end */}
3998                             \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
3999                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa6f5ed20252712989645935ecb73be46}{tPSSourceOnTimer});
4000 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE) && (PD\_CONFIG\_CABLE\_COMMUNICATION\_ENABLE)}
4001 \textcolor{preprocessor}{}                            \textcolor{comment}{/* Cable plug will need a soft reset */}
4002                             pdInstance->\hyperlink{struct__pd__instance_a7be408d709efe6ec210d68a3d4098cc9}{psmCablePlugResetNeeded} = 1;
4003 \textcolor{preprocessor}{#endif}
4004 \textcolor{preprocessor}{}
4005                             \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edae1406149d183dba960809596aa525528}{PD\_PHY\_SNK\_GET\_TYPEC\_CURRENT\_CAP}, &inCase32Tmp);
4006                             pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a2a64b10db4e1644e17ee04e0a19cc412}{PD\_SnkDrawTypeCVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam},
4007                                                                          (uint8\_t)inCase32Tmp, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badfb60998cac82d001b52af44674eef18}{kVbusPower\_InFRSwap});
4008                             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a2d0a8b5453cd82a137805d3b023b264d}{PD\_DPM\_FR\_SWAP\_SUCCESS}, NULL, 1);
4009                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac19a0ca772773bf8cdecb2f2000e0b9e}{PSM\_PE\_SNK\_STARTUP};
4010                         \}
4011                         \textcolor{keywordflow}{else}
4012                         \{
4013                             \textcolor{comment}{/* A protocol error during power role swap triggers a Hard Reset */}
4014                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab2abfb3452a3e195acad327c441296f6}{PSM\_HARD\_RESET};
4015                         \}
4016                     \}
4017                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa6f5ed20252712989645935ecb73be46}{tPSSourceOnTimer}))
4018                     \{
4019                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
4020                     \}
4021                     \textcolor{keywordflow}{else}
4022                     \{
4023                         didNothingStepB = 1;
4024                     \}
4025                     \textcolor{keywordflow}{break};
4026 
4027                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aa1ded4aeaaf1546c7d1b30f9a72d8233}{PE\_FRS\_SNK\_SRC\_Send\_Swap}: \textcolor{comment}{/* B */}
4028                     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} == 0) && 
      \hyperlink{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}{PD\_DpmCheckLessOrEqualVsafe5v}(pdInstance))
4029                     \{
4030                         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a81922cf6a4f22bcee69123e95fac7758}{PD\_SrcTurnOnTypeCVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badfb60998cac82d001b52af44674eef18}{kVbusPower\_InFRSwap});
4031                         pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} = 1;
4032                     \}
4033                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
4034                     \{
4035                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
4036                             (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bad01688ea0b5ce6abad13d1b59929b78a}{kPD\_MsgAccept}))
4037                         \{
4038                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a22771f42025488c2aa330eee49a96f46}{PE\_FRS\_SNK\_SRC\_Transition\_to\_off};
4039                         \}
4040                         \textcolor{keywordflow}{else}
4041                         \{
4042                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY};
4043                         \}
4044                     \}
4045                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}))
4046                     \{
4047                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
4048                     \}
4049                     \textcolor{keywordflow}{else}
4050                     \{
4051                         didNothingStepB = 1;
4052                     \}
4053                     \textcolor{keywordflow}{break};
4054 
4055                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a22771f42025488c2aa330eee49a96f46}{PE\_FRS\_SNK\_SRC\_Transition\_to\_off}: \textcolor{comment}{/* B */}
4056                     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} == 0) && 
      \hyperlink{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}{PD\_DpmCheckLessOrEqualVsafe5v}(pdInstance))
4057                     \{
4058                         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a81922cf6a4f22bcee69123e95fac7758}{PD\_SrcTurnOnTypeCVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badfb60998cac82d001b52af44674eef18}{kVbusPower\_InFRSwap});
4059                         pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} = 1;
4060                     \}
4061                     \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == 
      \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa743d4f3063fded4f9e313960f046bfe9}{PSM\_TRIGGER\_PD\_MSG})
4062                     \{
4063                         \textcolor{keywordflow}{if} ((triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.NumOfDataObjs == 0) &&
4064                             (triggerInfo.\hyperlink{struct__psm__trigger__info_a2d5eac633a3f806ce33111067b23c6df}{msgHeader}.\hyperlink{struct__pd__msg__header_a6dc4609c23d8d9e5d8830177d959fe17}{bitFields}.messageType == 
      \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bace8d31912ce329a95b898d11530ac3b1}{kPD\_MsgPsRdy}))
4065                         \{
4066                             \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{PD\_TimerClear}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa58fa563b3c588ec13b08efd9ce323b64}{tPSSourceOffTimer});
4067                             \hyperlink{usb__pd__policy_8c_a1ae8632e71437586ae348c78f1518772}{PD\_MsgSetPortRole}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource}, pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole});
4068                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a53aba4689937ad582cd75f1dc965829a}{PE\_FRS\_SNK\_SRC\_Vbus\_Applied};
4069                         \}
4070                         \textcolor{keywordflow}{else}
4071                         \{
4072                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY};
4073                         \}
4074                     \}
4075                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{PD\_TimerCheckValidTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa58fa563b3c588ec13b08efd9ce323b64}{tPSSourceOffTimer}))
4076                     \{
4077                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY};
4078                     \}
4079                     \textcolor{keywordflow}{else}
4080                     \{
4081                         didNothingStepB = 1;
4082                     \}
4083                     \textcolor{keywordflow}{break};
4084 
4085                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a53aba4689937ad582cd75f1dc965829a}{PE\_FRS\_SNK\_SRC\_Vbus\_Applied}: \textcolor{comment}{/* B */}
4086                 \{
4087                     uint8\_t checkVal;
4088                     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} == 0) && 
      \hyperlink{usb__pd__policy_8c_abdde9b20d8e38e68b6de66b1e9ece3eb}{PD\_DpmCheckLessOrEqualVsafe5v}(pdInstance))
4089                     \{
4090                         pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->
      \hyperlink{struct__pd__power__callback_a81922cf6a4f22bcee69123e95fac7758}{PD\_SrcTurnOnTypeCVbus}(pdInstance->\hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badfb60998cac82d001b52af44674eef18}{kVbusPower\_InFRSwap});
4091                         pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} = 1;
4092                     \}
4093                     \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda8ceae23865e570716c3b63f07371825b}{PD\_PHY\_FR\_SWAP\_CHECK\_VBUS\_APPLIED}, &checkVal);
4094                     \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened}) || (checkVal))
4095                     \{
4096                         pdInstance->\hyperlink{struct__pd__instance_a3ec5ee7a312bb3b142e16fc8ba019476}{fr5VOpened} = 1;
4097                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a60d82df8a488c0e926e61c63a400c3cb}{PE\_FRS\_SNK\_SRC\_Assert\_Rp};
4098                     \}
4099                     \textcolor{keywordflow}{else}
4100                     \{
4101                         \textcolor{comment}{/* need check vbus constantly */}
4102                         didNothingStepB = 0;
4103                     \}
4104                     \textcolor{keywordflow}{break};
4105                 \}
4106 \textcolor{preprocessor}{#endif}
4107 \textcolor{preprocessor}{}                \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a07a0e09f3ef502e87cc88da3124920d5}{PSM\_PE\_BIST\_TEST\_DATA\_MODE}: \textcolor{comment}{/* (B) */}
4108                     didNothingStepB = 1;
4109                     \textcolor{keywordflow}{break};
4110 
4111                 \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4196d00c604ca0624a80835573551686}{PSM\_PE\_BIST\_CARRIER\_MODE\_2}: \textcolor{comment}{/* (B) */}
4112 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_COMPLIANCE\_TEST\_ENABLE) && (PD\_CONFIG\_COMPLIANCE\_TEST\_ENABLE)}
4113 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faf2be170d04083d1ce7c3666218f9c725}{tBISTContModeTimer}))
4114                     \{
4115                         \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, 
      \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda12e5c95c04532128d54f63e4e76d2c6e}{PD\_PHY\_RESET\_MSG\_FUNCTION}, NULL);
4116                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
4117                         \{
4118                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac2cf2928f82b4a269bf222bafd340397}{PSM\_PE\_SRC\_TRANSITION\_TO\_DEFAULT};
4119                         \}
4120                         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
4121                         \{
4122                             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4ed497a81e543cc7428fcec9e2510f17}{PSM\_PE\_SNK\_TRANSITION\_TO\_DEFAULT};
4123                         \}
4124                         \textcolor{comment}{/* PD\_PhyControl(pdInstance, PD\_PHY\_EXIT\_BIST, NULL); */}
4125                     \}
4126                     \textcolor{keywordflow}{else}
4127                     \{
4128                         \textcolor{comment}{/* We do nothing here, it's all done by the hardware until the device is power
       cycled. */}
4129                         didNothingStepB = 1;
4130                     \}
4131 \textcolor{preprocessor}{#endif}
4132 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{break};
4133 
4134                 \textcolor{keywordflow}{default}:
4135                     didNothingStepB = 1;
4136 
4137                     \textcolor{keywordflow}{break};
4138             \}
4139         \}
4140 
4141         \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} != \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE})
4142         \{
4143             \textcolor{keywordflow}{if} (triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} == \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa5b9fdd1dd1d563306d560e4e6051cfb9}{PSM\_TRIGGER\_DPM\_MSG})
4144             \{
4145                 \hyperlink{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046}{PD\_PsmCommandFail}(pdInstance, triggerInfo.
      \hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg});
4146             \}
4147             triggerInfo.\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
4148         \}
4149     \}
4150 
4151     \textcolor{keywordflow}{if} ((msgReceived) && (\hyperlink{usb__pd__policy_8c_aa84db2763770b08d1dd666c12e4ec45b}{PD\_PsmCanPendingReceive}(pdInstance)))
4152     \{
4153         \hyperlink{usb__pd__policy_8c_aadc2d7bd93e2f244a0b4aefb26d5d5ad}{PD\_MsgReceive}(pdInstance); \textcolor{comment}{/* msg has been processed, receiving next msg */}
4154     \}
4155 
4156     \textcolor{keywordflow}{if} ((!didNothingStepB) || (!didNothingStepA))
4157     \{
4158         \textcolor{keywordflow}{return} \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{kSM\_Continue};
4159     \}
4160 
4161     \textcolor{keywordflow}{return} \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a7cacf9f3344176be4f627e097c8fa5ff}{kSM\_WaitEvent};
4162 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac46d497d9fc03b0096c2977f6a203e02_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac46d497d9fc03b0096c2977f6a203e02_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Reset@{P\-D\-\_\-\-Psm\-Reset}}
\index{P\-D\-\_\-\-Psm\-Reset@{P\-D\-\_\-\-Psm\-Reset}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Reset}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Reset (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61}

\begin{DoxyCode}
337 \{
338     uint8\_t uint8Tmp;
339 
340     pdInstance->\hyperlink{struct__pd__instance_ac25d2d3e3181280ef797e42323c60053}{psmGotoMinTx} = 0;
341     pdInstance->\hyperlink{struct__pd__instance_af189a6cdfc3021280df10fe8a7a86a8f}{psmGotoMinRx} = 0;
342     pdInstance->\hyperlink{struct__pd__instance_a817d87a8494e9f703f8854e7fdf32dfd}{psmHardResetNeedsVSafe0V} = 0;
343     pdInstance->\hyperlink{struct__pd__instance_afc95df19affca8d292c845f328349f8f}{psmPresentlyPdConnected} = 0;
344     pdInstance->\hyperlink{struct__pd__instance_a7be408d709efe6ec210d68a3d4098cc9}{psmCablePlugResetNeeded} = 0;
345     pdInstance->\hyperlink{struct__pd__instance_af7a143c0a8141d2a359a5ce18eb708f6}{psmCableDiscoveried} = 0;
346     pdInstance->\hyperlink{struct__pd__instance_a48293366cd7123e1c703dd01f0921304}{commandEvaluateResult} = \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073a4d58370b8ee8d3d2a4c477f7a3f84dda}{kStatus\_PD\_Error};
347 
348 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
349 \textcolor{preprocessor}{}    \textcolor{keywordflow}{for} (uint8Tmp = 0; uint8Tmp < \hyperlink{usb__pd__interface_8h_a85d244032fc8867df82a1b4aa63bf4c9}{PSM\_SECONDARY\_STATE\_COUNT}; uint8Tmp++)
350     \{
351         pdInstance->\hyperlink{struct__pd__instance_ad376945c62a0066016cf2652e62da35a}{psmSecondaryState}[uint8Tmp] = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE};
352         pdInstance->\hyperlink{struct__pd__instance_a539e99b475d489e955238343ca800918}{psmNewSecondaryState}[uint8Tmp] = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN};
353     \}
354 \textcolor{preprocessor}{#endif}
355 \textcolor{preprocessor}{}
356     uint8Tmp = 0;
357     \textcolor{comment}{// disable FR\_SWAP}
358     \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3edab364b8f9461757d17739cce20263b117}{PD\_PHY\_CONTROL\_FR\_SWAP}, &uint8Tmp);
359     \hyperlink{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}{PD\_TimerCancelAllTimers}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89d7e1d0c4575dfcbaaddc7e6c63a2b8}{tSenderResponseTimer}, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa89479a25c88b992d3de7e33b044d9ed9}{\_tMaxPSMTimer});
360 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a275c11fb3caf0d669e274a15f4c39f61_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ac674e40520a08c8895ec4e852a3751c7}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Set\-Normal\-Power@{P\-D\-\_\-\-Psm\-Set\-Normal\-Power}}
\index{P\-D\-\_\-\-Psm\-Set\-Normal\-Power@{P\-D\-\_\-\-Psm\-Set\-Normal\-Power}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Set\-Normal\-Power}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Set\-Normal\-Power (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{psm\-State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_ac674e40520a08c8895ec4e852a3751c7}

\begin{DoxyCode}
317 \{
318     \textcolor{keywordflow}{switch} (psmState)
319     \{
320         \textcolor{comment}{/* the follow state is stable state (may stay long time) */}
321         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY}:
322         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY}:
323         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53acd44fc87a9973fac8beae5e8d0e7ccd3}{PSM\_PE\_SNK\_WAIT\_FOR\_CAPABILITIES}:
324         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3aed57e7d8fb4f9c6223ef2a29320c1b}{PSM\_PE\_SRC\_SEND\_CAPABILITIES}:
325         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7a493e1fe84c3cce59c37d36dc048c04}{PSM\_PE\_SRC\_DISABLED}:
326         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ab4892cb5d358476586341f1958ef0894}{PSM\_EXIT\_TO\_ERROR\_RECOVERY}:
327         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac945a3cf4c6df692a9b446cfac24041d}{PSM\_EXIT\_TO\_ERROR\_RECOVERY\_WITH\_DELAY}:
328             \hyperlink{usb__pd__policy_8c_a83de99272e34bf7bad5146401157ccff}{PD\_ConnectSetPowerProgress}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
329             \textcolor{keywordflow}{break};
330 
331         \textcolor{keywordflow}{default}:
332             \textcolor{keywordflow}{break};
333     \}
334 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac674e40520a08c8895ec4e852a3751c7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac674e40520a08c8895ec4e852a3751c7_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ac96632daf46a82db5a695cdc2d647371}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Dpm\-Message@{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Dpm\-Message}}
\index{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Dpm\-Message@{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Dpm\-Message}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Dpm\-Message}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Dpm\-Message (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$}]{trigger\-Info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_ac96632daf46a82db5a695cdc2d647371}

\begin{DoxyCode}
1262 \{
1263     \textcolor{keywordflow}{if} (triggerInfo->\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg} < \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa9db050ca92168863b9d0d02111a62d1f}{PD\_DPM\_CONTROL\_DISCOVERY\_IDENTITY})
1264     \{
1265         triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
1266         \textcolor{keywordflow}{if} (!\hyperlink{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{PD\_PsmStartCommand}(pdInstance, triggerInfo->
      \hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg}, 1))
1267         \{
1268             \hyperlink{usb__pd__policy_8c_aa172ea42ac48e9241f6f7b93649aa046}{PD\_PsmCommandFail}(pdInstance, triggerInfo->\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg});
1269             \textcolor{keywordflow}{return};
1270         \}
1271         \textcolor{keywordflow}{switch} (triggerInfo->\hyperlink{struct__psm__trigger__info_ad7f05d06a3113ff4fa5ea1cb6cc0cf83}{dpmMsg})
1272         \{
1273 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE) && (PD\_CONFIG\_DUAL\_DATA\_ROLE\_ENABLE)}
1274 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa7baf188a71537ab45cc32ff871765ef0}{PD\_DPM\_CONTROL\_DR\_SWAP}:
1275             \{
1276                 \textcolor{comment}{// TODO: check alternate mode}
1277                 \textcolor{keywordflow}{if} (\hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{PD\_TimerCheckInvalidOrTimeOut}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa4b5a0c5d3a294276454fefd1e6eab44d}{tDrSwapWaitTimer}))
1278                 \{
1279                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a34b7b536dbe97967c88705e17a6476c9}{PSM\_PE\_DRS\_SEND\_DR\_SWAP};
1280                 \}
1281                 \textcolor{keywordflow}{else}
1282                 \{
1283                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7fdfa8eec5d0a18ad209c8213932e170}{PSM\_PE\_DRS\_EVALUATE\_DR\_SWAP\_WAIT\_TIMER\_TIME\_OUT};
1284                 \}
1285                 \textcolor{keywordflow}{break};
1286             \}
1287 \textcolor{preprocessor}{#endif}
1288 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if (defined PD\_CONFIG\_VCONN\_SUPPORT) && (PD\_CONFIG\_VCONN\_SUPPORT)}
1289 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa9be0b6c27f6eb87d6466b9697915f460}{PD\_DPM\_CONTROL\_VCONN\_SWAP}:
1290             \{
1291                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53adbca6a8a2998452362aaab4a162429f1}{PSM\_PE\_VCS\_SEND\_SWAP};
1292                 \textcolor{keywordflow}{break};
1293             \}
1294 \textcolor{preprocessor}{#endif}
1295 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
1296 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aac2fe93d0e29fa39cef8bd57f45ee5a05}{PD\_DPM\_GET\_BATTERY\_CAP}:
1297             \{
1298                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a80ecd4021c5388f51469f70534bc96c4}{PE\_Get\_Battery\_Cap};
1299                 \textcolor{keywordflow}{break};
1300             \}
1301             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aaf908c79595be0dd645a1edd222cfa471}{PD\_DPM\_GET\_BATTERY\_STATUS}:
1302             \{
1303                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5c59fac69248ef645437145785e5f13a}{PE\_Get\_Battery\_Status};
1304                 \textcolor{keywordflow}{break};
1305             \}
1306             \textcolor{keywordflow}{case} \hyperlink{group__usb__pd__stack_ggabf2676c3360b7c572954ae09c0a5e46aa59afaaae85a74936ea0cc5f66b9fb4ae}{PD\_DPM\_GET\_MANUFACTURER\_INFO}:
1307             \{
1308                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a77041c81b4c648b823006673db2f5cc8}{PE\_Get\_Manfacturer\_Info};
1309                 \textcolor{keywordflow}{break};
1310             \}
1311 \textcolor{preprocessor}{#if 0}
1312 \textcolor{preprocessor}{}            \textcolor{keywordflow}{case} PD\_DPM\_SECURITY\_REQUEST:
1313             \{
1314                 pdInstance->extAllDataSize = pdInstance->extRemainSize = pdInstance->
      \hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength};
1315                 pdInstance->extChunkNumber = 0;
1316                 pdInstance->extDataBuffer = pdInstance->\hyperlink{struct__pd__instance_a05d172382020769919cd2afd088fe164}{commandExtParam}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer};
1317                 pdInstance->extRequestChunkHeader.bitFields.chunked = pdInstance->
      \hyperlink{struct__pd__instance_af61039550d3e5b4f070ac74ed3e711a3}{unchunkedFeature};
1318                 pdInstance->extRequestChunkHeader.bitFields.chunkNumber = 0;
1319                 pdInstance->extRequestChunkHeader.bitFields.dataSize = pdInstance->extAllDataSize;
1320                 pdInstance->extRequestChunkHeader.bitFields.requestChunk = 0;
1321                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac39b4eb7ba5e8588f0e1de6ae536471c}{PE\_Send\_Security\_Request};
1322                 \textcolor{keywordflow}{break};
1323             \}
1324 \textcolor{preprocessor}{#endif}
1325 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
1326 \textcolor{preprocessor}{}
1327             \textcolor{keywordflow}{default}:
1328                 \textcolor{keywordflow}{break};
1329         \}
1330     \}
1331 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac96632daf46a82db5a695cdc2d647371_cgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a82a9479341ca58d919f5f5df53647dea}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Pd\-Message@{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Pd\-Message}}
\index{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Pd\-Message@{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Pd\-Message}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Pd\-Message}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Sink\-And\-Source\-Rdy\-Process\-Pd\-Message (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{{\bf psm\-\_\-trigger\-\_\-info\-\_\-t} $\ast$}]{trigger\-Info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_a82a9479341ca58d919f5f5df53647dea}

\begin{DoxyCode}
1519 \{
1520     uint32\_t commandResultCallback;
1521 
1522 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
1523 \textcolor{preprocessor}{}    \hyperlink{struct__pd__extended__msg__header}{pd\_extended\_msg\_header\_t} extHeader;
1524     extHeader.\hyperlink{struct__pd__extended__msg__header_a1d247099ea671c66798b32e603697c5d}{extendedMsgHeaderVal} = (uint32\_t)(
      \hyperlink{usb__misc_8h_ad653e9416e47d6669d5b8e57c48e2d6f}{USB\_SHORT\_FROM\_LITTLE\_ENDIAN\_ADDRESS}((triggerInfo->
      \hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer})));
1525 \textcolor{preprocessor}{#endif}
1526 \textcolor{preprocessor}{}
1527     \textcolor{keywordflow}{if} ((triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop} != \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) || (triggerInfo->
      \hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType} == \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba66aafd87acfa6b79caa2331114cd632a}{kPD\_MsgVendorDefined}))
1528     \{
1529         \textcolor{keywordflow}{return};
1530     \}
1531 
1532     triggerInfo->\hyperlink{struct__psm__trigger__info_a4ad5cd13544e540fbd9a6bb06a041732}{triggerEvent} = \hyperlink{usb__pd__policy_8c_a5f15ca7d021f2d073f4e7929f825169fa0738799dbe3469ecbd4e8b5da2c93fc8}{PSM\_TRIGGER\_NONE};
1533     \textcolor{comment}{/* note: vdm message will be processed before this */}
1534     \textcolor{keywordflow}{switch} (triggerInfo->\hyperlink{struct__psm__trigger__info_a0c8121495f67a38197784329ebbc1d8e}{pdMsgType})
1535     \{
1536         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368baa8f159f471074375887c51aa4e6c1856}{kPD\_MsgAlert}:
1537         \{
1538             \hyperlink{struct__pd__command__data__param}{pd\_command\_data\_param\_t} commandExtParam;
1539             \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink})
1540             \{
1541                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4a655ea5b215db30df1459c393425729}{PE\_SNK\_Source\_Alert\_Received};
1542             \}
1543             \textcolor{keywordflow}{else}
1544             \{
1545                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53afb6007f96712d3851d3a865e8a537013}{PE\_SRC\_Sink\_Alert\_Received};
1546             \}
1547             commandExtParam.\hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = &triggerInfo->\hyperlink{struct__psm__trigger__info_ab8dad32f7d50d933824c9ea766850ab8}{pdMsgDataBuffer}[0];
1548             commandExtParam.\hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = 4;
1549             commandExtParam.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP};
1550             \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a2ca776167fbab779a679639add785fcd}{PD\_DPM\_ALERT\_RECEIVED}, &
      commandExtParam, 0);
1551             \textcolor{keywordflow}{if} (commandExtParam.\hyperlink{struct__pd__command__data__param_ae615100fed31d9a3b0d14df3e88b427f}{resultStatus} == 
      \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported})
1552             \{
1553                 \hyperlink{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{PD\_PsmTransitionOnMsgSendControl}(
1554                     pdInstance, \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported},
1555                     (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource}) ? 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a007090e305486428e250343237d6e6b0}{PSM\_PE\_SRC\_READY} : \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a658445c0923213e00338437ec4a89594}{PSM\_PE\_SNK\_READY});
1556             \}
1557             \textcolor{keywordflow}{break};
1558         \}
1559 
1560         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba49642259c83717f150998ad12db96122}{kPD\_MsgNotSupported}:
1561             commandResultCallback = \hyperlink{group__usb__pd__stack_ggaa0c9fbfbfb4442ef9d805438bfeb045caa7d52b6983bc63b06da53587776a1664}{kCommandResult\_NotSupported};
1562 \textcolor{preprocessor}{#if 0}
1563 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} == PD\_DPM\_SECURITY\_REQUEST)
1564             \{
1565                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, PD\_DPM\_SECURITY\_REQUEST\_FAIL, &
      commandResultCallback, 1);
1566             \}
1567             \textcolor{keywordflow}{else}
1568 \textcolor{preprocessor}{#endif}
1569 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_ae144ddf17de553d955ce28afa535d4f9}{alertWaitReply})
1570             \{
1571                 pdInstance->\hyperlink{struct__pd__instance_ae144ddf17de553d955ce28afa535d4f9}{alertWaitReply} = 0;
1572                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8a0cbb394fa1a8c85368a4d84c1e5647c2}{PD\_DPM\_SEND\_ALERT\_FAIL}, &commandResultCallback, 0);
1573             \}
1574             \textcolor{keywordflow}{else}
1575             \{
1576             \}
1577             \textcolor{keywordflow}{break};
1578 
1579 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT) && (PD\_CONFIG\_EXTENDED\_MSG\_SUPPORT)}
1580 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bac3a2ecb4c14453ad29ce5ed40f9ab46a}{kPD\_MsgGetBatteryCap}:
1581             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (uint8\_t *)&(pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData}[1]);
1582             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} += 2; \textcolor{comment}{/* data pos */}
1583             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize;
1584             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = triggerInfo->
      \hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop};
1585             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53af57f1b28d1d2e5c70927ab5be1fc8d1f}{PE\_Give\_Battery\_Cap};
1586             \textcolor{keywordflow}{break};
1587 
1588         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bafdbc3afe02d076186203e1fb5cebe78a}{kPD\_MsgGetBatteryStatus}:
1589             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (uint8\_t *)&(pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData}[1]);
1590             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} += 2; \textcolor{comment}{/* data pos */}
1591             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize;
1592             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = triggerInfo->
      \hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop};
1593             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a3786ef2885ab7d4ff175973e2c0f7953}{PE\_Give\_Battery\_Status};
1594             \textcolor{keywordflow}{break};
1595 
1596         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bab7714bb078012f97329fa2aa02cb5ca6}{kPD\_MsgGetManufacturerInfo}:
1597             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (uint8\_t *)&(pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData}[1]);
1598             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} += 2; \textcolor{comment}{/* data pos */}
1599             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize;
1600             pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.\hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = triggerInfo->
      \hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop};
1601             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a395aa353974c638755b42084e94b1eef}{PE\_Give\_Manufacturer\_Info};
1602             \textcolor{keywordflow}{break};
1603 
1604 \textcolor{preprocessor}{#if 0}
1605 \textcolor{preprocessor}{}        \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba94163ce483808757dbfb58405a1bff03}{kPD\_MsgSecurityRequest}:
1606         \{
1607             \textcolor{comment}{/* (responser) chunked request's response, or the first msg */}
1608             \textcolor{keywordflow}{if} (!(extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk))
1609             \{
1610                 \textcolor{keywordflow}{if} (extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunked)
1611                 \{
1612                     \textcolor{keywordflow}{if} (((extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber + 1) * 26) < extHeader.
      \hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize)
1613                     \{
1614                         \textcolor{comment}{/* request next chunk */}
1615                         PD\_PsmSendChunkedMsgRequest(pdInstance, (
      \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop},
1616                                                     \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba94163ce483808757dbfb58405a1bff03}{kPD\_MsgSecurityRequest}, extHeader
      );
1617                     \}
1618                     \textcolor{keywordflow}{else}
1619                     \{
1620                         \textcolor{comment}{/* receive all the data */}
1621                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9044ca4d4b7a47e0cc8a2573f1fc2bc0}{PE\_Send\_Security\_Response};
1622                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (uint8\_t *)&(pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData}[1]);
1623                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} += 2; \textcolor{comment}{/* data pos */}
1624                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize;
1625                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop};
1626                         pdInstance->extRequestChunkHeader.bitFields.requestChunk = 0;
1627                     \}
1628                 \}
1629                 \textcolor{keywordflow}{else}
1630                 \{
1631                     \textcolor{comment}{/* receive all the data */}
1632                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9044ca4d4b7a47e0cc8a2573f1fc2bc0}{PE\_Send\_Security\_Response};
1633                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (uint8\_t *)&(pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData}[1]);
1634                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} += 2; \textcolor{comment}{/* data pos */}
1635                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize;
1636                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop};
1637                     pdInstance->extRequestChunkHeader.bitFields.requestChunk = 0;
1638                 \}
1639             \}
1640             \textcolor{keywordflow}{else}
1641             \{
1642                 \textcolor{comment}{/* (initiator) chunked request received */}
1643                 pdInstance->extRequestChunkHeader = extHeader;
1644                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ac39b4eb7ba5e8588f0e1de6ae536471c}{PE\_Send\_Security\_Request};
1645             \}
1646             \textcolor{keywordflow}{break};
1647         \}
1648 
1649         \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bab4407cf4f44a8c11dd35980f6c541640}{kPD\_MsgSecurityResponse}:
1650         \{
1651             \textcolor{comment}{/* (responser) chunked request's response, or the first msg */}
1652             \textcolor{keywordflow}{if} (!(extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.requestChunk))
1653             \{
1654                 \textcolor{keywordflow}{if} (extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunked)
1655                 \{
1656                     \textcolor{keywordflow}{if} (((extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.chunkNumber + 1) * 26) < extHeader.
      \hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize)
1657                     \{
1658                         \textcolor{comment}{/* request next chunk */}
1659                         PD\_PsmSendChunkedMsgRequest(pdInstance, (
      \hyperlink{group__usb__pd__stack_ga59170ea474bbce078de8ffb3eea617aa}{start\_of\_packet\_t})triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop},
1660                                                     \hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368bab4407cf4f44a8c11dd35980f6c541640}{kPD\_MsgSecurityResponse}, 
      extHeader);
1661                     \}
1662                     \textcolor{keywordflow}{else}
1663                     \{
1664                         \textcolor{comment}{/* receive all the data */}
1665                         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ad7045267a261d8ee3f7c91e73df6d4ae}{PE\_Security\_Response\_Received};
1666                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (uint8\_t *)&(pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData}[1]);
1667                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} += 2; \textcolor{comment}{/* data pos */}
1668                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize;
1669                         pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop};
1670                         pdInstance->extRequestChunkHeader.bitFields.requestChunk = 0;
1671                     \}
1672                 \}
1673                 \textcolor{keywordflow}{else}
1674                 \{
1675                     \textcolor{comment}{/* receive all the data */}
1676                     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53ad7045267a261d8ee3f7c91e73df6d4ae}{PE\_Security\_Response\_Received};
1677                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} = (uint8\_t *)&(pdInstance->\hyperlink{struct__pd__instance_accf867a3b224d5e7708c3167b49eb259}{receivedData}[1]);
1678                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a208a0a5b69c2c44eaa616e4e1d6b77ee}{dataBuffer} += 2; \textcolor{comment}{/* data pos */}
1679                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_a1ebd3619e990184cbc131f98137e3447}{dataLength} = extHeader.\hyperlink{struct__pd__extended__msg__header_aac756f1b65823f59184919281e17c0ce}{bitFields}.dataSize;
1680                     pdInstance->\hyperlink{struct__pd__instance_a93988814b8f6bf439021e6ff46fff207}{commandExtParamCallback}.
      \hyperlink{struct__pd__command__data__param_abc162486c37792c444d2ea46da2c27ed}{sop} = triggerInfo->\hyperlink{struct__psm__trigger__info_a27c2acd560222336245db0a281cc5c1c}{pdMsgSop};
1681                     pdInstance->extRequestChunkHeader.bitFields.requestChunk = 0;
1682                 \}
1683             \}
1684             \textcolor{keywordflow}{else}
1685             \{
1686                 \textcolor{comment}{/* (initiator) chunked request received */}
1687                 pdInstance->extRequestChunkHeader = extHeader;
1688                 pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a9044ca4d4b7a47e0cc8a2573f1fc2bc0}{PE\_Send\_Security\_Response};
1689             \}
1690             \textcolor{keywordflow}{break};
1691         \}
1692 \textcolor{preprocessor}{#endif}
1693 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
1694 \textcolor{preprocessor}{}
1695         \textcolor{keywordflow}{default}:
1696             \textcolor{keywordflow}{break};
1697     \}
1698 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a82a9479341ca58d919f5f5df53647dea_cgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Start\-Command@{P\-D\-\_\-\-Psm\-Start\-Command}}
\index{P\-D\-\_\-\-Psm\-Start\-Command@{P\-D\-\_\-\-Psm\-Start\-Command}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Start\-Command}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\-\_\-t P\-D\-\_\-\-Psm\-Start\-Command (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{command, }
\item[{uint8\-\_\-t}]{is\-Initiator}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c}

\begin{DoxyCode}
699 \{
700 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_PD3\_AMS\_COLLISION\_AVOID\_ENABLE) && (PD\_CONFIG\_PD3\_AMS\_COLLISION\_AVOID\_ENABLE)}
701 \textcolor{preprocessor}{}    uint8\_t start = 1;
702 
703     \textcolor{keywordflow}{if} (isInitiator)
704     \{
705         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} == \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource})
706         \{
707             \hyperlink{usb__pd__msg_8c_a0f4c4b5235e5789a5b705a458ff97bfe}{PD\_MsgSrcStartCommand}(pdInstance);
708         \}
709         \textcolor{keywordflow}{else}
710         \{
711             start = \hyperlink{usb__pd__msg_8c_a5181f0cdc3342fe4e3898f08f5cf73b6}{PD\_MsgSnkCheckStartCommand}(pdInstance);
712         \}
713     \}
714     \textcolor{keywordflow}{else}
715     \{
716         start = 1;
717     \}
718 
719     \textcolor{keywordflow}{if} (start)
720 \textcolor{preprocessor}{#endif}
721 \textcolor{preprocessor}{}    \{
722         pdInstance->\hyperlink{struct__pd__instance_a19172e14529d11e2239205c36accdfba}{commandProcessing} = command;
723         pdInstance->\hyperlink{struct__pd__instance_aece677cf125a9acd9546c1bc0f75b5b9}{commandIsInitiator} = isInitiator;
724     \}
725 
726 \textcolor{preprocessor}{#if defined(PD\_CONFIG\_PD3\_AMS\_COLLISION\_AVOID\_ENABLE) && (PD\_CONFIG\_PD3\_AMS\_COLLISION\_AVOID\_ENABLE)}
727 \textcolor{preprocessor}{}    \textcolor{keywordflow}{return} start;
728 \textcolor{preprocessor}{#else}
729 \textcolor{preprocessor}{}    \textcolor{keywordflow}{return} 1;
730 \textcolor{preprocessor}{#endif}
731 \textcolor{preprocessor}{}\}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a26fc00ebd036043cf62cc2e558becd5c_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_ac6e31fa3949c6ca1288f96b6c5252bba}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-State\-Machine@{P\-D\-\_\-\-Psm\-State\-Machine}}
\index{P\-D\-\_\-\-Psm\-State\-Machine@{P\-D\-\_\-\-Psm\-State\-Machine}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-State\-Machine}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Psm\-State\-Machine (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_ac6e31fa3949c6ca1288f96b6c5252bba}

\begin{DoxyCode}
6484 \{
6485     uint32\_t infoVal;
6486     \textcolor{comment}{// error, continue, wait event}
6487     uint8\_t returnVal = \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{kSM\_Continue};
6488 
6489     \textcolor{comment}{// dpmStateMachine的作用？ 表示是否进入了DPM State machine ?}
6490     \textcolor{keywordflow}{switch} (pdInstance->\hyperlink{struct__pd__instance_a6e12cc53d94812cf2a28973fae7c6a7e}{dpmStateMachine})
6491     \{
6492         \textcolor{comment}{// 如果该变量为0，则检查是否有vbus，如果有，设置为1 （这应该是初始化的流程）}
6493         \textcolor{keywordflow}{case} 0:
6494             \textcolor{comment}{/* wait vbus charge */}
6495             \textcolor{comment}{/* Neither Source nor Sink should enter PSM before VSafe5V is available */}
6496             \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, 
      &infoVal);
6497             \textcolor{keywordflow}{if} (infoVal & \hyperlink{group__usb__pd__phy__drv_gabe6758409c7aeff91de688fe7cefa195}{PD\_VBUS\_POWER\_STATE\_VBUS\_MASK})
6498             \{
6499                 pdInstance->\hyperlink{struct__pd__instance_a6e12cc53d94812cf2a28973fae7c6a7e}{dpmStateMachine} = 1;
6500             \}
6501             \textcolor{keywordflow}{break};
6502 
6503         \textcolor{keywordflow}{case} 1:
6504             \textcolor{comment}{// 什么情况会unknown, 如果unknown，则置为idle，否则保持}
6505             pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} == 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a5a92c20e8e77ed015efd0490d126a80a}{PSM\_UNKNOWN}) ? \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53aaa98c2eded130e35a80326c4c59c9d7c}{PSM\_IDLE} : pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState};
6506 
6507             \textcolor{comment}{/* Did we do anything in Step A or B or C */}
6508             \textcolor{comment}{/* Step A: common process */}
6509             \textcolor{comment}{/* Step B: state is not changed */}
6510             \textcolor{comment}{/* Step C: change to new state */}
6511 
6512             \textcolor{comment}{// 作用 ？}
6513             \textcolor{keywordflow}{do}
6514             \{
6515                 returnVal = \hyperlink{usb__pd__policy_8c_afbd2eb3bceb62f29229f0bff6eed6844}{PD\_PsmEnterState}(pdInstance);
6516                 returnVal = \hyperlink{usb__pd__policy_8c_ac46d497d9fc03b0096c2977f6a203e02}{PD\_PsmProcessState}(pdInstance);
6517             \} \textcolor{keywordflow}{while} (((pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != pdInstance->
      \hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState}) || (returnVal == \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{kSM\_Continue})) &&
6518                      (returnVal != \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}{kSM\_ErrorRecovery}));
6519 
6520             \textcolor{keywordflow}{if} (returnVal == \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}{kSM\_ErrorRecovery})
6521             \{
6522                 \hyperlink{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}{PD\_TimerCancelAllTimers}(pdInstance, 
      \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa2033278364993300e5dbf3c5a088cc78}{\_tStartTimer}, \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071faa18ebe20854093d25a292b738d04147f}{\_tMaxDpmTimer});
6523             \}
6524             \textcolor{keywordflow}{break};
6525 
6526         \textcolor{keywordflow}{default}:
6527             \textcolor{keywordflow}{break};
6528     \}
6529 
6530     \textcolor{keywordflow}{return} returnVal;
6531 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac6e31fa3949c6ca1288f96b6c5252bba_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_ac6e31fa3949c6ca1288f96b6c5252bba_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Control@{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Control}}
\index{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Control@{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Control}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Control}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Control (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{msg\-Type, }
\item[{{\bf pd\-\_\-psm\-\_\-state\-\_\-t}}]{success\-Next\-State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}}\label{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57}

\begin{DoxyCode}
261 \{
262     \hyperlink{usb__pd__policy_8c_aebb9e4a574913ad404235c42dd319730}{PD\_MsgSendControlTransition}(pdInstance, msgType, successNextState, 
      \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a4d6fcbcfe0d0eb9b171933d16b28ace6}{PSM\_CHECK\_ASYNC\_RX}, \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a54c6c17d279f56bce6f263804ab33296}{PSM\_SEND\_SOFT\_RESET});
263 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aff3535a878f79a57d065fa8d9b5aba57_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Error@{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Error}}
\index{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Error@{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Error}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Error}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Psm\-Transition\-On\-Msg\-Send\-Error (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{interrupted\-State, }
\item[{{\bf pd\-\_\-psm\-\_\-state\-\_\-t}}]{error\-State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c}


Function to simplify the error handling of message transmit. 



 \begin{DoxyNote}{Note}
Only called from C\-L\-P task context 
\end{DoxyNote}

\begin{DoxyCode}
214 \{
215 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE) && (PD\_CONFIG\_VENDOR\_DEFINED\_MESSAGE\_ENABLE)}
216 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ((\hyperlink{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4}{PD\_MsgRecvPending}(pdInstance)) && (pdInstance->
      \hyperlink{struct__pd__instance_a21c5a4229c4d099a6840ac2d13a5a32e}{receivedSop} == \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1a5c5082dee0eb49208cd4a5c728ff7fce}{kPD\_MsgSOP}) &&
217         (((\hyperlink{usb__pd__policy_8c_a746e358795fd62e6873cb51e7ff8b7a3}{MSG\_DATA\_HEADER} & \hyperlink{usb__pd__spec_8h_a13f0f9266cf4b2158dfb505a2322684a}{PD\_MSG\_HEADER\_MESSAGE\_TYPE\_MASK})
       >> \hyperlink{usb__pd__spec_8h_a86a7dc4b5a4755e8ead223d653adfcbe}{PD\_MSG\_HEADER\_MESSAGE\_TYPE\_POS}) ==
218          (\hyperlink{usb__pd__spec_8h_a5dd447708699386a010c1e71e0f9368ba66aafd87acfa6b79caa2331114cd632a}{kPD\_MsgVendorDefined} & \hyperlink{usb__pd__spec_8h_afbe845f7ee998a739bae14cf4b2d36b8}{PD\_MSG\_TYPE\_VALUE\_MASK})))
219     \{
220         \textcolor{comment}{/* re-excute the psmCurState */}
221         \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} != \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ee6a2f41bbfa406b9492016783b6b18}{PSM\_INTERRUPTED\_REQUEST})
222         \{
223             pdInstance->\hyperlink{struct__pd__instance_a4a53a203e61b44957d56747fb7c8a312}{psmInterruptedState} = pdInstance->
      \hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState};
224             pdInstance->\hyperlink{struct__pd__instance_a3bc0e6fd670db006ccb2ba39dadedcc5}{psmCurState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ee6a2f41bbfa406b9492016783b6b18}{PSM\_INTERRUPTED\_REQUEST};
225         \}
226         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = \hyperlink{usb__pd__spec_8h_a745958437dde25902f704348772cec53a7ee6a2f41bbfa406b9492016783b6b18}{PSM\_INTERRUPTED\_REQUEST};
227     \}
228 \textcolor{preprocessor}{#endif}
229 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{usb__pd__policy_8c_a4a1258c0505ff43986e259a96d0bccf4}{PD\_MsgRecvPending}(pdInstance))
230     \{
231         pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = (\hyperlink{usb__pd__spec_8h_a46ab85ad33154cc61c1fa42d5ca24944}{pd\_psm\_state\_t})interruptedState;
232     \}
233     pdInstance->\hyperlink{struct__pd__instance_ab770921a8b608fc49a0d564a22a1aad3}{psmNewState} = errorState;
234     \textcolor{keywordflow}{return};
235 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_aa631d2e98602c309c01a110bed7cf94c_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__policy_8c_a602f8622c0ba8d21b5013537dd3dadf9}{\index{usb\-\_\-pd\-\_\-policy.\-c@{usb\-\_\-pd\-\_\-policy.\-c}!P\-D\-\_\-\-Stack\-State\-Machine@{P\-D\-\_\-\-Stack\-State\-Machine}}
\index{P\-D\-\_\-\-Stack\-State\-Machine@{P\-D\-\_\-\-Stack\-State\-Machine}!usb_pd_policy.c@{usb\-\_\-pd\-\_\-policy.\-c}}
\subsubsection[{P\-D\-\_\-\-Stack\-State\-Machine}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Stack\-State\-Machine (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance}
\end{DoxyParamCaption}
)}}\label{usb__pd__policy_8c_a602f8622c0ba8d21b5013537dd3dadf9}

\begin{DoxyCode}
6666 \{
6667     uint32\_t taskEventSet;
6668     \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338}{TypeCState\_t} connectStatus;
6669     uint8\_t smState = 0;
6670     uint8\_t connected;
6671 
6672     \textcolor{comment}{//initializeLabel表示state machine是否被初始化过}
6673     \textcolor{comment}{//为0表示没有}
6674     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a2edcb21b9d568937192741d32381d2b1}{initializeLabel} == 0)
6675     \{
6676         pdInstance->\hyperlink{struct__pd__instance_a2edcb21b9d568937192741d32381d2b1}{initializeLabel} = 1;
6677         pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected} = 0;
6678         \textcolor{comment}{/* We want to override any existing MTP-based connection */}
6679         \textcolor{comment}{// 根据typec power role (typec\_power\_role\_config\_t) init}
6680         \hyperlink{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4}{PD\_ConnectInitRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole}, 0);
6681         \textcolor{comment}{// curConnectState}
6682         pdInstance->\hyperlink{struct__pd__instance_aa310a61602eb5d34b4b511ce4ad60f1d}{connectedResult} = \hyperlink{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02}{PD\_ConnectGetStateMachine}(
      pdInstance);
6683         \hyperlink{usb__pd__policy_8c_ac70b1975475b5b94815c02eb5be41e1a}{PD\_DpmSetVconn}(pdInstance, 0);
6684     \}
6685     \textcolor{comment}{// 该event group在init func中已经建立了}
6686     \textcolor{comment}{// not auto clear}
6687     \hyperlink{group__usb__os__abstraction_ga5ce587209d676871f3ec62900054febd}{USB\_OsaEventWait}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 0xffu, 0, pdInstance->
      \hyperlink{struct__pd__instance_a2505651a0001ea647306dbd800927778}{waitTime}, &taskEventSet);
6688     pdInstance->\hyperlink{struct__pd__instance_a2505651a0001ea647306dbd800927778}{waitTime} = \hyperlink{usb__pd__interface_8h_ac3471f042971fd1641303f2622b844c1}{PD\_WAIT\_EVENT\_TIME};
6689     \hyperlink{usb__pd__policy_8c_a39aa541f6a8e3843b3ab18fdcf533768}{PD\_PortTaskEventProcess}(pdInstance, taskEventSet);
6690     \textcolor{keywordflow}{if} (taskEventSet & \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ae5b6c5a346b9ba137369e1193675227b}{PD\_TASK\_EVENT\_TYPEC\_STATE\_PROCESS})
6691     \{
6692         \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      PD\_TASK\_EVENT\_TYPEC\_STATE\_PROCESS);
6693     \}
6694 
6695     \textcolor{comment}{/* Process Type-C state change by PD stack */}
6696     \textcolor{comment}{// return curConnectState}
6697     connectStatus = \hyperlink{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02}{PD\_ConnectGetStateMachine}(pdInstance);
6698     \textcolor{keywordflow}{if} (connectStatus != pdInstance->\hyperlink{struct__pd__instance_aa310a61602eb5d34b4b511ce4ad60f1d}{connectedResult})
6699     \{
6700         pdInstance->\hyperlink{struct__pd__instance_aa310a61602eb5d34b4b511ce4ad60f1d}{connectedResult} = connectStatus;
6701     \}
6702 
6703     \textcolor{comment}{/* Process Type-C state change by Type-C state machine */}
6704     connected = \hyperlink{usb__pd__policy_8c_a25116c60801fe4f4def90e3e42614b54}{PD\_ConnectCheck}(pdInstance);
6705     connectStatus = \hyperlink{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02}{PD\_ConnectGetStateMachine}(pdInstance);
6706     \textcolor{keywordflow}{if} (connected != \hyperlink{usb__pd__interface_8h_a924ee365c422092460915bc8cd8b9cbba4e1bf59f2d40fb235c0afed35f455701}{kConnectState\_NotStable})
6707     \{
6708         \textcolor{keywordflow}{if} (connected == \hyperlink{usb__pd__interface_8h_a924ee365c422092460915bc8cd8b9cbba56560172992b012a9e3ea7a47885bd40}{kConnectState\_Connected})
6709         \{
6710             connected = 1;
6711         \}
6712         \textcolor{keywordflow}{else}
6713         \{
6714             connected = 0;
6715         \}
6716         \textcolor{comment}{/* connect state change */}
6717         \textcolor{keywordflow}{if} ((connected != pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected}) ||
6718             ((pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected}) && (connectStatus != pdInstance->
      \hyperlink{struct__pd__instance_aa310a61602eb5d34b4b511ce4ad60f1d}{connectedResult})))
6719         \{
6720             \textcolor{comment}{/* change from disconnect to connect */}
6721             \textcolor{keywordflow}{if} ((!(pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected})) && (connected))
6722             \{
6723                 \textcolor{keywordflow}{switch} (connectStatus)
6724                 \{
6725                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a08ce67bf9e0a4d46237c40642b049bcc}{TYPEC\_ATTACHED\_SRC}:
6726                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a06a469da27f359966648eda899622706}{TYPEC\_ATTACHED\_SNK}:
6727                         pdInstance->\hyperlink{struct__pd__instance_a007de2aa1ac9ae814d10d26a949dd61d}{pendingSOP} = \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1aaa62220b2caaa3d1273068a3e03969d4}{kPD\_MsgSOPMask};
6728                         \textcolor{keywordflow}{if} (connectStatus == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a08ce67bf9e0a4d46237c40642b049bcc}{TYPEC\_ATTACHED\_SRC})
6729                         \{
6730                             pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
6731                             pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP};
6732                             pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28a239cd9fcbe39abba0bc8959dc1a24e37}{kPD\_IsVconnSource};
6733                         \}
6734                         \textcolor{keywordflow}{else}
6735                         \{
6736                             pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink};
6737                             pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP};
6738                             pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28ad27a489c262689fb72562c3a59cb9727}{kPD\_NotVconnSource};
6739                         \}
6740                         \textcolor{keywordflow}{break};
6741 
6742                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a1e60a88a2cd942ba4bd065ee2b9438d3}{TYPEC\_AUDIO\_ACCESSORY}:
6743                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a09376cb7ece9c3734d29379623b63a69}{TYPEC\_UNORIENTED\_DEBUG\_ACCESSORY\_SRC}:
6744                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338abe78848b46b7ac825cdc24493593a500}{TYPEC\_DEBUG\_ACCESSORY\_SNK}:
6745                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a52743b32e531cf3605d534ae3d2bf014}{TYPEC\_POWERED\_ACCESSORY}:
6746                         \textcolor{comment}{/* do nothing */}
6747                         \textcolor{comment}{/* pdInstance->curPowerRole = kPD\_PowerRoleSource; */}
6748                         \textcolor{comment}{/* pdInstance->curDataRole = kPD\_DataRoleDFP; */}
6749                         \textcolor{keywordflow}{break};
6750 
6751 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_DEBUG\_ACCESSORY\_SUPPORT) && (PD\_CONFIG\_DEBUG\_ACCESSORY\_SUPPORT)}
6752 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338aa6be0b74b1649d54569a428ef0e326a4}{TYPEC\_ORIENTED\_DEBUG\_ACCESSORY\_SRC}:
6753                         \textcolor{keywordflow}{if} (\hyperlink{usb__pd__interface_8h_a447c32bfcfe6d47479635166462cfcd2}{PD\_CONFIG\_DEBUG\_ACCESSORY\_ROLE} == 
      CONFIG\_DEBUG\_ACCESSORY\_NONE)
6754                         \{
6755                             \textcolor{comment}{/* Wait for disconnection */}
6756                         \}
6757                         \textcolor{keywordflow}{else}
6758                         \{
6759                             pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
6760                             pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP};
6761                             pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28a239cd9fcbe39abba0bc8959dc1a24e37}{kPD\_IsVconnSource};
6762                         \}
6763                         \textcolor{keywordflow}{break};
6764 \textcolor{preprocessor}{#endif}
6765 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{default}:
6766                         \textcolor{keywordflow}{break};
6767                 \}
6768 
6769                 \textcolor{comment}{// call PD\_DpmDemoAppCallback in pd\_app.c}
6770                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8adbefad204068244fdf75ba1ff211fbfc}{PD\_CONNECTED}, NULL, 0);
6771                 \hyperlink{usb__pd__policy_8c_a150b2573c8bfe54de3d77cd020d85bc0}{PD\_DpmConnect}(pdInstance);
6772             \}
6773             \textcolor{comment}{/* still connect, but role change. For example: Try.SRC */}
6774             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected}) && (connected) && (connectStatus != pdInstance->
      \hyperlink{struct__pd__instance_aa310a61602eb5d34b4b511ce4ad60f1d}{connectedResult}))
6775             \{
6776                 \textcolor{keywordflow}{switch} (connectStatus)
6777                 \{
6778                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a08ce67bf9e0a4d46237c40642b049bcc}{TYPEC\_ATTACHED\_SRC}:
6779                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a06a469da27f359966648eda899622706}{TYPEC\_ATTACHED\_SNK}:
6780                         pdInstance->\hyperlink{struct__pd__instance_a007de2aa1ac9ae814d10d26a949dd61d}{pendingSOP} = \hyperlink{group__usb__pd__stack_gga7a924235403e0acab44d01e720091aa1aaa62220b2caaa3d1273068a3e03969d4}{kPD\_MsgSOPMask};
6781                         \textcolor{keywordflow}{if} (connectStatus == \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a08ce67bf9e0a4d46237c40642b049bcc}{TYPEC\_ATTACHED\_SRC})
6782                         \{
6783                             pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
6784                             pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP};
6785                             pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28a239cd9fcbe39abba0bc8959dc1a24e37}{kPD\_IsVconnSource};
6786                         \}
6787                         \textcolor{keywordflow}{else}
6788                         \{
6789                             pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8bafca465150c227ef579c7a2bfc47b4072}{kPD\_PowerRoleSink};
6790                             pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828a20fd8fe92eea59b9fd7dd0691e395baa}{kPD\_DataRoleUFP};
6791                             pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28ad27a489c262689fb72562c3a59cb9727}{kPD\_NotVconnSource};
6792                         \}
6793                         \textcolor{keywordflow}{break};
6794 
6795                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a1e60a88a2cd942ba4bd065ee2b9438d3}{TYPEC\_AUDIO\_ACCESSORY}:
6796                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a09376cb7ece9c3734d29379623b63a69}{TYPEC\_UNORIENTED\_DEBUG\_ACCESSORY\_SRC}:
6797                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338abe78848b46b7ac825cdc24493593a500}{TYPEC\_DEBUG\_ACCESSORY\_SNK}:
6798                     \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338a52743b32e531cf3605d534ae3d2bf014}{TYPEC\_POWERED\_ACCESSORY}:
6799                         \textcolor{keywordflow}{break};
6800 
6801 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_DEBUG\_ACCESSORY\_SUPPORT) && (PD\_CONFIG\_DEBUG\_ACCESSORY\_SUPPORT)}
6802 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{case} \hyperlink{usb__pd__spec_8h_a9a1674d34c926c8ecd0f9f70e2da0338aa6be0b74b1649d54569a428ef0e326a4}{TYPEC\_ORIENTED\_DEBUG\_ACCESSORY\_SRC}:
6803                         \textcolor{keywordflow}{if} (\hyperlink{usb__pd__interface_8h_a447c32bfcfe6d47479635166462cfcd2}{PD\_CONFIG\_DEBUG\_ACCESSORY\_ROLE} == 
      CONFIG\_DEBUG\_ACCESSORY\_NONE)
6804                         \{
6805                             \textcolor{comment}{/* Wait for disconnection */}
6806                         \}
6807                         \textcolor{keywordflow}{else}
6808                         \{
6809                             pdInstance->\hyperlink{struct__pd__instance_aea65859fe3a8409ac66aa9f54fb119bf}{curPowerRole} = 
      \hyperlink{group__usb__pd__stack_gga46146487374ddc31d48f33b2b6a26f8ba9fdae65ce89c7d877981a3abef33a2cb}{kPD\_PowerRoleSource};
6810                             pdInstance->\hyperlink{struct__pd__instance_a766dd3de4bdd34f1eebcd41d1425327a}{curDataRole} = \hyperlink{group__usb__pd__stack_gga25760887aa95821023cc0ab5e151f828ad5849c6d513a7161652bf49bf5096e61}{kPD\_DataRoleDFP};
6811                             pdInstance->\hyperlink{struct__pd__instance_a1b1254d08a7d1b7809c37ac0e1253ed5}{psmPresentlyVconnSource} = 
      \hyperlink{group__usb__pd__stack_ggab67908aebf6cb10704f4ec6127761e28a239cd9fcbe39abba0bc8959dc1a24e37}{kPD\_IsVconnSource};
6812                         \}
6813                         \textcolor{keywordflow}{break};
6814 \textcolor{preprocessor}{#endif}
6815 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{default}:
6816                         \textcolor{keywordflow}{break};
6817                 \}
6818                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, 
      \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8afb6d14742fec55ac288edda0d928683a}{PD\_CONNECT\_ROLE\_CHANGE}, NULL, 0);
6819             \}
6820             \textcolor{comment}{/* change from connect to disconnect */}
6821             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected}) && (!(connected)))
6822             \{
6823                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac8d3cd4dd7fa3432e364a9a3d6602563}{PD\_DISCONNECTED}, NULL, 0);
6824                 \hyperlink{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344}{PD\_DpmDisconnect}(pdInstance);
6825                 pdInstance->\hyperlink{struct__pd__instance_a2edcb21b9d568937192741d32381d2b1}{initializeLabel} = 0;
6826             \}
6827             \textcolor{keywordflow}{else}
6828             \{
6829             \}
6830 
6831             pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected} = connected;
6832         \}
6833         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected}) \textcolor{comment}{/* connect result stable and connected */}
6834         \{
6835             pdInstance->\hyperlink{struct__pd__instance_abb01fbdcfbc66eba6c7d5d85e91e62e4}{noConnectButVBusExit} = 0;
6836             smState = \hyperlink{usb__pd__policy_8c_ac6e31fa3949c6ca1288f96b6c5252bba}{PD\_PsmStateMachine}(pdInstance);
6837 
6838             \textcolor{comment}{/* Force a partner disconnect if the PSM has requested a error recovery */}
6839             \textcolor{keywordflow}{if} (smState == \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a068485ee233ba1ee47e054c6e8d8490f}{kSM\_ErrorRecovery})
6840             \{
6841                 pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected} = 0;
6842                 \hyperlink{usb__pd__policy_8c_a694e9dd685d69f5b21d23e6bbee6e7d9}{PD\_DpmAppCallback}(pdInstance, \hyperlink{group__usb__pd__stack_gga6e10571af6af1a42760ea442ab580eb8ac8d3cd4dd7fa3432e364a9a3d6602563}{PD\_DISCONNECTED}, NULL, 0);
6843                 \hyperlink{usb__pd__policy_8c_abc2774ff9e02e6ff6ff4a5fb8088c344}{PD\_DpmDisconnect}(pdInstance);
6844 
6845                 \hyperlink{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4}{PD\_ConnectInitRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole}, 1);
6846                 pdInstance->\hyperlink{struct__pd__instance_a2edcb21b9d568937192741d32381d2b1}{initializeLabel} = 0;
6847                 pdInstance->\hyperlink{struct__pd__instance_a2505651a0001ea647306dbd800927778}{waitTime} = \hyperlink{usb__pd__interface_8h_ac3471f042971fd1641303f2622b844c1}{PD\_WAIT\_EVENT\_TIME};
6848             \}
6849             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (smState == \hyperlink{usb__pd__policy_8c_ad9afbdaee91955dd5e1a909853a02119a660d4f138319988dc5abf216bf0a2a44}{kSM\_Continue})
6850             \{
6851                 pdInstance->\hyperlink{struct__pd__instance_a2505651a0001ea647306dbd800927778}{waitTime} = \hyperlink{usb__pd__interface_8h_ac3471f042971fd1641303f2622b844c1}{PD\_WAIT\_EVENT\_TIME};
6852             \}
6853             \textcolor{keywordflow}{else}
6854             \{
6855                 pdInstance->\hyperlink{struct__pd__instance_a2505651a0001ea647306dbd800927778}{waitTime} = 0; \textcolor{comment}{/* wait for ever */}
6856             \}
6857         \}
6858         \textcolor{keywordflow}{else}
6859         \{
6860         \}
6861 
6862 \textcolor{preprocessor}{#if (defined PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE) && (PD\_CONFIG\_PD3\_FAST\_ROLE\_SWAP\_ENABLE)}
6863 \textcolor{preprocessor}{}        \textcolor{comment}{/* check FR\_Swap signal */}
6864         \textcolor{keywordflow}{if} (\hyperlink{group__usb__os__abstraction_gab25fb5d93d3b665ca8eadf2a670d3361}{USB\_OsaEventCheck}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ace1c61e1c2c9768ffea7e4ed3552dabd}{PD\_TASK\_EVENT\_FR\_SWAP\_SINGAL}, NULL) ==
6865             \hyperlink{group__usb__os__abstraction_gga453ebd2f93aafb8c938c3a23c815f9bdab90805fb75297fda1ca60dbb2283f933}{kStatus\_USB\_OSA\_Success})
6866         \{
6867             \textcolor{keywordflow}{if} (!(pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected}))
6868             \{
6869                 \hyperlink{group__usb__os__abstraction_ga90357f04d40469dc07104033b3c8581c}{USB\_OsaEventClear}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ace1c61e1c2c9768ffea7e4ed3552dabd}{PD\_TASK\_EVENT\_FR\_SWAP\_SINGAL});
6870 
6871                 \textcolor{comment}{/* when receiving FR\_Swap signal, PTN5110 will open source vbus defaultly.  */}
6872                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a2d9a457d63da9c4cb5e3feece0cbf3ec}{pdConfig}->\hyperlink{struct__pd__instance__config_a1f5e597bbfc0af871a5e887c34eb3aca}{phyType} == 
      \hyperlink{group__usb__pd__stack_gga8bd01601105e164bc0e0bb538aaa5c1ca6f0eabe71ca45162254c941b34558d2c}{kPD\_PhyPTN5110})
6873                 \{
6874                     pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a1afed4126bcbe1ba278eb27f31e99c9c}{PD\_SrcTurnOffVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
6875                 \}
6876             \}
6877         \}
6878 
6879         \textcolor{comment}{/* check unreasonable situation */}
6880         \textcolor{keywordflow}{if} (!(pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected}))
6881         \{
6882             \hyperlink{usb__pd__policy_8c_a555b1880b5b259c3fdcd3da821e06cf2}{PD\_PhyControl}(pdInstance, \hyperlink{group__usb__pd__phy__drv_ggab8bfca50e2ac042b47a697c88f84c3eda4a23adc388bf03852d850ff3919328d6}{PD\_PHY\_GET\_VBUS\_POWER\_STATE}, 
      &taskEventSet);
6883             \textcolor{keywordflow}{if} (taskEventSet & (\hyperlink{group__usb__pd__phy__drv_ga1f2e4aed47a47caec2aba9edb2236e42}{PD\_VBUS\_POWER\_STATE\_VSAFE5V\_MASK} | 
      \hyperlink{group__usb__pd__phy__drv_gabe6758409c7aeff91de688fe7cefa195}{PD\_VBUS\_POWER\_STATE\_VBUS\_MASK}))
6884             \{
6885                 pdInstance->\hyperlink{struct__pd__instance_abb01fbdcfbc66eba6c7d5d85e91e62e4}{noConnectButVBusExit}++;
6886                 pdInstance->\hyperlink{struct__pd__instance_a519457e415e4eb39231c3e32316ffc83}{callbackFns}->\hyperlink{struct__pd__power__callback_a1afed4126bcbe1ba278eb27f31e99c9c}{PD\_SrcTurnOffVbus}(pdInstance->
      \hyperlink{struct__pd__instance_a0eb7710a55cb5eb2a57355d772b26f74}{callbackParam}, \hyperlink{group__usb__pd__stack_gga1af9af0106a9413093f8e0d9b796771badc5ad96f1d56cc3354757de9aea78896}{kVbusPower\_Stable});
6887                 \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_abb01fbdcfbc66eba6c7d5d85e91e62e4}{noConnectButVBusExit} >= 100)
6888                 \{
6889                     \hyperlink{struct__pd__phy__config}{pd\_phy\_config\_t} phyConfig;
6890 
6891                     pdInstance->\hyperlink{struct__pd__instance_abb01fbdcfbc66eba6c7d5d85e91e62e4}{noConnectButVBusExit} = 0;
6892                     pdInstance->\hyperlink{struct__pd__instance_adbed7b2cd53df40e0611a8879c903339}{phyInterface}->\hyperlink{struct__pd__phy__api__interface_a9e36ebe547c2ed82866597b2afc54bd0}{pdPhyDeinit}(pdInstance->
      \hyperlink{struct__pd__instance_a7c1184292efe9a5ae30b6ac422c1e9f4}{pdPhyHandle});
6893                     phyConfig.\hyperlink{struct__pd__phy__config_aa5aa79cabb041cefecc0483c840f75a1}{interface} = pdInstance->\hyperlink{struct__pd__instance_a2d9a457d63da9c4cb5e3feece0cbf3ec}{pdConfig}->
      \hyperlink{struct__pd__instance__config_acb93f9cec67a95c40730be43c80d3214}{phyInterface};
6894                     phyConfig.\hyperlink{struct__pd__phy__config_aa606732850969dd6c9bd06b608e8015c}{i2cConfig}.\hyperlink{struct__pd__i2c__interface__config_abef5bc903024c7f0c489407549948987}{slaveAddress} = pdInstance->
      \hyperlink{struct__pd__instance_a2d9a457d63da9c4cb5e3feece0cbf3ec}{pdConfig}->\hyperlink{struct__pd__instance__config_a7e72c5dda8b81981ebd3062f6999bce1}{interfaceParam};
6895                     pdInstance->\hyperlink{struct__pd__instance_adbed7b2cd53df40e0611a8879c903339}{phyInterface}->\hyperlink{struct__pd__phy__api__interface_a8f9666a7543d431aec266710dbc8d78c}{pdPhyInit}(pdInstance, &(pdInstance->
      \hyperlink{struct__pd__instance_a7c1184292efe9a5ae30b6ac422c1e9f4}{pdPhyHandle}), &phyConfig);
6896                 \}
6897             \}
6898         \}
6899         \textcolor{keywordflow}{else}
6900         \{
6901             pdInstance->\hyperlink{struct__pd__instance_abb01fbdcfbc66eba6c7d5d85e91e62e4}{noConnectButVBusExit} = 0;
6902         \}
6903 \textcolor{preprocessor}{#endif}
6904 \textcolor{preprocessor}{}    \}
6905     pdInstance->\hyperlink{struct__pd__instance_aa310a61602eb5d34b4b511ce4ad60f1d}{connectedResult} = connectStatus;
6906 
6907 \textcolor{preprocessor}{#if 0}
6908 \textcolor{preprocessor}{}    \textcolor{comment}{/* unclear error recovery */}
6909     connectStatus = \hyperlink{usb__pd__policy_8c_a1fb3d7072f44bb8959b640f553c45e02}{PD\_ConnectGetStateMachine}(pdInstance);
6910     \textcolor{keywordflow}{if} (connectStatus == \hyperlink{usb__pd__policy_8c_aa173143bdf6b1a4a301e5576b364d5d6}{PD\_ConnectGetInitRoleState}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole}))
6911     \{
6912         pdInstance->typeCStateNeedRecovery++;
6913     \}
6914     \textcolor{keywordflow}{else}
6915     \{
6916         pdInstance->typeCStateNeedRecovery = 0;
6917     \}
6918     \textcolor{keywordflow}{if} ((!(pdInstance->\hyperlink{struct__pd__instance_aefbe7a5da39f65fa52efdc9cbae4d9cc}{isConnected})) && (pdInstance->typeCStateNeedRecovery >= 100))
6919     \{
6920         pdInstance->typeCStateNeedRecovery = 0;
6921         \hyperlink{usb__pd__policy_8c_ac1262f667cd36f90f205a468ba59b1d4}{PD\_ConnectInitRole}(pdInstance, pdInstance->
      \hyperlink{struct__pd__instance_aa7854ddf70e64f92b178cc5d787037a2}{pdPowerPortConfig}->\hyperlink{struct__pd__power__port__config_a649079672f270a65578bd41e0e624e16}{typecRole}, 1);
6922     \}
6923 \textcolor{preprocessor}{#endif}
6924 \textcolor{preprocessor}{}\}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{usb__pd__policy_8c_a602f8622c0ba8d21b5013537dd3dadf9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__policy_8c_a602f8622c0ba8d21b5013537dd3dadf9_icgraph}
\end{center}
\end{figure}


