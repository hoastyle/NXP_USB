\hypertarget{usb__pd__timer_8c}{\section{pd/usb\-\_\-pd\-\_\-timer.c File Reference}
\label{usb__pd__timer_8c}\index{pd/usb\-\_\-pd\-\_\-timer.\-c@{pd/usb\-\_\-pd\-\_\-timer.\-c}}
}
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-config.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-phy.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-timer.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usb\-\_\-pd\-\_\-interface.\-h\char`\"{}}\\*
Include dependency graph for usb\-\_\-pd\-\_\-timer.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{usb__pd__timer_8c_a2db2b7ebded2d6a9e062a6cc7bfce4d7}{P\-D\-\_\-\-Timer\-Callback} (\hyperlink{usb__pd__interface_8h_a1deb7ee8a70201e41a45bef369b5d692}{pd\-\_\-instance\-\_\-t} $\ast$pd\-Instance, uint8\-\_\-t timr\-Name)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{P\-D\-\_\-\-Timer\-Clear} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint8\-\_\-t timr\-Name)
\item 
\hyperlink{group__usb__pd__stack_ga04a1f331d9807a70ab9bb753f5ed1c80}{pd\-\_\-status\-\_\-t} \hyperlink{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{P\-D\-\_\-\-Timer\-Start} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint8\-\_\-t timr\-Name, uint16\-\_\-t timr\-Time)
\item 
uint8\-\_\-t \hyperlink{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{P\-D\-\_\-\-Timer\-Check\-Invalid\-Or\-Time\-Out} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint8\-\_\-t timr\-Name)
\item 
uint8\-\_\-t \hyperlink{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{P\-D\-\_\-\-Timer\-Check\-Valid\-Time\-Out} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint8\-\_\-t timr\-Name)
\item 
void \hyperlink{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}{P\-D\-\_\-\-Timer\-Cancel\-All\-Timers} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle, uint8\-\_\-t begin, uint8\-\_\-t end)
\item 
void \hyperlink{group__usb__pd__stack_gad8420ee79286dfb87b1b9d9c0845f31d}{P\-D\-\_\-\-Timer\-Isr\-Function} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle)
\begin{DoxyCompactList}\small\item\em P\-D stack timer function. \end{DoxyCompactList}\item 
void \hyperlink{usb__pd__timer_8c_ab9b44f9a09bf56e73ef27ed1adabefea}{P\-D\-\_\-\-Timer\-Init} (\hyperlink{group__usb__pd__stack_ga9397835347d48ef48b6b0ecba6312213}{pd\-\_\-handle} pd\-Handle)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{usb__pd__timer_8c_a2db2b7ebded2d6a9e062a6cc7bfce4d7}{\index{usb\-\_\-pd\-\_\-timer.\-c@{usb\-\_\-pd\-\_\-timer.\-c}!P\-D\-\_\-\-Timer\-Callback@{P\-D\-\_\-\-Timer\-Callback}}
\index{P\-D\-\_\-\-Timer\-Callback@{P\-D\-\_\-\-Timer\-Callback}!usb_pd_timer.c@{usb\-\_\-pd\-\_\-timer.\-c}}
\subsubsection[{P\-D\-\_\-\-Timer\-Callback}]{\setlength{\rightskip}{0pt plus 5cm}static void P\-D\-\_\-\-Timer\-Callback (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-instance\-\_\-t} $\ast$}]{pd\-Instance, }
\item[{uint8\-\_\-t}]{timr\-Name}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{usb__pd__timer_8c_a2db2b7ebded2d6a9e062a6cc7bfce4d7}

\begin{DoxyCode}
58 \{
59     \textcolor{keywordflow}{switch} (timrName)
60     \{
61         \textcolor{keywordflow}{case} \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa629695f4472eb942d64b013b16b37c72}{tMsgHardResetCompleteTimer}:
62             \textcolor{comment}{/* do nothing */}
63             \textcolor{keywordflow}{break};
64 \textcolor{preprocessor}{#if 0}
65 \textcolor{preprocessor}{}        \textcolor{comment}{/* if has USB function */}
66         \textcolor{keywordflow}{case} \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa39f25865d100dc5632bb838ff0e35344}{tUSBSuspendTimer}:
67         \textcolor{keywordflow}{case} \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fad7e692d3a93a14492bbc148e9a5ae62f}{tUSBTimer}:
68             \textcolor{keywordflow}{break};
69 \textcolor{preprocessor}{#endif}
70 \textcolor{preprocessor}{}
71         \textcolor{keywordflow}{default}:
72             \textcolor{comment}{/* do nothing, code will use \_PD\_TimerCheckInvalidOrTimeOut to check the timr */}
73             \hyperlink{group__usb__os__abstraction_gaa83073c31cced5742027d4046bd633db}{USB\_OsaEventSet}(pdInstance->\hyperlink{struct__pd__instance_ab04e9fcc994b2547509169e07ab21465}{taskEventHandle}, 
      \hyperlink{usb__pd__interface_8h_a08a5013301d9587b47017854a2ee5981ad67d7de3ba6594e125904b656e3f4798}{PD\_TASK\_EVENT\_TIME\_OUT});
74             \textcolor{keywordflow}{break};
75     \}
76 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=318pt]{usb__pd__timer_8c_a2db2b7ebded2d6a9e062a6cc7bfce4d7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c_a2db2b7ebded2d6a9e062a6cc7bfce4d7_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}{\index{usb\-\_\-pd\-\_\-timer.\-c@{usb\-\_\-pd\-\_\-timer.\-c}!P\-D\-\_\-\-Timer\-Cancel\-All\-Timers@{P\-D\-\_\-\-Timer\-Cancel\-All\-Timers}}
\index{P\-D\-\_\-\-Timer\-Cancel\-All\-Timers@{P\-D\-\_\-\-Timer\-Cancel\-All\-Timers}!usb_pd_timer.c@{usb\-\_\-pd\-\_\-timer.\-c}}
\subsubsection[{P\-D\-\_\-\-Timer\-Cancel\-All\-Timers}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Timer\-Cancel\-All\-Timers (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-handle}}]{pd\-Handle, }
\item[{uint8\-\_\-t}]{begin, }
\item[{uint8\-\_\-t}]{end}
\end{DoxyParamCaption}
)}}\label{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c}

\begin{DoxyCode}
139 \{
140     uint32\_t index;
141     uint32\_t bitMape;
142     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
143     \hyperlink{struct__pd__instance}{pd\_instance\_t} *pdInstance = (\hyperlink{struct__pd__instance}{pd\_instance\_t} *)pdHandle;
144 
145     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
146     \textcolor{keywordflow}{for} (index = begin; index <= end; ++index)
147     \{
148         bitMape = (0x00000001u << (index & 0x1Fu));
149         pdInstance->\hyperlink{struct__pd__instance_a00d9a2aa7fd533c3ac15236b61e894f0}{timrsRunningState}[(index / 32)] &= (~bitMape);
150         pdInstance->\hyperlink{struct__pd__instance_a4e19ba81575c13f30d4482d5ac141573}{timrsTimeOutState}[(index / 32)] &= (~bitMape);
151     \}
152     \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
153 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c_a815f84fb85fcde5a2efa4af5a02e323c_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}{\index{usb\-\_\-pd\-\_\-timer.\-c@{usb\-\_\-pd\-\_\-timer.\-c}!P\-D\-\_\-\-Timer\-Check\-Invalid\-Or\-Time\-Out@{P\-D\-\_\-\-Timer\-Check\-Invalid\-Or\-Time\-Out}}
\index{P\-D\-\_\-\-Timer\-Check\-Invalid\-Or\-Time\-Out@{P\-D\-\_\-\-Timer\-Check\-Invalid\-Or\-Time\-Out}!usb_pd_timer.c@{usb\-\_\-pd\-\_\-timer.\-c}}
\subsubsection[{P\-D\-\_\-\-Timer\-Check\-Invalid\-Or\-Time\-Out}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Timer\-Check\-Invalid\-Or\-Time\-Out (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-handle}}]{pd\-Handle, }
\item[{uint8\-\_\-t}]{timr\-Name}
\end{DoxyParamCaption}
)}}\label{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f}

\begin{DoxyCode}
116 \{
117     \hyperlink{struct__pd__instance}{pd\_instance\_t} *pdInstance = (\hyperlink{struct__pd__instance}{pd\_instance\_t} *)pdHandle;
118     \textcolor{comment}{/* timr is not running */}
119     \textcolor{keywordflow}{if} (!(pdInstance->\hyperlink{struct__pd__instance_a00d9a2aa7fd533c3ac15236b61e894f0}{timrsRunningState}[(timrName / 32)] & (0x00000001u << (timrName & 0
      x1Fu))))
120     \{
121         \textcolor{keywordflow}{return} 1;
122     \}
123 
124     \textcolor{keywordflow}{return} 0;
125 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c_a3d4072fbbc7b10a05c795eaf9ed33f5f_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}{\index{usb\-\_\-pd\-\_\-timer.\-c@{usb\-\_\-pd\-\_\-timer.\-c}!P\-D\-\_\-\-Timer\-Check\-Valid\-Time\-Out@{P\-D\-\_\-\-Timer\-Check\-Valid\-Time\-Out}}
\index{P\-D\-\_\-\-Timer\-Check\-Valid\-Time\-Out@{P\-D\-\_\-\-Timer\-Check\-Valid\-Time\-Out}!usb_pd_timer.c@{usb\-\_\-pd\-\_\-timer.\-c}}
\subsubsection[{P\-D\-\_\-\-Timer\-Check\-Valid\-Time\-Out}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t P\-D\-\_\-\-Timer\-Check\-Valid\-Time\-Out (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-handle}}]{pd\-Handle, }
\item[{uint8\-\_\-t}]{timr\-Name}
\end{DoxyParamCaption}
)}}\label{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c}

\begin{DoxyCode}
128 \{
129     \hyperlink{struct__pd__instance}{pd\_instance\_t} *pdInstance = (\hyperlink{struct__pd__instance}{pd\_instance\_t} *)pdHandle;
130     \textcolor{keywordflow}{if} (pdInstance->\hyperlink{struct__pd__instance_a4e19ba81575c13f30d4482d5ac141573}{timrsTimeOutState}[(timrName / 32)] & (0x00000001u << (timrName & 0x1Fu
      )))
131     \{
132         \textcolor{keywordflow}{return} 1;
133     \}
134 
135     \textcolor{keywordflow}{return} 0;
136 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c_afd2f667e16635d3db0523f13afe7610c_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}{\index{usb\-\_\-pd\-\_\-timer.\-c@{usb\-\_\-pd\-\_\-timer.\-c}!P\-D\-\_\-\-Timer\-Clear@{P\-D\-\_\-\-Timer\-Clear}}
\index{P\-D\-\_\-\-Timer\-Clear@{P\-D\-\_\-\-Timer\-Clear}!usb_pd_timer.c@{usb\-\_\-pd\-\_\-timer.\-c}}
\subsubsection[{P\-D\-\_\-\-Timer\-Clear}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Timer\-Clear (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-handle}}]{pd\-Handle, }
\item[{uint8\-\_\-t}]{timr\-Name}
\end{DoxyParamCaption}
)}}\label{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5}

\begin{DoxyCode}
79 \{
80     uint32\_t bitMape;
81     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
82     \hyperlink{struct__pd__instance}{pd\_instance\_t} *pdInstance = (\hyperlink{struct__pd__instance}{pd\_instance\_t} *)pdHandle;
83 
84     bitMape = (0x00000001u << (timrName & 0x1Fu));
85 
86     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
87     pdInstance->\hyperlink{struct__pd__instance_a00d9a2aa7fd533c3ac15236b61e894f0}{timrsRunningState}[(timrName / 32)] &= (~bitMape);
88     pdInstance->\hyperlink{struct__pd__instance_a4e19ba81575c13f30d4482d5ac141573}{timrsTimeOutState}[(timrName / 32)] &= (~bitMape);
89     \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
90 
91     \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success};
92 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c_a453ba4a7609afd86d5e6b9fb8759b6b5_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__timer_8c_ab9b44f9a09bf56e73ef27ed1adabefea}{\index{usb\-\_\-pd\-\_\-timer.\-c@{usb\-\_\-pd\-\_\-timer.\-c}!P\-D\-\_\-\-Timer\-Init@{P\-D\-\_\-\-Timer\-Init}}
\index{P\-D\-\_\-\-Timer\-Init@{P\-D\-\_\-\-Timer\-Init}!usb_pd_timer.c@{usb\-\_\-pd\-\_\-timer.\-c}}
\subsubsection[{P\-D\-\_\-\-Timer\-Init}]{\setlength{\rightskip}{0pt plus 5cm}void P\-D\-\_\-\-Timer\-Init (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-handle}}]{pd\-Handle}
\end{DoxyParamCaption}
)}}\label{usb__pd__timer_8c_ab9b44f9a09bf56e73ef27ed1adabefea}

\begin{DoxyCode}
190 \{
191     uint32\_t index32;
192     \hyperlink{struct__pd__instance}{pd\_instance\_t} *pdInstance = (\hyperlink{struct__pd__instance}{pd\_instance\_t} *)pdHandle;
193 
194     \textcolor{comment}{// tTimerCount是timer的个数，初始化所有timer的相关变量，包括state和value}
195     \textcolor{keywordflow}{for} (index32 = 0; index32 < ((\hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa208e3a31f39a2eafdaa34d97ae09cd6f}{tTimerCount} + 31) / 32); ++index32)
196     \{
197         pdInstance->\hyperlink{struct__pd__instance_a00d9a2aa7fd533c3ac15236b61e894f0}{timrsRunningState}[index32] = 0;
198         pdInstance->\hyperlink{struct__pd__instance_a4e19ba81575c13f30d4482d5ac141573}{timrsTimeOutState}[index32] = 0;
199     \}
200     \textcolor{keywordflow}{for} (index32 = 0; index32 < \hyperlink{usb__pd__timer_8h_a94e23fe7d4bf2bf6f8de1f51126d071fa208e3a31f39a2eafdaa34d97ae09cd6f}{tTimerCount}; ++index32)
201     \{
202         pdInstance->\hyperlink{struct__pd__instance_a10267d00b21df313fb3064255d161d6b}{timrsTimeValue}[index32] = 0;
203     \}
204 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c_ab9b44f9a09bf56e73ef27ed1adabefea_icgraph}
\end{center}
\end{figure}


\hypertarget{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}{\index{usb\-\_\-pd\-\_\-timer.\-c@{usb\-\_\-pd\-\_\-timer.\-c}!P\-D\-\_\-\-Timer\-Start@{P\-D\-\_\-\-Timer\-Start}}
\index{P\-D\-\_\-\-Timer\-Start@{P\-D\-\_\-\-Timer\-Start}!usb_pd_timer.c@{usb\-\_\-pd\-\_\-timer.\-c}}
\subsubsection[{P\-D\-\_\-\-Timer\-Start}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pd\-\_\-status\-\_\-t} P\-D\-\_\-\-Timer\-Start (
\begin{DoxyParamCaption}
\item[{{\bf pd\-\_\-handle}}]{pd\-Handle, }
\item[{uint8\-\_\-t}]{timr\-Name, }
\item[{uint16\-\_\-t}]{timr\-Time}
\end{DoxyParamCaption}
)}}\label{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f}

\begin{DoxyCode}
95 \{
96     uint32\_t bitMape;
97     \hyperlink{usb__osa__bm_8h_a8dbccf46cc2f8e3b5cece6a4a84f7ae8}{USB\_OSA\_SR\_ALLOC}();
98     \hyperlink{struct__pd__instance}{pd\_instance\_t} *pdInstance = (\hyperlink{struct__pd__instance}{pd\_instance\_t} *)pdHandle;
99 
100     \textcolor{keywordflow}{if} (timrTime == 0)
101     \{
102         \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073a4d58370b8ee8d3d2a4c477f7a3f84dda}{kStatus\_PD\_Error};
103     \}
104 
105     bitMape = (0x00000001u << (timrName & 0x1Fu));
106 
107     \hyperlink{usb__osa__bm_8h_a0485f70bf9c9a22f0340f014bc567362}{USB\_OSA\_ENTER\_CRITICAL}();
108     pdInstance->\hyperlink{struct__pd__instance_a10267d00b21df313fb3064255d161d6b}{timrsTimeValue}[timrName] = timrTime;
109     pdInstance->\hyperlink{struct__pd__instance_a4e19ba81575c13f30d4482d5ac141573}{timrsTimeOutState}[(timrName / 32)] &= (~(bitMape));
110     pdInstance->\hyperlink{struct__pd__instance_a00d9a2aa7fd533c3ac15236b61e894f0}{timrsRunningState}[(timrName / 32)] |= bitMape;
111     \hyperlink{usb__osa__bm_8h_a5b8053eca19b6df666a26fad3b07f953}{USB\_OSA\_EXIT\_CRITICAL}();
112     \textcolor{keywordflow}{return} \hyperlink{group__usb__pd__stack_ggaaad4cd00dd02567c6169429e3a895073acf06f954f9c52f560cea34df48c63555}{kStatus\_PD\_Success};
113 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{usb__pd__timer_8c_afa3b5394c429c185ea93be16ddb1545f_icgraph}
\end{center}
\end{figure}


